function handlePageChange(a){var b=chrome.extension.getURL("");a.url.substr(0,b.length)===b?theTab?a.id!=theTab.id&&(console.log("Duplicate TweetDeck page"),chrome.tabs.remove(a.id),TD.bg.utils.showTDTab()):(console.log("TweetDeck page created"),theTab=a):theTab&&a.id==theTab.id&&(console.log("User has navigated away"),handlePageDeath(a.id))}function handlePageDeath(a){if(theTab&&a==theTab.id){console.log("TweetDeck page closed"),theTab=null;var b=[];for(var c in TD.bg.streamRequests)TD.bg.streamRequests.hasOwnProperty(c)&&b.push(TD.bg.streamRequests[c]);for(var d=0;d<b.length;d++)b[d].deleteLater()}}TD={bg:{},util:{}},TD.util.isChromeApp=function(){return!0},TD.bg.init=function(){TD.bg.contextMenu.init()};var theTab=null;chrome.tabs.onCreated.addListener(function(a){handlePageChange(a)}),chrome.tabs.onUpdated.addListener(function(a,b,c){b.url&&handlePageChange(c)}),chrome.tabs.onRemoved.addListener(function(a){handlePageDeath(a)}),TD.util.i18n=function(){var a={},b,c,d=function(a){if(typeof TD_locale_messages=="undefined")return undefined;var b=TD_locale_messages[a];return b&&b.message?b.message:undefined},e=function(a){var b=deck.i18n(a);return b?b:undefined};return a.getMessage=function(a){return b||(TD.util.isChromeApp()?b=chrome.i18n.getMessage:TD.util.isWrapperApp()?b=e:b=d),b(a)},a.getLocale=function(){return c?c:(TD.util.isChromeApp()&&(c=a.getMessage("@@ui_locale")),c)},a}(),TD.i=function(){var a=/[^A-Za-z0-9_]/g,b={};return function(c,d,e){var f,g,h;return typeof c=="string"&&(c={text:c}),TD.util.i18n.getLocale()==="en_US"?h=c.text:(f=b[c.text],f===undefined&&(f=c.text.replace(a,""),b[c.text]=f),h=TD.util.i18n.getMessage(f)||c.text),e||(h=TD.ui.template.toHtml(h,d)),h}}(),TD.buildID="9cd94b5a7c5a7cc7a7a68cb76f720043a14720eb",TD.buildIDShort="9cd94b5",TD.version="1.5.7",TD.config={api_root:"https://api.tweetdeck.com",td_create_key:"WRaMQNHU2Jy51bhFEL3C",td_create_secret:"MiLkmD1t1xlZqKoLLY8ScxX5gwpOQsjBopZcV4KLcuo=",client_name:"blackbird",debug_menu:!1,app_name:"TweetDeck",app_icon:"web/assets/logos/128.png",sync_name:"blackbird"},TD.bg.utils={},TD.bg.utils.getActiveTabWindow=function(){var a=chrome.extension.getViews(),b;for(var c=0;c<a.length;c++){b=a[c];if(b.location.href==theTab.url)return b}},TD.bg.utils.showTDTab=function(){if(!theTab)return;var a=this,b=function(a){theTab=a,chrome.windows.get(a.windowId,c)},c=function(a){a.focused||chrome.windows.update(a.id,{focused:!0})};chrome.tabs.get(theTab.id,b),chrome.tabs.update(theTab.id,{selected:!0})},TD.bg.utils.focusOrOpenTDTab=function(a){var b=function(){var b=TD.bg.utils.getActiveTabWindow(),c=function(){if(b.TD&&b.TD.ready){a(b.TD);return}setTimeout(c,500)};c()};theTab&&theTab.id?(TD.bg.utils.showTDTab(),b()):chrome.tabs.create({url:"templates/default.html"},function(a){setTimeout(function(){b()},100)})},TD.bg.streamRequests={},TD.bg.StreamRequest=function(a,b,c){var d=function(){console.log((new Date).toUTCString(),">",c.getUsername(),">",arguments)};this.receivedChars=0;var e=this,f,g,h,i,j,k=c.getUserID(),l=TD.bg.streamRequests[k];l&&(d("Replacing duplicate StreamRequest"),l.deleteLater()),TD.bg.streamRequests[k]=this;var m=function(){var d=b+"/oauth/echo/twitter/"+encodeURIComponent(a);i=new XMLHttpRequest,i.open("GET",d),i.setRequestHeader("x-td-oauth-key",c.getOAuthToken()),i.setRequestHeader("x-td-oauth-secret",c.getTokenSecret()),i.setRequestHeader("x-td-oauth-service","twitter"),i.onreadystatechange=n,i.send()},n=function(){switch(i.readyState){case XMLHttpRequest.DONE:d("Signer HTTP status:",i.status),i.status===200?(h=JSON.parse(i.responseText).headers.Authorization,o()):r("Failed to sign request",0)}},o=function(){j=new XMLHttpRequest,j.open("GET",a),j.setRequestHeader("Authorization",h),j.setRequestHeader("X-User-Agent","TweetDeck Chrome "+TD.version),j.onreadystatechange=p,j.send()},p=function(){switch(j.readyState){case XMLHttpRequest.HEADERS_RECEIVED:d("Stream HTTP status:",j.status);break;case XMLHttpRequest.LOADING:var a=j.responseText.slice(e.receivedChars),b=a.split("\r"),c,f;e.receivedChars+=a.length,a.charAt(a.length-1)!=="\r"&&(c=b.pop(),e.receivedChars-=c.length);for(f=0;f<b.length;f++)q(b[f]);break;case XMLHttpRequest.DONE:r("Stream interrupted",j.status)}},q=function(a){f&&f(a)},r=function(a,b){g&&g(a,b)};this.onStreaming={connect:function(a){f=a},disconnect:function(a){f===a&&(f=null)}},this.onFailure={connect:function(a){g=a},disconnect:function(a){g===a&&(g=null)}},this.goStreaming=function(){m()},this.deleteLater=function(){d("Closing stream connection"),i&&(i.onreadystatechange=null,i.abort()),j&&(j.onreadystatechange=null,j.abort()),q=null,r=null,delete TD.bg.streamRequests[k]}},TD.bg.contextMenu=function(){var a={},b=chrome.contextMenus,c=chrome.i18n.getMessage,d=function(a,b){var c;a.linkUrl?c=a.linkUrl:(b&&b.title&&(c=b.title,c.length>100&&(c=c.substr(0,100)+"â€¦"),c+=" "),c+=a.pageUrl),TD.bg.utils.focusOrOpenTDTab(function(a){a.ui.compose.showComposeWindow(c+" ")})};return a.init=function(){b.create({title:TD.i("Share page with TweetDeck",null,!0),onclick:d}),b.create({title:TD.i("Share link with TweetDeck",null,!0),onclick:d,contexts:["link"]})},a}();