window.Modernizr=function(a,b,c){function D(a){j.cssText=a}function E(a,b){return D(n.join(a+";")+(b||""))}function F(a,b){return typeof a===b}function G(a,b){return!!~(""+a).indexOf(b)}function H(a,b){for(var d in a)if(j[a[d]]!==c)return b=="pfx"?a[d]:!0;return!1}function I(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:F(f,"function")?f.bind(d||b):f}return!1}function J(a,b,c){var d=a.charAt(0).toUpperCase()+a.substr(1),e=(a+" "+p.join(d+" ")+d).split(" ");return F(b,"string")||F(b,"undefined")?H(e,b):(e=(a+" "+q.join(d+" ")+d).split(" "),I(e,b,c))}function L(){e.input=function(c){for(var d=0,e=c.length;d<e;d++)u[c[d]]=c[d]in k;return u.list&&(u.list=!!b.createElement("datalist")&&!!a.HTMLDataListElement),u}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),e.inputtypes=function(a){for(var d=0,e,f,h,i=a.length;d<i;d++)k.setAttribute("type",f=a[d]),e=k.type!=="text",e&&(k.value=l,k.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(f)&&k.style.WebkitAppearance!==c?(g.appendChild(k),h=b.defaultView,e=h.getComputedStyle&&h.getComputedStyle(k,null).WebkitAppearance!=="textfield"&&k.offsetHeight!==0,g.removeChild(k)):/^(search|tel)$/.test(f)||(/^(url|email)$/.test(f)?e=k.checkValidity&&k.checkValidity()===!1:/^color$/.test(f)?(g.appendChild(k),g.offsetWidth,e=k.value!=l,g.removeChild(k)):e=k.value!=l)),t[a[d]]=!!e;return t}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var d="2.5.3",e={},f=!0,g=b.documentElement,h="modernizr",i=b.createElement(h),j=i.style,k=b.createElement("input"),l=":)",m={}.toString,n=" -webkit- -moz- -o- -ms- ".split(" "),o="Webkit Moz O ms",p=o.split(" "),q=o.toLowerCase().split(" "),r={svg:"http://www.w3.org/2000/svg"},s={},t={},u={},v=[],w=v.slice,x,y=function(a,c,d,e){var f,i,j,k=b.createElement("div"),l=b.body,m=l?l:b.createElement("body");if(parseInt(d,10))while(d--)j=b.createElement("div"),j.id=e?e[d]:h+(d+1),k.appendChild(j);return f=["&#173;","<style>",a,"</style>"].join(""),k.id=h,(l?k:m).innerHTML+=f,m.appendChild(k),l||(m.style.background="",g.appendChild(m)),i=c(k,a),l?k.parentNode.removeChild(k):m.parentNode.removeChild(m),!!i},z=function(b){var c=a.matchMedia||a.msMatchMedia;if(c)return c(b).matches;var d;return y("@media "+b+" { #"+h+" { position: absolute; } }",function(b){d=(a.getComputedStyle?getComputedStyle(b,null):b.currentStyle).position=="absolute"}),d},A=function(){function d(d,e){e=e||b.createElement(a[d]||"div"),d="on"+d;var f=d in e;return f||(e.setAttribute||(e=b.createElement("div")),e.setAttribute&&e.removeAttribute&&(e.setAttribute(d,""),f=F(e[d],"function"),F(e[d],"undefined")||(e[d]=c),e.removeAttribute(d))),e=null,f}var a={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return d}(),B={}.hasOwnProperty,C;!F(B,"undefined")&&!F(B.call,"undefined")?C=function(a,b){return B.call(a,b)}:C=function(a,b){return b in a&&F(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if(typeof b!="function")throw new TypeError;var c=w.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(w.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(w.call(arguments)))};return d});var K=function(c,d){var f=c.join(""),g=d.length;y(f,function(c,d){var f=b.styleSheets[b.styleSheets.length-1],h=f?f.cssRules&&f.cssRules[0]?f.cssRules[0].cssText:f.cssText||"":"",i=c.childNodes,j={};while(g--)j[i[g].id]=i[g];e.touch="ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch||(j.touch&&j.touch.offsetTop)===9,e.csstransforms3d=(j.csstransforms3d&&j.csstransforms3d.offsetLeft)===9&&j.csstransforms3d.offsetHeight===3,e.generatedcontent=(j.generatedcontent&&j.generatedcontent.offsetHeight)>=1,e.fontface=/src/i.test(h)&&h.indexOf(d.split(" ")[0])===0},g,d)}(['@font-face {font-family:"font";src:url("https://")}',["@media (",n.join("touch-enabled),("),h,")","{#touch{top:9px;position:absolute}}"].join(""),["@media (",n.join("transform-3d),("),h,")","{#csstransforms3d{left:9px;position:absolute;height:3px;}}"].join(""),['#generatedcontent:after{content:"',l,'";visibility:hidden}'].join("")],["fontface","touch","csstransforms3d","generatedcontent"]);s.flexbox=function(){return J("flexOrder")},s["flexbox-legacy"]=function(){return J("boxDirection")},s.canvas=function(){var a=b.createElement("canvas");return!!a.getContext&&!!a.getContext("2d")},s.canvastext=function(){return!!e.canvas&&!!F(b.createElement("canvas").getContext("2d").fillText,"function")},s.webgl=function(){return!!a.WebGLRenderingContext},s.touch=function(){return e.touch},s.geolocation=function(){return!!navigator.geolocation},s.postmessage=function(){return!!a.postMessage},s.websqldatabase=function(){return!!a.openDatabase},s.indexedDB=function(){return!!J("indexedDB",a)},s.hashchange=function(){return A("hashchange",a)&&(b.documentMode===c||b.documentMode>7)},s.history=function(){return!!a.history&&!!history.pushState},s.draganddrop=function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a},s.websockets=function(){for(var b=-1,c=p.length;++b<c;)if(a[p[b]+"WebSocket"])return!0;return"WebSocket"in a},s.rgba=function(){return D("background-color:rgba(150,255,150,.5)"),G(j.backgroundColor,"rgba")},s.hsla=function(){return D("background-color:hsla(120,40%,100%,.5)"),G(j.backgroundColor,"rgba")||G(j.backgroundColor,"hsla")},s.multiplebgs=function(){return D("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(j.background)},s.backgroundsize=function(){return J("backgroundSize")},s.borderimage=function(){return J("borderImage")},s.borderradius=function(){return J("borderRadius")},s.boxshadow=function(){return J("boxShadow")},s.textshadow=function(){return b.createElement("div").style.textShadow===""},s.opacity=function(){return E("opacity:.55"),/^0.55$/.test(j.opacity)},s.cssanimations=function(){return J("animationName")},s.csscolumns=function(){return J("columnCount")},s.cssgradients=function(){var a="background-image:",b="gradient(linear,left top,right bottom,from(#9f9),to(white));",c="linear-gradient(left top,#9f9, white);";return D((a+"-webkit- ".split(" ").join(b+a)+n.join(c+a)).slice(0,-a.length)),G(j.backgroundImage,"gradient")},s.cssreflections=function(){return J("boxReflect")},s.csstransforms=function(){return!!J("transform")},s.csstransforms3d=function(){var a=!!J("perspective");return a&&"webkitPerspective"in g.style&&(a=e.csstransforms3d),a},s.csstransitions=function(){return J("transition")},s.fontface=function(){return e.fontface},s.generatedcontent=function(){return e.generatedcontent},s.video=function(){var a=b.createElement("video"),c=!1;try{if(c=!!a.canPlayType)c=new Boolean(c),c.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),c.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}catch(d){}return c},s.audio=function(){var a=b.createElement("audio"),c=!1;try{if(c=!!a.canPlayType)c=new Boolean(c),c.ogg=a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),c.mp3=a.canPlayType("audio/mpeg;").replace(/^no$/,""),c.wav=a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),c.m4a=(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,"")}catch(d){}return c},s.localstorage=function(){try{return localStorage.setItem(h,h),localStorage.removeItem(h),!0}catch(a){return!1}},s.sessionstorage=function(){try{return sessionStorage.setItem(h,h),sessionStorage.removeItem(h),!0}catch(a){return!1}},s.webworkers=function(){return!!a.Worker},s.applicationcache=function(){return!!a.applicationCache},s.svg=function(){return!!b.createElementNS&&!!b.createElementNS(r.svg,"svg").createSVGRect},s.inlinesvg=function(){var a=b.createElement("div");return a.innerHTML="<svg/>",(a.firstChild&&a.firstChild.namespaceURI)==r.svg},s.smil=function(){return!!b.createElementNS&&/SVGAnimate/.test(m.call(b.createElementNS(r.svg,"animate")))},s.svgclippaths=function(){return!!b.createElementNS&&/SVGClipPath/.test(m.call(b.createElementNS(r.svg,"clipPath")))};for(var M in s)C(s,M)&&(x=M.toLowerCase(),e[x]=s[M](),v.push((e[x]?"":"no-")+x));return e.input||L(),e.addTest=function(a,b){if(typeof a=="object")for(var d in a)C(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b=="function"?b():b,g.className+=" "+(b?"":"no-")+a,e[a]=b}return e},D(""),i=k=null,function(a,b){function g(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function h(){var a=k.elements;return typeof a=="string"?a.split(" "):a}function i(a){var b={},c=a.createElement,e=a.createDocumentFragment,f=e();a.createElement=function(a){var e=(b[a]||(b[a]=c(a))).cloneNode();return k.shivMethods&&e.canHaveChildren&&!d.test(a)?f.appendChild(e):e},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+h().join().replace(/\w+/g,function(a){return b[a]=c(a),f.createElement(a),'c("'+a+'")'})+");return n}")(k,f)}function j(a){var b;return a.documentShived?a:(k.shivCSS&&!e&&(b=!!g(a,"article,aside,details,figcaption,figure,footer,header,hgroup,nav,section{display:block}audio{display:none}canvas,video{display:inline-block;*display:inline;*zoom:1}[hidden]{display:none}audio[controls]{display:inline-block;*display:inline;*zoom:1}mark{background:#FF0;color:#000}")),f||(b=!i(a)),b&&(a.documentShived=b),a)}var c=a.html5||{},d=/^<|^(?:button|form|map|select|textarea)$/i,e,f;(function(){var a=b.createElement("a");a.innerHTML="<xyz></xyz>",e="hidden"in a,f=a.childNodes.length==1||function(){try{b.createElement("a")}catch(a){return!0}var c=b.createDocumentFragment();return typeof c.cloneNode=="undefined"||typeof c.createDocumentFragment=="undefined"||typeof c.createElement=="undefined"}()})();var k={elements:c.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:c.shivCSS!==!1,shivMethods:c.shivMethods!==!1,type:"default",shivDocument:j};a.html5=k,j(b)}(this,b),e._version=d,e._prefixes=n,e._domPrefixes=q,e._cssomPrefixes=p,e.mq=z,e.hasEvent=A,e.testProp=function(a){return H([a])},e.testAllProps=J,e.testStyles=y,e.prefixed=function(a,b,c){return b?J(a,b,c):J(a,"pfx")},g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(f?" js "+v.join(" "):""),e}(this,this.document);var TD={storage:{},core:{},net:{},mustaches:typeof TD_mustaches=="undefined"?{}:TD_mustaches,templates:{},components:{},services:{},controller:{auth:{}},vo:{},ui:{},sync:{},cache:{}};TD.buildID="9cd94b5a7c5a7cc7a7a68cb76f720043a14720eb",TD.buildIDShort="9cd94b5",TD.version="1.5.7",TD.config={api_root:"https://api.tweetdeck.com",td_create_key:"WRaMQNHU2Jy51bhFEL3C",td_create_secret:"MiLkmD1t1xlZqKoLLY8ScxX5gwpOQsjBopZcV4KLcuo=",client_name:"blackbird",debug_menu:!1,app_name:"TweetDeck",app_icon:"web/assets/logos/128.png",sync_name:"blackbird"},TD.i=function(){var a=/[^A-Za-z0-9_]/g,b={};return function(c,d,e){var f,g,h;return typeof c=="string"&&(c={text:c}),TD.util.i18n.getLocale()==="en_US"?h=c.text:(f=b[c.text],f===undefined&&(f=c.text.replace(a,""),b[c.text]=f),h=TD.util.i18n.getMessage(f)||c.text),e||(h=TD.ui.template.toHtml(h,d)),h}}();var Hogan={};(function(a,b){function c(a,b,c,d){function e(){}function f(){}e.prototype=a,f.prototype=a.subs;var g,h=new e;h.subs=new f,h.subsText={},h.ib();for(g in b)h.subs[g]=b[g],h.subsText[g]=d;for(g in c)h.partials[g]=c[g];return h}function j(a){return String(a===null||a===undefined?"":a)}function k(a){return a=j(a),i.test(a)?a.replace(d,"&amp;").replace(e,"&lt;").replace(f,"&gt;").replace(g,"&#39;").replace(h,"&quot;"):a}a.Template=function(a,b,c,d){a=a||{},this.r=a.code||this.r,this.c=c,this.options=d,this.text=b||"",this.partials=a.partials||{},this.subs=a.subs||{},this.ib()},a.Template.prototype={r:function(a,b,c){return""},v:k,t:j,render:function(a,b,c){return this.ri([a],b||{},c)},ri:function(a,b,c){return this.r(a,b,c)},ep:function(a,b){var d=this.partials[a],e=b[d.name];if(d.instance&&d.base==e)return d.instance;if(typeof e=="string"){if(!this.c)throw new Error("No compiler available.");e=this.c.compile(e,this.options)}return e?(this.partials[a].base=e,d.subs&&(e=c(e,d.subs,d.partials,this.text)),this.partials[a].instance=e,e):null},rp:function(a,b,c,d){var e=this.ep(a,c);return e?e.ri(b,c,d):""},rs:function(a,b,c){var d=a[a.length-1];if(!l(d)){c(a,b,this);return}for(var e=0;e<d.length;e++)a.push(d[e]),c(a,b,this),a.pop()},s:function(a,b,c,d,e,f,g){var h;return l(a)&&a.length===0?!1:(typeof a=="function"&&(a=this.ms(a,b,c,d,e,f,g)),h=a===""||!!a,!d&&h&&b&&b.push(typeof a=="object"?a:b[b.length-1]),h)},d:function(a,b,c,d){var e=a.split("."),f=this.f(e[0],b,c,d),g=null;if(a==="."&&l(b[b.length-2]))f=b[b.length-1];else for(var h=1;h<e.length;h++)f&&typeof f=="object"&&f[e[h]]!=null?(g=f,f=f[e[h]]):f="";return d&&!f?!1:(!d&&typeof f=="function"&&(b.push(g),f=this.mv(f,b,c),b.pop()),f)},f:function(a,b,c,d){var e=!1,f=null,g=!1;for(var h=b.length-1;h>=0;h--){f=b[h];if(f&&typeof f=="object"&&f[a]!=null){e=f[a],g=!0;break}}return g?(!d&&typeof e=="function"&&(e=this.mv(e,b,c)),e):d?!1:""},ls:function(a,b,c,d,e){var f=this.options.delimiters;return this.options.delimiters=e,this.b(this.ct(j(a.call(b,d)),b,c)),this.options.delimiters=f,!1},ct:function(a,b,c){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(a,this.options).render(b,c)},b:b?function(a){this.buf.push(a)}:function(a){this.buf+=a},fl:b?function(){var a=this.buf.join("");return this.buf=[],a}:function(){var a=this.buf;return this.buf="",a},ib:function(){this.buf=b?[]:""},ms:function(a,b,c,d,e,f,g){var h,i=b[b.length-1],j=a.call(i);return typeof j=="function"?d?!0:(h=this.activeSub&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(j,i,c,h.substring(e,f),g)):j},mv:function(a,b,c){var d=b[b.length-1],e=a.call(d);return typeof e=="function"?this.ct(j(e.call(d)),d,c):e},sub:function(a,b,c,d){var e=this.subs[a];e&&(this.activeSub=a,e(b,c,this,d),this.activeSub=!1)}};var d=/&/g,e=/</g,f=/>/g,g=/\'/g,h=/\"/g,i=/[&<>\"\']/,l=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"}})(typeof exports!="undefined"?exports:Hogan),function(a){function g(a){a.n.substr(a.n.length-1)==="}"&&(a.n=a.n.substring(0,a.n.length-1))}function h(a){return a.trim?a.trim():a.replace(/^\s*|\s*$/g,"")}function i(a,b,c){if(b.charAt(c)!=a.charAt(0))return!1;for(var d=1,e=a.length;d<e;d++)if(b.charAt(c+d)!=a.charAt(d))return!1;return!0}function k(b,c,d,e){var f=[],g=null,h=null,i=null;h=d[d.length-1];while(b.length>0){i=b.shift();if(!(!h||h.tag!="<"||i.tag in j))throw new Error("Illegal content in < super tag.");if(a.tags[i.tag]<=a.tags.$||l(i,e))d.push(i),i.nodes=k(b,i.tag,d,e);else{if(i.tag=="/"){if(d.length===0)throw new Error("Closing tag without opener: /"+i.n);g=d.pop();if(i.n!=g.n&&!m(i.n,g.n,e))throw new Error("Nesting error: "+g.n+" vs. "+i.n);return g.end=i.i,f}i.tag=="\n"&&(i.last=b.length==0||b[0].tag=="\n")}f.push(i)}if(d.length>0)throw new Error("missing closing tag: "+d.pop().n);return f}function l(a,b){for(var c=0,d=b.length;c<d;c++)if(b[c].o==a.n)return a.tag="#",!0}function m(a,b,c){for(var d=0,e=c.length;d<e;d++)if(c[d].c==a&&c[d].o==b)return!0}function n(a){var b=[];for(var c in a)b.push('"'+q(c)+'": function(c,p,t,i) {'+a[c]+"}");return"{ "+b.join(",")+" }"}function o(a){var b=[];for(var c in a.partials)b.push('"'+q(c)+'":{name:"'+q(a.partials[c].name)+'", '+o(a.partials[c])+"}");return"partials: {"+b.join(",")+"}, subs: "+n(a.subs)}function q(a){return a.replace(f,"\\\\").replace(c,'\\"').replace(d,"\\n").replace(e,"\\r")}function r(a){return~a.indexOf(".")?"d":"f"}function s(a,b){var c="<"+(b.prefix||""),d=c+a.n+p++;return b.partials[d]={name:a.n,partials:{}},b.code+='t.b(t.rp("'+q(d)+'",c,p,"'+(a.indent||"")+'"));',d}function t(a,b){b.code+="t.b(t.t(t."+r(a.n)+'("'+q(a.n)+'",c,p,0)));'}function u(a){return"t.b("+a+");"}var b=/\S/,c=/\"/g,d=/\n/g,e=/\r/g,f=/\\/g;a.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12},a.scan=function v(c,d){function v(){o.length>0&&(p.push({tag:"_t",text:new String(o)}),o="")}function w(){var c=!0;for(var d=s;d<p.length;d++){c=a.tags[p[d].tag]<a.tags._v||p[d].tag=="_t"&&p[d].text.match(b)===null;if(!c)return!1}return c}function x(a,b){v();if(a&&w())for(var c=s,d;c<p.length;c++)p[c].text&&((d=p[c+1])&&d.tag==">"&&(d.indent=p[c].text.toString()),p.splice(c,1));else b||p.push({tag:"\n"});q=!1,s=p.length}function y(a,b){var c="="+u,d=a.indexOf(c,b),e=h(a.substring(a.indexOf("=",b)+1,d)).split(" ");return t=e[0],u=e[1],d+c.length-1}var e=c.length,f=0,j=1,k=2,l=f,m=null,n=null,o="",p=[],q=!1,r=0,s=0,t="{{",u="}}";d&&(d=d.split(" "),t=d[0],u=d[1]);for(r=0;r<e;r++)l==f?i(t,c,r)?(--r,v(),l=j):c.charAt(r)=="\n"?x(q):o+=c.charAt(r):l==j?(r+=t.length-1,n=a.tags[c.charAt(r+1)],m=n?c.charAt(r+1):"_v",m=="="?(r=y(c,r),l=f):(n&&r++,l=k),q=r):i(u,c,r)?(p.push({tag:m,n:h(o),otag:t,ctag:u,i:m=="/"?q-t.length:r+u.length}),o="",r+=u.length-1,l=f,m=="{"&&(u=="}}"?r++:g(p[p.length-1]))):o+=c.charAt(r);return x(q,!0),p};var j={_t:!0,"\n":!0,$:!0,"/":!0};a.stringify=function(b,c,d){return"{code: function (c,p,i) { "+a.wrapMain(b.code)+" },"+o(b)+"}"};var p=0;a.generate=function(b,c,d){p=0;var e={code:"",subs:{},partials:{}};return a.walk(b,e),d.asString?this.stringify(e,c,d):this.makeTemplate(e,c,d)},a.wrapMain=function(a){return'var t=this;t.b(i=i||"");'+a+"return t.fl();"},a.template=a.Template,a.makeTemplate=function(a,b,c){var d=this.makePartials(a);return d.code=new Function("c","p","i",this.wrapMain(a.code)),new this.template(d,b,this,c)},a.makePartials=function(a){var b,c={subs:{},partials:a.partials,name:a.name};for(b in c.partials)c.partials[b]=this.makePartials(c.partials[b]);for(b in a.subs)c.subs[b]=new Function("c","p","t","i",a.subs[b]);return c},a.codegen={"#":function(b,c){c.code+="if(t.s(t."+r(b.n)+'("'+q(b.n)+'",c,p,1),'+"c,p,0,"+b.i+","+b.end+',"'+b.otag+" "+b.ctag+'")){'+"t.rs(c,p,"+"function(c,p,t){",a.walk(b.nodes,c),c.code+="});c.pop();}"},"^":function(b,c){c.code+="if(!t.s(t."+r(b.n)+'("'+q(b.n)+'",c,p,1),c,p,1,0,0,"")){',a.walk(b.nodes,c),c.code+="};"},">":s,"<":function(b,c){var d={partials:{},code:"",subs:{},inPartial:!0};a.walk(b.nodes,d);var e=c.partials[s(b,c)];e.subs=d.subs,e.partials=d.partials},$:function(b,c){var d={subs:{},code:"",partials:c.partials,prefix:b.n};a.walk(b.nodes,d),c.subs[b.n]=d.code,c.inPartial||(c.code+='t.sub("'+q(b.n)+'",c,p,i);')},"\n":function(a,b){b.code+=u('"\\n"'+(a.last?"":" + i"))},_v:function(a,b){b.code+="t.b(t.v(t."+r(a.n)+'("'+q(a.n)+'",c,p,0)));'},_t:function(a,b){b.code+=u('"'+q(a.text)+'"')},"{":t,"&":t},a.walk=function(b,c){var d;for(var e=0,f=b.length;e<f;e++)d=a.codegen[b[e].tag],d&&d(b[e],c);return c},a.parse=function(a,b,c){return c=c||{},k(a,"",[],c.sectionTags||[])},a.cache={},a.cacheKey=function(a,b){return[a,!!b.asString,!!b.disableLambda].join("||")},a.compile=function(b,c){c=c||{};var d=a.cacheKey(b,c),e=this.cache[d];return e?e:(e=this.generate(this.parse(this.scan(b,c.delimiters),b,c),b,c),this.cache[d]=e)}}(typeof exports!="undefined"?exports:Hogan),function(a,b){function c(a){return K.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function d(a){if(!cp[a]){var b=H.body,c=K("<"+a+">").appendTo(b),d=c.css("display");c.remove();if(d==="none"||d===""){cq||(cq=H.createElement("iframe"),cq.frameBorder=cq.width=cq.height=0),b.appendChild(cq);if(!cr||!cq.createElement)cr=(cq.contentWindow||cq.contentDocument).document,cr.write((H.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>"),cr.close();c=cr.createElement(a),cr.body.appendChild(c),d=K.css(c,"display"),b.removeChild(cq)}cp[a]=d}return cp[a]}function e(a,b){var c={};return K.each(cv.concat.apply([],cv.slice(0,b)),function(){c[this]=a}),c}function f(){cw=b}function g(){return setTimeout(f,0),cw=K.now()}function h(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function i(){try{return new a.XMLHttpRequest}catch(b){}}function j(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var d=a.dataTypes,e={},f,g,h=d.length,i,j=d[0],k,l,m,n,o;for(f=1;f<h;f++){if(f===1)for(g in a.converters)typeof g=="string"&&(e[g.toLowerCase()]=a.converters[g]);k=j,j=d[f];if(j==="*")j=k;else if(k!=="*"&&k!==j){l=k+" "+j,m=e[l]||e["* "+j];if(!m){o=b;for(n in e){i=n.split(" ");if(i[0]===k||i[0]==="*"){o=e[i[1]+" "+j];if(o){n=e[n],n===!0?m=o:o===!0&&(m=n);break}}}}!m&&!o&&K.error("No conversion from "+l.replace(" "," to ")),m!==!0&&(c=m?m(c):o(n(c)))}}return c}function k(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g)i in d&&(c[g[i]]=d[i]);while(f[0]==="*")f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"));if(h)for(i in e)if(e[i]&&e[i].test(h)){f.unshift(i);break}if(f[0]in d)j=f[0];else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j)return j!==f[0]&&f.unshift(j),d[j]}function l(a,b,c,d){if(K.isArray(b))K.each(b,function(b,e){c||bR.test(a)?d(a,e):l(a+"["+(typeof e=="object"||K.isArray(e)?b:"")+"]",e,c,d)});else if(!c&&b!=null&&typeof b=="object")for(var e in b)l(a+"["+e+"]",b[e],c,d);else d(a,b)}function m(a,c){var d,e,f=K.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((f[d]?a:e||(e={}))[d]=c[d]);e&&K.extend(!0,a,e)}function n(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===ce,l;for(;i<j&&(k||!l);i++)l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=n(a,c,d,e,l,g)));return(k||!l)&&!g["*"]&&(l=n(a,c,d,e,"*",g)),l}function o(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(K.isFunction(c)){var d=b.toLowerCase().split(ca),e=0,f=d.length,g,h,i;for(;e<f;e++)g=d[e],i=/^\+/.test(g),i&&(g=g.substr(1)||"*"),h=a[g]=a[g]||[],h[i?"unshift":"push"](c)}}}function p(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?bL:bM,f=0,g=e.length;if(d>0){if(c!=="border")for(;f<g;f++)c||(d-=parseFloat(K.css(a,"padding"+e[f]))||0),c==="margin"?d+=parseFloat(K.css(a,c+e[f]))||0:d-=parseFloat(K.css(a,"border"+e[f]+"Width"))||0;return d+"px"}d=bN(a,b,b);if(d<0||d==null)d=a.style[b]||0;d=parseFloat(d)||0;if(c)for(;f<g;f++)d+=parseFloat(K.css(a,"padding"+e[f]))||0,c!=="padding"&&(d+=parseFloat(K.css(a,"border"+e[f]+"Width"))||0),c==="margin"&&(d+=parseFloat(K.css(a,c+e[f]))||0);return d+"px"}function q(a,b){b.src?K.ajax({url:b.src,async:!1,dataType:"script"}):K.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bB,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)}function r(a){var b=H.createElement("div");return bD.appendChild(b),b.innerHTML=a.outerHTML,b.firstChild}function s(a){var b=(a.nodeName||"").toLowerCase();b==="input"?t(a):b!=="script"&&typeof a.getElementsByTagName!="undefined"&&K.grep(a.getElementsByTagName("input"),t)}function t(a){if(a.type==="checkbox"||a.type==="radio")a.defaultChecked=a.checked}function u(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function v(a,b){var c;if(b.nodeType===1){b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase();if(c==="object")b.outerHTML=a.outerHTML;else if(c!=="input"||a.type!=="checkbox"&&a.type!=="radio"){if(c==="option")b.selected=a.defaultSelected;else if(c==="input"||c==="textarea")b.defaultValue=a.defaultValue}else a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value);b.removeAttribute(K.expando)}}function w(a,b){if(b.nodeType===1&&!!K.hasData(a)){var c,d,e,f=K._data(a),g=K._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;d<e;d++)K.event.add(b,c+(h[c][d].namespace?".":"")+h[c][d].namespace,h[c][d],h[c][d].data)}g.data&&(g.data=K.extend({},g.data))}}function x(a,b){return K.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function y(a){var b=bp.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}function z(a,b,c){b=b||0;if(K.isFunction(b))return K.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return K.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=K.grep(a,function(a){return a.nodeType===1});if(bl.test(b))return K.filter(b,d,!c);b=K.filter(b,d)}return K.grep(a,function(a,d){return K.inArray(a,b)>=0===c})}function A(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function B(){return!0}function C(){return!1}function D(a,b,c){var d=b+"defer",e=b+"queue",f=b+"mark",g=K._data(a,d);g&&(c==="queue"||!K._data(a,e))&&(c==="mark"||!K._data(a,f))&&setTimeout(function(){!K._data(a,e)&&!K._data(a,f)&&(K.removeData(a,d,!0),g.fire())},0)}function E(a){for(var b in a){if(b==="data"&&K.isEmptyObject(a[b]))continue;if(b!=="toJSON")return!1}return!0}function F(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(O,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:K.isNumeric(d)?parseFloat(d):N.test(d)?K.parseJSON(d):d}catch(f){}K.data(a,c,d)}else d=b}return d}function G(a){var b=L[a]={},c,d;a=a.split(/\s+/);for(c=0,d=a.length;c<d;c++)b[a[c]]=!0;return b}var H=a.document,I=a.navigator,J=a.location,K=function(){function c(){if(!d.isReady){try{H.documentElement.doScroll("left")}catch(a){setTimeout(c,1);return}d.ready()}}var d=function(a,b){return new d.fn.init(a,b,g)},e=a.jQuery,f=a.$,g,h=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,i=/\S/,j=/^\s+/,k=/\s+$/,l=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,m=/^[\],:{}\s]*$/,n=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,o=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,p=/(?:^|:|,)(?:\s*\[)+/g,q=/(webkit)[ \/]([\w.]+)/,r=/(opera)(?:.*version)?[ \/]([\w.]+)/,s=/(msie) ([\w.]+)/,t=/(mozilla)(?:.*? rv:([\w.]+))?/,u=/-([a-z]|[0-9])/ig,v=/^-ms-/,w=function(a,b){return(b+"").toUpperCase()},x=I.userAgent,y,z,A,B=Object.prototype.toString,C=Object.prototype.hasOwnProperty,D=Array.prototype.push,E=Array.prototype.slice,F=String.prototype.trim,G=Array.prototype.indexOf,J={};return d.fn=d.prototype={constructor:d,init:function(a,c,e){var f,g,i,j;if(!a)return this;if(a.nodeType)return this.context=this[0]=a,this.length=1,this;if(a==="body"&&!c&&H.body)return this.context=H,this[0]=H.body,this.selector=a,this.length=1,this;if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?f=h.exec(a):f=[null,a,null];if(f&&(f[1]||!c)){if(f[1])return c=c instanceof d?c[0]:c,j=c?c.ownerDocument||c:H,i=l.exec(a),i?d.isPlainObject(c)?(a=[H.createElement(i[1])],d.fn.attr.call(a,c,!0)):a=[j.createElement(i[1])]:(i=d.buildFragment([f[1]],[j]),a=(i.cacheable?d.clone(i.fragment):i.fragment).childNodes),d.merge(this,a);g=H.getElementById(f[2]);if(g&&g.parentNode){if(g.id!==f[2])return e.find(a);this.length=1,this[0]=g}return this.context=H,this.selector=a,this}return!c||c.jquery?(c||e).find(a):this.constructor(c).find(a)}return d.isFunction(a)?e.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),d.makeArray(a,this))},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return E.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var e=this.constructor();return d.isArray(a)?D.apply(e,a):d.merge(e,a),e.prevObject=this,e.context=this.context,b==="find"?e.selector=this.selector+(this.selector?" ":"")+c:b&&(e.selector=this.selector+"."+b+"("+c+")"),e},each:function(a,b){return d.each(this,a,b)},ready:function(a){return d.bindReady(),z.add(a),this},eq:function(a){return a=+a,a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(E.apply(this,arguments),"slice",E.call(arguments).join(","))},map:function(a){return this.pushStack(d.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:D,sort:[].sort,splice:[].splice},d.fn.init.prototype=d.fn,d.extend=d.fn.extend=function(){var a,c,e,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!d.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++)if((a=arguments[j])!=null)for(c in a){e=i[c],f=a[c];if(i===f)continue;l&&f&&(d.isPlainObject(f)||(g=d.isArray(f)))?(g?(g=!1,h=e&&d.isArray(e)?e:[]):h=e&&d.isPlainObject(e)?e:{},i[c]=d.extend(l,h,f)):f!==b&&(i[c]=f)}return i},d.extend({noConflict:function(b){return a.$===d&&(a.$=f),b&&a.jQuery===d&&(a.jQuery=e),d},isReady:!1,readyWait:1,holdReady:function(a){a?d.readyWait++:d.ready(!0)},ready:function(a){if(a===!0&&!--d.readyWait||a!==!0&&!d.isReady){if(!H.body)return setTimeout(d.ready,1);d.isReady=!0;if(a!==!0&&--d.readyWait>0)return;z.fireWith(H,[d]),d.fn.trigger&&d(H).trigger("ready").off("ready")}},bindReady:function(){if(!z){z=d.Callbacks("once memory");if(H.readyState==="complete")return setTimeout(d.ready,1);if(H.addEventListener)H.addEventListener("DOMContentLoaded",A,!1),a.addEventListener("load",d.ready,!1);else if(H.attachEvent){H.attachEvent("onreadystatechange",A),a.attachEvent("onload",d.ready);var b=!1;try{b=a.frameElement==null}catch(e){}H.documentElement.doScroll&&b&&c()}}},isFunction:function(a){return d.type(a)==="function"},isArray:Array.isArray||function(a){return d.type(a)==="array"},isWindow:function(a){return a&&typeof a=="object"&&"setInterval"in a},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):J[B.call(a)]||"object"},isPlainObject:function(a){if(!a||d.type(a)!=="object"||a.nodeType||d.isWindow(a))return!1;try{if(a.constructor&&!C.call(a,"constructor")&&!C.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}var e;for(e in a);return e===b||C.call(a,e)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw new Error(a)},parseJSON:function(b){if(typeof b!="string"||!b)return null;b=d.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(m.test(b.replace(n,"@").replace(o,"]").replace(p,"")))return(new Function("return "+b))();d.error("Invalid JSON: "+b)},parseXML:function(c){var e,f;try{a.DOMParser?(f=new DOMParser,e=f.parseFromString(c,"text/xml")):(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(c))}catch(g){e=b}return(!e||!e.documentElement||e.getElementsByTagName("parsererror").length)&&d.error("Invalid XML: "+c),e},noop:function(){},globalEval:function(b){b&&i.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(v,"ms-").replace(u,w)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,e){var f,g=0,h=a.length,i=h===b||d.isFunction(a);if(e){if(i){for(f in a)if(c.apply(a[f],e)===!1)break}else for(;g<h;)if(c.apply(a[g++],e)===!1)break}else if(i){for(f in a)if(c.call(a[f],f,a[f])===!1)break}else for(;g<h;)if(c.call(a[g],g,a[g++])===!1)break;return a},trim:F?function(a){return a==null?"":F.call(a)}:function(a){return a==null?"":(a+"").replace(j,"").replace(k,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var e=d.type(a);a.length==null||e==="string"||e==="function"||e==="regexp"||d.isWindow(a)?D.call(c,a):d.merge(c,a)}return c},inArray:function(a,b,c){var d;if(b){if(G)return G.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length=="number")for(var f=c.length;e<f;e++)a[d++]=c[e];else while(c[e]!==b)a[d++]=c[e++];return a.length=d,a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++)e=!!b(a[f],f),c!==e&&d.push(a[f]);return d},map:function(a,c,e){var f,g,h=[],i=0,j=a.length,k=a instanceof d||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||d.isArray(a));if(k)for(;i<j;i++)f=c(a[i],i,e),f!=null&&(h[h.length]=f);else for(g in a)f=c(a[g],g,e),f!=null&&(h[h.length]=f);return h.concat.apply([],h)},guid:1,proxy:function(a,c){if(typeof c=="string"){var e=a[c];c=a,a=e}if(!d.isFunction(a))return b;var f=E.call(arguments,2),g=function(){return a.apply(c,f.concat(E.call(arguments)))};return g.guid=a.guid=a.guid||g.guid||d.guid++,g},access:function(a,c,e,f,g,h){var i=a.length;if(typeof c=="object"){for(var j in c)d.access(a,j,c[j],f,g,e);return a}if(e!==b){f=!h&&f&&d.isFunction(e);for(var k=0;k<i;k++)g(a[k],c,f?e.call(a[k],k,g(a[k],c)):e,h);return a}return i?g(a[0],c):b},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=q.exec(a)||r.exec(a)||s.exec(a)||a.indexOf("compatible")<0&&t.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}d.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(c,e){return e&&e instanceof d&&!(e instanceof a)&&(e=a(e)),d.fn.init.call(this,c,e,b)},a.fn.init.prototype=a.fn;var b=a(H);return a},browser:{}}),d.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){J["[object "+b+"]"]=b.toLowerCase()}),y=d.uaMatch(x),y.browser&&(d.browser[y.browser]=!0,d.browser.version=y.version),d.browser.webkit&&(d.browser.safari=!0),i.test("Â ")&&(j=/^[\s\xA0]+/,k=/[\s\xA0]+$/),g=d(H),H.addEventListener?A=function(){H.removeEventListener("DOMContentLoaded",A,!1),d.ready()}:H.attachEvent&&(A=function(){H.readyState==="complete"&&(H.detachEvent("onreadystatechange",A),d.ready())}),d}(),L={};K.Callbacks=function(a){a=a?L[a]||G(a):{};var c=[],d=[],e,f,g,h,i,j=function(b){var d,e,f,g,h;for(d=0,e=b.length;d<e;d++)f=b[d],g=K.type(f),g==="array"?j(f):g==="function"&&(!a.unique||!l.has(f))&&c.push(f)},k=function(b,j){j=j||[],e=!a.memory||[b,j],f=!0,i=g||0,g=0,h=c.length;for(;c&&i<h;i++)if(c[i].apply(b,j)===!1&&a.stopOnFalse){e=!0;break}f=!1,c&&(a.once?e===!0?l.disable():c=[]:d&&d.length&&(e=d.shift(),l.fireWith(e[0],e[1])))},l={add:function(){if(c){var a=c.length;j(arguments),f?h=c.length:e&&e!==!0&&(g=a,k(e[0],e[1]))}return this},remove:function(){if(c){var b=arguments,d=0,e=b.length;for(;d<e;d++)for(var g=0;g<c.length;g++)if(b[d]===c[g]){f&&g<=h&&(h--,g<=i&&i--),c.splice(g--,1);if(a.unique)break}}return this},has:function(a){if(c){var b=0,d=c.length;for(;b<d;b++)if(a===c[b])return!0}return!1},empty:function(){return c=[],this},disable:function(){return c=d=e=b,this},disabled:function(){return!c},lock:function(){return d=b,(!e||e===!0)&&l.disable(),this},locked:function(){return!d},fireWith:function(b,c){return d&&(f?a.once||d.push([b,c]):(!a.once||!e)&&k(b,c)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!e}};return l};var M=[].slice;K.extend({Deferred:function(a){var b=K.Callbacks("once memory"),c=K.Callbacks("once memory"),d=K.Callbacks("memory"),e="pending",f={resolve:b,reject:c,notify:d},g={done:b.add,fail:c.add,progress:d.add,state:function(){return e},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){return h.done(a).fail(b).progress(c),this},always:function(){return h.done.apply(h,arguments).fail.apply(h,arguments),this},pipe:function(a,b,c){return K.Deferred(function(d){K.each({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=b[0],e=b[1],f;K.isFunction(c)?h[a](function(){f=c.apply(this,arguments),f&&K.isFunction(f.promise)?f.promise().then(d.resolve,d.reject,d.notify):d[e+"With"](this===h?d:this,[f])}):h[a](d[e])})}).promise()},promise:function(a){if(a==null)a=g;else for(var b in g)a[b]=g[b];return a}},h=g.promise({}),i;for(i in f)h[i]=f[i].fire,h[i+"With"]=f[i].fireWith;return h.done(function(){e="resolved"},c.disable,d.lock).fail(function(){e="rejected"},b.disable,d.lock),a&&a.call(h,h),h},when:function(a){function b(a){return function(b){g[a]=arguments.length>1?M.call(arguments,0):b,j.notifyWith(k,g)}}function c(a){return function(b){d[a]=arguments.length>1?M.call(arguments,0):b,--h||j.resolveWith(j,d)}}var d=M.call(arguments,0),e=0,f=d.length,g=Array(f),h=f,i=f,j=f<=1&&a&&K.isFunction(a.promise)?a:K.Deferred(),k=j.promise();if(f>1){for(;e<f;e++)d[e]&&d[e].promise&&K.isFunction(d[e].promise)?d[e].promise().then(c(e),j.reject,b(e)):--h;h||j.resolveWith(j,d)}else j!==a&&j.resolveWith(j,f?[a]:[]);return k}}),K.support=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o=H.createElement("div"),p=H.documentElement;o.setAttribute("className","t"),o.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",c=o.getElementsByTagName("*"),d=o.getElementsByTagName("a")[0];if(!c||!c.length||!d)return{};e=H.createElement("select"),f=e.appendChild(H.createElement("option")),g=o.getElementsByTagName("input")[0],b={leadingWhitespace:o.firstChild.nodeType===3,tbody:!o.getElementsByTagName("tbody").length,htmlSerialize:!!o.getElementsByTagName("link").length,style:/top/.test(d.getAttribute("style")),hrefNormalized:d.getAttribute("href")==="/a",opacity:/^0.55/.test(d.style.opacity),cssFloat:!!d.style.cssFloat,checkOn:g.value==="on",optSelected:f.selected,getSetAttribute:o.className!=="t",enctype:!!H.createElement("form").enctype,html5Clone:H.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},g.checked=!0,b.noCloneChecked=g.cloneNode(!0).checked,e.disabled=!0,b.optDisabled=!f.disabled;try{delete o.test}catch(q){b.deleteExpando=!1}!o.addEventListener&&o.attachEvent&&o.fireEvent&&(o.attachEvent("onclick",function(){b.noCloneEvent=!1}),o.cloneNode(!0).fireEvent("onclick")),g=H.createElement("input"),g.value="t",g.setAttribute("type","radio"),b.radioValue=g.value==="t",g.setAttribute("checked","checked"),o.appendChild(g),i=H.createDocumentFragment(),i.appendChild(o.lastChild),b.checkClone=i.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=g.checked,i.removeChild(g),i.appendChild(o),o.innerHTML="",a.getComputedStyle&&(h=H.createElement("div"),h.style.width="0",h.style.marginRight="0",o.style.width="2px",o.appendChild(h),b.reliableMarginRight=(parseInt((a.getComputedStyle(h,null)||{marginRight:0}).marginRight,10)||0)===0);if(o.attachEvent)for(m in{submit:1,change:1,focusin:1})l="on"+m,n=l in o,n||(o.setAttribute(l,"return;"),n=typeof o[l]=="function"),b[m+"Bubbles"]=n;return i.removeChild(o),i=e=f=h=o=g=null,K(function(){var a,c,d,e,f,g,h,i,k,l,m,p=H.getElementsByTagName("body")[0];!p||(h=1,i="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",k="visibility:hidden;border:0;",l="style='"+i+"border:5px solid #000;padding:0;'",m="<div "+l+"><div></div></div>"+"<table "+l+" cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>",a=H.createElement("div"),a.style.cssText=k+"width:0;height:0;position:static;top:0;margin-top:"+h+"px",p.insertBefore(a,p.firstChild),o=H.createElement("div"),a.appendChild(o),o.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",j=o.getElementsByTagName("td"),n=j[0].offsetHeight===0,j[0].style.display="",j[1].style.display="none",b.reliableHiddenOffsets=n&&j[0].offsetHeight===0,o.innerHTML="",o.style.width=o.style.paddingLeft="1px",K.boxModel=b.boxModel=o.offsetWidth===2,typeof o.style.zoom!="undefined"&&(o.style.display="inline",o.style.zoom=1,b.inlineBlockNeedsLayout=o.offsetWidth===2,o.style.display="",o.innerHTML="<div style='width:4px;'></div>",b.shrinkWrapBlocks=o.offsetWidth!==2),o.style.cssText=i+k,o.innerHTML=m,c=o.firstChild,d=c.firstChild,f=c.nextSibling.firstChild.firstChild,g={doesNotAddBorder:d.offsetTop!==5,doesAddBorderForTableAndCells:f.offsetTop===5},d.style.position="fixed",d.style.top="20px",g.fixedPosition=d.offsetTop===20||d.offsetTop===15,d.style.position=d.style.top="",c.style.overflow="hidden",c.style.position="relative",g.subtractsBorderForOverflowNotVisible=d.offsetTop===-5,g.doesNotIncludeMarginInBodyOffset=p.offsetTop!==h,p.removeChild(a),o=a=null,K.extend(b,g))}),b}();var N=/^(?:\{.*\}|\[.*\])$/,O=/([A-Z])/g;K.extend({cache:{},uuid:0,expando:"jQuery"+(K.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){return a=a.nodeType?K.cache[a[K.expando]]:a[K.expando],!!a&&!E(a)},data:function(a,c,d,e){if(!!K.acceptData(a)){var f,g,h,i=K.expando,j=typeof c=="string",k=a.nodeType,l=k?K.cache:a,m=k?a[i]:a[i]&&i,n=c==="events";if((!m||!l[m]||!n&&!e&&!l[m].data)&&j&&d===b)return;m||(k?a[i]=m=++K.uuid:m=i),l[m]||(l[m]={},k||(l[m].toJSON=K.noop));if(typeof c=="object"||typeof c=="function")e?l[m]=K.extend(l[m],c):l[m].data=K.extend(l[m].data,c);return f=g=l[m],e||(g.data||(g.data={}),g=g.data),d!==b&&(g[K.camelCase(c)]=d),n&&!g[c]?f.events:(j?(h=g[c],h==null&&(h=g[K.camelCase(c)])):h=g,h)}},removeData:function(a,b,c){if(!!K.acceptData(a)){var d,e,f,g=K.expando,h=a.nodeType,i=h?K.cache:a,j=h?a[g]:g;if(!i[j])return;if(b){d=c?i[j]:i[j].data;if(d){K.isArray(b)||(b in d?b=[b]:(b=K.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(e=0,f=b.length;e<f;e++)delete d[b[e]];if(!(c?E:K.isEmptyObject)(d))return}}if(!c){delete i[j].data;if(!E(i[j]))return}K.support.deleteExpando||!i.setInterval?delete i[j]:i[j]=null,h&&(K.support.deleteExpando?delete a[g]:a.removeAttribute?a.removeAttribute(g):a[g]=null)}},_data:function(a,b,c){return K.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=K.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),K.fn.extend({data:function(a,c){var d,e,f,g=null;if(typeof a=="undefined"){if(this.length){g=K.data(this[0]);if(this[0].nodeType===1&&!K._data(this[0],"parsedAttrs")){e=this[0].attributes;for(var h=0,i=e.length;h<i;h++)f=e[h].name,f.indexOf("data-")===0&&(f=K.camelCase(f.substring(5)),F(this[0],f,g[f]));K._data(this[0],"parsedAttrs",!0)}}return g}return typeof a=="object"?this.each(function(){K.data(this,a)}):(d=a.split("."),d[1]=d[1]?"."+d[1]:"",c===b?(g=this.triggerHandler("getData"+d[1]+"!",[d[0]]),g===b&&this.length&&(g=K.data(this[0],a),g=F(this[0],a,g)),g===b&&d[1]?this.data(d[0]):g):this.each(function(){var b=K(this),e=[d[0],c];b.triggerHandler("setData"+d[1]+"!",e),K.data(this,a,c),b.triggerHandler("changeData"+d[1]+"!",e)}))},removeData:function(a){return this.each(function(){K.removeData(this,a)})}}),K.extend({_mark:function(a,b){a&&(b=(b||"fx")+"mark",K._data(a,b,(K._data(a,b)||0)+1))},_unmark:function(a,b,c){a!==!0&&(c=b,b=a,a=!1);if(b){c=c||"fx";var d=c+"mark",e=a?0:(K._data(b,d)||1)-1;e?K._data(b,d,e):(K.removeData(b,d,!0),D(b,c,"mark"))}},queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=K._data(a,b),c&&(!d||K.isArray(c)?d=K._data(a,b,K.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){b=b||"fx";var c=K.queue(a,b),d=c.shift(),e={};d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),K._data(a,b+".run",e),d.call(a,function(){K.dequeue(a,b)},e)),c.length||(K.removeData(a,b+"queue "+b+".run",!0),D(a,b,"queue"))}}),K.fn.extend({queue:function(a,c){return typeof a!="string"&&(c=a,a="fx"),c===b?K.queue(this[0],a):this.each(function(){var b=K.queue(this,a,c);a==="fx"&&b[0]!=="inprogress"&&K.dequeue(this,a)})},dequeue:function(a){return this.each(function(){K.dequeue(this,a)})},delay:function(a,b){return a=K.fx?K.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function d(){--h||e.resolveWith(f,[f])}typeof a!="string"&&(c=a,a=b),a=a||"fx";var e=K.Deferred(),f=this,g=f.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;while(g--)if(l=K.data(f[g],i,b,!0)||(K.data(f[g],j,b,!0)||K.data(f[g],k,b,!0))&&K.data(f[g],i,K.Callbacks("once memory"),!0))h++,l.add(d);return d(),e.promise()}});var P=/[\n\t\r]/g,Q=/\s+/,R=/\r/g,S=/^(?:button|input)$/i,T=/^(?:button|input|object|select|textarea)$/i,U=/^a(?:rea)?$/i,V=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,W=K.support.getSetAttribute,X,Y,Z;K.fn.extend({attr:function(a,b){return K.access(this,a,b,!0,K.attr)},removeAttr:function(a){return this.each(function(){K.removeAttr(this,a)})},prop:function(a,b){return K.access(this,a,b,!0,K.prop)},removeProp:function(a){return a=K.propFix[a]||a,this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,f,g,h;if(K.isFunction(a))return this.each(function(b){K(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(Q);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1)if(!e.className&&b.length===1)e.className=a;else{f=" "+e.className+" ";for(g=0,h=b.length;g<h;g++)~f.indexOf(" "+b[g]+" ")||(f+=b[g]+" ");e.className=K.trim(f)}}}return this},removeClass:function(a){var c,d,e,f,g,h,i;if(K.isFunction(a))return this.each(function(b){K(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===b){c=(a||"").split(Q);for(d=0,e=this.length;d<e;d++){f=this[d];if(f.nodeType===1&&f.className)if(a){g=(" "+f.className+" ").replace(P," ");for(h=0,i=c.length;h<i;h++)g=g.replace(" "+c[h]+" "," ");f.className=K.trim(g)}else f.className=""}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";return K.isFunction(a)?this.each(function(c){K(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if(c==="string"){var e,f=0,g=K(this),h=b,i=a.split(Q);while(e=i[f++])h=d?h:!g.hasClass(e),g[h?"addClass":"removeClass"](e)}else if(c==="undefined"||c==="boolean")this.className&&K._data(this,"__className__",this.className),this.className=this.className||a===!1?"":K._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(P," ").indexOf(b)>-1)return!0;return!1},val:function(a){var c,d,e,f=this[0];if(!!arguments.length)return e=K.isFunction(a),this.each(function(d){var f=K(this),g;if(this.nodeType===1){e?g=a.call(this,d,f.val()):g=a,g==null?g="":typeof g=="number"?g+="":K.isArray(g)&&(g=K.map(g,function(a){return a==null?"":a+""})),c=K.valHooks[this.nodeName.toLowerCase()]||K.valHooks[this.type];if(!c||!("set"in c)||c.set(this,g,"value")===b)this.value=g}});if(f)return c=K.valHooks[f.nodeName.toLowerCase()]||K.valHooks[f.type],c&&"get"in c&&(d=c.get(f,"value"))!==b?d:(d=f.value,typeof d=="string"?d.replace(R,""):d==null?"":d)}}),K.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,f=a.selectedIndex,g=[],h=a.options,i=a.type==="select-one";if(f<0)return null;c=i?f:0,d=i?f+1:h.length;for(;c<d;c++){e=h[c];if(e.selected&&(K.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!K.nodeName(e.parentNode,"optgroup"))){b=K(e).val();if(i)return b;g.push(b)}}return i&&!g.length&&h.length?K(h[f]).val():g},set:function(a,b){var c=K.makeArray(b);return K(a).find("option").each(function(){this.selected=K.inArray(K(this).val(),c)>=0}),c.length||(a.selectedIndex=-1),c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(a,c,d,e){var f,g,h,i=a.nodeType;if(!!a&&i!==3&&i!==8&&i!==2){if(e&&c in K.attrFn)return K(a)[c](d);if(typeof a.getAttribute=="undefined")return K.prop(a,c,d);h=i!==1||!K.isXMLDoc(a),h&&(c=c.toLowerCase(),g=K.attrHooks[c]||(V.test(c)?Y:X));if(d!==b){if(d===null){K.removeAttr(a,c);return}return g&&"set"in g&&h&&(f=g.set(a,d,c))!==b?f:(a.setAttribute(c,""+d),d)}return g&&"get"in g&&h&&(f=g.get(a,c))!==null?f:(f=a.getAttribute(c),f===null?b:f)}},removeAttr:function(a,b){var c,d,e,f,g=0;if(b&&a.nodeType===1){d=b.toLowerCase().split(Q),f=d.length;for(;g<f;g++)e=d[g],e&&(c=K.propFix[e]||e,K.attr(a,e,""),a.removeAttribute(W?e:c),V.test(e)&&c in a&&(a[c]=!1))}},attrHooks:{type:{set:function(a,b){if(S.test(a.nodeName)&&a.parentNode)K.error("type property can't be changed");else if(!K.support.radioValue&&b==="radio"&&K.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}},value:{get:function(a,b){return X&&K.nodeName(a,"button")?X.get(a,b):b in a?a.value:null},set:function(a,b,c){if(X&&K.nodeName(a,"button"))return X.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,f,g,h=a.nodeType;if(!!a&&h!==3&&h!==8&&h!==2)return g=h!==1||!K.isXMLDoc(a),g&&(c=K.propFix[c]||c,f=K.propHooks[c]),d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&(e=f.get(a,c))!==null?e:a[c]},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):T.test(a.nodeName)||U.test(a.nodeName)&&a.href?0:b}}}}),K.attrHooks.tabindex=K.propHooks.tabIndex,Y={get:function(a,c){var d,e=K.prop(a,c);return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;return b===!1?K.removeAttr(a,c):(d=K.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase())),c}},W||(Z={name:!0,id:!0},X=K.valHooks.button={get:function(a,c){var d;return d=a.getAttributeNode(c),d&&(Z[c]?d.nodeValue!=="":d.specified)?d.nodeValue:b},set:function(a,b,c){var d=a.getAttributeNode(c);return d||(d=H.createAttribute(c),a.setAttributeNode(d)),d.nodeValue=b+""}},K.attrHooks.tabindex.set=X.set,K.each(["width","height"],function(a,b){K.attrHooks[b]=K.extend(K.attrHooks[b],{set:function(a,c){if(c==="")return a.setAttribute(b,"auto"),c}})}),K.attrHooks.contenteditable={get:X.get,set:function(a,b,c){b===""&&(b="false"),X.set(a,b,c)}}),K.support.hrefNormalized||K.each(["href","src","width","height"],function(a,c){K.attrHooks[c]=K.extend(K.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),K.support.style||(K.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),K.support.optSelected||(K.propHooks.selected=K.extend(K.propHooks.selected,{get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}})),K.support.enctype||(K.propFix.enctype="encoding"),K.support.checkOn||K.each(["radio","checkbox"],function(){K.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),K.each(["radio","checkbox"],function(){K.valHooks[this]=K.extend(K.valHooks[this],{set:function(a,b){if(K.isArray(b))return a.checked=K.inArray(K(a).val(),b)>=0}})});var $=/^(?:textarea|input|select)$/i,_=/^([^\.]*)?(?:\.(.+))?$/,ba=/\bhover(\.\S+)?\b/,bb=/^key/,bc=/^(?:mouse|contextmenu)|click/,bd=/^(?:focusinfocus|focusoutblur)$/,be=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,bf=function(a){var b=be.exec(a);return b&&(b[1]=(b[1]||"").toLowerCase(),b[3]=b[3]&&new RegExp("(?:^|\\s)"+b[3]+"(?:\\s|$)")),b},bg=function(a,b){var c=a.attributes||{};return(!b[1]||a.nodeName.toLowerCase()===b[1])&&(!b[2]||(c.id||{}).value===b[2])&&(!b[3]||b[3].test((c["class"]||{}).value))},bh=function(a){return K.event.special.hover?a:a.replace(ba,"mouseenter$1 mouseleave$1")};K.event={add:function(a,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r;if(!(a.nodeType===3||a.nodeType===8||!c||!d||!(g=K._data(a)))){d.handler&&(o=d,d=o.handler),d.guid||(d.guid=K.guid++),i=g.events,i||(g.events=i={}),h=g.handle,h||(g.handle=h=function(a){return typeof K!="undefined"&&(!a||K.event.triggered!==a.type)?K.event.dispatch.apply(h.elem,arguments):b},h.elem=a),c=K.trim(bh(c)).split(" ");for(j=0;j<c.length;j++){k=_.exec(c[j])||[],l=k[1],m=(k[2]||"").split(".").sort(),r=K.event.special[l]||{},l=(f?r.delegateType:r.bindType)||l,r=K.event.special[l]||{},n=K.extend({type:l,origType:k[1],data:e,handler:d,guid:d.guid,selector:f,quick:bf(f),namespace:m.join(".")},o),q=i[l];if(!q){q=i[l]=[],q.delegateCount=0;if(!r.setup||r.setup.call(a,e,m,h)===!1)a.addEventListener?a.addEventListener(l,h,!1):a.attachEvent&&a.attachEvent("on"+l,h)}r.add&&(r.add.call(a,n),n.handler.guid||(n.handler.guid=d.guid)),f?q.splice(q.delegateCount++,0,n):q.push(n),K.event.global[l]=!0}a=null}},global:{},remove:function(a,b,c,d,e){var f=K.hasData(a)&&K._data(a),g,h,i,j,k,l,m,n,o,p,q,r;if(!!f&&!!(n=f.events)){b=K.trim(bh(b||"")).split(" ");for(g=0;g<b.length;g++){h=_.exec(b[g])||[],i=j=h[1],k=h[2];if(!i){for(i in n)K.event.remove(a,i+b[g],c,d,!0);continue}o=K.event.special[i]||{},i=(d?o.delegateType:o.bindType)||i,q=n[i]||[],l=q.length,k=k?new RegExp("(^|\\.)"+k.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(m=0;m<q.length;m++)r=q[m],(e||j===r.origType)&&(!c||c.guid===r.guid)&&(!k||k.test(r.namespace))&&(!d||d===r.selector||d==="**"&&r.selector)&&(q.splice(m--,1),r.selector&&q.delegateCount--,o.remove&&o.remove.call(a,r));q.length===0&&l!==q.length&&((!o.teardown||o.teardown.call(a,k)===!1)&&K.removeEvent(a,i,f.handle),delete n[i])}K.isEmptyObject(n)&&(p=f.handle,p&&(p.elem=null),K.removeData(a,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,f){if(!e||e.nodeType!==3&&e.nodeType!==8){var g=c.type||c,h=[],i,j,k,l,m,n,o,p,q,r;if(bd.test(g+K.event.triggered))return;g.indexOf("!")>=0&&(g=g.slice(0,-1),j=!0),g.indexOf(".")>=0&&(h=g.split("."),g=h.shift(),h.sort());if((!e||K.event.customEvent[g])&&!K.event.global[g])return;c=typeof c=="object"?c[K.expando]?c:new K.Event(g,c):new K.Event(g),c.type=g,c.isTrigger=!0,c.exclusive=j,c.namespace=h.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,n=g.indexOf(":")<0?"on"+g:"";if(!e){i=K.cache;for(k in i)i[k].events&&i[k].events[g]&&K.event.trigger(c,d,i[k].handle.elem,!0);return}c.result=b,c.target||(c.target=e),d=d!=null?K.makeArray(d):[],d.unshift(c),o=K.event.special[g]||{};if(o.trigger&&o.trigger.apply(e,d)===!1)return;q=[[e,o.bindType||g]];if(!f&&!o.noBubble&&!K.isWindow(e)){r=o.delegateType||g,l=bd.test(r+g)?e:e.parentNode,m=null;for(;l;l=l.parentNode)q.push([l,r]),m=l;m&&m===e.ownerDocument&&q.push([m.defaultView||m.parentWindow||a,r])}for(k=0;k<q.length&&!c.isPropagationStopped();k++)l=q[k][0],c.type=q[k][1],p=(K._data(l,"events")||{})[c.type]&&K._data(l,"handle"),p&&p.apply(l,d),p=n&&l[n],p&&K.acceptData(l)&&p.apply(l,d)===!1&&c.preventDefault();return c.type=g,!f&&!c.isDefaultPrevented()&&(!o._default||o._default.apply(e.ownerDocument,d)===!1)&&(g!=="click"||!K.nodeName(e,"a"))&&K.acceptData(e)&&n&&e[g]&&(g!=="focus"&&g!=="blur"||c.target.offsetWidth!==0)&&!K.isWindow(e)&&(m=e[n],m&&(e[n]=null),K.event.triggered=g,e[g](),K.event.triggered=b,m&&(e[n]=m)),c.result}},dispatch:function(c){c=K.event.fix(c||a.event);var d=(K._data(this,"events")||{})[c.type]||[],e=d.delegateCount,f=[].slice.call(arguments,0),g=!c.exclusive&&!c.namespace,h=[],i,j,k,l,m,n,o,p,q,r,s;f[0]=c,c.delegateTarget=this;if(e&&!c.target.disabled&&(!c.button||c.type!=="click")){l=K(this),l.context=this.ownerDocument||this;for(k=c.target;k!=this;k=k.parentNode||this){n={},p=[],l[0]=k;for(i=0;i<e;i++)q=d[i],r=q.selector,n[r]===b&&(n[r]=q.quick?bg(k,q.quick):l.is(r)),n[r]&&p.push(q);p.length&&h.push({elem:k,matches:p})}}d.length>e&&h.push({elem:this,matches:d.slice(e)});for(i=0;i<h.length&&!c.isPropagationStopped();i++){o=h[i],c.currentTarget=o.elem;for(j=0;j<o.matches.length&&!c.isImmediatePropagationStopped();j++){q=o.matches[j];if(g||!c.namespace&&!q.namespace||c.namespace_re&&c.namespace_re.test(q.namespace))c.data=q.data,c.handleObj=q,m=((K.event.special[q.origType]||{}).handle||q.handler).apply(o.elem,f),m!==b&&(c.result=m,m===!1&&(c.preventDefault(),c.stopPropagation()))}}return c.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){var d,e,f,g=c.button,h=c.fromElement;return a.pageX==null&&c.clientX!=null&&(d=a.target.ownerDocument||H,e=d.documentElement,f=d.body,a.pageX=c.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),a.pageY=c.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)),!a.relatedTarget&&h&&(a.relatedTarget=h===a.target?c.toElement:h),!a.which&&g!==b&&(a.which=g&1?1:g&2?3:g&4?2:0),a}},fix:function(a){if(a[K.expando])return a;var c,d,e=a,f=K.event.fixHooks[a.type]||{},g=f.props?this.props.concat(f.props):this.props;a=K.Event(e);for(c=g.length;c;)d=g[--c],a[d]=e[d];return a.target||(a.target=e.srcElement||H),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey===b&&(a.metaKey=a.ctrlKey),f.filter?f.filter(a,e):a},special:{ready:{setup:K.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){K.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=K.extend(new K.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?K.event.trigger(e,null,b):K.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},K.event.handle=K.event.dispatch,K.removeEvent=H.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},K.Event=function(a,b){if(this instanceof K.Event)a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?B:C):this.type=a,b&&K.extend(this,b),this.timeStamp=a&&a.timeStamp||K.now(),this[K.expando]=!0;else return new K.Event(a,b)},K.Event.prototype={preventDefault:function(){this.isDefaultPrevented=B;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=B;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=B,this.stopPropagation()},isDefaultPrevented:C,isPropagationStopped:C,isImmediatePropagationStopped:C},K.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){K.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c=this,d=a.relatedTarget,e=a.handleObj,f=e.selector,g;if(!d||d!==c&&!K.contains(c,d))a.type=e.origType,g=e.handler.apply(this,arguments),a.type=b;return g}}}),K.support.submitBubbles||(K.event.special.submit={setup:function(){if(K.nodeName(this,"form"))return!1;K.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=K.nodeName(c,"input")||K.nodeName(c,"button")?c.form:b;d&&!d._submit_attached&&(K.event.add(d,"submit._submit",function(a){this.parentNode&&!a.isTrigger&&K.event.simulate("submit",this.parentNode,a,!0)}),d._submit_attached=!0)})},teardown:function(){if(K.nodeName(this,"form"))return!1;K.event.remove(this,"._submit")}}),K.support.changeBubbles||(K.event.special.change={setup:function(){if($.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")K.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),K.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1,K.event.simulate("change",this,a,!0))});return!1}K.event.add(this,"beforeactivate._change",function(a){var b=a.target;$.test(b.nodeName)&&!b._change_attached&&(K.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&K.event.simulate("change",this.parentNode,a,!0)}),b._change_attached=!0)})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox")return a.handleObj.handler.apply(this,arguments)},teardown:function(){return K.event.remove(this,"._change"),$.test(this.nodeName)}}),K.support.focusinBubbles||K.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){K.event.simulate(b,a.target,K.event.fix(a),!0)};K.event.special[b]={setup:function(){c++===0&&H.addEventListener(a,d,!0)},teardown:function(){--c===0&&H.removeEventListener(a,d,!0)}}}),K.fn.extend({on:function(a,c,d,e,f){var g,h;if(typeof a=="object"){typeof c!="string"&&(d=c,c=b);for(h in a)this.on(h,c,d,a[h],f);return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1)e=C;else if(!e)return this;return f===1&&(g=e,e=function(a){return K().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=K.guid++)),this.each(function(){K.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on.call(this,a,b,c,d,1)},off:function(a,c,d){if(a&&a.preventDefault&&a.handleObj){var e=a.handleObj;return K(a.delegateTarget).off(e.namespace?e.type+"."+e.namespace:e.type,e.selector,e.handler),this}if(typeof a=="object"){for(var f in a)this.off(f,c,a[f]);return this}if(c===!1||typeof c=="function")d=c,c=b;return d===!1&&(d=C),this.each(function(){K.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){return K(this.context).on(a,this.selector,b,c),this},die:function(a,b){return K(this.context).off(a,this.selector||"**",b),this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length==1?this.off(a,"**"):this.off(b,a,c)},trigger:function(a,b){return this.each(function(){K.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return K.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||K.guid++,d=0,e=function(c){var e=(K._data(this,"lastToggle"+a.guid)||0)%d;return K._data(this,"lastToggle"+a.guid,e+1),c.preventDefault(),b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),K.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){K.fn[b]=function(a,c){return c==null&&(c=a,a=null),arguments.length>0?this.on(b,null,a,c):this.trigger(b)},K.attrFn&&(K.attrFn[b]=!0),bb.test(b)&&(K.event.fixHooks[b]=K.event.keyHooks),bc.test(b)&&(K.event.fixHooks[b]=K.event.mouseHooks)}),function(){function a(a,b,c,d,f,g){for(var h=0,i=d.length;h<i;h++){var j=d[h];if(j){var k=!1;j=j[a];while(j){if(j[e]===c){k=d[j.sizset];break}if(j.nodeType===1){g||(j[e]=c,j.sizset=h);if(typeof b!="string"){if(j===b){k=!0;break}}else if(m.filter(b,[j]).length>0){k=j;break}}j=j[a]}d[h]=k}}}function c(a,b,c,d,f,g){for(var h=0,i=d.length;h<i;h++){var j=d[h];if(j){var k=!1;j=j[a];while(j){if(j[e]===c){k=d[j.sizset];break}j.nodeType===1&&!g&&(j[e]=c,j.sizset=h);if(j.nodeName.toLowerCase()===b){k=j;break}j=j[a]}d[h]=k}}}var d=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,e="sizcache"+(Math.random()+"").replace(".",""),f=0,g=Object.prototype.toString,h=!1,i=!0,j=/\\/g,k=/\r\n/g,l=/\W/;[0,0].sort(function(){return i=!1,0});var m=function(a,b,c,e){c=c||[],b=b||H;var f=b;if(b.nodeType!==1&&b.nodeType!==9)return[];if(!a||typeof a!="string")return c;var h,i,j,k,l,n,q,r,t=!0,u=m.isXML(b),v=[],x=a;do{d.exec(""),h=d.exec(x);if(h){x=h[3],v.push(h[1]);if(h[2]){k=h[3];break}}}while(h);if(v.length>1&&p.exec(a))if(v.length===2&&o.relative[v[0]])i=w(v[0]+v[1],b,e);else{i=o.relative[v[0]]?[b]:m(v.shift(),b);while(v.length)a=v.shift(),o.relative[a]&&(a+=v.shift()),i=w(a,i,e)}else{!e&&v.length>1&&b.nodeType===9&&!u&&o.match.ID.test(v[0])&&!o.match.ID.test(v[v.length-1])&&(l=m.find(v.shift(),b,u),b=l.expr?m.filter(l.expr,l.set)[0]:l.set[0]);if(b){l=e?{expr:v.pop(),set:s(e)}:m.find(v.pop(),v.length===1&&(v[0]==="~"||v[0]==="+")&&b.parentNode?b.parentNode:b,u),i=l.expr?m.filter(l.expr,l.set):l.set,v.length>0?j=s(i):t=!1;while(v.length)n=v.pop(),q=n,o.relative[n]?q=v.pop():n="",q==null&&(q=b),o.relative[n](j,q,u)}else j=v=[]}j||(j=i),j||m.error(n||a);if(g.call(j)==="[object Array]")if(!t)c.push.apply(c,j);else if(b&&b.nodeType===1)for(r=0;j[r]!=null;r++)j[r]&&(j[r]===!0||j[r].nodeType===1&&m.contains(b,j[r]))&&c.push(i[r]);else for(r=0;j[r]!=null;r++)j[r]&&j[r].nodeType===1&&c.push(i[r]);else s(j,c);return k&&(m(k,f,c,e),m.uniqueSort(c)),c};m.uniqueSort=function(a){if(u){h=i,a.sort(u);if(h)for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1)}return a},m.matches=function(a,b){return m(a,null,null,b)},m.matchesSelector=function(a,b){return m(b,null,null,[a]).length>0},m.find=function(a,b,c){var d,e,f,g,h,i;if(!a)return[];for(e=0,f=o.order.length;e<f;e++){h=o.order[e];if(g=o.leftMatch[h].exec(a)){i=g[1],g.splice(1,1);if(i.substr(i.length-1)!=="\\"){g[1]=(g[1]||"").replace(j,""),d=o.find[h](g,b,c);if(d!=null){a=a.replace(o.match[h],"");break}}}}return d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]),{set:d,expr:a}},m.filter=function(a,c,d,e){var f,g,h,i,j,k,l,n,p,q=a,r=[],s=c,t=c&&c[0]&&m.isXML(c[0]);while(a&&c.length){for(h in o.filter)if((f=o.leftMatch[h].exec(a))!=null&&f[2]){k=o.filter[h],l=f[1],g=!1,f.splice(1,1);if(l.substr(l.length-1)==="\\")continue;s===r&&(r=[]);if(o.preFilter[h]){f=o.preFilter[h](f,s,d,r,e,t);if(!f)g=i=!0;else if(f===!0)continue}if(f)for(n=0;(j=s[n])!=null;n++)j&&(i=k(j,f,n,s),p=e^i,d&&i!=null?p?g=!0:s[n]=!1:p&&(r.push(j),g=!0));if(i!==b){d||(s=r),a=a.replace(o.match[h],"");if(!g)return[];break}}if(a===q)if(g==null)m.error(a);else break;q=a}return s},m.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)};var n=m.getText=function(a){var b,c,d=a.nodeType,e="";if(d){if(d===1||d===9){if(typeof a.textContent=="string")return a.textContent;if(typeof a.innerText=="string")return a.innerText.replace(k,"");for(a=a.firstChild;a;a=a.nextSibling)e+=n(a)}else if(d===3||d===4)return a.nodeValue}else for(b=0;c=a[b];b++)c.nodeType!==8&&(e+=n(c));return e},o=m.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!l.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++)if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&m.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!l.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++)c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b);d&&m.filter(b,a,!0)}},"":function(b,d,e){var g,h=f++,i=a;typeof d=="string"&&!l.test(d)&&(d=d.toLowerCase(),g=d,i=c),i("parentNode",d,h,b,g,e)},"~":function(b,d,e){var g,h=f++,i=a;typeof d=="string"&&!l.test(d)&&(d=d.toLowerCase(),g=d,i=c),i("previousSibling",d,h,b,g,e)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined")return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(j,"")+" ";if(f)return a;for(var g=0,h;(h=b[g])!=null;g++)h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1));return!1},ID:function(a){return a[1].replace(j,"")},TAG:function(a,b){return a[1].replace(j,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||m.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else a[2]&&m.error(a[0]);return a[0]=f++,a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(j,"");return!f&&o.attrMap[g]&&(a[1]=o.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(j,""),a[2]==="~="&&(a[4]=" "+a[4]+" "),a},PSEUDO:function(a,b,c,e,f){if(a[1]==="not")if((d.exec(a[3])||"").length>1||/^\w/.test(a[3]))a[3]=m(a[3],null,null,b);else{var g=m.filter(a[3],b,c,!0^f);return c||e.push.apply(e,g),!1}else if(o.match.POS.test(a[0])||o.match.CHILD.test(a[0]))return!0;return a},POS:function(a){return a.unshift(!0),a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!m(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=o.filters[e];if(f)return f(a,c,b,d);if(e==="contains")return(a.textContent||a.innerText||n([a])||"").indexOf(b[3])>=0;if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++)if(g[h]===a)return!1;return!0}m.error(e)},CHILD:function(a,b){var c,d,f,g,h,i,j,k=b[1],l=a;switch(k){case"only":case"first":while(l=l.previousSibling)if(l.nodeType===1)return!1;if(k==="first")return!0;l=a;case"last":while(l=l.nextSibling)if(l.nodeType===1)return!1;return!0;case"nth":c=b[2],d=b[3];if(c===1&&d===0)return!0;f=b[0],g=a.parentNode;if(g&&(g[e]!==f||!a.nodeIndex)){i=0;for(l=g.firstChild;l;l=l.nextSibling)l.nodeType===1&&(l.nodeIndex=++i);g[e]=f}return j=a.nodeIndex-d,c===0?j===0:j%c===0&&j/c>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||!!a.nodeName&&a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=m.attr?m.attr(a,c):o.attrHandle[c]?o.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":!f&&m.attr?d!=null:f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=o.setFilters[e];if(f)return f(a,c,b,d)}}},p=o.match.POS,q=function(a,b){return"\\"+(b-0+1)};for(var r in o.match)o.match[r]=new RegExp(o.match[r].source+/(?![^\[]*\])(?![^\(]*\))/.source),o.leftMatch[r]=new RegExp(/(^(?:.|\r|\n)*?)/.source+o.match[r].source.replace(/\\(\d+)/g,q));var s=function(a,b){return a=Array.prototype.slice.call(a,0),b?(b.push.apply(b,a),b):a};try{Array.prototype.slice.call(H.documentElement.childNodes,0)[0].nodeType}catch(t){s=function(a,b){var c=0,d=b||[];if(g.call(a)==="[object Array]")Array.prototype.push.apply(d,a);else if(typeof a.length=="number")for(var e=a.length;c<e;c++)d.push(a[c]);else for(;a[c];c++)d.push(a[c]);return d}}var u,v;H.documentElement.compareDocumentPosition?u=function(a,b){return a===b?(h=!0,0):!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition?-1:1:a.compareDocumentPosition(b)&4?-1:1}:(u=function(a,b){if(a===b)return h=!0,0;if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],g=a.parentNode,i=b.parentNode,j=g;if(g===i)return v(a,b);if(!g)return-1;if(!i)return 1;while(j)e.unshift(j),j=j.parentNode;j=i;while(j)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++)if(e[k]!==f[k])return v(e[k],f[k]);return k===c?v(a,f[k],-1):v(e[k],b,1)},v=function(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}),function(){var a=H.createElement("div"),c="script"+(new Date).getTime(),d=H.documentElement;a.innerHTML="<a name='"+c+"'/>",d.insertBefore(a,d.firstChild),H.getElementById(c)&&(o.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},o.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),d.removeChild(a),d=a=null}(),function(){var a=H.createElement("div");a.appendChild(H.createComment("")),a.getElementsByTagName("*").length>0&&(o.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(o.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),H.querySelectorAll&&function(){var a=m,b=H.createElement("div"),c="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){m=function(b,d,e,f){d=d||H;if(!f&&!m.isXML(d)){var g=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(g&&(d.nodeType===1||d.nodeType===9)){if(g[1])return s(d.getElementsByTagName(b),e);if(g[2]&&o.find.CLASS&&d.getElementsByClassName)return s(d.getElementsByClassName(g[2]),e)}if(d.nodeType===9){if(b==="body"&&d.body)return s([d.body],e);if(g&&g[3]){var h=d.getElementById(g[3]);if(!h||!h.parentNode)return s([],e);if(h.id===g[3])return s([h],e)}try{return s(d.querySelectorAll(b),e)}catch(i){}}else if(d.nodeType===1&&d.nodeName.toLowerCase()!=="object"){var j=d,k=d.getAttribute("id"),l=k||c,n=d.parentNode,p=/^\s*[+~]/.test(b);k?l=l.replace(/'/g,"\\$&"):d.setAttribute("id",l),p&&n&&(d=d.parentNode);try{if(!p||n)return s(d.querySelectorAll("[id='"+l+"'] "+b),e)}catch(q){}finally{k||j.removeAttribute("id")}}}return a(b,d,e,f)};for(var d in a)m[d]=a[d];b=null}}(),function(){var a=H.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var c=!b.call(H.createElement("div"),"div"),d=!1;try{b.call(H.documentElement,"[test!='']:sizzle")}catch(e){d=!0}m.matchesSelector=function(a,e){e=e.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!m.isXML(a))try{if(d||!o.match.PSEUDO.test(e)&&!/!=/.test(e)){var f=b.call(a,e);if(f||!c||a.document&&a.document.nodeType!==11)return f}}catch(g){}return m(e,null,null,[a]).length>0}}}(),function(){var a=H.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1)return;o.order.splice(1,0,"CLASS"),o.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c)return b.getElementsByClassName(a[1])},a=null}}(),H.documentElement.contains?m.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:H.documentElement.compareDocumentPosition?m.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:m.contains=function(){return!1},m.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var w=function(a,b,c){var d,e=[],f="",g=b.nodeType?[b]:b;while(d=o.match.PSEUDO.exec(a))f+=d[0],a=a.replace(o.match.PSEUDO,"");a=o.relative[a]?a+"*":a;for(var h=0,i=g.length;h<i;h++)m(a,g[h],e,c);return m.filter(f,e)};m.attr=K.attr,m.selectors.attrMap={},K.find=m,K.expr=m.selectors,K.expr[":"]=K.expr.filters,K.unique=m.uniqueSort,K.text=m.getText,K.isXMLDoc=m.isXML,K.contains=m.contains}();var bi=/Until$/,bj=/^(?:parents|prevUntil|prevAll)/,bk=/,/,bl=/^.[^:#\[\.,]*$/,bm=Array.prototype.slice,bn=K.expr.match.POS,bo={children:!0,contents:!0,next:!0,prev:!0};K.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string")return K(a).filter(function(){for(c=0,d=b.length;c<d;c++)if(K.contains(b[c],this))return!0});var e=this.pushStack("","find",a),f,g,h;for(c=0,d=this.length;c<d;c++){f=e.length,K.find(a,this[c],e);if(c>0)for(g=f;g<e.length;g++)for(h=0;h<f;h++)if(e[h]===e[g]){e.splice(g--,1);break}}return e},has:function(a){var b=K(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++)if(K.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(z(this,a,!1),"not",a)},filter:function(a){return this.pushStack(z(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?bn.test(a)?K(a,this.context).index(this[0])>=0:K.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,e,f=this[0];if(K.isArray(a)){var g=1;while(f&&f.ownerDocument&&f!==b){for(d=0;d<a.length;d++)K(f).is(a[d])&&c.push({selector:a[d],elem:f,level:g});f=f.parentNode,g++}return c}var h=bn.test(a)||typeof a!="string"?K(a,b||this.context):0;for(d=0,e=this.length;d<e;d++){f=this[d];while(f){if(h?h.index(f)>-1:K.find.matchesSelector(f,a)){c.push(f);break}f=f.parentNode;if(!f||!f.ownerDocument||f===b||f.nodeType===11)break}}return c=c.length>1?K.unique(c):c,this.pushStack(c,"closest",a)},index:function(a){return a?typeof a=="string"?K.inArray(this[0],K(a)):K.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(a,b){var c=typeof a=="string"?K(a,b):K.makeArray(a&&a.nodeType?[a]:a),d=K.merge(this.get(),c);return this.pushStack(A(c[0])||A(d[0])?d:K.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),K.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return K.dir(a,"parentNode")},parentsUntil:function(a,b,c){return K.dir(a,"parentNode",c)},next:function(a){return K.nth(a,2,"nextSibling")},prev:function(a){return K.nth(a,2,"previousSibling")},nextAll:function(a){return K.dir(a,"nextSibling")},prevAll:function(a){return K.dir(a,"previousSibling")},nextUntil:function(a,b,c){return K.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return K.dir(a,"previousSibling",c)},siblings:function(a){return K.sibling(a.parentNode.firstChild,a)},children:function(a){return K.sibling(a.firstChild)},contents:function(a){return K.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:K.makeArray(a.childNodes)}},function(a,b){K.fn[a]=function(c,d){var e=K.map(this,b,c);return bi.test(a)||(d=c),d&&typeof d=="string"&&(e=K.filter(d,e)),e=this.length>1&&!bo[a]?K.unique(e):e,(this.length>1||bk.test(d))&&bj.test(a)&&(e=e.reverse()),this.pushStack(e,a,bm.call(arguments).join(","))}}),K.extend({filter:function(a,b,c){return c&&(a=":not("+a+")"),b.length===1?K.find.matchesSelector(b[0],a)?[b[0]]:[]:K.find.matches(a,b)},dir:function(a,c,d){var e=[],f=a[c];while(f&&f.nodeType!==9&&(d===b||f.nodeType!==1||!K(f).is(d)))f.nodeType===1&&e.push(f),f=f[c];return e},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var bp="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",bq=/ jQuery\d+="(?:\d+|null)"/g,br=/^\s+/,bs=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,bt=/<([\w:]+)/,bu=/<tbody/i,bv=/<|&#?\w+;/,bw=/<(?:script|style)/i,bx=/<(?:script|object|embed|option|style)/i,by=new RegExp("<(?:"+bp+")","i"),bz=/checked\s*(?:[^=]|=\s*.checked.)/i,bA=/\/(java|ecma)script/i,bB=/^\s*<!(?:\[CDATA\[|\-\-)/,bC={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bD=y(H);bC.optgroup=bC.option,bC.tbody=bC.tfoot=bC.colgroup=bC.caption=bC.thead,bC.th=bC.td,K.support.htmlSerialize||(bC._default=[1,"div<div>","</div>"]),K.fn.extend({text:function(a){return K.isFunction(a)?this.each(function(b){var c=K(this);c.text(a.call(this,b,c.text()))}):typeof a!="object"&&a!==b?this.empty().append((this[0]&&this[0].ownerDocument||H).createTextNode(a)):K.text(this)},wrapAll:function(a){if(K.isFunction(a))return this.each(function(b){K(this).wrapAll(a.call(this,b))});if(this[0]){var b=K(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return K.isFunction(a)?this.each(function(b){K(this).wrapInner(a.call(this,b))}):this.each(function(){var b=K(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=K.isFunction(a);return this.each(function(c){K(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){K.nodeName(this,"body")||K(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=K.clean(arguments);return a.push.apply(a,this.toArray()),this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=this.pushStack(this,"after",arguments);return a.push.apply(a,K.clean(arguments)),a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++)if(!a||K.filter(a,[d]).length)!b&&d.nodeType===1&&(K.cleanData(d.getElementsByTagName("*")),K.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&K.cleanData(b.getElementsByTagName("*"));while(b.firstChild)b.removeChild(b.firstChild)}return this},clone:function(a,b){return a=a==null?!1:a,b=b==null?a:b,this.map(function(){return K.clone(this,a,b)})},html:function(a){if(a===b)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(bq,""):null;if(typeof a=="string"&&!bw.test(a)&&(K.support.leadingWhitespace||!br.test(a))&&!bC[(bt.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(bs,"<$1></$2>");try{for(var c=0,d=this.length;c<d;c++)this[c].nodeType===1&&(K.cleanData(this[c].getElementsByTagName("*")),this[c].innerHTML=a)}catch(e){this.empty().append(a)}}else K.isFunction(a)?this.each(function(b){var c=K(this);c.html(a.call(this,b,c.html()))}):this.empty().append(a);return this},replaceWith:function(a){return this[0]&&this[0].parentNode?K.isFunction(a)?this.each(function(b){var c=K(this),d=c.html();c.replaceWith(a.call(this,b,d))}):(typeof a!="string"&&(a=K(a).detach()),this.each(function(){var b=this.nextSibling,c=this.parentNode;K(this).remove(),b?K(b).before(a):K(c).append(a)})):this.length?this.pushStack(K(K.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,f,g,h,i=a[0],j=[];if(!K.support.checkClone&&arguments.length===3&&typeof i=="string"&&bz.test(i))return this.each(function(){K(this).domManip(a,c,d,!0)});if(K.isFunction(i))return this.each(function(e){var f=K(this);a[0]=i.call(this,e,c?f.html():b),f.domManip(a,c,d)});if(this[0]){h=i&&i.parentNode,K.support.parentNode&&h&&h.nodeType===11&&h.childNodes.length===this.length?e={fragment:h}:e=K.buildFragment(a,this,j),g=e.fragment,g.childNodes.length===1?f=g=g.firstChild:f=g.firstChild;if(f){c=c&&K.nodeName(f,"tr");for(var k=0,l=this.length,m=l-1;k<l;k++)d.call(c?x(this[k],f):this[k],e.cacheable||l>1&&k<m?K.clone(g,!0,!0):g)}j.length&&K.each(j,q)}return this}}),K.buildFragment=function(a,b,c){var d,e,f,g,h=a[0];return b&&b[0]&&(g=b[0].ownerDocument||b[0]),g.createDocumentFragment||(g=H),a.length===1&&typeof h=="string"&&h.length<512&&g===H&&h.charAt(0)==="<"&&!bx.test(h)&&(K.support.checkClone||!bz.test(h))&&(K.support.html5Clone||!by.test(h))&&(e=!0,f=K.fragments[h],f&&f!==1&&(d=f)),d||(d=g.createDocumentFragment(),K.clean(a,g,d,c)),e&&(K.fragments[h]=f?d:1),{fragment:d,cacheable:e}},K.fragments={},K.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){K.fn[a]=function(c){var d=[],e=K(c),f=this.length===1&&this[0].parentNode;if(f&&f.nodeType===11&&f.childNodes.length===1&&e.length===1)return e[b](this[0]),this;for(var g=0,h=e.length;g<h;g++){var i=(g>0?this.clone(!0):this).get();K(e[g])[b](i),d=d.concat(i)}return this.pushStack(d,a,e.selector)}}),K.extend({clone:function(a,b,c){var d,e,f,g=K.support.html5Clone||!by.test("<"+a.nodeName)?a.cloneNode(!0):r(a);if((!K.support.noCloneEvent||!K.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!K.isXMLDoc(a)){v(a,g),d=u(a),e=u(g);for(f=0;d[f];++f)e[f]&&v(d[f],e[f])}if(b){w(a,g);if(c){d=u(a),e=u(g);for(f=0;d[f];++f)w(d[f],e[f])}}return d=e=null,g},clean:function(a,b,c,d){var e;b=b||H,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||H);var f=[],g;for(var h=0,i;(i=a[h])!=null;h++){typeof i=="number"&&(i+="");if(!i)continue;if(typeof i=="string")if(!bv.test(i))i=b.createTextNode(i);else{i=i.replace(bs,"<$1></$2>");var j=(bt.exec(i)||["",""])[1].toLowerCase(),k=bC[j]||bC._default,l=k[0],m=b.createElement("div");b===H?bD.appendChild(m):y(b).appendChild(m),m.innerHTML=k[1]+i+k[2];while(l--)m=m.lastChild;if(!K.support.tbody){var n=bu.test(i),o=j==="table"&&!n?m.firstChild&&m.firstChild.childNodes:k[1]==="<table>"&&!n?m.childNodes:[];for(g=o.length-1;g>=0;--g)K.nodeName(o[g],"tbody")&&!o[g].childNodes.length&&o[g].parentNode.removeChild(o[g])}!K.support.leadingWhitespace&&br.test(i)&&m.insertBefore(b.createTextNode(br.exec(i)[0]),m.firstChild),i=m.childNodes}var p;if(!K.support.appendChecked)if(i[0]&&typeof (p=i.length)=="number")for(g=0;g<p;g++)s(i[g]);else s(i);i.nodeType?f.push(i):f=K.merge(f,i)}if(c){e=function(a){return!a.type||bA.test(a.type)};for(h=0;f[h];h++)if(d&&K.nodeName(f[h],"script")&&(!f[h].type||f[h].type.toLowerCase()==="text/javascript"))d.push(f[h].parentNode?f[h].parentNode.removeChild(f[h]):f[h]);else{if(f[h].nodeType===1){var q=K.grep(f[h].getElementsByTagName("script"),e);f.splice.apply(f,[h+1,0].concat(q))}c.appendChild(f[h])}}return f},cleanData:function(a){var b,c,d=K.cache,e=K.event.special,f=K.support.deleteExpando;for(var g=0,h;(h=a[g])!=null;g++){if(h.nodeName&&K.noData[h.nodeName.toLowerCase()])continue;c=h[K.expando];if(c){b=d[c];if(b&&b.events){for(var i in b.events)e[i]?K.event.remove(h,i):K.removeEvent(h,i,b.handle);b.handle&&(b.handle.elem=null)}f?delete h[K.expando]:h.removeAttribute&&h.removeAttribute(K.expando),delete d[c]}}}});var bE=/alpha\([^)]*\)/i,bF=/opacity=([^)]*)/,bG=/([A-Z]|^ms)/g,bH=/^-?\d+(?:px)?$/i,bI=/^-?\d/,bJ=/^([\-+])=([\-+.\de]+)/,bK={position:"absolute",visibility:"hidden",display:"block"},bL=["Left","Right"],bM=["Top","Bottom"],bN,bO,bP;K.fn.css=function(a,c){return arguments.length===2&&c===b?this:K.access(this,a,c,!0,function(a,c,d){return d!==b?K.style(a,c,d):K.css(a,c)})},K.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bN(a,"opacity","opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":K.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var f,g,h=K.camelCase(c),i=a.style,j=K.cssHooks[h];c=K.cssProps[h]||h;if(d===b)return j&&"get"in j&&(f=j.get(a,!1,e))!==b?f:i[c];g=typeof d,g==="string"&&(f=bJ.exec(d))&&(d=+(f[1]+1)*+f[2]+parseFloat(K.css(a,c)),g="number");if(d==null||g==="number"&&isNaN(d))return;g==="number"&&!K.cssNumber[h]&&(d+="px");if(!j||!("set"in j)||(d=j.set(a,d))!==b)try{i[c]=d}catch(k){}}},css:function(a,c,d){var e,f;c=K.camelCase(c),f=K.cssHooks[c],c=K.cssProps[c]||c,c==="cssFloat"&&(c="float");if(f&&"get"in f&&(e=f.get(a,!0,d))!==b)return e;if(bN)return bN(a,c)},swap:function(a,b,c){var d={};for(var e in b)d[e]=a.style[e],a.style[e]=b[e];c.call(a);for(e in b)a.style[e]=d[e]}}),K.curCSS=K.css,K.each(["height","width"],function(a,b){K.cssHooks[b]={get:function(a,c,d){var e;if(c)return a.offsetWidth!==0?p(a,b,d):(K.swap(a,bK,function(){e=p(a,b,d)}),e)},set:function(a,b){if(!bH.test(b))return b;b=parseFloat(b);if(b>=0)return b+"px"}}}),K.support.opacity||(K.cssHooks.opacity={get:function(a,b){return bF.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=K.isNumeric(b)?"alpha(opacity="+b*100+")":"",f=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&K.trim(f.replace(bE,""))===""){c.removeAttribute("filter");if(d&&!d.filter)return}c.filter=bE.test(f)?f.replace(bE,e):f+" "+e}}),K(function(){K.support.reliableMarginRight||(K.cssHooks.marginRight={get:function(a,b){var c;return K.swap(a,{display:"inline-block"},function(){b?c=bN(a,"margin-right","marginRight"):c=a.style.marginRight}),c}})}),H.defaultView&&H.defaultView.getComputedStyle&&(bO=function(a,b){var c,d,e;return b=b.replace(bG,"-$1").toLowerCase(),(d=a.ownerDocument.defaultView)&&(e=d.getComputedStyle(a,null))&&(c=e.getPropertyValue(b),c===""&&!K.contains(a.ownerDocument.documentElement,a)&&(c=K.style(a,b))),c}),H.documentElement.currentStyle&&(bP=function(a,b){var c,d,e,f=a.currentStyle&&a.currentStyle[b],g=a.style;return f===null&&g&&(e=g[b])&&(f=e),!bH.test(f)&&bI.test(f)&&(c=g.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),g.left=b==="fontSize"?"1em":f||0,f=g.pixelLeft+"px",g.left=c,d&&(a.runtimeStyle.left=d)),f===""?"auto":f}),bN=bO||bP,K.expr&&K.expr.filters&&(K.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!K.support.reliableHiddenOffsets&&(a.style&&a.style.display||K.css(a,"display"))==="none"},K.expr.filters.visible=function(a){return!K.expr.filters.hidden(a)});var bQ=/%20/g,bR=/\[\]$/,bS=/\r?\n/g,bT=/#.*$/,bU=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bV=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bW=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,bX=/^(?:GET|HEAD)$/,bY=/^\/\//,bZ=/\?/,b$=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,b_=/^(?:select|textarea)/i,ca=/\s+/,cb=/([?&])_=[^&]*/,cc=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,cd=K.fn.load,ce={},cf={},cg,ch,ci=["*/"]+["*"];try{cg=J.href}catch(cj){cg=H.createElement("a"),cg.href="",cg=cg.href}ch=cc.exec(cg.toLowerCase())||[],K.fn.extend({load:function(a,c,d){if(typeof a!="string"&&cd)return cd.apply(this,arguments);if(!this.length)return this;var e=a.indexOf(" ");if(e>=0){var f=a.slice(e,a.length);a=a.slice(0,e)}var g="GET";c&&(K.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=K.param(c,K.ajaxSettings.traditional),g="POST"));var h=this;return K.ajax({url:a,type:g,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),h.html(f?K("<div>").append(c.replace(b$,"")).find(f):c)),d&&h.each(d,[c,b,a])}}),this},serialize:function(){return K.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?K.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||b_.test(this.nodeName)||bV.test(this.type))}).map(function(a,b){var c=K(this).val();return c==null?null:K.isArray(c)?K.map(c,function(a,c){return{name:b.name,value:a.replace(bS,"\r\n")}}):{name:b.name,value:c.replace(bS,"\r\n")}}).get()}}),K.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){K.fn[b]=function(a){return this.on(b,a)}}),K.each(["get","post"],function(a,c){K[c]=function(a,d,e,f){return K.isFunction(d)&&(f=f||e,e=d,d=b),K.ajax({type:c,url:a,data:d,success:e,dataType:f})}}),K.extend({getScript:function(a,c){return K.get(a,b,c,"script")},getJSON:function(a,b,c){return K.get(a,b,c,"json")},ajaxSetup:function(a,b){return b?m(a,K.ajaxSettings):(b=a,a=K.ajaxSettings),m(a,b),a},ajaxSettings:{url:cg,isLocal:bW.test(ch[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":ci},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":K.parseJSON,"text xml":K.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:o(ce),ajaxTransport:o(cf),ajax:function(a,c){function d(a,c,d,n){if(v!==2){v=2,t&&clearTimeout(t),s=b,q=n||"",y.readyState=a>0?4:0;var o,p,r,u=c,x=d?k(e,y,d):b,z,A;if(a>=200&&a<300||a===304){if(e.ifModified){if(z=y.getResponseHeader("Last-Modified"))K.lastModified[m]=z;if(A=y.getResponseHeader("Etag"))K.etag[m]=A}if(a===304)u="notmodified",o=!0;else try{p=j(e,x),u="success",o=!0}catch(B){u="parsererror",r=B}}else{r=u;if(!u||a)u="error",a<0&&(a=0)}y.status=a,y.statusText=""+(c||u),o?h.resolveWith(f,[p,u,y]):h.rejectWith(f,[y,u,r]),y.statusCode(l),l=b,w&&g.trigger("ajax"+(o?"Success":"Error"),[y,e,o?p:r]),i.fireWith(f,[y,u]),w&&(g.trigger("ajaxComplete",[y,e]),--K.active||K.event.trigger("ajaxStop"))}}typeof a=="object"&&(c=a,a=b),c=c||{};var e=K.ajaxSetup({},c),f=e.context||e,g=f!==e&&(f.nodeType||f instanceof K)?K(f):K.event,h=K.Deferred(),i=K.Callbacks("once memory"),l=e.statusCode||{},m,o={},p={},q,r,s,t,u,v=0,w,x,y={readyState:0,setRequestHeader:function(a,b){if(!v){var c=a.toLowerCase();a=p[c]=p[c]||a,o[a]=b}return this},getAllResponseHeaders:function(){return v===2?q:null},getResponseHeader:function(a){var c;if(v===2){if(!r){r={};while(c=bU.exec(q))r[c[1].toLowerCase()]=c[2]}c=r[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){return v||(e.mimeType=a),this},abort:function(a){return a=a||"abort",s&&s.abort(a),d(0,a),this}};h.promise(y),y.success=y.done,y.error=y.fail,y.complete=i.add,y.statusCode=function(a){if(a){var b;if(v<2)for(b in a)l[b]=[l[b],a[b]];else b=a[y.status],y.then(b,b)}return this},e.url=((a||e.url)+"").replace(bT,"").replace(bY,ch[1]+"//"),e.dataTypes=K.trim(e.dataType||"*").toLowerCase().split(ca),e.crossDomain==null&&(u=cc.exec(e.url.toLowerCase()),e.crossDomain=!(!u||u[1]==ch[1]&&u[2]==ch[2]&&(u[3]||(u[1]==="http:"?80:443))==(ch[3]||(ch[1]==="http:"?80:443)))),e.data&&e.processData&&typeof e.data!="string"&&(e.data=K.param(e.data,e.traditional)),n(ce,e,c,y);if(v===2)return!1;w=e.global,e.type=e.type.toUpperCase(),e.hasContent=!bX.test(e.type),w&&K.active++===0&&K.event.trigger("ajaxStart");if(!e.hasContent){e.data&&(e.url+=(bZ.test(e.url)?"&":"?")+e.data,delete e.data),m=e.url;if(e.cache===!1){var z=K.now(),A=e.url.replace(cb,"$1_="+z);e.url=A+(A===e.url?(bZ.test(e.url)?"&":"?")+"_="+z:"")}}(e.data&&e.hasContent&&e.contentType!==!1||c.contentType)&&y.setRequestHeader("Content-Type",e.contentType),e.ifModified&&(m=m||e.url,K.lastModified[m]&&y.setRequestHeader("If-Modified-Since",K.lastModified[m]),K.etag[m]&&y.setRequestHeader("If-None-Match",K.etag[m])),y.setRequestHeader("Accept",e.dataTypes[0]&&e.accepts[e.dataTypes[0]]?e.accepts[e.dataTypes[0]]+(e.dataTypes[0]!=="*"?", "+ci+"; q=0.01":""):e.accepts["*"]);for(x in e.headers)y.setRequestHeader(x,e.headers[x]);if(!e.beforeSend||e.beforeSend.call(f,y,e)!==!1&&v!==2){for(x in{success:1,error:1,complete:1})y[x](e[x]);s=n(cf,e,c,y);if(!s)d(-1,"No Transport");else{y.readyState=1,w&&g.trigger("ajaxSend",[y,e]),e.async&&e.timeout>0&&(t=setTimeout(function(){y.abort("timeout")},e.timeout));try{v=1,s.send(o,d)}catch(B){if(v<2)d(-1,B);else throw B}}return y}return y.abort(),!1},param:function(a,c){var d=[],e=function(a,b){b=K.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=K.ajaxSettings.traditional);if(K.isArray(a)||a.jquery&&!K.isPlainObject(a))K.each(a,function(){e(this.name,this.value)});else for(var f in a)l(f,a[f],c,e);return d.join("&").replace(bQ,"+")}}),K.extend({active:0,lastModified:{},etag:{}});var ck=K.now(),cl=/(\=)\?(&|$)|\?\?/i;K.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return K.expando+"_"+ck++}}),K.ajaxPrefilter("json jsonp",function(b,c,d){var e=b.contentType==="application/x-www-form-urlencoded"&&typeof b.data=="string";if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(cl.test(b.url)||e&&cl.test(b.data))){var f,g=b.jsonpCallback=K.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h=a[g],i=b.url,j=b.data,k="$1"+g+"$2";return b.jsonp!==!1&&(i=i.replace(cl,k),b.url===i&&(e&&(j=j.replace(cl,k)),b.data===j&&(i+=(/\?/.test(i)?"&":"?")+b.jsonp+"="+g))),b.url=i,b.data=j,a[g]=function(a){f=[a]},d.always(function(){a[g]=h,f&&K.isFunction(h)&&a[g](f[0])}),b.converters["script json"]=function(){return f||K.error(g+" was not called"),f[0]},b.dataTypes[0]="json","script"}}),K.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){return K.globalEval(a),a}}}),K.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),K.ajaxTransport("script",function(a){if(a.crossDomain){var c,d=H.head||H.getElementsByTagName("head")[0]||H.documentElement;return{send:function(e,f){c=H.createElement("script"),c.async="async",a.scriptCharset&&(c.charset=a.scriptCharset),c.src=a.url,c.onload=c.onreadystatechange=function(a,e){if(e||!c.readyState||/loaded|complete/.test(c.readyState))c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c),c=b,e||f(200,"success")},d.insertBefore(c,d.firstChild)},abort:function(){c&&c.onload(0,1)}}}});var cm=a.ActiveXObject?function(){for(var a in co)co[a](0,1)}:!1,cn=0,co;K.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&i()||h()}:i,function(a){K.extend(K.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(K.ajaxSettings.xhr()),K.support.ajax&&K.ajaxTransport(function(c){if(!c.crossDomain||K.support.cors){var d;return{send:function(e,f){var g=c.xhr(),h,i;c.username?g.open(c.type,c.url,c.async,c.username,c.password):g.open(c.type,c.url,c.async);if(c.xhrFields)for(i in c.xhrFields)g[i]=c.xhrFields[i];c.mimeType&&g.overrideMimeType&&g.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(i in e)g.setRequestHeader(i,e[i])}catch(j){}g.send(c.hasContent&&c.data||null),d=function(a,e){var i,j,k,l,m;try{if(d&&(e||g.readyState===4)){d=b,h&&(g.onreadystatechange=K.noop,cm&&delete co[h]);if(e)g.readyState!==4&&g.abort();else{i=g.status,k=g.getAllResponseHeaders(),l={},m=g.responseXML,m&&m.documentElement&&(l.xml=m),l.text=g.responseText;try{j=g.statusText}catch(n){j=""}!i&&c.isLocal&&!c.crossDomain?i=l.text?200:404:i===1223&&(i=204)}}}catch(o){e||f(-1,o)}l&&f(i,j,l,k)},!c.async||g.readyState===4?d():(h=++cn,cm&&(co||(co={},K(a).unload(cm)),co[h]=d),g.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var cp={},cq,cr,cs=/^(?:toggle|show|hide)$/,ct=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,cu,cv=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cw;K.fn.extend({show:function(a,b,c){var f,g;if(a||a===0)return this.animate(e("show",3),a,b,c);for(var h=0,i=this.length;h<i;h++)f=this[h],f.style&&(g=f.style.display,!K._data(f,"olddisplay")&&g==="none"&&(g=f.style.display=""),g===""&&K.css(f,"display")==="none"&&K._data(f,"olddisplay",d(f.nodeName)));for(h=0;h<i;h++){f=this[h];if(f.style){g=f.style.display;if(g===""||g==="none")f.style.display=K._data(f,"olddisplay")||""}}return this},hide:function(a,b,c){if(a||a===0)return this.animate(e("hide",3),a,b,c);var d,f,g=0,h=this.length;for(;g<h;g++)d=this[g],d.style&&(f=K.css(d,"display"),f!=="none"&&!K._data(d,"olddisplay")&&K._data(d,"olddisplay",f));for(g=0;g<h;g++)this[g].style&&(this[g].style.display="none");return this},_toggle:K.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";return K.isFunction(a)&&K.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:K(this).is(":hidden");K(this)[b?"show":"hide"]()}):this.animate(e("toggle",3),a,b,c),this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,e){function f(){g.queue===!1&&K._mark(this);var b=K.extend({},g),c=this.nodeType===1,e=c&&K(this).is(":hidden"),f,h,i,j,k,l,m,n,o;b.animatedProperties={};for(i in a){f=K.camelCase(i),i!==f&&(a[f]=a[i],delete a[i]),h=a[f],K.isArray(h)?(b.animatedProperties[f]=h[1],h=a[f]=h[0]):b.animatedProperties[f]=b.specialEasing&&b.specialEasing[f]||b.easing||"swing";if(h==="hide"&&e||h==="show"&&!e)return b.complete.call(this);c&&(f==="height"||f==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],K.css(this,"display")==="inline"&&K.css(this,"float")==="none"&&(!K.support.inlineBlockNeedsLayout||d(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a)j=new K.fx(this,b,i),h=a[i],cs.test(h)?(o=K._data(this,"toggle"+i)||(h==="toggle"?e?"show":"hide":0),o?(K._data(this,"toggle"+i,o==="show"?"hide":"show"),j[o]()):j[h]()):(k=ct.exec(h),l=j.cur(),k?(m=parseFloat(k[2]),n=k[3]||(K.cssNumber[i]?"":"px"),n!=="px"&&(K.style(this,i,(m||1)+n),l=(m||1)/j.cur()*l,K.style(this,i,l+n)),k[1]&&(m=(k[1]==="-="?-1:1)*m+l),j.custom(l,m,n)):j.custom(l,h,""));return!0}var g=K.speed(b,c,e);return K.isEmptyObject(a)?this.each(g.complete,[!1]):(a=K.extend({},a),g.queue===!1?this.each(f):this.queue(g.queue,f))},stop:function(a,c,d){return typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){function b(a,b,c){var e=b[c];K.removeData(a,c,!0),e.stop(d)}var c,e=!1,f=K.timers,g=K._data(this);d||K._unmark(!0,this);if(a==null)for(c in g)g[c]&&g[c].stop&&c.indexOf(".run")===c.length-4&&b(this,g,c);else g[c=a+".run"]&&g[c].stop&&b(this,g,c);for(c=f.length;c--;)f[c].elem===this&&(a==null||f[c].queue===a)&&(d?f[c](!0):f[c].saveState(),e=!0,f.splice(c,1));(!d||!e)&&K.dequeue(this,a)})}}),K.each({slideDown:e("show",1),slideUp:e("hide",1),slideToggle:e("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){K.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),K.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?K.extend({},a):{complete:c||!c&&b||K.isFunction(a)&&a,duration:a,easing:c&&b||b&&!K.isFunction(b)&&b};d.duration=K.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in K.fx.speeds?K.fx.speeds[d.duration]:K.fx.speeds._default;if(d.queue==null||d.queue===!0)d.queue="fx";return d.old=d.complete,d.complete=function(a){K.isFunction(d.old)&&d.old.call(this),d.queue?K.dequeue(this,d.queue):a!==!1&&K._unmark(this)},d},easing:{linear:function(a,b,c,d){return c+d*a},swing:function(a,b,c,d){return(-Math.cos(a*Math.PI)/2+.5)*d+c}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),K.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(K.fx.step[this.prop]||K.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]==null||!!this.elem.style&&this.elem.style[this.prop]!=null){var a,b=K.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a}return this.elem[this.prop]},custom:function(a,c,d){function e(a){return f.step(a)}var f=this,h=K.fx;this.startTime=cw||g(),this.end=c,this.now=this.start=a,this.pos=this.state=0,this.unit=d||this.unit||(K.cssNumber[this.prop]?"":"px"),e.queue=this.options.queue,e.elem=this.elem,e.saveState=function(){f.options.hide&&K._data(f.elem,"fxshow"+f.prop)===b&&K._data(f.elem,"fxshow"+f.prop,f.start)},e()&&K.timers.push(e)&&!cu&&(cu=setInterval(h.tick,h.interval))},show:function(){var a=K._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=a||K.style(this.elem,this.prop),this.options.show=!0,a!==b?this.custom(this.cur(),a):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),K(this.elem).show()},hide:function(){this.options.orig[this.prop]=K._data(this.elem,"fxshow"+this.prop)||K.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b,c,d,e=cw||g(),f=!0,h=this.elem,i=this.options;if(a||e>=i.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),i.animatedProperties[this.prop]=!0;for(b in i.animatedProperties)i.animatedProperties[b]!==!0&&(f=!1);if(f){i.overflow!=null&&!K.support.shrinkWrapBlocks&&K.each(["","X","Y"],function(a,b){h.style["overflow"+b]=i.overflow[a]}),i.hide&&K(h).hide();if(i.hide||i.show)for(b in i.animatedProperties)K.style(h,b,i.orig[b]),K.removeData(h,"fxshow"+b,!0),K.removeData(h,"toggle"+b,!0);d=i.complete,d&&(i.complete=!1,d.call(h))}return!1}return i.duration==Infinity?this.now=e:(c=e-this.startTime,this.state=c/i.duration,this.pos=K.easing[i.animatedProperties[this.prop]](this.state,c,0,1,i.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update(),!0}},K.extend(K.fx,{tick:function(){var a,b=K.timers,c=0;for(;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||K.fx.stop()},interval:13,stop:function(){clearInterval(cu),cu=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){K.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=a.now+a.unit:a.elem[a.prop]=a.now}}}),K.each(["width","height"],function(a,b){K.fx.step[b]=function(a){K.style(a.elem,b,Math.max(0,a.now)+a.unit)}}),K.expr&&K.expr.filters&&(K.expr.filters.animated=function(a){return K.grep(K.timers,function(b){return a===b.elem}).length});var cx=/^t(?:able|d|h)$/i,cy=/^(?:body|html)$/i;"getBoundingClientRect"in H.documentElement?K.fn.offset=function(a){var b=this[0],d;if(a)return this.each(function(b){K.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return K.offset.bodyOffset(b);try{d=b.getBoundingClientRect()}catch(e){}var f=b.ownerDocument,g=f.documentElement;if(!d||!K.contains(g,b))return d?{top:d.top,left:d.left}:{top:0,left:0};var h=f.body,i=c(f),j=g.clientTop||h.clientTop||0,k=g.clientLeft||h.clientLeft||0,l=i.pageYOffset||K.support.boxModel&&g.scrollTop||h.scrollTop,m=i.pageXOffset||K.support.boxModel&&g.scrollLeft||h.scrollLeft,n=d.top+l-j,o=d.left+m-k;return{top:n,left:o}}:K.fn.offset=function(a){var b=this[0];if(a)return this.each(function(b){K.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return K.offset.bodyOffset(b);var c,d=b.offsetParent,e=b,f=b.ownerDocument,g=f.documentElement,h=f.body,i=f.defaultView,j=i?i.getComputedStyle(b,null):b.currentStyle,k=b.offsetTop,l=b.offsetLeft;while((b=b.parentNode)&&b!==h&&b!==g){if(K.support.fixedPosition&&j.position==="fixed")break;c=i?i.getComputedStyle(b,null):b.currentStyle,k-=b.scrollTop,l-=b.scrollLeft,b===d&&(k+=b.offsetTop,l+=b.offsetLeft,K.support.doesNotAddBorder&&(!K.support.doesAddBorderForTableAndCells||!cx.test(b.nodeName))&&(k+=parseFloat(c.borderTopWidth)||0,l+=parseFloat(c.borderLeftWidth)||0),e=d,d=b.offsetParent),K.support.subtractsBorderForOverflowNotVisible&&c.overflow!=="visible"&&(k+=parseFloat(c.borderTopWidth)||0,l+=parseFloat(c.borderLeftWidth)||0),j=c}if(j.position==="relative"||j.position==="static")k+=h.offsetTop,l+=h.offsetLeft;return K.support.fixedPosition&&j.position==="fixed"&&(k+=Math.max(g.scrollTop,h.scrollTop),l+=Math.max(g.scrollLeft,h.scrollLeft)),{top:k,left:l}},K.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;return K.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(K.css(a,"marginTop"))||0,c+=parseFloat(K.css(a,"marginLeft"))||0),{top:b,left:c}},setOffset:function(a,b,c){var d=K.css(a,"position");d==="static"&&(a.style.position="relative");var e=K(a),f=e.offset(),g=K.css(a,"top"),h=K.css(a,"left"),i=(d==="absolute"||d==="fixed")&&K.inArray("auto",[g,h])>-1,j={},k={},l,m;i?(k=e.position(),l=k.top,m=k.left):(l=parseFloat(g)||0,m=parseFloat(h)||0),K.isFunction(b)&&(b=b.call(a,c,f)),b.top!=null&&(j.top=b.top-f.top+l),b.left!=null&&(j.left=b.left-f.left+m),"using"in b?b.using.call(a,j):e.css(j)}},K.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),c=this.offset(),d=cy.test(b[0].nodeName)?{top:0,left:0}:b.offset();return c.top-=parseFloat(K.css(a,"marginTop"))||0,c.left-=parseFloat(K.css(a,"marginLeft"))||0,d.top+=parseFloat(K.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(K.css(b[0],"borderLeftWidth"))||0,{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||H.body;while(a&&!cy.test(a.nodeName)&&K.css(a,"position")==="static")a=a.offsetParent;return a})}}),K.each(["Left","Top"],function(a,d){var e="scroll"+d;K.fn[e]=function(d){var f,g;return d===b?(f=this[0],f?(g=c(f),g?"pageXOffset"in g?g[a?"pageYOffset":"pageXOffset"]:K.support.boxModel&&g.document.documentElement[e]||g.document.body[e]:f[e]):null):this.each(function(){g=c(this),g?g.scrollTo(a?K(g).scrollLeft():d,a?d:K(g).scrollTop()):this[e]=d})}}),K.each(["Height","Width"],function(a,c){var d=c.toLowerCase();K.fn["inner"+c]=function(){var a=this[0];return a?a.style?parseFloat(K.css(a,d,"padding")):this[d]():null},K.fn["outer"+c]=function(a){var b=this[0];return b?b.style?parseFloat(K.css(b,d,a?"margin":"border")):this[d]():null},K.fn[d]=function(a){var e=this[0];if(!e)return a==null?null:this;if(K.isFunction(a))return this.each(function(b){var c=K(this);c[d](a.call(this,b,c[d]()))});if(K.isWindow(e)){var f=e.document.documentElement["client"+c],g=e.document.body;return e.document.compatMode==="CSS1Compat"&&f||g&&g["client"+c]||f}if(e.nodeType===9)return Math.max(e.documentElement["client"+c],e.body["scroll"+c],e.documentElement["scroll"+c],e.body["offset"+c],e.documentElement["offset"+c]);if(a===b){var h=K.css(e,d),i=parseFloat(h);return K.isNumeric(i)?i:h}return this.css(d,typeof a=="string"?a:a+"px")}}),a.jQuery=a.$=K,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return K})}(window),TD.controller.feather=function(){var exposed={};exposed.latestFeatherId=0;var feather_base;return window.location.href.indexOf("http://localhost:8090")===0?feather_base="http://localhost:8090":feather_base="https://web.tweetdeck.com",exposed.loadFeathers=function(isRetry){var d=new TD.core.defer.Deferred;return $.get(feather_base+"/web/scripts/unbundled/feathers.js").success(function(feathers){eval(feathers),d.callback()}).error(function(a,b,c){isRetry||exposed.loadFeathers(!0),d.errback()}),d},exposed.applyFeathers=function(a){var b=exposed.latestFeatherId,c,d=_.sortBy(a,function(a){return a.id});for(var e=0;e<d.length;e++){c=d[e];if(c.id>b)try{c.patch(),b=c.id}catch(f){console.log("Error patching feather id: "+c.id+" "+f)}}exposed.latestFeatherId=b},setInterval(exposed.loadFeathers,36e5),exposed}(),TD.constants={keyCodes:{enter:13,escape:27,tab:9,del:8,spacebar:32,upArrow:38,downArrow:40,leftArrow:37,rightArrow:39},charCodes:{space:32,questionMark:63},regexps:{name:/\S+/,username:/^[@ï¼ ]?([a-zA-Z0-9_]{1,15})$/,usernameWithAt:/^[@ï¼ ]{1}([a-zA-Z0-9_]{1,15}) /,usernameWithSpace:/^[@ï¼ ]{1}(\w{1,15})\s*$/,email:/^[\w-]+([^@,\s\<\>\(\)]*[\w-]+)?\@[\w-]+(\.[\w-]+)*\.[a-z]{2,}$/i}},function(a){var b={};a.publish=function(c,e){var f=b[c];f&&a.each(f,function(){this.apply(a,e||[])})},a.subscribe=function(a,c){return b[a]||(b[a]=[]),b[a].push(c),[a,c]},a.unsubscribe=function(c){if(!c||!(c instanceof Array))throw new Error("unsubscribe(): handle must be an instance of Array.");var e=c[0];b[e]&&a.each(b[e],function(a){this==c[1]&&b[e].splice(a,1)})},a.unsubscribeAll=function(a){delete b[a]}}(jQuery),TD.core.base64=function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b=function(a){a=a.replace(/\r\n/g,"\n");var b="";for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(d&63|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(d&63|128))}return b},c=function(a){var b="",c=0,d=c1=c2=0;while(c<a.length)d=a.charCodeAt(c),d<128?(b+=String.fromCharCode(d),c++):d>191&&d<224?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((d&31)<<6|c2&63),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((d&15)<<12|(c2&63)<<6|c3&63),c+=3);return b},d=function(c){var d="",e,f,g,h,i,j,k,l=0;c=b(c);while(l<c.length)e=c.charCodeAt(l++),f=c.charCodeAt(l++),g=c.charCodeAt(l++),h=e>>2,i=(e&3)<<4|f>>4,j=(f&15)<<2|g>>6,k=g&63,isNaN(f)?j=k=64:isNaN(g)&&(k=64),d=d+a.charAt(h)+a.charAt(i)+a.charAt(j)+a.charAt(k);return d},e=function(b){var d="",e,f,g,h,i,j,k,l=0;b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(l<b.length)h=a.indexOf(b.charAt(l++)),i=a.indexOf(b.charAt(l++)),j=a.indexOf(b.charAt(l++)),k=a.indexOf(b.charAt(l++)),e=h<<2|i>>4,f=(i&15)<<4|j>>2,g=(j&3)<<6|k,d=d+String.fromCharCode(e),j!=64&&(d=d+String.fromCharCode(f)),k!=64&&(d=d+String.fromCharCode(g));return d=c(d),d};return{encode:d,decode:e}}(),function(a,b){function c(a){return"[object Arguments]"==bc.call(a)}function d(a){return new e(a)}function e(a){if(a&&a._wrapped)return a;this._wrapped=a}function f(){for(var a,b,c,d=-1,e=arguments.length,f={e:"",f:"",k:"",q:"",c:{d:"",m:"++l<o"},o:{d:""}};++d<e;)for(b in a=arguments[d],a)c=(c=a[b])==B?"":c,/d|m|j/.test(b)?("string"==typeof c&&(c={b:c,n:c}),f.c[b]=c.b,f.o[b]=c.n):f[b]=c;a=f.a,b=f.c,c=f.o;var d=/^[^,]+/.exec(a)[0],e=c.m,g=/\S+$/.exec(e||d)[0];f.g=d,f.i=E,f.h="j.call("+g+",l)",f.l=g,f.p=L,f.r=f.r!==C,f.f||(f.f="if(!"+d+")return u");if("r"==d||!b.j)f.c=B;return e||(c.m="l in "+g),Function("c,i,j,k,n,s,w,z,C,D,h,E",'"use strict";return function('+a+"){"+bj(f)+"}")(R,U,_,y,j,P,bb,X,bc,A,C)}function g(a,b){return N[b]}function h(a){return"\\"+Q[a]}function i(a){return O[a]}function j(a,b){return function(c,d,e){return a.call(b,c,d,e)}}function k(){}function l(a,b){var c=N.length;return N[c]="'+_.escape("+b+")+'",M+c}function m(a,b){var c=N.length;return N[c]="'+((__t=("+b+"))==null?'':__t)+'",M+c}function n(a,b){var c=N.length;return N[c]="';"+b+";__p+='",M+c}function o(a,b,c,d){if(!a)return c;var e=a.length,f=3>arguments.length;d&&(b=j(b,d));if(e===e>>>0){for(e&&f&&(c=a[--e]);e--;)c=b(c,a[e],e,a);return c}var g=bC(a);for((e=g.length)&&f&&(c=a[g[--e]]);e--;)f=g[e],c=b(c,a[f],f,a);return c}function p(a,c,d){if(a)return c==b||d?a[0]:bb.call(a,0,c)}function q(a,b){var c=[];if(!a)return c;for(var d,e=-1,f=a.length;++e<f;)d=a[e],bB(d)?ba.apply(c,b?d:q(d)):c.push(d);return c}function r(a,b,c){if(!a)return-1;var d=-1,e=a.length;if(c){if("number"!=typeof c)return d=u(a,b),a[d]===b?d:-1;d=(0>c?Math.max(0,e+c):c)-1}for(;++d<e;)if(a[d]===b)return d;return-1}function s(a,b,c){var d=-Infinity,e=d;if(!a)return e;var f=-1,g=a.length;if(!b){for(;++f<g;)a[f]>e&&(e=a[f]);return e}for(c&&(b=j(b,c));++f<g;)c=b(a[f],f,a),c>d&&(d=c,e=a[f]);return e}function t(a,c,d){return a?bb.call(a,c==b||d?1:c):[]}function u(a,b,c,d){if(!a)return 0;var e,f=0,g=a.length;if(c){if(d)var h=c,c=function(a){return h.call(d,a)};for(b=c(b);f<g;)e=f+g>>>1,c(a[e])<b?f=e+1:g=e}else for(;f<g;)e=f+g>>>1,a[e]<b?f=e+1:g=e;return f}function v(a,b,c,d){var e=[];if(!a)return e;var f=-1,g=a.length,h=[];"function"==typeof b&&(d=c,c=b,b=C);for(c?d&&(c=j(c,d)):c=y;++f<g;)if(d=c(a[f],f,a),b?!f||h[h.length-1]!==d:0>r(h,d))h.push(d),e.push(a[f]);return e}function w(a,b){function c(){var g=arguments,h=b;return e||(a=b[d]),f.length&&(g=g.length?$.apply(f,g):f),this instanceof c?(k.prototype=a.prototype,h=new k,g=a.apply(h,g),P[typeof g]&&g!==B?g:h):a.apply(h,g)}var d,e=bc.call(a)==U;if(e){if(bd)return bd.call.apply(bd,arguments)}else d=b,b=a;var f=bb.call(arguments,2);return c}function x(a,c,d){d||(d=[]);if(a===c)return 0!==a||1/a==1/c;if(a==b||c==b)return a===c;a._chain&&(a=a._wrapped),c._chain&&(c=c._wrapped);if(a.isEqual&&bc.call(a.isEqual)==U)return a.isEqual(c);if(c.isEqual&&bc.call(c.isEqual)==U)return c.isEqual(a);var e=bc.call(a);if(e!=bc.call(c))return C;switch(e){case X:return a==""+c;case V:return a!=+a?c!=+c:0==a?1/a==1/c:a==+c;case S:case T:return+a==+c;case W:return a.source==c.source&&a.global==c.global&&a.multiline==c.multiline&&a.ignoreCase==c.ignoreCase}if("object"!=typeof a||"object"!=typeof c)return C;for(var f=d.length;f--;)if(d[f]==a)return A;var f=-1,g=A,h=0;d.push(a);if(e==R){if(h=a.length,g=h==c.length)for(;h--&&(g=x(a[h],c[h],d)););}else{if("constructor"in a!="constructor"in c||a.constructor!=c.constructor)return C;for(var i in a)if(_.call(a,i)&&(h++,!(g=_.call(c,i)&&x(a[i],c[i],d))))break;if(g){for(i in c)if(_.call(c,i)&&!(h--))break;g=!h}if(g&&E)for(;7>++f&&(i=L[f],!_.call(a,i)||!!(g=_.call(c,i)&&x(a[i],c[i],d))););}return d.pop(),g}function y(a){return a}function z(a){bu(bA(a),function(b){var c=d[b]=a[b];e.prototype[b]=function(){var a=[this._wrapped];return arguments.length&&ba.apply(a,arguments),a=c.apply(d,a),this._chain&&(a=new e(a),a._chain=A),a}})}"use strict";var A=!0,B=null,C=!1,D="object"==typeof exports&&exports&&("object"==typeof global&&global&&global==global.global&&(a=global),exports),E=!{valueOf:0}.propertyIsEnumerable("valueOf"),F=0,G=a._,H=RegExp("^"+({}.valueOf+"").replace(/[.*+?^=!:${}()|[\]\/\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),I=/__token__(\d+)/g,J=/[&<"']/g,K=/['\n\r\t\u2028\u2029\\]/g,L="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),M="__token__",N=[],O={"&":"&amp;","<":"&lt;",'"':"&quot;","'":"&#x27;"},P={"boolean":C,"function":A,object:A,number:C,string:C,"undefined":C},Q={"\\":"\\","'":"'","\n":"n","\r":"r","\t":"t","\u2028":"u2028","\u2029":"u2029"},R="[object Array]",S="[object Boolean]",T="[object Date]",U="[object Function]",V="[object Number]",W="[object RegExp]",X="[object String]",Y=Array.prototype,Z=Object.prototype,$=Y.concat,_=Z.hasOwnProperty,ba=Y.push,bb=Y.slice,bc=Z.toString,bd=H.test(bd=bb.bind)&&/\n|Opera/.test(bd+bc.call(a.opera))&&bd,be=H.test(be=Array.isArray)&&be,bf=a.isFinite,bg=H.test(bg=Object.keys)&&bg,bh=a.clearTimeout,bi=a.setTimeout;d.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,variable:"obj"};var bj=Function("obj","var __p;with(obj){__p='var l,u';if(k){__p+='='+k};__p+=';'+f+';'+q+';';if(c){__p+='var o='+g+'.length;l=-1;';if(o){__p+='if(o===o>>>0){'};__p+=''+c['d']+';while('+c['m']+'){'+c['j']+'}';if(o){__p+='}'}}if(o){if(c){__p+='else{'}if(!i){__p+='var v=typeof '+l+'==\\'function\\';'};__p+=''+o['d']+';for('+o['m']+'){';if(i){if(r){__p+='if('+h+'){'};__p+=''+o['j']+';';if(r){__p+='}'}}else{__p+='if(!(v&&l==\\'prototype\\')';if(r){__p+='&&'+h};__p+='){'+o['j']+'}'};__p+='}';if(i){__p+='var g='+l+'.constructor;';for(var k=0;k<7;k++){__p+='l=\\''+p[k]+'\\';if(';if(p[k]=='constructor'){__p+='!(g&&g.prototype==='+l+')&&'};__p+=''+h+'){'+o['j']+'}'}}if(c){__p+='}'}};__p+=''+e+';return u'}return __p"),bk={a:"f,d,B",k:"f",q:"if(!d){d=k}else if(B){d=n(d,B)}",j:"d(f[l],l,f)"},bl={k:"D",j:"if(!d(f[l],l,f))return!u"},bm={a:"r",k:"r",q:"for(var x,y=1,o=arguments.length;y<o;y++){x=arguments[y];"+(E?"if(x){":""),m:"l in x",r:C,j:"r[l]=x[l]",e:(E?"}":"")+"}"},bn={k:"[]",j:"d(f[l],l,f)&&u.push(f[l])"},bo={q:"if(B)d=n(d,B)"},bp={j:{n:bk.j}},bq={k:"",f:"if(!f)return[]",d:{b:"u=Array(o)",n:"u=[]"},j:{b:"u[l]=d(f[l],l,f)",n:"u.push(d(f[l],l,f))"}},br=f({a:"r",f:"if(!s[typeof r]||r===null)throw TypeError()",k:"[]",j:"u.push(l)"}),H=f({a:"f,A",k:"h",j:"if(f[l]===A)return D"}),bs=f(bk,bl),Z=f(bk,bn),bt=f(bk,bo,{k:"",j:"if(d(f[l],l,f))return f[l]"}),bu=f(bk,bo),bv=f(bq,{a:"f,p",q:"var b=w.call(arguments,2),m=typeof p=='function'",j:{b:"u[l]=(m?p:f[l][p]).apply(f[l],b)",n:"u.push((m?p:f[l][p]).apply(f[l],b))"}}),bw=f(bk,bq),bx=f(bq,{a:"f,t",j:{b:"u[l]=f[l][t]",n:"u.push(f[l][t])"}}),bq=f({a:"f,d,a,B",k:"a",q:"var q=arguments.length<3;if(B)d=n(d,B)",d:{b:"if(q)u=f[++l]"},j:{b:"u=d(u,f[l],l,f)",n:"u=q?(q=h,f[l]):d(u,f[l],l,f)"}}),bn=f(bk,bn,{j:"!"+bn.j}),bl=f(bk,bl,{k:"h",j:bl.j.replace("!","")}),by=f(bm,{j:"if(r[l]==E)"+bm.j}),bz=f(bm),bm=f(bk,bo,bp,{r:C}),bk=f(bk,bo,bp),bA=f({a:"r",k:"[]",r:C,j:"if(C.call(r[l])==i)u.push(l)",e:"u.sort()"});c(arguments)||(c=function(a){return!!a&&!!_.call(a,"callee")});var bB=be||function(a){return bc.call(a)==R},be=f({a:"F",k:"D",q:"var e=C.call(F);if(e==c||e==z)return!F.length",j:{n:"return h"}}),bC=bg?function(a){return"function"==typeof a?br(a):bg(a)}:br,bD=f({a:"r",k:"[]",j:"u.push(r[l])"});d.VERSION="0.3.1",d.after=function(a,b){return 1>a?b():function(){if(1>--a)return b.apply(this,arguments)}},d.bind=w,d.bindAll=function(a){var b=arguments,c=1;1==b.length&&(c=0,b=bA(a));for(var d=b.length;c<d;c++)a[b[c]]=w(a[b[c]],a);return a},d.chain=function(a){return a=new e(a),a._chain=A,a},d.clone=function(a){return P[typeof a]&&a!==B?bB(a)?a.slice():bz({},a):a},d.compact=function(a){var b=[];if(!a)return b;for(var c=-1,d=a.length;++c<d;)a[c]&&b.push(a[c]);return b},d.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}},d.contains=H,d.debounce=function(a,c,d){function e(){i=b,d||a.apply(h,f)}var f,g,h,i;return function(){var b=d&&!i;return f=arguments,h=this,bh(i),i=bi(e,c),b&&(g=a.apply(h,f)),g}},d.defaults=by,d.defer=function(a){var c=bb.call(arguments,1);return bi(function(){return a.apply(b,c)},1)},d.delay=function(a,c){var d=bb.call(arguments,2);return bi(function(){return a.apply(b,d)},c)},d.difference=function(a){var b=[];if(!a)return b;for(var c=-1,d=a.length,e=$.apply(b,bb.call(arguments,1));++c<d;)0>r(e,a[c])&&b.push(a[c]);return b},d.escape=function(a){return a==B?"":(a+"").replace(J,i)},d.every=bs,d.extend=bz,d.filter=Z,d.find=bt,d.first=p,d.flatten=q,d.forEach=bu,d.forIn=bm,d.forOwn=bk,d.functions=bA,d.groupBy=function(a,b,c){var d={};if(!a)return d;var e,f=-1,g="function"==typeof b,h=a.length;for(g&&c&&(b=j(b,c));++f<h;)e=a[f],c=g?b(e,f,a):e[b],(_.call(d,c)?d[c]:d[c]=[]).push(e);return d},d.has=function(a,b){return _.call(a,b)},d.identity=y,d.indexOf=r,d.initial=function(a,c,d){return a?bb.call(a,0,-(c==b||d?1:c)):[]},d.intersection=function(a){var b=[];if(!a)return b;for(var c,d=-1,e=a.length,f=bb.call(arguments,1);++d<e;)c=a[d],0>r(b,c)&&bs(f,function(a){return-1<r(a,c)})&&b.push(c);return b},d.invoke=bv,d.isArguments=c,d.isArray=bB,d.isBoolean=function(a){return a===A||a===C||bc.call(a)==S},d.isDate=function(a){return bc.call(a)==T},d.isElement=function(a){return!!a&&1==a.nodeType},d.isEmpty=be,d.isEqual=x,d.isFinite=function(a){return bf(a)&&bc.call(a)==V},d.isFunction=function(a){return bc.call(a)==U},d.isNaN=function(a){return bc.call(a)==V&&a!=+a},d.isNull=function(a){return a===B},d.isNumber=function(a){return bc.call(a)==V},d.isObject=function(a){return P[typeof a]&&a!==B},d.isRegExp=function(a){return bc.call(a)==W},d.isString=function(a){return bc.call(a)==X},d.isUndefined=function(a){return a===b},d.keys=bC,d.last=function(a,c,d){if(a){var e=a.length;return c==b||d?a[e-1]:bb.call(a,-c||e)}},d.lastIndexOf=function(a,b,c){if(!a)return-1;var d=a.length;for(c&&"number"==typeof c&&(d=(0>c?Math.max(0,d+c):Math.min(c,d-1))+1);d--;)if(a[d]===b)return d;return-1},d.map=bw,d.max=s,d.memoize=function(a,b){var c={};return function(){var d=b?b.apply(this,arguments):arguments[0];return _.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}},d.min=function(a,b,c){var d=Infinity,e=d;if(!a)return e;var f=-1,g=a.length;if(!b){for(;++f<g;)a[f]<e&&(e=a[f]);return e}for(c&&(b=j(b,c));++f<g;)c=b(a[f],f,a),c<d&&(d=c,e=a[f]);return e},d.mixin=z,d.noConflict=function(){return a._=G,this},d.once=function(a){var b,c=C;return function(){return c?b:(c=A,b=a.apply(this,arguments))}},d.partial=function(a){var b=bb.call(arguments,1),c=b.length;return function(){var d;return d=arguments,d.length&&(b.length=c,ba.apply(b,d)),d=1==b.length?a.call(this,b[0]):a.apply(this,b),b.length=c,d}},d.pick=function(a){for(var b,c=0,d=$.apply(Y,arguments),e=d.length,f={};++c<e;)b=d[c],b in a&&(f[b]=a[b]);return f},d.pluck=bx,d.range=function(a,b,c){c||(c=1),2>arguments.length&&(b=a||0,a=0);for(var d=-1,e=Math.max(Math.ceil((b-a)/c),0),f=Array(e);++d<e;)f[d]=a,a+=c;return f},d.reduce=bq,d.reduceRight=o,d.reject=bn,d.rest=t,d.result=function(a,b){if(!a)return B;var c=a[b];return bc.call(c)==U?a[b]():c},d.shuffle=function(a){if(!a)return[];for(var b,c=-1,d=a.length,e=Array(d);++c<d;)b=Math.floor(Math.random()*(c+1)),e[c]=e[b],e[b]=a[c];return e},d.size=function(a){var b=bc.call(a);return b==R||b==X?a.length:bC(a).length},d.some=bl,d.sortBy=function(a,c,d){if(!a)return[];if("string"==typeof c)var e=c,c=function(a){return a[e]};else d&&(c=j(c,d));for(var d=-1,f=a.length,g=Array(f);++d<f;)g[d]={a:c(a[d],d,a),b:a[d]};for(g.sort(function(a,c){var d=a.a,e=c.a;return d===b?1:e===b?-1:d<e?-1:d>e?1:0});f--;)g[f]=g[f].b;return g},d.sortedIndex=u,d.tap=function(a,b){return b(a),a},d.template=function(a,b,c){c||(c={});var e;e=d.templateSettings;var f=c.escape,i=c.evaluate,j=c.interpolate,c=c.variable;return f==B&&(f=e.escape),i==B&&(i=e.evaluate),j==B&&(j=e.interpolate),f&&(a=a.replace(f,l)),j&&(a=a.replace(j,m)),i&&(a=a.replace(i,n)),a="__p='"+a.replace(K,h).replace(I,g)+"';",N.length=0,c||(c=e.variable,a="with("+c+"||{}){"+a+"}"),a="function("+c+"){var __p,__t,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}"+a+"return __p}",e=Function("_","return "+a)(d),b?e(b):(e.source=a,e)},d.throttle=function(a,c){function d(){i=new Date,h=b,a.apply(g,e)}var e,f,g,h,i=0;return function(){var b=new Date,j=c-(b-i);return e=arguments,g=this,0>=j?(i=b,f=a.apply(g,e)):h||(h=bi(d,j)),f}},d.times=function(a,b,c){var d=-1;if(c)for(;++d<a;)b.call(c,d);else for(;++d<a;)b(d)},d.toArray=function(a){if(!a)return[];if(bc.call(a.toArray)==U)return a.toArray();var b=a.length;return b===b>>>0?bb.call(a):bD(a)},d.union=function(){for(var a=-1,b=[],c=$.apply(b,arguments),d=c.length;++a<d;)0>r(b,c[a])&&b.push(c[a]);return b},d.uniq=v,d.uniqueId=function(a){var b=F++;return a?a+b:b},d.values=bD,d.without=function(a){var b=[];if(!a)return b;for(var c=bb.call(arguments,1),d=-1,e=a.length;++d<e;)0>r(c,a[d])&&b.push(a[d]);return b},d.wrap=function(a,b){return function(){var c=[a];return arguments.length&&ba.apply(c,arguments),b.apply(this,c)}},d.zip=function(a){if(!a)return[];for(var b=-1,c=s(bx(arguments,"length")),d=Array(c);++b<c;)d[b]=bx(arguments,b);return d},d.all=bs,d.any=bl,d.collect=bw,d.detect=bt,d.each=bu,d.foldl=bq,d.foldr=o,d.head=p,d.include=H,d.inject=bq,d.methods=bA,d.select=Z,d.tail=t,d.take=p,d.unique=v,e.prototype=d.prototype,z(d),e.prototype.chain=function(){return this._chain=A,this},e.prototype.value=function(){return this._wrapped},bu("pop push reverse shift sort splice unshift".split(" "),function(a){var b=Y[a];e.prototype[a]=function(){var a=this._wrapped;return b.apply(a,arguments),a.length===0&&delete a[0],this._chain&&(a=new e(a),a._chain=A),a}}),bu(["concat","join","slice"],function(a){var b=Y[a];e.prototype[a]=function(){var a=b.apply(this._wrapped,arguments);return this._chain&&(a=new e(a),a._chain=A),a}}),typeof define=="function"&&typeof define.amd=="object"&&define.amd?(a._=d,define(function(){return d})):D?"object"==typeof module&&module&&module.s==D?(module.s=d)._=d:D._=d:a._=d}(this),function(){function a(a){return a?c.escapeRegExp(a):"\\s"}var b=String.prototype.trim,c;c=this._s={capitalize:function(a){return a.charAt(0).toUpperCase()+a.substring(1).toLowerCase()},join:function(a){for(var b="",c=1;c<arguments.length;c+=1)b+=String(arguments[c]),c!==arguments.length-1&&(b+=String(a));return b},escapeRegExp:function(a){return a.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},reverse:function(a){return Array.prototype.reverse.apply(a.split("")).join("")},contains:function(a,b){return a.indexOf(b)!==-1},clean:function(a){return c.strip(a.replace(/\s+/g," "))},trim:function(c,d){return!d&&b?b.call(c):(d=a(d),c.replace(new RegExp("^["+d+"]+|["+d+"]+$","g"),""))},ltrim:function(b,c){return c=a(c),b.replace(new RegExp("^["+c+"]+","g"),"")},rtrim:function(b,c){return c=a(c),b.replace(new RegExp("["+c+"]+$","g"),"")},startsWith:function(a,b){return a.length>=b.length&&a.substring(0,b.length)===b},endsWith:function(a,b){return a.length>=b.length&&a.substring(a.length-b.length)===b},sprintf:function(){for(var a=0,b,c=arguments[a++],d=[],e,f,g;c;){if(e=/^[^\x25]+/.exec(c))d.push(e[0]);else if(e=/^\x25{2}/.exec(c))d.push("%");else{if(!(e=/^\x25(?:(\d+)\$)?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(c)))throw"Huh ?!";if((b=arguments[e[1]||a++])==null||b==undefined)throw"Too few arguments.";if(/[^s]/.test(e[7])&&typeof b!="number")throw"Expecting number but found "+typeof b;switch(e[7]){case"b":b=b.toString(2);break;case"c":b=String.fromCharCode(b);break;case"d":b=parseInt(b);break;case"e":b=e[6]?b.toExponential(e[6]):b.toExponential();break;case"f":b=e[6]?parseFloat(b).toFixed(e[6]):parseFloat(b);break;case"o":b=b.toString(8);break;case"s":b=(b=String(b))&&e[6]?b.substring(0,e[6]):b;break;case"u":b=Math.abs(b);break;case"x":b=b.toString(16);break;case"X":b=b.toString(16).toUpperCase()}b=/[def]/.test(e[7])&&e[2]&&b>=0?"+"+b:b,f=e[3]?e[3]=="0"?"0":e[3].charAt(1):" ",g=e[5]-String(b).length-0;if(e[5]){g=g;for(var h=[];g>0;h[--g]=f);f=h.join("")}else f="";f=f,d.push(""+(e[4]?b+f:f+b))}c=c.substring(e[0].length)}return d.join("")}},this._s.strip=c.trim,this._s.lstrip=c.ltrim,this._s.rstrip=c.rtrim,this._&&this._.mixin(this._s)}(),TD.core.sha1=function(a){function b(a,b){var c=a<<b|a>>>32-b;return c}function c(a){var b="",c,d,e;for(c=0;c<=6;c+=2)d=a>>>c*4+4&15,e=a>>>c*4&15,b+=d.toString(16)+e.toString(16);return b}function d(a){var b="",c,d;for(c=7;c>=0;c--)d=a>>>c*4&15,b+=d.toString(16);return b}function e(a){a=a.replace(/\r\n/g,"\n");var b="";for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(d&63|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(d&63|128))}return b}var f,g,h,i=new Array(80),j=1732584193,k=4023233417,l=2562383102,m=271733878,n=3285377520,o,p,q,r,s,t;a=e(a);var u=a.length,v=new Array;for(g=0;g<u-3;g+=4)h=a.charCodeAt(g)<<24|a.charCodeAt(g+1)<<16|a.charCodeAt(g+2)<<8|a.charCodeAt(g+3),v.push(h);switch(u%4){case 0:g=2147483648;break;case 1:g=a.charCodeAt(u-1)<<24|8388608;break;case 2:g=a.charCodeAt(u-2)<<24|a.charCodeAt(u-1)<<16|32768;break;case 3:g=a.charCodeAt(u-3)<<24|a.charCodeAt(u-2)<<16|a.charCodeAt(u-1)<<8|128}v.push(g);while(v.length%16!=14)v.push(0);v.push(u>>>29),v.push(u<<3&4294967295);for(f=0;f<v.length;f+=16){for(g=0;g<16;g++)i[g]=v[f+g];for(g=16;g<=79;g++)i[g]=b(i[g-3]^i[g-8]^i[g-14]^i[g-16],1);o=j,p=k,q=l,r=m,s=n;for(g=0;g<=19;g++)t=b(o,5)+(p&q|~p&r)+s+i[g]+1518500249&4294967295,s=r,r=q,q=b(p,30),p=o,o=t;for(g=20;g<=39;g++)t=b(o,5)+(p^q^r)+s+i[g]+1859775393&4294967295,s=r,r=q,q=b(p,30),p=o,o=t;for(g=40;g<=59;g++)t=b(o,5)+(p&q|p&r|q&r)+s+i[g]+2400959708&4294967295,s=r,r=q,q=b(p,30),p=o,o=t;for(g=60;g<=79;g++)t=b(o,5)+(p^q^r)+s+i[g]+3395469782&4294967295,s=r,r=q,q=b(p,30),p=o,o=t;j=j+o&4294967295,k=k+p&4294967295,l=l+q&4294967295,m=m+r&4294967295,n=n+s&4294967295}var t=d(j)+d(k)+d(l)+d(m)+d(n);return t.toLowerCase()},function(){var a=8,b="=",c=0,d=function(b){var c=[],d=(1<<a)-1,e=b.length*a,f;for(f=0;f<e;f+=a)c[f>>5]|=(b.charCodeAt(f/a)&d)<<32-a-f%32;return c},e=function(a){var b=[],c=a.length,d,e;for(d=0;d<c;d+=2){e=parseInt(a.substr(d,2),16);if(!isNaN(e))b[d>>3]|=e<<24-4*(d%8);else return"INVALID HEX STRING"}return b},f=function(a){var b=c?"0123456789ABCDEF":"0123456789abcdef",d="",e=a.length*4,f,g;for(f=0;f<e;f+=1)g=a[f>>2]>>(3-f%4)*8,d+=b.charAt(g>>4&15)+b.charAt(g&15);return d},g=function(a){var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d="",e=a.length*4,f,g,h;for(f=0;f<e;f+=3){h=(a[f>>2]>>8*(3-f%4)&255)<<16|(a[f+1>>2]>>8*(3-(f+1)%4)&255)<<8|a[f+2>>2]>>8*(3-(f+2)%4)&255;for(g=0;g<4;g+=1)f*8+g*6<=a.length*32?d+=c.charAt(h>>6*(3-g)&63):d+=b}return d},h=function(a,b){return a>>>b|a<<32-b},i=function(a,b){return a>>>b},j=function(a,b,c){return a&b^~a&c},k=function(a,b,c){return a&b^a&c^b&c},l=function(a){return h(a,2)^h(a,13)^h(a,22)},m=function(a){return h(a,6)^h(a,11)^h(a,25)},n=function(a){return h(a,7)^h(a,18)^i(a,3)},o=function(a){return h(a,17)^h(a,19)^i(a,10)},p=function(a,b){var c=(a&65535)+(b&65535),d=(a>>>16)+(b>>>16)+(c>>>16);return(d&65535)<<16|c&65535},q=function(a,b,c,d){var e=(a&65535)+(b&65535)+(c&65535)+(d&65535),f=(a>>>16)+(b>>>16)+(c>>>16)+(d>>>16)+(e>>>16);return(f&65535)<<16|e&65535},r=function(a,b,c,d,e){var f=(a&65535)+(b&65535)+(c&65535)+(d&65535)+(e&65535),g=(a>>>16)+(b>>>16)+(c>>>16)+(d>>>16)+(e>>>16)+(f>>>16);return(g&65535)<<16|f&65535},s=function(a,b,c){var d,e,f,g,h,i,s,t,u,v,w,x,y,z,A,B=[],C;if(c==="SHA-224"||c==="SHA-256")x=(b+65>>9<<4)+15,A=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],c==="SHA-224"?w=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]:w=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];a[b>>5]|=128<<24-b%32,a[x]=b,C=a.length;for(y=0;y<C;y+=16){d=w[0],e=w[1],f=w[2],g=w[3],h=w[4],i=w[5],s=w[6],t=w[7];for(z=0;z<64;z+=1)z<16?B[z]=a[z+y]:B[z]=q(o(B[z-2]),B[z-7],n(B[z-15]),B[z-16]),u=r(t,m(h),j(h,i,s),A[z],B[z]),v=p(l(d),k(d,e,f)),t=s,s=i,i=h,h=p(g,u),g=f,f=e,e=d,d=p(u,v);w[0]=p(d,w[0]),w[1]=p(e,w[1]),w[2]=p(f,w[2]),w[3]=p(g,w[3]),w[4]=p(h,w[4]),w[5]=p(i,w[5]),w[6]=p(s,w[6]),w[7]=p(t,w[7])}switch(c){case"SHA-224":return[w[0],w[1],w[2],w[3],w[4],w[5],w[6]];case"SHA-256":return w;default:return[]}},t=function(b,c){this.sha224=null,this.sha256=null,this.strBinLen=null,this.strToHash=null;if("HEX"===c){if(0!==b.length%2)return"TEXT MUST BE IN BYTE INCREMENTS";this.strBinLen=b.length*4,this.strToHash=e(b)}else if("ASCII"===c||"undefined"==typeof c)this.strBinLen=b.length*a,this.strToHash=d(b);else return"UNKNOWN TEXT INPUT TYPE"};t.prototype={getHash:function(a,b){var c=null,d=this.strToHash.slice();switch(b){case"HEX":c=f;break;case"B64":c=g;break;default:return"FORMAT NOT RECOGNIZED"}switch(a){case"SHA-224":return null===this.sha224&&(this.sha224=s(d,this.strBinLen,a)),c(this.sha224);case"SHA-256":return null===this.sha256&&(this.sha256=s(d,this.strBinLen,a)),c(this.sha256);default:return"HASH NOT RECOGNIZED"}},getHMAC:function(b,c,h,i){var j,k,l,m,n,o,p=[],q=[];switch(i){case"HEX":j=f;break;case"B64":j=g;break;default:return"FORMAT NOT RECOGNIZED"}switch(h){case"SHA-224":o=224;break;case"SHA-256":o=256;break;default:return"HASH NOT RECOGNIZED"}if("HEX"===c){if(0!==b.length%2)return"KEY MUST BE IN BYTE INCREMENTS";k=e(b),n=b.length*4}else if("ASCII"===c)k=d(b),n=b.length*a;else return"UNKNOWN KEY INPUT TYPE";64<n/8?(k=s(k,n,h),k[15]&=4294967040):64>n/8&&(k[15]&=4294967040);for(l=0;l<=15;l+=1)p[l]=k[l]^909522486,q[l]=k[l]^1549556828;return m=s(p.concat(this.strToHash),512+this.strBinLen,h),m=s(q.concat(m),512+o,h),j(m)}},window.jsSHA=t}(),TD.util=function(){var a,b,c=0,d=1e3,e=d*60,f=e*60,g=f*24,h=g*7,i=/(.+)(?:_normal)\.(\w+)$/,j=new RegExp("<(?:.|\\n)*?>","gm"),k=/\B(?=(\d{3})+(?!\d))/g;return $.subscribe("/date",function(a){var b=TD.util.parseDateString(a).getTime(),d=(new Date).getTime();c=b-d}),{SPOTIFY_REGEXP:/spotify:(track|artist|search|album|(user:\w+:playlist)):\w+/g,ANCHOR_TAG_REGEXP:/href=/g,LT_REGEXP:/</g,GT_REGEXP:/>/g,SINGLE_QUOTE_REGEXP:/'/g,QUOTE_REGEXP:/"/g,TWITTER_USERNAME_REGEXP:/@([A-Za-z0-9_]+)/g,parseDateString:function(a){var b;return $.browser.msie&&a?b=new Date(Date.parse(a.replace(/( \+)/," UTC$1"))):b=new Date(a),b},parseISO8601:function(a){var b=a.split("+"),c=b[0].split("T"),d=c[0].split("-"),e=c[1].split("Z"),f=e[0].split(":"),g=f[2].split("."),h=Number(f[0]),i=new Date;return i.setUTCDate(1),i.setUTCMonth(0),i.setUTCFullYear(Number(d[0])),i.setUTCMonth(Number(d[1])-1),i.setUTCDate(Number(d[2])),i.setUTCHours(Number(h)),i.setUTCMinutes(Number(f[1])),i.setUTCSeconds(Number(g[0])),g[1]?i.setUTCMilliseconds(Number(g[1].substring(0,3))):i.setUTCMilliseconds(0),i},iso8601:function(a){a||(a=new Date);var b=("000"+a.getUTCFullYear()).slice(-4)+"-"+("0"+(a.getUTCMonth()+1)).slice(-2)+"-"+("0"+a.getUTCDate()).slice(-2)+"T"+("0"+a.getUTCHours()).slice(-2)+":"+("0"+a.getUTCMinutes()).slice(-2)+":"+("0"+a.getUTCSeconds()).slice(-2);return a.getMilliseconds()&&(b+="."+("000"+a.getMilliseconds()).slice(-3)),b},prettyDate:function(a){return TD.util.timeAgo(a.getTime(),!1,!0)},clean:function(a){return a?a.replace(this.LT_REGEXP,"&lt;").replace(this.GT_REGEXP,"&gt;").replace(this.SINGLE_QUOTE_REGEXP,"&#39;").replace(this.QUOTE_REGEXP,"&quot;"):a},removeHTMLCodes:function(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')},stripHTMLTags:function(a){return a.replace(j,"")},h:function(a){var b=$("<div/>"),c=function(a){return a?b.text(a).html().replace(/\"/gi,"&quot;"):a};return this.h=function(a){return c(a)},c(a)},transform:function(a,b){return a?(b=b||{},this.updateEntities(a,b),this.linkify(a,b)):""},updateEntities:function(a,b){b.urls=b.urls||[],b.media=b.media||[],b.hashtags=b.hashtags||[],b.user_mentions=b.user_mentions||[],b.other=b.other||[];var c=this.extractURLEntities(a),d=this.extractMentionEntities(a),e=this.extractHashtagEntities(a),f=this.extractSpotifyEntities(a),g,h,i,j;for(g=0,h=c.length;g<h;g++)this.getEntityOverlap(c[g],b)||b.urls.push(c[g]);for(g=0,h=d.length;g<h;g++)i=d[g],j=this.getEntityOverlap(i,b),j?i.list_slug&&i.indices[0]===j.indices[0]&&(j.indices=i.indices,j.list_slug=i.list_slug):b.user_mentions.push(i);for(g=0,h=e.length;g<h;g++)this.getEntityOverlap(e[g],b)||b.hashtags.push(e[g]);for(g=0,h=f.length;g<h;g++)this.getEntityOverlap(f[g],b)||b.other.push(f[g]);return b},extractURLEntities:function(a){return twttr.txt.extractUrlsWithIndices(a)},extractMentionEntities:function(a){var b=twttr.txt.extractMentionsOrListsWithIndices(a);return _.each(b,function(a){a.screen_name=a.screenName,a.list_slug=a.listSlug,delete a.screenName,delete a.listSlug}),b},extractHashtagEntities:function(a){var b=twttr.txt.extractHashtagsWithIndices(a);return _.each(b,function(a){a.text=a.hashtag,delete a.hashtag}),b},extractSpotifyEntities:function(a){var b=[],c=0;return a.replace(this.SPOTIFY_REGEXP,function(d){var e=a.indexOf(d,c);c=e+d.length+1,b.push({spotifyURI:d,indices:[e,c]})}),b},getEntityOverlap:function(a,b){var c=b.urls;c=c.concat(b.media),c=c.concat(b.user_mentions),c=c.concat(b.hashtags),c=c.concat(b.other);for(var d=0,e=c.length;d<e;d++)if(a.indices[0]<c[d].indices[1]&&a.indices[1]>c[d].indices[0])return c[d];return null},linkify:function(a,b){var c=b.urls||[];c=c.concat(b.media||[]),c=c.concat(b.user_mentions||[]),c=c.concat(b.hashtags||[]),c=c.concat(b.other||[]),c.sort(function(a,b){return b.indices[0]-a.indices[0]});var d,e,f,g,h,i="";for(var j=0,k=c.length;j<k;j++)g=c[j],d=a.substring(0,g.indices[0]),e=a.substring(g.indices[0],g.indices[1]),f=a.substring(g.indices[1]),h="",g.url?e===g.url?h=this.createUrlAnchor(g):h=e:g.screen_name?g.list_slug?h=TD.ui.template.render("text/list_link",{slug:g.list_slug.substr(1),user:{screenName:g.screen_name},fullName:"@"+g.screen_name+g.list_slug}):(h='<a href="http://twitter.com/'+g.screen_name+'" rel="user"',e="<s>@</s><b>"+g.screen_name+"</b>",h+=' target="_blank">'+e+"</a>"):g.text?h='<a href="http://twitter.com/search?q=%23'+g.text+'" rel="hashtag" target="_blank"><s class="hash">#</s><b>'+g.text+"</b></a>":g.spotifyURI&&(h='<a href="'+TD.util.escape(g.spotifyURI)+'" rel="spotify" target="_blank">'+g.spotifyURI+"</a>"),i=h+this.clean(f)+i,a=d;return this.clean(a)+i},createUrlAnchor:function(a){var b,c=a.url,d="url";!_.startsWith(c,"https://")&&!_.startsWith(c,"http://")&&(c="http://"+c),b='<a href="'+TD.util.escape(c)+'" target="_blank" class="url-ext" ',a.expanded_url&&(b+='data-full-url="'+TD.util.escape(a.expanded_url)+'" ');if(a.type=="photo"){var e="";a.sizes&&a.sizes.large&&(e=":large"),b+='data-media-url="'+TD.util.escape(a.media_url)+e+'" ',b+='data-media-thumb-url="'+TD.util.escape(a.media_url)+':thumb" '}if(a.type==="photo"||TD.services.media.looksLikeMediaUrl(a.expanded_url||a.url))d="mediaPreview";return b+='rel="'+d+'" ',a.display_url&&a.expanded_url&&a.display_url.charCodeAt(a.display_url.length-1)==8230&&(b+='title="'+TD.util.escape(a.expanded_url)+'" '),b+=">"+TD.util.escape(a.display_url||a.url)+"</a>",b},getReplyUsers:function(a){var b=[],c=[],d={},e,f="";a.account&&(f=a.account.getUsername().toLowerCase()),a.retweetedStatus&&b.push(a.retweetedStatus.user.screenName),b.push(a.user.screenName),b=b.concat(twttr.txt.extractMentions(a.text));for(var g=0;g<b.length;g++)e=b[g].toLowerCase(),!d[e]&&e!=f&&c.push("@"+b[g]),d[e]=!0;return c.length||c.push("@"+f),c},pluralise:function(a,b,c){return c!=1?b:a},selectAttrsFrom:function(a,b){var c={};for(var d=0;d<b.length;d++)c[b[d]]=a[b[d]];return c},values:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},isEmpty:_.isEmpty,isChromeApp:function(){return a==null&&(a=_.startsWith(window.location.href,"chrome-extension://")),a},isWrapperApp:function(){return b==null&&(b=Boolean(window.deck&&deck.inApp())),b},shouldStream:function(){return TD.settings.getUseStream()?TD.util.isChromeApp()&&chrome.tabs!==undefined?!0:TD.util.isWrapperApp()?!0:!1:!1},getCurrentLocation:function(a,b,c){var d=Number.MAX_VALUE,e,f,g,h=navigator.geolocation,i=function(a){var b=a.coords.accuracy;b<d&&(e=a,d=b),b<50&&(clearTimeout(g),j())},j=function(){h.clearWatch(f),e?b(e):c&&c()};g=setTimeout(j,a),f=h.watchPosition(i,c,{enableHighAccuracy:!0})},openURL:function(a){if(!_.isString(a))return;if(!_.startsWith(a,"https://")&&!_.startsWith(a,"http://"))return;var b=window.open(a);b.focus()},maybeOpenClickExternally:function(a){var b=!1,c=$(a.currentTarget),d=c.prop("tagName"),e=c.attr("rel"),f=c.attr("target"),g=a.ctrlKey||a.shiftKey||a.altKey||a.metaKey||a.button!==0;return d==="A"&&f==="_blank"&&(e==="url"||g)&&(TD.util.isWrapperApp()?(TD.util.openURL(c.attr("href")),a.preventDefault(),a.stopImmediatePropagation()):a.stopImmediatePropagation(),b=!0),b},openEmail:function(a,b,c){var d="mailto:",e={};b&&(e.subject=b),c&&(e.body=c),a&&(d+=a),d=d+"?"+TD.net.util.formEncode(e),window.open(d)},escape:function(a){return this.clean(a)},truncateText:function(a,b,c,d,e,f){b=b==undefined?"â¦":b,d=d||0,f=f||0;var g;if(a.length>c+d){var h=a.indexOf(" ",c-f-1);h!=-1&&(c=Math.min(c,h+1)),g=a.substr(0,c),e&&(g=this.transform(g)),g+=b}return g},timesCached:null,timeWords:function(){return TD.util.timesCached||(TD.util.timesCached={longForm:{singular:{now:TD.i("now",null,!0),seconds:TD.i("{{one}} second ago",null,!0),minutes:TD.i("{{one}} minute ago",null,!0),hours:TD.i("{{one}} hour ago",null,!0),days:TD.i("{{one}} day ago",null,!0)},plural:{now:TD.i("now",null,!0),seconds:TD.i("{{plural_number}} seconds ago",null,!0),minutes:TD.i("{{plural_number}} minutes ago",null,!0),hours:TD.i("{{plural_number}} hours ago",null,!0),days:TD.i("{{plural_number}} days ago",null,!0)}},shortForm:{singular:{now:TD.i("now",null,!0),seconds:TD.i("{{one}}s",null,!0),minutes:TD.i("{{one}}m",null,!0),hours:TD.i("{{one}}h",null,!0),days:TD.i("{{one}}d",null,!0)},plural:{now:TD.i("now",null,!0),seconds:TD.i("{{plural_number}}s",null,!0),minutes:TD.i("{{plural_number}}m",null,!0),hours:TD.i("{{plural_number}}h",null,!0),days:TD.i("{{plural_number}}d",null,!0)}}}),TD.util.timesCached},datesCached:null,dates:function(){return TD.util.datesCached||(TD.util.datesCached={months:[TD.i("Jan"),TD.i("Feb"),TD.i("Mar"),TD.i("Apr"),TD.i("May"),TD.i("Jun"),TD.i("Jul"),TD.i("Aug"),TD.i("Sep"),TD.i("Oct"),TD.i("Nov"),TD.i("Dec")],dates:[TD.i("1st"),TD.i("2nd"),TD.i("3rd"),TD.i("4th"),TD.i("5th"),TD.i("6th"),TD.i("7th"),TD.i("8th"),TD.i("9th"),TD.i("10th"),TD.i("11th"),TD.i("12th"),TD.i("13th"),TD.i("14th"),TD.i("15th"),TD.i("16th"),TD.i("17th"),TD.i("18th"),TD.i("19th"),TD.i("20th"),TD.i("21st"),TD.i("22nd"),TD.i("23rd"),TD.i("24th"),TD.i("25th"),TD.i("26th"),TD.i("27th"),TD.i("28th"),TD.i("29th"),TD.i("30th"),TD.i("31st")]}),TD.util.datesCached},timeAgo:function(a,b,h){var i=(new Date).getTime(),j=(new Date(a)).getTime(),k,l=TD.util.timeWords()[b?"longForm":"shortForm"],m,n,o;return h&&(i+=c),k=i-j,isNaN(k)||k<d*-5?"":(k<d*7?(n="",m="now"):k<e?(n=Math.floor(k/d),m="seconds"):k<f?(n=Math.floor(k/e),m="minutes"):k<g?(n=Math.floor(k/f),m="hours"):(n=Math.floor(k/g),m="days"),n===1?l=l.singular:l=l.plural,o=TD.ui.template.toHtml(l[m],{one:n,plural_number:n}),o)},prettyTime:function(a){var b={month:TD.util.dates().months[a.getMonth()],hours24:a.getHours(),hours12:a.getHours()%12||12,minutes:TD.util.padLeadingZero(a.getMinutes()),amPm:a.getHours()<12?TD.i("AM"):TD.i("PM"),date:TD.util.dates().dates[a.getDate()-1],day:a.getDate(),year:a.getFullYear().toString().slice(2)};return b},prettyTimeString:function(a){return TD.i("{{hours12}}:{{minutes}} {{amPm}} - {{day}} {{month}} {{year}}",TD.util.prettyTime(a))},padLeadingZero:function(a){return a.toString().replace(/^(\d)$/,"0$1")},prettyNumber:function(a){var b;if(typeof a=="string")a=parseInt(a,10);else if(typeof a!="number"||isNaN(a))return"";return b=a.toString().split("."),b[0].replace(k,",")},chirpDescSort:function(a,b){return b.created.getTime()-a.created.getTime()},chirpAscSort:function(a,b){return a.created.getTime()-b.created.getTime()},leven:function(a,b){var c,d,e=a.length,f=b.length;if(!e)return f;if(!f)return e;var g=[];for(var h=0;h<=e;h++)g[h]=[],g[h][0]=h;for(var i=0;i<=f;i++)g[0][i]=i;for(var h=1;h<=e;h++){c=a.charAt(h-1);for(var i=1;i<=f;i++)g[h][i]=Math.min(g[h-1][i]+1,g[h][i-1]+1,g[h-1][i-1]+(c==b.charAt(i-1)?0:1))}return g[e][f]},transformTwitterAvatar:function(a,b){return a.replace(i,"$1_"+b+".$2")},getOSName:function(){var a="";return this.isWrapperApp()?a=deck.osname():navigator.appVersion.indexOf("Win")!=-1?a="windows":navigator.appVersion.indexOf("Mac")!=-1?a="osx":navigator.appVersion.indexOf("Linux")!=-1&&(a="linux"),a},getAppEnv:function(){var a="unknown",b;if(this.isChromeApp())a="chrome";else if(this.isWrapperApp()){b=this.getOSName();switch(b){case"osx":a="mac";break;case"windows":a="win"}}else _.startsWith(window.location.href,"file://")||(a="web");return a},bind:function(a,b){return function(){a.apply(b,arguments)}},insertLogDivider:_.debounce(function(){console.log(" ")},1),versionComparator:function(a,b){a=a.toString(),b=b.toString();var c=a.split("."),d=b.split("."),e,f,g=Math.min(c.length,d.length);for(var h=0;h<g;h++){e=parseInt(c[h],10),f=parseInt(d[h],10);if(e>f)return 1;if(e<f)return-1}return c.length>d.length?1:c.length<d.length?-1:0},getPreciseTime:function(){if(!window.performance)return+(new Date);if(typeof window.performance.now=="function")return window.performance.now();if(typeof window.performance.webkitNow=="function")return window.performance.webkitNow()},fnPerformanceWrapper:function(a,b,c){return function(){var d=TD.util.getPreciseTime(),e,f=a.apply(b,arguments);return e=TD.util.getPreciseTime(),TD.controller.stats.performance.log(c,e-d),f}},logTimeToRenderColumn:function(a,b){var c;b>0&&(c=a/b,TD.controller.stats.performance.log(TD.controller.stats.performance.keys.RENDER_TWEET,c))}}}(),TD.core.defer=function(){var a={};a.NAME="TD.core.defer",a.DEBUG_DEFERREDS=!1;var b=Array.prototype.slice,c=function(a){this.message=a,this.name=a};c.prototype=new Error,c.prototype.toString=function(){return this.message&&this.message!=this.name?this.name+"("+this.message.toString()+")":this.name+"()"};var d=function(a,b,d){d.prototype=new c(a.NAME+"."+b),a[b]=d};d(a,"AlreadyCalledError",function(a){this.deferred=a}),d(a,"CancelledError",function(a){this.deferred=a}),d(a,"GenericError",function(a){this.message=a}),d(a,"XMLHttpRequestError",function(a,b){this.req=a,this.message=b;try{this.number=a.status}catch(c){}});var e=function(){try{throw new Error("DEBUG_DEFERRED stack trace")}catch(a){return a.stack}};return a.Deferred=function(b){this.chain=[],this.id=_.uniqueId("d:"),a.DEBUG_DEFERREDS&&(this.create_stack=e()),this.fired=-1,this.paused=0,this.results=[null,null],this.canceller=b,this.silentlyCancelled=!1,this.chained=!1},a.Deferred.prototype={toString:function(){var a;return this.fired==-1?a="unfired":this.fired===0?a="success":a="error","Deferred("+this.id+", "+a+"["+this.chain.length+"])"},cancel:function(){this.fired==-1?(this.canceller?this.canceller(this):this.silentlyCancelled=!0,this.fired==-1&&this.errback(new a.CancelledError(this))):this.fired===0&&this.results[0]instanceof a.Deferred&&this.results[0].cancel()},_resback:function(b){a.DEBUG_DEFERREDS&&(this.invoke_stack=e()),this.fired=b instanceof Error?1:0,this.results[this.fired]=b,this._fire()},_check:function(){if(this.fired!=-1){if(!this.silentlyCancelled)throw new a.AlreadyCalledError(this);this.silentlyCancelled=!1;return}},callback:function(b){this._check();if(b instanceof a.Deferred)throw new Error("Deferred instances can only be chained if they are the result of a callback");this._resback(b)},errback:function(b){this._check();if(b instanceof a.Deferred)throw new Error("Deferred instances can only be chained if they are the result of a callback");b instanceof Error||(b=new a.GenericError(b)),this._resback(b)},addBoth:function(a){var c=b.call(arguments,1);return this.addCallbacks(a,a,c,c,null,null)},addBothWith:function(a,c){var d=b.call(arguments,2);return this.addCallbacks(c,c,d,d,a,a)},addCallback:function(a){var c=b.call(arguments,1);return this.addCallbacks(a,null,c,null,null,null)},addCallbackWith:function(a,c){var d=b.call(arguments,2);return this.addCallbacks(c,null,d,null,a,null)},addErrback:function(a){var c=b.call(arguments,1);return this.addCallbacks(null,a,null,c,null,null)},addErrbackWith:function(a,c){var d=b.call(arguments,2);return this.addCallbacks(null,c,null,d,null,a)},addCallbacks:function(a,b,c,d,e,f){if(this.chained)throw new Error("Chained Deferreds can not be re-used");return this.chain.push([a,b,c,d,e,f]),this.fired>=0&&this._fire(),this},_fire:function(){var b=this.chain,c=this.fired,d=this.results[c],e=this,f=null,g,h,i=function(a){e._resback(a),e.paused--,e.paused===0&&e.fired>=0&&e._fire()};while(b.length>0&&this.paused===0){var j=b.shift(),k=j[c];if(k===null)continue;try{j[2+c]?g=[d].concat(j[2+c]):g=[d],h=j[4+c],d=k.apply(h,g),c=d instanceof Error?1:0,d instanceof a.Deferred&&(f=i,this.paused++)}catch(l){c=1,l instanceof Error?d=l:d=new a.GenericError(l),d.stack&&d.stack.split?d.stackTrace=d.stack.split("\n"):d.stackTrace=[]}}this.fired=c,this.results[c]=d,f&&this.paused&&(d.addBoth(f),d.chained=!0)}},a.DeferredList=function(b,c,d){a.Deferred.apply(this,[d]),this.list=b;var e=[];this.resultList=e,this.finishedCount=0,this.fireOnOneCallback=Boolean(c&&c.fireOnOneCallback),this.fireOnOneErrback=Boolean(c&&c.fireOnOneErrback),this.consumeErrors=Boolean(c&&c.consumeErrors);var f=_.bind(this._cbDeferred,this);for(var g=0;g<b.length;g++){var h=b[g];e.push(void 0),h.addCallback(f,g,!0),h.addErrback(f,g,!1)}b.length===0&&!this.fireOnOneCallback&&this.callback(this.resultList)},a.DeferredList.prototype=new a.Deferred,a.DeferredList.prototype._cbDeferred=function(a,b,c){return this.resultList[b]=[c,a],this.finishedCount+=1,this.fired==-1&&(c&&this.fireOnOneCallback?this.callback([b,a]):!c&&this.fireOnOneErrback?this.errback(a):this.finishedCount==this.list.length&&this.callback(this.resultList)),!c&&this.consumeErrors&&(a=null),a},a.gatherResults=function(b){var c=new a.DeferredList(b,{fireOnOneErrback:!0});return c.addCallback(function(a){var b=[];for(var c=0;c<a.length;c++)b.push(a[c][1]);return b}),c},a.succeed=function(b){var c=new a.Deferred;return c.callback.apply(c,[b]),c},a.fail=function(b){var c=new a.Deferred;return c.errback.apply(c,[b]),c},a.maybeDeferred=function(c){var d;try{var e=c.apply(null,b.call(arguments,1));e instanceof a.Deferred?d=e:e instanceof Error?d=a.fail(e):d=a.succeed(e)}catch(f){d=a.fail(f)}return d},a}(),TD.util.i18n=function(){var a={},b,c,d=function(a){if(typeof TD_locale_messages=="undefined")return undefined;var b=TD_locale_messages[a];return b&&b.message?b.message:undefined},e=function(a){var b=deck.i18n(a);return b?b:undefined};return a.getMessage=function(a){return b||(TD.util.isChromeApp()?b=chrome.i18n.getMessage:TD.util.isWrapperApp()?b=e:b=d),b(a)},a.getLocale=function(){return c?c:(TD.util.isChromeApp()&&(c=a.getMessage("@@ui_locale")),c)},a}(),TD.services.bitly=function(){var a={},b,c="tweetdeckapi",d="R_b8032856b71a14fabfe64f6845689ddf",e=function(a,b,e,f){var g="http://api.bitly.com/v3/"+a;b.login=c,b.apiKey=d,b.format="json";var h=TD.storage.accountController.getAccountsForService("bitly");if(h.length>0){var i=h[0];b.x_login=i.getUserID(),b.x_apiKey=i.getOAuthToken()}TD.net.ajax.jsonp(g,b,e,f)};return a.shorten=function(a,b,c){!_.startsWith(a,"http://")&&!_.startsWith(a,"https://")&&(a="http://"+a);var d=function(d){if(!d||!d.data||!d.data.url){c();return}d.data&&(d.data.long_url=a),b(d)};return e("shorten",{longUrl:a},d,c)},a}(),TD.services.media=function(){var a={};a.NO_FLASH=TD.util.isWrapperApp()&&TD.util.getOSName()==="windows",a.YOUTUBE_GALLERY_WIDTH=640,a.YOUTUBE_GALLERY_HEIGHT=390,a.YOUTUBE_DETAIL_WIDTH=304,a.YOUTUBE_DETAIL_HEIGHT=200;var b=/(http:\/\/|www.)?twitpic.com\/\w+/,c=/http(s)?:\/\/twitter.com\/\w+\/status\/[0-9]+\/photo\/[0-9]+/,d=/(http:\/\/|www.)?yfrog.com\/\w+/,e=/(http:\/\/|www.)?plixi.com\/p\/[0-9]+/,f=/(http:\/\/|www.)?lockerz.com\/s\/[0-9]+/,g=/(http:\/\/|www.)?instagr.am\/p\/[\w-]+(\/)/,h=/(?:(?:https?\:\/\/)?(?:www\.)?)?youtube\.com\/watch[a-zA-Z0-9_\-\?\&\=\/]+/,i=/(http:\/\/|www.)?youtu\.be\/([a-zA-Z0-9_\-\?\&\=\/]+)/,j=new RegExp(h.source+"|"+i.source),k=/http:\/\/(www\.)?(flickr\.com\/photos\/.+|flic\.kr\/.+|twitgoo\.com\/.+|mobypicture\.com\/user\/.+\/view\/.+|moby\.to\/.+|dailybooth\.com\/.+\/.+|.+\.deviantart\.com\/art\/.+|.+\.deviantart\.com\/gallery\/.+|.+\.deviantart\.com\/#\/.+|fav\.me\/.+|.+\.deviantart\.com|.+\.deviantart\.com\/gallery|.+\.deviantart\.com\/.+\/.+\.jpg|.+\.deviantart\.com\/.+\/.+\.gif|.+\.deviantart\.net\/.+\/.+\.jpg|.+\.deviantart\.net\/.+\/.+\.gif|photozou\.jp\/photo\/show\/.+\/.+|photozou\.jp\/photo\/photo_only\/.+\/.+|soundcloud\.com\/.+|soundcloud\.com\/.+\/.+|soundcloud\.com\/.+\/sets\/.+|soundcloud\.com\/groups\/.+|snd\.sc\/.+|audioboo\.fm\/boos\/.+|boo\.fm\/b.+|slideshare\.net\/.+\/.+|slideshare\.net\/mobile\/.+\/.+|slidesha\.re\/.+|twitvid\.com\/.+|ustre\.am\/.+|ustream\.tv\/recorded\/.+|ustream\.tv\/channel\/.+|ustream\.tv\/.+|hulu\.com\/w\/.+|hulu\.com\/embed\/.+|hulu\.com\/watch.+|vimeo\.com\/groups\/.+\/videos\/.+|vimeo\.com\/.+|vimeo\.com\/m\/#\/.+|vevo\.com\/watch\/.+)/i,l={},m={},n=[],o={video:!0,rich:!0},p=function(a,b){return l[a]?(_.contains(l[a],b)||l[a].push(b),!1):(l[a]=[b],!0)},q=function(b,c){var d=l[b];delete l[b];if(c.type==="link")return;a.NO_FLASH&&o[c.type]&&!c.isYouTube&&(c.disabled=!0),c.flaggedNSFW=!1,c.textUrl=b,c.isVideo=c.type==="video",m[b]=c;while(d&&d.length)d.pop()(c,{url:b})},r=_.debounce(function(){n.length&&($.embedly(n,{maxWidth:null,wmode:"opaque",urlRe:k,key:"1db5affa06d111e084894040444cdc60"},function(a,b){a.isEmbedly=!0,q(b.url,a)}),n=[])},0),s=function(a){var b;return a&&a.media_url&&(b={thumbnail_url:a.media_url+":thumb",url:a.media_url+":large",textUrl:a.url,type:"photo",small:a.media_url+":small",provider_name:"Twitter"}),b},t=function(a){return{thumbnail_url:"http://twitpic.com/show/thumb/"+a.split("/").pop(),url:"http://twitpic.com/show/full/"+a.split("/").pop(),type:"photo",provider_name:"Twitpic"}},u=function(a){return{thumbnail_url:a+":small",url:a+":iphone",type:"photo",provider_name:"YFrog"}},v=function(a){return{thumbnail_url:"http://api.plixi.com/api/tpapi.svc/imagefromurl?size=thumbnail&url="+a,url:"http://api.plixi.com/api/tpapi.svc/imagefromurl?size=medium&url="+a,type:"photo",provider_name:"Lockerz"}},w=function(a){var b;return _.endsWith(a,"/")&&(a=a.substring(0,a.length-1)),b="http://instagr.am/p/"+a.split("/").pop()+"/media/?size=",{thumbnail_url:b+"t",url:b+"l",type:"photo",provider_name:"Instagr.am"}};a.getYouTubeThumb=function(a){var b;return a.match(h)?b=TD.net.util.decodeURL(a).v:b=a.split("/").pop().split("?")[0],{thumbnail_url:"http://img.youtube.com/vi/"+b+"/1.jpg",url:a,type:"video",isVideo:!0,isYouTube:!0,height:"100%",width:"100%",id:b,provider_name:"YouTube"}};var x=[[c,s],[b,t],[d,u],[e,v],[f,v],[g,w],[j,a.getYouTubeThumb]];return a.getEmbedableContent=function(a,b){var c=[];if(a instanceof TD.services.FacebookUpdate){var d=a;p(d.link,b),TD.services.media.getMedia(d.link,d.account.getKey(),function(a){q(d.link,a)});return}if(!a||!a.entities)return;_.each(a.entities.media,function(a){b(s(a),{url:a.expanded_url})});var e=_.map(a.entities.urls,function(a){var b=a.expanded_url||a.url;return _.startsWith(b,"http")||(b="http://"+b),b});_.each(e,function(a){var d;if(m[a]){p(a,b),q(a,m[a]);return}for(var e=0;e<x.length;e++){d=a.match(x[e][0]);if(d&&d[0]==a){var f=x[e][1](a);if(f){p(a,b),q(a,f);return}}}d=a.match(k),d&&p(a,b)&&c.push(a)}),n=n.concat(c),r();return},a.supportedUrl=function(b,c){if(!c)return null;var d=null;b.entities&&b.entities.media&&_.each(b.entities.media,function(a){a.url===c&&(d=c)});if(d)return c;if(b.entities){var e=c;_.each(b.entities.urls,function(a){a.url===e&&(c=a.expanded_url||a.url)})}return a.looksLikeMediaUrl(c)?c:null},a.looksLikeMediaUrl=function(a){for(var b=0;b<x.length;b++){matches=a.match(x[b][0]);if(_.contains(a,"twitter.com"))return!1;if(matches&&matches[0]==a)return!0}return a.match(k)?!0:!1},a.createVideoEmbed=function(b,c,d,e){var f={};f.type="video",f.isVideo=!0,f.provider_name="Video",f.height=360,f.width=640,f.title=b,c.match(j)&&(f.id=a.getYouTubeThumb(c).id,f.isYouTube=!0);if(e){var g=TD.ui.template.render("media/oembed",{url:d});f.html=g}else f.html=d;m[c]=f},a.getMedia=function(a,b,c,d){if(m[a]){var e=m[a];e.provider_name==="YouTube"&&!e.html&&(e.html=TD.ui.template.render("media/youtube",{id:e.id})),c(e);return}if(_.contains(a,"facebook.com/photo.php")){var f=TD.controller.clients.getClient(b);f.getPhotoInfo(a,function(a){c({thumbnail_url:a.picture,url:a.source,type:"photo",provider_name:"Facebook"})});return}d()},a}(),!function(a,b){typeof define=="function"?define(b):typeof module!="undefined"?module.exports=b():this[a]=b()}("klass",function(){function f(a){return j.call(g(a)?a:function(){},a,1)}function g(a){return typeof a===c}function h(a,b,c){return function(){var d=this.supr;this.supr=c[e][a];var f=b.apply(this,arguments);return this.supr=d,f}}function i(a,b,c){for(var f in b)b.hasOwnProperty(f)&&(a[f]=g(b[f])&&g(c[e][f])&&d.test(b[f])?h(f,b[f],c):b[f])}function j(a,b){function c(){}function l(){this.initialize?this.initialize.apply(this,arguments):(b||h&&d.apply(this,arguments),j.apply(this,arguments))}c[e]=this[e];var d=this,f=new c,h=g(a),j=h?a:this,k=h?{}:a;return l.methods=function(a){return i(f,a,d),l[e]=f,this},l.methods.call(l,k).prototype.constructor=l,l.extend=arguments.callee,l[e].implement=l.statics=function(a,b){return a=typeof a=="string"?function(){var c={};return c[a]=b,c}():a,i(this,a,d),this},l.mixin=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];b===undefined?console.warn("you have an undefined mixin coming from "+ns):b.call(this,this)}return this},l}var a=this,b=a.klass,c="function",d=/xyz/.test(function(){xyz})?/\bsupr\b/:/.*/,e="prototype";return f.noConflict=function(){return a.klass=b,this},a.klass=f,f}),klass.mixin=function(a,b){if(_.isString(a)){var c=window,d=a.split(".");for(var e=0,f=d.length;e<f;++e)c=c[d[e]]=c[d[e]]||(_.isUndefined(d[e+1])?b:{});return c}_.extend(a,b)},klass.mixin("TD.mixins.caretHelper",function(){return this.statics({spaceBoundary:/\s|$/,wordEnd:/\S+$/}).methods({init:function(){this.$input.bind("blur",_.bind(function(a){setTimeout(_.bind(function(){this.hide()},this),1e3)},this)).bind("mouseup",_.bind(function(a){setTimeout(_.bind(function(){this.getCaret()},this),0)},this)).bind("focus",_.bind(function(a){this.getCaret()},this))},getCurrentText:function(){return this.$input.val()},setCaretPosition:function(a){var b=this.$input[0];if(b.setSelectionRange)b.focus(),b.setSelectionRange(a,a);else if(b.createTextRange){var c=b.createTextRange();c.collapse(!0),c.moveEnd("character",a),c.moveStart("character",a),c.select()}this.lastCaret=a},getCaret:function(){var a=this.$input[0],b=0;if(document.selection){try{a.focus()}catch(c){}var d=document.selection.createRange();if(d==null)return this.lastCaret=0,0;var e=a.createTextRange(),f=e.duplicate();e.moveToBookmark(d.getBookmark()),f.setEndPoint("EndToStart",e),b=f.text.length}else if(a.selectionStart||a.selectionStart=="0")b=a.selectionStart;return this.lastCaret=b,b},insertOrReplaceSelection:function(a,b){var c=this.$input[0],d=this.getCaret(),e=d+a.length;if(document.selection){c.focus();var f=document.selection.createRange();f.text=a;if(b){var g=c.createTextRange();g.collapse(!0),g.moveEnd("character",e),g.moveStart("character",d),g.select()}else this.setCaretPosition(e)}else if(c.selectionStart||c.selectionStart=="0"){var h=c.selectionStart,i=c.selectionEnd,j=c.scrollTop;c.value=c.value.substring(0,h)+a+c.value.substring(i,c.value.length),c.focus(),c.selectionStart=b?d:e,c.selectionEnd=e,c.scrollTop=j}else c.value+=a,this.setCaretPosition(e),c.focus();this.lastCaret=e,this.$input.change()},getCurrentWord:function(a){var b=this.getCurrentText(),c=b.slice(0,a),d=b.slice(a,b.length),e=b.charAt(a-1);if(!e||e===" ")return"";this.leftBoundary=c.search(this.constructor.wordEnd);var f=c.slice(this.leftBoundary,c.length),g=d.slice(0,d.search(this.constructor.spaceBoundary)),h=f.concat(g);return this.rightBoundary=this.leftBoundary+h.length,h},replaceCurrentWord:function(a){var b=this.getCurrentText().split("");this.oldValueArray=b;var c=b.slice(0,this.leftBoundary),d=b.slice(this.rightBoundary,b.length);if(d.length<1||!d[0].match(/\s/))a+=" ";var e=(c.join("")+a).length+1;return{value:c.join("")+a+d.join(""),cursor:e}}}),this});if(typeof window=="undefined"||window===null)window={twttr:{}};window.twttr==null&&(window.twttr={});if(typeof twttr=="undefined"||twttr===null)twttr={};(function(){function b(a,b){return b=b||"",typeof a!="string"&&(a.global&&b.indexOf("g")<0&&(b+="g"),a.ignoreCase&&b.indexOf("i")<0&&(b+="i"),a.multiline&&b.indexOf("m")<0&&(b+="m"),a=a.source),new RegExp(a.replace(/#\{(\w+)\}/g,function(a,b){var c=twttr.txt.regexen[b]||"";return typeof c!="string"&&(c=c.source),c}),b)}function c(a,b){return a.replace(/#\{(\w+)\}/g,function(a,c){return b[c]||""})}function d(a,b,c){var d=String.fromCharCode(b);return c!==b&&(d+="-"+String.fromCharCode(c)),a.push(d),a}function o(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function s(a,b,c){return c?!a||a.match(b)&&RegExp["$&"]===a:typeof a=="string"&&a.match(b)&&RegExp["$&"]===a}twttr.txt={},twttr.txt.regexen={};var a={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};twttr.txt.htmlEscape=function(b){return b&&b.replace(/[&"'><]/g,function(b){return a[b]})};var e=String.fromCharCode,f=[e(32),e(133),e(160),e(5760),e(6158),e(8232),e(8233),e(8239),e(8287),e(12288)];d(f,9,13),d(f,8192,8202);var g=[e(65534),e(65279),e(65535)];d(g,8234,8238),twttr.txt.regexen.spaces_group=b(f.join("")),twttr.txt.regexen.spaces=b("["+f.join("")+"]"),twttr.txt.regexen.invalid_chars_group=b(g.join("")),twttr.txt.regexen.punct=/\!'#%&'\(\)*\+,\\\-\.\/:;<=>\?@\[\]\^_{|}~\$/,twttr.txt.regexen.atSigns=/[@ï¼ ]/,twttr.txt.regexen.extractMentions=b(/(^|[^a-zA-Z0-9_!#$%&*@ï¼ ])(#{atSigns})([a-zA-Z0-9_]{1,20})/g),twttr.txt.regexen.extractReply=b(/^(?:#{spaces})*#{atSigns}([a-zA-Z0-9_]{1,20})/),twttr.txt.regexen.listName=/[a-zA-Z][a-zA-Z0-9_\-\u0080-\u00ff]{0,24}/,twttr.txt.regexen.extractMentionsOrLists=b(/(^|[^a-zA-Z0-9_!#$%&*@ï¼ ])(#{atSigns})([a-zA-Z0-9_]{1,20})(\/[a-zA-Z][a-zA-Z0-9_\-]{0,24})?/g);var h=[];d(h,1024,1279),d(h,1280,1319),d(h,11744,11775),d(h,42560,42655),d(h,1425,1469),d(h,1471,1471),d(h,1473,1474),d(h,1476,1477),d(h,1479,1479),d(h,1488,1514),d(h,1520,1522),d(h,64274,64296),d(h,64298,64310),d(h,64312,64316),d(h,64318,64318),d(h,64320,64321),d(h,64323,64324),d(h,64326,64335),d(h,1552,1562),d(h,1568,1631),d(h,1646,1747),d(h,1749,1756),d(h,1758,1768),d(h,1770,1775),d(h,1786,1788),d(h,1791,1791),d(h,1872,1919),d(h,2208,2208),d(h,2210,2220),d(h,2276,2302),d(h,64336,64433),d(h,64467,64829),d(h,64848,64911),d(h,64914,64967),d(h,65008,65019),d(h,65136,65140),d(h,65142,65276),d(h,8204,8204),d(h,3585,3642),d(h,3648,3662),d(h,4352,4607),d(h,12592,12677),d(h,43360,43391),d(h,44032,55215),d(h,55216,55295),d(h,65441,65500),d(h,12449,12538),d(h,12540,12542),d(h,65382,65439),d(h,65392,65392),d(h,65296,65305),d(h,65313,65338),d(h,65345,65370),d(h,12353,12438),d(h,12441,12446),d(h,13312,19903),d(h,19968,40959),d(h,173824,177983),d(h,177984,178207),d(h,194560,195103),d(h,12291,12291),d(h,12293,12293),d(h,12347,12347),twttr.txt.regexen.nonLatinHashtagChars=b(h.join(""));var i=[];d(i,192,214),d(i,216,246),d(i,248,255),d(i,256,591),d(i,595,596),d(i,598,599),d(i,601,601),d(i,603,603),d(i,611,611),d(i,616,616),d(i,623,623),d(i,626,626),d(i,649,649),d(i,651,651),d(i,699,699),d(i,7680,7935),twttr.txt.regexen.latinAccentChars=b(i.join("")),twttr.txt.regexen.endScreenNameMatch=b(/^(?:#{atSigns}|[#{latinAccentChars}]|:\/\/)/),twttr.txt.regexen.hashtagAlpha=b(/[a-z_#{latinAccentChars}#{nonLatinHashtagChars}]/i),twttr.txt.regexen.hashtagAlphaNumeric=b(/[a-z0-9_#{latinAccentChars}#{nonLatinHashtagChars}]/i),twttr.txt.regexen.endHashtagMatch=/^(?:[#ï¼]|:\/\/)/,twttr.txt.regexen.hashtagBoundary=b(/(?:^|$|[^&\/a-z0-9_#{latinAccentChars}#{nonLatinHashtagChars}])/),twttr.txt.regexen.autoLinkHashtags=b(/(#{hashtagBoundary})(#|ï¼)(#{hashtagAlphaNumeric}*#{hashtagAlpha}#{hashtagAlphaNumeric}*)/gi),twttr.txt.regexen.autoLinkUsernamesOrLists=/(^|[^a-zA-Z0-9_!#\$%&*@ï¼ ]|RT:?)([@ï¼ ]+)([a-zA-Z0-9_]{1,20})(\/[a-zA-Z][a-zA-Z0-9_\-]{0,24})?/g,twttr.txt.regexen.autoLinkEmoticon=/(8\-\#|8\-E|\+\-\(|\`\@|\`O|\&lt;\|:~\(|\}:o\{|:\-\[|\&gt;o\&lt;|X\-\/|\[:-\]\-I\-|\/\/\/\/Ã\\\\\\\\|\(\|:\|\/\)|â:\*\)|\( \| \))/g,twttr.txt.regexen.validPrecedingChars=b(/(?:[^-\/"'!=A-Za-z0-9_@ï¼ $#ï¼\.#{invalid_chars_group}]|^)/),twttr.txt.regexen.invalidDomainChars=c("#{punct}#{spaces_group}#{invalid_chars_group}",twttr.txt.regexen),twttr.txt.regexen.validDomainChars=b(/[^#{invalidDomainChars}]/),twttr.txt.regexen.validSubdomain=b(/(?:(?:#{validDomainChars}(?:[_-]|#{validDomainChars})*)?#{validDomainChars}\.)/),twttr.txt.regexen.validDomainName=b(/(?:(?:#{validDomainChars}(?:-|#{validDomainChars})*)?#{validDomainChars}\.)/),twttr.txt.regexen.validGTLD=b(/(?:(?:aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|xxx)(?=[^a-zA-Z]|$))/),twttr.txt.regexen.validCCTLD=b(/(?:(?:ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|ss|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)(?=[^a-zA-Z]|$))/),twttr.txt.regexen.validPunycode=b(/(?:xn--[0-9a-z]+)/),twttr.txt.regexen.validDomain=b(/(?:#{validSubdomain}*#{validDomainName}(?:#{validGTLD}|#{validCCTLD}|#{validPunycode}))/),twttr.txt.regexen.validAsciiDomain=b(/(?:(?:[a-z0-9#{latinAccentChars}]+)\.)+(?:#{validGTLD}|#{validCCTLD}|#{validPunycode})/gi),twttr.txt.regexen.invalidShortDomain=b(/^#{validDomainName}#{validCCTLD}$/),twttr.txt.regexen.validPortNumber=b(/[0-9]+/),twttr.txt.regexen.validGeneralUrlPathChars=b(/[a-z0-9!\*';:=\+,\.\$\/%#\[\]\-_~|&#{latinAccentChars}]/i),twttr.txt.regexen.validUrlBalancedParens=b(/\(#{validGeneralUrlPathChars}+\)/i),twttr.txt.regexen.validUrlPathEndingChars=b(/[\+\-a-z0-9=_#\/#{latinAccentChars}]|(?:#{validUrlBalancedParens})/i),twttr.txt.regexen.validUrlPath=b("(?:(?:#{validGeneralUrlPathChars}*(?:#{validUrlBalancedParens}#{validGeneralUrlPathChars}*)*#{validUrlPathEndingChars})|(?:@#{validGeneralUrlPathChars}+/))","i"),twttr.txt.regexen.validUrlQueryChars=/[a-z0-9!?\*'\(\);:&=\+\$\/%#\[\]\-_\.,~|]/i,twttr.txt.regexen.validUrlQueryEndingChars=/[a-z0-9_&=#\/]/i,twttr.txt.regexen.extractUrl=b("((#{validPrecedingChars})((https?:\\/\\/)?(#{validDomain})(?::(#{validPortNumber}))?(\\/#{validUrlPath}*)?(\\?#{validUrlQueryChars}*#{validUrlQueryEndingChars})?))","gi"),twttr.txt.regexen.validTcoUrl=/^https?:\/\/t\.co\/[a-z0-9]+/i,twttr.txt.regexen.validateUrlUnreserved=/[a-z0-9\-._~]/i,twttr.txt.regexen.validateUrlPctEncoded=/(?:%[0-9a-f]{2})/i,twttr.txt.regexen.validateUrlSubDelims=/[!$&'()*+,;=]/i,twttr.txt.regexen.validateUrlPchar=b("(?:#{validateUrlUnreserved}|#{validateUrlPctEncoded}|#{validateUrlSubDelims}|[:|@])","i"),twttr.txt.regexen.validateUrlScheme=/(?:[a-z][a-z0-9+\-.]*)/i,twttr.txt.regexen.validateUrlUserinfo=b("(?:#{validateUrlUnreserved}|#{validateUrlPctEncoded}|#{validateUrlSubDelims}|:)*","i"),twttr.txt.regexen.validateUrlDecOctet=/(?:[0-9]|(?:[1-9][0-9])|(?:1[0-9]{2})|(?:2[0-4][0-9])|(?:25[0-5]))/i,twttr.txt.regexen.validateUrlIpv4=b(/(?:#{validateUrlDecOctet}(?:\.#{validateUrlDecOctet}){3})/i),twttr.txt.regexen.validateUrlIpv6=/(?:\[[a-f0-9:\.]+\])/i,twttr.txt.regexen.validateUrlIp=b("(?:#{validateUrlIpv4}|#{validateUrlIpv6})","i"),twttr.txt.regexen.validateUrlSubDomainSegment=/(?:[a-z0-9](?:[a-z0-9_\-]*[a-z0-9])?)/i,twttr.txt.regexen.validateUrlDomainSegment=/(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?)/i,twttr.txt.regexen.validateUrlDomainTld=/(?:[a-z](?:[a-z0-9\-]*[a-z0-9])?)/i,twttr.txt.regexen.validateUrlDomain=b(/(?:(?:#{validateUrlSubDomainSegment]}\.)*(?:#{validateUrlDomainSegment]}\.)#{validateUrlDomainTld})/i),twttr.txt.regexen.validateUrlHost=b("(?:#{validateUrlIp}|#{validateUrlDomain})","i"),twttr.txt.regexen.validateUrlUnicodeSubDomainSegment=/(?:(?:[a-z0-9]|[^\u0000-\u007f])(?:(?:[a-z0-9_\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i,twttr.txt.regexen.validateUrlUnicodeDomainSegment=/(?:(?:[a-z0-9]|[^\u0000-\u007f])(?:(?:[a-z0-9\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i,twttr.txt.regexen.validateUrlUnicodeDomainTld=/(?:(?:[a-z]|[^\u0000-\u007f])(?:(?:[a-z0-9\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i,twttr.txt.regexen.validateUrlUnicodeDomain=b(/(?:(?:#{validateUrlUnicodeSubDomainSegment}\.)*(?:#{validateUrlUnicodeDomainSegment}\.)#{validateUrlUnicodeDomainTld})/i),twttr.txt.regexen.validateUrlUnicodeHost=b("(?:#{validateUrlIp}|#{validateUrlUnicodeDomain})","i"),twttr.txt.regexen.validateUrlPort=/[0-9]{1,5}/,twttr.txt.regexen.validateUrlUnicodeAuthority=b("(?:(#{validateUrlUserinfo})@)?(#{validateUrlUnicodeHost})(?::(#{validateUrlPort}))?","i"),twttr.txt.regexen.validateUrlAuthority=b("(?:(#{validateUrlUserinfo})@)?(#{validateUrlHost})(?::(#{validateUrlPort}))?","i"),twttr.txt.regexen.validateUrlPath=b(/(\/#{validateUrlPchar}*)*/i),twttr.txt.regexen.validateUrlQuery=b(/(#{validateUrlPchar}|\/|\?)*/i),twttr.txt.regexen.validateUrlFragment=b(/(#{validateUrlPchar}|\/|\?)*/i),twttr.txt.regexen.validateUrlUnencoded=b("^(?:([^:/?#]+):\\/\\/)?([^/?#]*)([^?#]*)(?:\\?([^#]*))?(?:#(.*))?$","i");var j="tweet-url",k="list-slug",l="username",m="hashtag",n=' rel="nofollow"';twttr.txt.autoLink=function(a,b){return b=o(b||{}),twttr.txt.autoLinkUsernamesOrLists(twttr.txt.autoLinkUrlsCustom(twttr.txt.autoLinkHashtags(a,b),b),b)},twttr.txt.autoLinkUsernamesOrLists=function(a,b){b=o(b||{}),b.urlClass=b.urlClass||j,b.listClass=b.listClass||k,b.usernameClass=b.usernameClass||l,b.usernameUrlBase=b.usernameUrlBase||"https://twitter.com/",b.listUrlBase=b.listUrlBase||"https://twitter.com/";if(!b.suppressNoFollow)var d=n;var e="",f=twttr.txt.splitTags(a);for(var g=0;g<f.length;g++){var h=f[g];g!==0&&(e+=g%2===0?">":"<"),g%4!==0?e+=h:e+=h.replace(twttr.txt.regexen.autoLinkUsernamesOrLists,function(a,e,f,g,h,i,j){var k=j.slice(i+a.length),l={before:e,at:b.usernameIncludeSymbol?"":f,at_before_user:b.usernameIncludeSymbol?f:"",user:twttr.txt.htmlEscape(g),slashListname:twttr.txt.htmlEscape(h),extraHtml:d,preChunk:"",postChunk:""};for(var m in b)b.hasOwnProperty(m)&&(l[m]=b[m]);if(h&&!b.suppressLists){var n=l.chunk=c("#{user}#{slashListname}",l);return l.list=twttr.txt.htmlEscape(n.toLowerCase()),c('#{before}#{at}<a class="#{urlClass} #{listClass}" href="#{listUrlBase}#{list}"#{extraHtml}>#{preChunk}#{at_before_user}#{chunk}#{postChunk}</a>',l)}return k&&k.match(twttr.txt.regexen.endScreenNameMatch)?a:(l.chunk=l.user,l.dataScreenName=b.suppressDataScreenName?"":c('data-screen-name="#{chunk}" ',l),c('#{before}#{at}<a class="#{urlClass} #{usernameClass}" #{dataScreenName}href="#{usernameUrlBase}#{chunk}"#{extraHtml}>#{preChunk}#{at_before_user}#{chunk}#{postChunk}</a>',l))})}return e},twttr.txt.autoLinkHashtags=function(a,b){b=o(b||{}),b.urlClass=b.urlClass||j,b.hashtagClass=b.hashtagClass||m,b.hashtagUrlBase=b.hashtagUrlBase||"https://twitter.com/#!/search?q=%23";if(!b.suppressNoFollow)var d=n;return a.replace(twttr.txt.regexen.autoLinkHashtags,function(a,e,f,g,h,i){var j=i.slice(h+a.length);if(j.match(twttr.txt.regexen.endHashtagMatch))return a;var k={before:e,hash:twttr.txt.htmlEscape(f),preText:"",text:twttr.txt.htmlEscape(g),postText:"",extraHtml:d};for(var l in b)b.hasOwnProperty(l)&&(k[l]=b[l]);return c('#{before}<a href="#{hashtagUrlBase}#{text}" title="##{text}" class="#{urlClass} #{hashtagClass}"#{extraHtml}>#{hash}#{preText}#{text}#{postText}</a>',k)})},twttr.txt.autoLinkUrlsCustom=function(a,b){b=o(b||{}),b.suppressNoFollow||(b.rel="nofollow"),b.urlClass&&(b["class"]=b.urlClass,delete b.urlClass);var d,e,f;if(b.urlEntities){d={};for(e=0,f=b.urlEntities.length;e<f;e++)d[b.urlEntities[e].url]=b.urlEntities[e]}return delete b.suppressNoFollow,delete b.suppressDataScreenName,delete b.listClass,delete b.usernameClass,delete b.usernameUrlBase,delete b.listUrlBase,delete b.urlEntities,a.replace(twttr.txt.regexen.extractUrl,function(a,e,f,g,h,i,j,k,l){var m;if(h){var n="",o="";g.match(twttr.txt.regexen.validTcoUrl)&&(g=RegExp.lastMatch,o=RegExp.rightContext);var p=g,q=twttr.txt.htmlEscape(p);if(d&&d[g]&&d[g].display_url){var p=d[g].display_url,r=d[g].expanded_url;b.title||(b.title=r);var s=p.replace(/â¦/g,"");if(r.indexOf(s)!=-1){var t=r.indexOf(s),u={displayUrlSansEllipses:s,beforeDisplayUrl:r.substr(0,t),afterDisplayUrl:r.substr(t+s.length),precedingEllipsis:p.match(/^â¦/)?"â¦":"",followingEllipsis:p.match(/â¦$/)?"â¦":""};$.each(u,function(a,b){u[a]=twttr.txt.htmlEscape(b)}),u.invisible="style='font-size:0; line-height:0'",q=c("<span class='tco-ellipsis'>#{precedingEllipsis}<span #{invisible}>&nbsp;</span></span><span #{invisible}>#{beforeDisplayUrl}</span><span class='js-display-url'>#{displayUrlSansEllipses}</span><span #{invisible}>#{afterDisplayUrl}</span><span class='tco-ellipsis'><span #{invisible}>&nbsp;</span>#{followingEllipsis}</span>",u)}}for(var v in b){var w=b[v].toString();n+=c(' #{k}="#{val}" ',{k:v,val:twttr.txt.htmlEscape(w)})}var x={before:f,htmlAttrs:n,url:twttr.txt.htmlEscape(g),linkText:q,after:o};return c('#{before}<a href="#{url}"#{htmlAttrs}>#{linkText}</a>#{after}',x)}return e})},twttr.txt.extractMentions=function(a){var b=[],c=twttr.txt.extractMentionsWithIndices(a);for(var d=0;d<c.length;d++){var e=c[d].screenName;b.push(e)}return b},twttr.txt.extractMentionsWithIndices=function(a){if(!a)return[];var b=[],c=0;return a.replace(twttr.txt.regexen.extractMentions,function(d,e,f,g,h,i){var j=i.slice(h+d.length);if(!j.match(twttr.txt.regexen.endScreenNameMatch)){var k=a.indexOf(f+g,c);c=k+g.length+1,b.push({screenName:g,indices:[k,c]})}}),b},twttr.txt.extractMentionsOrListsWithIndices=function(a){if(!a)return[];var b=[],c=0;return a.replace(twttr.txt.regexen.extractMentionsOrLists,function(d,e,f,g,h,i,j){var k=j.slice(i+d.length);if(!k.match(twttr.txt.regexen.endScreenNameMatch)){h=h||"";var l=a.indexOf(f+g+h,c);c=l+g.length+h.length+1,b.push({screenName:g,listSlug:h,indices:[l,c]})}}),b},twttr.txt.extractReplies=function(a){if(!a)return null;var b=a.match(twttr.txt.regexen.extractReply);return!b||RegExp.rightContext.match(twttr.txt.regexen.endScreenNameMatch)?null:b[1]},twttr.txt.extractUrls=function(a){var b=[],c=twttr.txt.extractUrlsWithIndices(a);for(var d=0;d<c.length;d++)b.push(c[d].url);return b},twttr.txt.extractUrlsWithIndices=function(a){if(!a)return[];var b=[];while(twttr.txt.regexen.extractUrl.exec(a)){var c=RegExp.$2,d=RegExp.$3,e=RegExp.$4,f=RegExp.$5,g=RegExp.$7,h=twttr.txt.regexen.extractUrl.lastIndex,i=h-d.length;if(!e){var j=null,k=!1,l=0;f.replace(twttr.txt.regexen.validAsciiDomain,function(a){var c=f.indexOf(a,l);l=c+a.length,j={url:a,indices:[i+c,i+l]},k=a.match(twttr.txt.regexen.invalidShortDomain),k||b.push(j)});if(j==null)continue;g&&(k&&b.push(j),j.url=d.replace(f,j.url),j.indices[1]=h)}else d.match(twttr.txt.regexen.validTcoUrl)&&(d=RegExp.lastMatch,h=i+d.length),b.push({url:d,indices:[i,h]})}return b},twttr.txt.extractHashtags=function(a){var b=[],c=twttr.txt.extractHashtagsWithIndices(a);for(var d=0;d<c.length;d++)b.push(c[d].hashtag);return b},twttr.txt.extractHashtagsWithIndices=function(a){if(!a)return[];var b=[],c=0;return a.replace(twttr.txt.regexen.autoLinkHashtags,function(d,e,f,g,h,i){var j=i.slice(h+d.length);if(j.match(twttr.txt.regexen.endHashtagMatch))return;var k=a.indexOf(f+g,c);c=k+g.length+1,b.push({hashtag:g,indices:[k,c]})}),b},twttr.txt.modifyIndicesFromUnicodeToUTF16=function(a,b){twttr.txt.convertUnicodeIndices(a,b,!1)},twttr.txt.modifyIndicesFromUTF16ToUnicode=function(a,b){twttr.txt.convertUnicodeIndices(a,b,!0)},twttr.txt.convertUnicodeIndices=function(a,b,c){if(b.length==0)return;var d=0,e=0;b.sort(function(a,b){return a.indices[0]-b.indices[0]});var f=0,g=b[0];while(d<a.length){if(g.indices[0]==(c?d:e)){var h=g.indices[1]-g.indices[0];g.indices[0]=c?e:d,g.indices[1]=g.indices[0]+h,f++;if(f==b.length)break;g=b[f]}var i=a.charCodeAt(d);55296<=i&&i<=56319&&d<a.length-1&&(i=a.charCodeAt(d+1),56320<=i&&i<=57343&&d++),e++,d++}},twttr.txt.splitTags=function(a){var b=a.split("<"),c,d=[],e;for(var f=0;f<b.length;f+=1){e=b[f];if(!e)d.push("");else{c=e.split(">");for(var g=0;g<c.length;g+=1)d.push(c[g])}}return d},twttr.txt.hitHighlight=function(a,b,c){var d="em";b=b||[],c=c||{};if(b.length===0)return a;var e=c.tag||d,f=["<"+e+">","</"+e+">"],g=twttr.txt.splitTags(a),h,i,j,k="",l=0,m=g[0],n=0,o=0,p=!1,q=m,r=[],s,t,u,v,w;for(i=0;i<b.length;i+=1)for(j=0;j<b[i].length;j+=1)r.push(b[i][j]);for(s=0;s<r.length;s+=1){t=r[s],u=f[s%2],v=!1;while(m!=null&&t>=n+m.length)k+=q.slice(o),p&&t===n+q.length&&(k+=u,v=!0),g[l+1]&&(k+="<"+g[l+1]+">"),n+=q.length,o=0,l+=2,m=g[l],q=m,p=!1;!v&&m!=null?(w=t-n,k+=q.slice(o,w)+u,o=w,s%2===0?p=!0:p=!1):v||(v=!0,k+=u)}if(m!=null){o<q.length&&(k+=q.slice(o));for(s=l+1;s<g.length;s+=1)k+=s%2===0?g[s]:"<"+g[s]+">"}return k};var p=140,q=[e(65534),e(65279),e(65535),e(8234),e(8235),e(8236),e(8237),e(8238)];twttr.txt.isInvalidTweet=function(a){if(!a)return"empty";if(a.length>p)return"too_long";for(var b=0;b<q.length;b++)if(a.indexOf(q[b])>=0)return"invalid_characters";return!1},twttr.txt.isValidTweetText=function(a){return!twttr.txt.isInvalidTweet(a)},twttr.txt.isValidUsername=function(a){if(!a)return!1;var b=twttr.txt.extractMentions(a);return b.length===1&&b[0]===a.slice(1)};var r=b(/^#{autoLinkUsernamesOrLists}$/);twttr.txt.isValidList=function(a){var b=a.match(r);return!!b&&b[1]==""&&!!b[4]},twttr.txt.isValidHashtag=function(a){if(!a)return!1;var b=twttr.txt.extractHashtags(a);return b.length===1&&b[0]===a.slice(1)},twttr.txt.isValidUrl=function(a,b,c){b==null&&(b=!0),c==null&&(c=!0);if(!a)return!1;var d=a.match(twttr.txt.regexen.validateUrlUnencoded);if(!d||d[0]!==a)return!1;var e=d[1],f=d[2],g=d[3],h=d[4],i=d[5];return(!c||s(e,twttr.txt.regexen.validateUrlScheme)&&e.match(/^https?$/i))&&s(g,twttr.txt.regexen.validateUrlPath)&&s(h,twttr.txt.regexen.validateUrlQuery,!0)&&s(i,twttr.txt.regexen.validateUrlFragment,!0)?b&&s(f,twttr.txt.regexen.validateUrlUnicodeAuthority)||!b&&s(f,twttr.txt.regexen.validateUrlAuthority):!1},typeof module!="undefined"&&module.exports&&(module.exports=twttr.txt)})(),TD.components.Base=klass(function(){this.$node=$.createElement("div").addClass("js-component")}).methods({$find:function(){return this.$node.find.apply(this.$node,arguments)},publishEvent:function(a,b){var c={data:b,target:this};TD.storage.notification.notify(a,c)},bubbleEvent:function(a,b){var c={data:b,target:this};this.$node.trigger(a,[c])},destroy:function(){this.$node.remove()},show:function(){this.$node.show()},hide:function(){this.$node.hide()}}),TD.components.Autocomplete=TD.components.Base.extend(function(a,b){var c={limit:5,dmMode:!1};this.options=_.extend(c,b),this.$input=a,this.isCompletionsOpen=!1,this.$node=$.createElement("ul").addClass("lst lst-modal l-compose-box").insertAfter(this.$input),this.$selectedItem=null,this._registerEvents(),c.dmMode?this.usernameRegex=this.constructor.dmUsername:this.usernameRegex=this.constructor.username}).mixin(TD.mixins.caretHelper).statics({regCache:{},username:/^[@ï¼ ]([a-zA-Z0-9_]{1,20})$/,dmUsername:/^([a-zA-Z0-9_]{1,20})$/,hashtag:/^[#ï¼]([a-zA-Z0-9_]+)/,SELECT:"td-autocomplete-select",_matchesContiguouslyCaches:{results:{},matchers:{}},_matchesConsecutivelyCaches:{results:{},matchers:{}},_htmlEscapeAndStrongifyMatches:function(a,b){return TD.util.escape(a.replace(b,"<strong>$1</strong>")).replace(/&lt;(\/?strong)&gt;/g,"<$1>")},_matchesContiguously:function(a,b){var c=TD.components.Autocomplete,d=c._matchesContiguouslyCaches.matchers,e=c._matchesContiguouslyCaches.results;return e[a]&&e[a][b]!==undefined?e[a][b]:(d[a]=d[a]||new RegExp("^"+a,"i"),e[a]=e[a]||{},e[a][b]=d[a].test(b.replace(/\W/,"")),e[a][b])},_matchesConsecutively:function(a,b){var c=TD.components.Autocomplete,d=c._matchesConsecutivelyCaches.matchers,e=c._matchesConsecutivelyCaches.results;return e[a]&&e[a][b]!==undefined?e[a][b]:(d[a]=d[a]||new RegExp(a.split("").join(".*"),"i"),e[a]=e[a]||{},e[a][b]=d[a].test(b),e[a][b])},levenSorter:function(a,b){var c=TD.components.Autocomplete._currentPrefix,d=TD.util.leven(a,c),e=TD.util.leven(b,c);return d<e?-1:d>e?1:0},sorter:function(a,b){var c=TD.components.Autocomplete._matchesContiguously,d=TD.components.Autocomplete._matchesConsecutively,e=TD.components.Autocomplete._currentPrefix;if(c(e,a[1])&&!c(e,b[1]))return-1;if(!c(e,a[1])&&c(e,b[1]))return 1;if(c(e,a[2])&&!c(e,b[2]))return-1;if(!c(e,a[2])&&c(e,b[2]))return 1;if(d(e,a[1])&&!d(e,b[1]))return-1;if(!d(e,a[1])&&d(e,b[1]))return 1;if(d(e,a[2])&&!d(e,b[2]))return-1;if(!d(e,a[2])&&d(e,b[2]))return 1;var f=TD.util.leven(a[1],e),g=TD.util.leven(b[1],e);if(f<g)return-1;if(f>g)return 1;var h=TD.util.leven(a[2],e),i=TD.util.leven(b[2],e);return h<i?-1:h>i?1:0}}).methods({_registerEvents:function(){var a=this,b="keypress"+($.browser.webkit||$.browser.msie?" keydown":"");this.$input.bind(b,_.bind(this.keypress,this)),this.$input.bind("keyup click",_.bind(this.keyup,this)),this.blurHandler=function(){_.delay(function(){a.hide()},500)},this.$input.bind("blur",this.blurHandler),this.$node.delegate("li","mouseenter",function(b){a.$node.find("li.s-selected").removeClass("s-selected"),$(this).addClass("s-selected")}).delegate("li","click",_.bind(function(b){a.$selectedItem=$(b.target).closest("li").addClass("s-selected"),a.$selectedItem.siblings(".s-selected").removeClass("s-selected"),this.$input.focus(),this.select()},this)),this.$input.bind("keydown",function(a){a.stopPropagation()})},_unregisterEvents:function(){var a="keypress"+($.browser.webkit||$.browser.msie?" keydown":"");this.$input.unbind(a),this.$input.unbind("keyup click keydown"),this.$input.unbind("bind",this.blurHandler)},keyup:function(a){if(!a.keyCode)return;a.stopPropagation();var b="",c=this.getCaret(),d=!1;b=this.getCurrentWord(c),b.match(this.usernameRegex)?(b=RegExp.$1,this.autocompleteType="username",d=!0):b.match(this.constructor.hashtag)&&(b=RegExp.$1,this.autocompleteType="hashtag",d=!0);if(b.length&&d)switch(a.keyCode){case TD.constants.keyCodes.escape:this.hide(),a.stopPropagation();break;case TD.constants.keyCodes.upArrow:case TD.constants.keyCodes.downArrow:break;case TD.constants.keyCodes.tab:case TD.constants.keyCodes.enter:!a.shiftKey&&this.$selectedItem&&this.isCompletionsOpen?this.select():this.options.dmMode&&!this.isCompletionsOpen&&this.select();break;case TD.constants.keyCodes.spacebar:this.options.dmMode&&this.set(this.$input.val());break;default:this.autocompleteType=="hashtag"?this.lookUpHashtag(b):this.lookUpUser(b)}else this.hide()},keypress:function(a){a.stopPropagation();switch(a.keyCode){case TD.constants.keyCodes.spacebar:if(!this.options.dmMode)break;case TD.constants.keyCodes.tab:case TD.constants.keyCodes.enter:case TD.constants.keyCodes.escape:this.isCompletionsOpen&&a.preventDefault();break;case TD.constants.keyCodes.upArrow:this.isCompletionsOpen&&!a.shiftKey&&(this.moveSelection("prev"),a.preventDefault());break;case TD.constants.keyCodes.downArrow:this.isCompletionsOpen&&!a.shiftKey&&(this.moveSelection("next"),a.preventDefault());break;default:this.$selectedItem=null}},sanitize:function(a){return a.replace(/ /g,"")},moveSelection:function(a){var b=a=="next"?"li:first":"li:last",c=this.$selectedItem||this.$node.find("li.s-selected");if(!c.length){this.$selectedItem=this.$node.find(b).addClass("s-selected");return}c=c.removeClass("s-selected"),a==="next"?c=c.nextAll("li:first"):c=c.prevAll("li:first"),c.length?this.$selectedItem=c.addClass("s-selected"):this.$selectedItem=this.$node.find(b).addClass("s-selected")},select:function(){var a,b;this.autocompleteType==="username"?(a=this.$selectedItem.find("em").text(),this.options.dmMode||(a="@"+a),b=this.$selectedItem.find("img").attr("src")):a=this.$selectedItem.find("b").text(),this.set(a,b)},set:function(a,b){var c=this.replaceCurrentWord(a);this.$input.val(c.value),this.setCaretPosition(c.cursor),this.$input.change(),this.$node.trigger(this.constructor.SELECT,[a,b]),this.hide()},show:function(){this.$node.show(),this.isCompletionsOpen=!0},hide:function(){this.$node.hide(),this.isCompletionsOpen=!1},lookUpHashtag:function(a){var b=this;a=this.sanitize(a);var c=function(a){if(a.match(this.re))return!0},d=this.getFilteredResults(a,_.keys(TD.ui.compose.hashtagSet),c);d=d.slice(0,this.options.limit);var e=new RegExp("("+a.split("").join("|")+")","gi");d=_.map(d,function(a){return{value:b.constructor._htmlEscapeAndStrongifyMatches(a,e)}});var f=TD.ui.template.render("compose/autocomplete_hashtag",{results:d});this.$node.html(f),d.length?(this.isCompletionsOpen||this.show(),this.moveSelection("next")):this.isCompletionsOpen&&this.hide()},lookUpUser:function(a){var b=this;a=this.sanitize(a);var c=function(a){if(a[1].match(this.re))return!0;if(a[2].replace(/ /g,"").match(this.re))return!0},d=this.getFilteredResults(a,TD.cache.autocomplete.getValues(),c);d=d.slice(0,this.options.limit);var e=new RegExp("("+a.split("").join("|")+")","gi");d=_.map(d,function(a){return{id:a[0],screenName:b.constructor._htmlEscapeAndStrongifyMatches(a[1],e),name:b.constructor._htmlEscapeAndStrongifyMatches(a[2],e),pic:TD.util.transformTwitterAvatar(a[3],"mini")}});var f=TD.ui.template.render("compose/autocomplete_twitter_user",{results:d});this.$node.html(f),d.length?(this.isCompletionsOpen||this.show(),this.moveSelection("next")):this.isCompletionsOpen&&this.hide()},getFilteredResults:function(a,b,c,d){var e=this.constructor.regCache[a];if(!e){var f=a.split(""),g="^"+f.join("\\w*");e=new RegExp(g,"i"),this.constructor.regCache[a]=e}var h=_.select(b,c,{re:e});return d?h.sort(d):h},destroy:function(){this._unregisterEvents(),this.$node.remove()}}),TD.components.Retweeters=TD.components.Base.extend(function(a,b){function f(a){var b,c={stats:[]};if(_.isString(a.retweeters_count))b=a.retweeters_count;else{var f=a.retweeters_count||0;b=Math.max(f,d.length)+""}b!=="0"&&c.stats.push({count:TD.util.prettyNumber(b),label:TD.util.pluralise(TD.i("Retweet"),TD.i("Retweets"),b)}),a.favoriters_count!=="0"&&c.stats.push({count:TD.util.prettyNumber(a.favoriters_count),label:TD.util.pluralise(TD.i("Favorite"),TD.i("Favorites"),a.favoriters_count)}),a.repliers_count!=="0"&&c.stats.push({count:TD.util.prettyNumber(a.repliers_count),label:TD.util.pluralise(TD.i("Reply"),TD.i("Replies"),a.repliers_count)});if(c.stats.length>0){var g=TD.ui.template.render("status/tweet_detail_socialstats",c);e.$node.html(g)}else e.destroy()}if(!(a instanceof TD.services.TwitterStatus)||a instanceof TD.services.TwitterDirectMessage)return;this.tweet=a.getMainTweet();var c=TD.controller.clients.getClient(this.tweet.account.getKey()),d=[],e=this;c.getTweetSummary(this.tweet.id,f,function(){e.destroy()})}),TD.components.RepliesTo=TD.components.Base.extend(function(a){this.chirp=a.getMainTweet(),this.mainTweet=this.chirp.getMainTweet(),this.repliesTo=[],this.subscription=$.subscribe("/tweets/related/"+this.mainTweet.id,_.bind(this._handleRelatedResults,this));var b=TD.controller.clients.getClient(this.chirp.account.getKey());b.getRelatedResults(this.mainTweet.id)}).methods({_handleRelatedResults:function(a){this.repliesTo=a.descendants.concat(a.forks),this.repliesTo.sort(TD.util.chirpAscSort);if(this.repliesTo.length>0){var b=_.map(this.repliesTo,function(a){return a.renderAsReply()}).join(""),c=TD.ui.template.render("status/tweet_detail_repliesto",{renderedChirps:b});this.$node.html(c)}},findChirp:function(a){var b=null;return this.chirp.id===a?b=this.chirp:this.mainTweet.id===a?b=this.mainTweet:this.repliesTo&&(b=_.detect(this.repliesTo,function(b){return b.id===a})),b},destroy:function(){$.unsubscribe(this.subscription),this.supr()}}),TD.components.InReplyTo=TD.components.Base.extend(function(a,b){var c=this;this.chirp=a,this.mainTweet=this.chirp.getMainTweet(),this.$container=b;if(!this.mainTweet.inReplyToID)return;this.$node.html(TD.ui.template.render("status/tweet_detail_inreplyto")),this.$repliesContainer=this.$find(".js-replies-before"),this.$repliesText=this.$find(".in-reply-to").hide(),this.replies=null,_.defer(function(){c.bubbleEvent(TD.components.InReplyTo.BEGIN)}),this.subscription=$.subscribe("/tweets/related/"+this.mainTweet.id,_.bind(this._handleRelatedResults,this)),this.client=TD.controller.clients.getClient(this.chirp.account.getKey()),this.client.getRelatedResults(this.mainTweet.id)}).statics({BEGIN:"td-load-convo",END:"td-load-finish"}).methods({_handleRelatedResults:function(a){this.replies=a.ancestors,_.isEmpty(this.replies)?this._getConversation():this._showReplies()},_getConversation:function(){var a=this;this.client.getConversation(this.mainTweet.inReplyToID,function(b){var c=_.find(b,function(b){return b.id===a.mainTweet.inReplyToID});a.replies=b,c?a._showReplies():a._getTweet()},function(){a._getTweet()})},_getTweet:function(){var a=this;this.client.show(this.mainTweet.inReplyToID,function(b){a.replies=a.replies||[],a.replies.push(b),a._showReplies()},function(){a.bubbleEvent(TD.components.InReplyTo.END)})},_showReplies:function(){_.defer(_.bind(this._showRepliesInternal,this))},_showRepliesInternal:function(){this.bubbleEvent(TD.components.InReplyTo.END);if(_.isEmpty(this.replies))return;this.replies.sort(TD.util.chirpAscSort);var a=this.mainTweet.id,b=_.map(this.replies,function(b){return b.id!==a?b.render():""}),c=this.$container.children().outerHeight();this.$repliesContainer.html(b.join("")),this.$repliesText.show();var d=this.$container.outerHeight(),e=this.$node.outerHeight();this.$container.find(".scroll-content").css("padding-bottom",d-c),this.$container.scrollTop(e),this.$container.animate({scrollTop:e-95},{duration:"fast"})},findChirp:function(a){var b=null;return this.chirp.id===a?b=this.chirp:this.mainTweet.id===a?b=this.mainTweet:this.replies&&(b=_.detect(this.replies,function(b){return b.id===a})),b},destroy:function(){this.subscription&&$.unsubscribe(this.subscription),this.supr()}}),TD.components.BaseModal=TD.components.Base.extend(function(){this.$node=$(TD.ui.template.render("large_modal")),$.publish("modal/close"),this.subscriptionHandleDestroy=$.subscribe("modal/close",_.bind(this.destroy,this)),this.$title=this.$find(".js-header-title"),this.$closeButton=this.$find(".js-dismiss"),this.$menuContainer=this.$find(".js-mdl-content"),this.$footer=this.$find("footer");var a=_.bind(this.destroy,this);this.$closeButton.bind("click",function(){a()}),this.$node.bind(TD.components.BaseModal.CLOSE_EVENT,a),this._handleKeydown=_.bind(this._handleKeydown,this),$(window).bind("keydown",this._handleKeydown);var b=_.bind(this.handleDragStart,this),c=_.bind(this.getDragDropBoundary,this);this.$node.draggable({boundary:c,handle:this.$find(".mdl-drag-handle")}),this.$node.on("start.draggable",b)}).statics({CLOSE_EVENT:"td-close"}).methods({getDragDropBoundary:function(){return this.$node.parent()},handleDragStart:function(){this.$node.css({position:"absolute",top:this.$node.offset().top,left:this.$node.offset().left})},show:function(){this.supr()},_handleKeydown:function(a){a.which===TD.constants.keyCodes.escape&&($(a.target).is("input, textarea")?$(a.target).blur():this.destroy())},destroy:function(){$.unsubscribe(this.subscriptionHandleDestroy),$(window).unbind("keydown",this._handleKeydown),this.supr()}}),TD.components.NewFeaturesSplash=TD.components.BaseModal.extend(function(){this.$title.text(TD.i("What's new in this update")),this.$menuContainer.append(TD.ui.template.render("splash/content")),this.$footer.append($(TD.ui.template.render("splash/footer"))),this.$doneButton=this.$find(".js-done"),this.$doneButton.click(_.bind(this.destroy,this)),$("#splash-modal").empty().append(this.$node).show(),TD.components.NewFeaturesSplash.updateSeenVersion()}).statics({FOR_VERSION:"1.5",shouldShow:function(){var a=TD.components.NewFeaturesSplash.FOR_VERSION,b=TD.settings.getPreviousSplashVersion();return TD.util.versionComparator(a,b)!==1?!1:TD.util.versionComparator(TD.version,a)===-1?!1:!0},updateSeenVersion:function(){TD.settings.setPreviousSplashVersion(TD.version)}}).methods({destroy:function(){this.supr(),$("#splash-modal").hide()}}),TD.components.OpenColumn=TD.components.BaseModal.extend(function(){var a=this;this.$footer.append($(TD.ui.template.render("open_column_footer"))),this.$backButton=this.$find(".js-back"),this.$addButton=this.$find(".js-add-column"),this.history=[],this.menu=null,this.$backButton.bind("click",function(){a._previous()})}).statics({GO_URL_REGEX:/^(add|profile)$/,GO_EVENT:"/go",instance:null}).methods({canGo:function(a,b){return TD.components.OpenColumn.GO_URL_REGEX.test(a)},go:function(a,b,c){TD.components.OpenColumn.instance=this,a==="profile"&&(this.history=[]),this.history.push([a,_.clone(b),c]);var d=b.shift();if(this.menu&&this.menu.canGo&&this.menu.canGo(a,b)){this.history.pop(),this.history[this.history.length-1]=fullUrl,this.menu.go(d,b,c);return}var e,f=!1,g=!1,h=!1;if(a==="add")switch(d){case"home":e=new TD.components.OpenColumnHome,f=!0;break;case"profile":break;case"search":e=new TD.components.OpenTwitterSearch;break;case"lists":e=new TD.components.OpenLists;break;case"trends":e=new TD.components.OpenTrends;break;case"facebook":e=new TD.components.OpenFacebook;break;default:TD.controller.columnManager.TWITTER_GENERIC[d]&&(e=new TD.components.OpenTwitterGeneric(d))}else if(a==="profile"){f=!0,g=!1,h=!0;switch(d){case"twitter":e=new TD.components.TwitterProfile,d="profile"}}this._show(d,e,f,g,h),e.go&&e.go(d,b,c)},_show:function(a,b,c,d,e){this.menu&&this.menu.destroy(),this.menu=b,this.$menuContainer.append(b.$node),c||this.menu.setup(this.$addButton),this.$node.toggleClass("s-nonav",c),this.$node.toggleClass("s-narrow",d),this.$node.toggleClass("s-profile",e),this.$backButton.toggle(this.history.length>1),a==="home"?this.$title.text(TD.i("Add Column")):a==="profile"?this.$title.text(TD.i("Account profile")):this.$title.text(TD.controller.columnManager.MENU_TITLE[a]||"")},_previous:function(){this.history.pop(),this.go.apply(this,this.history.pop())},destroy:function(){this.menu&&this.menu.destroy(),_.each(this.eventSubscriptions,function(a){$.unsubscribe(a)}),this.$backButton.unbind(),$("#open-modal").hide(),TD.components.OpenColumn.instance=null,this.supr()}}),TD.components.OpenColumnHome=TD.components.Base.extend(function(){var a=this,b={};_.each(TD.storage.accountController.getPostingAccounts(),function(a){b[a.getType()]=!0});var c=_.select(TD.controller.columnManager.DISPLAY_ORDER,function(a){return b[a.service]}),d=_.select(TD.controller.columnManager.DISPLAY_ORDER_SINGLETONS,function(a){return _.isEmpty(TD.controller.scheduler.getColumnsByType(a.type))});this.$node=$(TD.ui.template.render("open_column_home",{options:c,singletons:d,hasSingletons:d.length})),this.$launchers=this.$find(".js-item-launch"),this.$launchers.bind("click",function(b){var c=$(b.currentTarget),d=c.data("action"),e=c.data("type"),f;switch(d){case"add":f=TD.controller.columnManager.makeColumnFor(undefined,e,"tweetdeck"),TD.controller.columnManager.addColumnToUI(f),a.bubbleEvent(TD.components.BaseModal.CLOSE_EVENT);break;case"open":a.publishEvent(TD.components.OpenColumn.GO_EVENT,TD.components.OpenColumnHome.URL_BASE+"/"+e)}})}).statics({URL_BASE:"/add"}),TD.components.SplitMenu=TD.components.Base.extend(function(){this.$node=$(TD.ui.template.render("open_split_menu")),this.menuItems=[],this.rightPillarComponent=null,this.$leftPinnedContainer=this.$find(".js-left-pinned"),this.$leftPillarContainer=this.$find(".js-left-column"),this.$rightPillarContainer=this.$find(".js-right-column")}).methods({appendMenuItem:function(a){this.menuItems.push(a),this.$leftPillarContainer.append(a.$node)},removeMenuItem:function(a){a.destroy(),this.menuItems=_.without(this.menuItems,a)},appendPinnedMenuItem:function(a){this.menuItems.push(a),this.$leftPillarContainer.addClass("s-with-pinned"),this.$leftPinnedContainer.html(a.$node)},appendMenuItemElement:function(a){this.$leftPillarContainer.append(a)},setRightPillar:function(a){this.rightPillarComponent&&this.rightPillarComponent.destroy(),this.rightPillarComponent=a,this.$rightPillarContainer.html(a.$node)},destroy:function(){_.each(this.menuItems,function(a){a.destroy()}),this.rightPillarComponent&&this.rightPillarComponent.destroy(),this.supr()}}),TD.components.OpenSplitMenu=TD.components.SplitMenu.extend(function(){this.$addButton=null}).methods({setup:function(a){this.$addButton=a,this.$addButton.hide(),this.$addButton.click(_.bind(this._handleAddClick,this))},setChirpPillar:function(a){this.setRightPillar(a);var b=this;a instanceof TD.components.TemporaryColumn&&(a.populate(),_.defer(function(){b.$addButton.show(),b.$addButton.attr("disabled",!1)}))},_handleAddClick:function(a){this.$addButton.attr("disabled")||this.makeChirpColumnPermanent()},makeChirpColumnPermanent:function(){this.rightPillarComponent&&(this.rightPillarComponent.makePermanent(),this.$addButton.attr("disabled",!0))},destroy:function(){this.$addButton.unbind("click"),this.$addButton.hide(),this.supr()}}),TD.components.OpenTwitterGeneric=TD.components.OpenSplitMenu.extend(function(a){this.type=a,this.showUserSearch=!TD.controller.columnManager.SELF_ACCOUNTS_ONLY[a],this.userSearch=null,this.helpText=TD.controller.columnManager.HELP_TEXT[a],this.placeHolder=new TD.components.OpenColumnPlaceholder(this.helpText),this.setChirpPillar(this.placeHolder);if(this.showUserSearch){this.userSearch=new TD.components.TwitterUserSearch,this.appendPinnedMenuItem(this.userSearch);var b=this.userSearch.detachResultsContainer();this.appendMenuItemElement(b)}this.profileAccount=new TD.components.ProfileAccount,this.profileAccount.$node.hide(),this.appendMenuItem(this.profileAccount),this.selfAccounts=new TD.components.SelfAccounts("twitter"),this.appendMenuItem(this.selfAccounts),this.$node.bind(TD.components.MenuItemBase.BUBBLE_SELECT_EVENT,_.bind(this._handleSelect,this))}).methods({go:function(a,b,c){c.screenName&&(this.profileAccount.setUser(c.screenName),this.profileAccount.$node.show(),this.profileAccount.select())},_handleSelect:function(a,b){var c;if(b.target.account){var c=new TD.components.TemporaryColumn;c.genericTwitter(this.type,b.target.account,undefined)}else if(b.target.twitterUser){var c=new TD.components.TemporaryColumn,d=this.userSearch.client.oauth.account;c.genericTwitter(this.type,d,b.target.twitterUser)}c&&(this.setChirpPillar(c),a.stopPropagation())}}),TD.components.OpenTwitterSearch=TD.components.OpenSplitMenu.extend(function(){this.tweetSearch=new TD.components.TweetSearch,this.savedSearches=new TD.components.SavedSearches,this.appendPinnedMenuItem(this.tweetSearch),this.appendMenuItemElement(this.tweetSearch.detachRecentSearches()),this.appendMenuItem(this.savedSearches),this.helpText=TD.controller.columnManager.HELP_TEXT[TD.controller.columnManager.SEARCH],this.placeHolder=new TD.components.OpenColumnPlaceholder(this.helpText),this.setChirpPillar(this.placeHolder),this.$node.bind(TD.components.MenuItemBase.BUBBLE_SELECT_EVENT,_.bind(this._handleSearchSelect,this))}).methods({_handleSearchSelect:function(a,b){var c=b.target.title,d=new TD.components.TemporaryColumn;d.search(c),this.setChirpPillar(d),a.stopPropagation()},go:function(a,b,c){if(!c.query)return;this.tweetSearch.searchFor(decodeURIComponent(c.query))}}),TD.components.OpenLists=TD.components.OpenSplitMenu.extend(function(){this.screenName=null,this.listsComponent=null,this.newListButton=null,this.helpText=TD.controller.columnManager.HELP_TEXT[TD.controller.columnManager.LISTS],this.placeHolder=new TD.components.OpenColumnPlaceholder(this.helpText),this.removePlaceholder=new TD.components.OpenColumnPlaceholder(""),this.setChirpPillar(this.placeHolder),this.$node.bind(TD.components.MenuItemBase.BUBBLE_SELECT_EVENT,_.bind(this._handleListSelect,this)),this.$node.bind(TD.components.Lists.LOADED,_.bind(this._handleListsLoaded,this))}).methods({go:function(a,b,c){c.screenName?(this.screenName=c.screenName,this.listsComponent=new TD.components.Lists(this.screenName,c.slug),this.appendMenuItem(this.listsComponent)):(this.newListButton=new TD.components.NewListButton,this.appendPinnedMenuItem(this.newListButton),this.listsComponent=new TD.components.Lists,this.appendMenuItem(this.listsComponent))},_handleListsLoaded:function(a,b){if(b.target!==this.listsComponent)return;if(b.data===0){this.removeMenuItem(this.listsComponent);var c;this.screenName?c=TD.i("This user has no public lists"):c=TD.i("You are not subscribed to any lists"),this.listsComponent=new TD.components.OpenColumnPlaceholder(c),this.setChirpPillar(this.removePlaceholder),this.appendMenuItem(this.listsComponent)}},_handleListSelect:function(a,b){var c=b.target.list,d=new TD.components.TemporaryColumn;d.list(c),this.setChirpPillar(d),a.stopPropagation()}}),TD.components.OpenTrends=TD.components.OpenSplitMenu.extend(function(){this.trends=new TD.components.Trends,this.appendMenuItem(this.trends),this.helpText=TD.controller.columnManager.HELP_TEXT[TD.controller.columnManager.TRENDS],this.placeHolder=new TD.components.OpenColumnPlaceholder(this.helpText),this.setChirpPillar(this.placeHolder),this.$node.bind(TD.components.MenuItemBase.BUBBLE_SELECT_EVENT,_.bind(this._handleTrendSelect,this))}).methods({_handleTrendSelect:function(a,b){var c=b.target.title,d=new TD.components.TemporaryColumn;d.search(c),this.setChirpPillar(d),a.stopPropagation()}}),TD.components.OpenFacebook=TD.components.OpenSplitMenu.extend(function(){this.facebookMenu=new TD.components.FacebookMenu,this.appendMenuItem(this.facebookMenu),this.helpText=TD.controller.columnManager.HELP_TEXT[TD.controller.columnManager.FACEBOOK],this.placeHolder=new TD.components.OpenColumnPlaceholder(this.helpText),this.setChirpPillar(this.placeHolder),this.facebookMenu.newsFeedMenuItem.$node.bind(TD.components.MenuItemBase.BUBBLE_SELECT_EVENT,_.bind(this._newsfeed,this)),this.facebookMenu.notificationMenuItem.$node.bind(TD.components.MenuItemBase.BUBBLE_SELECT_EVENT,_.bind(this._notifications,this))}).methods({_newsfeed:function(a,b){var c=new TD.components.TemporaryColumn;c.facebookNewsFeed(),this.setChirpPillar(c),a.stopPropagation()},_notifications:function(a,b){var c=new TD.components.TemporaryColumn;c.facebookNotifications(),this.setChirpPillar(c),a.stopPropagation()}}),TD.components.OpenColumnPlaceholder=TD.components.Base.extend(function(a){this.helperText=a,this.$node=$(TD.ui.template.render("open_column_temp_help",{helpText:a}))}),TD.components.NewListButton=TD.components.Base.extend(function(){var a=this;this.$button=$.createElement("button").addClass("btn").text(TD.i("Create list")),this.$button.click(function(b){a.bubbleEvent(TD.components.BaseModal.CLOSE_EVENT);var c=new TD.components.ListDetails}),this.$node.append(this.$button),this.$node.addClass("sch-list")}),TD.components.ListDetails=TD.components.BaseModal.extend(function(a){this.theList=a,this.toAutoAdd=[];var b=TD.storage.accountController.getAccountsForService("twitter");this.$editForm=$(TD.ui.template.render("lists/edit_form",{accounts:b})),this.$menuContainer.append(this.$editForm),this.$footer.append($(TD.ui.template.render("lists/edit_footer"))),$("#lists-modal").empty().append(this.$node).show(),this.$account=$("#list-account"),this.$name=$("#list-name"),this.$description=$("#list-description"),this.$modePublic=this.$find('input:radio[value="public"]'),this.$modePrivate=this.$find('input:radio[value="private"]'),this.$saveButton=this.$find(".js-save"),this.$name.focus(),this.$saveButton.click(_.bind(this._handleSaveClick,this)),a?(this.$title.text(TD.i("Edit list")),this.$account.val(TD.storage.Account.generateKeyFor("twitter",a.user.id)),this.$account.attr("disabled",!0),this.$name.val(a.name),this.$description.val(a.description),a.isPrivate?this.$modePrivate.attr("checked",!0):this.$modePublic.attr("checked",!0)):this.$title.text(TD.i("Create list"))}).methods({autoAddMember:function(a){this.toAutoAdd.push(a)},_handleSaveClick:function(){this.$saveButton.attr("disabled",!0);var a=this.$account.val(),b=TD.controller.clients.getClient(a),c=this.$name.val(),d=this.$description.val(),e=Boolean(this.$modePrivate.attr("checked"));boundCallback=_.bind(this._handleSaveSuccess,this),boundErrback=_.bind(this._handleSaveFailure,this),this.theList?b.updateList(this.theList.id,c,d,e,boundCallback,boundErrback):b.createList(c,d,e,boundCallback,boundErrback)},_handleSaveSuccess:function(a){this.destroy();var b=new TD.components.ListMembers(a,this.toAutoAdd)},_handleSaveFailure:function(){this.$saveButton.attr("disabled",!1);var a=TD.i("Problem saving list. Please check the details and try again");TD.controller.progressIndicator.addMessage(a)},destroy:function(){this.supr(),$("#lists-modal").hide()}}),TD.components.ListMembers=TD.components.BaseModal.extend(function(a,b){var c=this;this.theList=a,this.membersIndex={},this.changed=!1,this.client=TD.controller.clients.getClient(a.account.getKey()),this.feedKey=TD.storage.Feed.generateKeyFor(this.theList.account.getKey(),"list",{listId:this.theList.id}),this.splitMenu=new TD.components.SplitMenu,this.userSearch=new TD.components.TwitterUserSearch(a.user.account,10,TD.components.ListMember),this.suggestedUsers=new TD.components.SuggestedUsers(a.user.account,10,TD.components.ListMember,a.name),this.loadingPane=new TD.components.OpenColumnPlaceholder(TD.i("Loading list members...")),this.memberList=new TD.components.ListMemberList,this.$title.text(TD.i("{{1}} by {{2}}",{1:a.name,2:a.user.screenName})),this.$menuContainer.append(this.splitMenu.$node),this.$footer.append($(TD.ui.template.render("lists/edit_members_footer"))),this.splitMenu.appendPinnedMenuItem(this.userSearch),this.splitMenu.appendMenuItemElement(this.userSearch.detachResultsContainer()),this.splitMenu.appendMenuItem(this.suggestedUsers),this.splitMenu.setRightPillar(this.loadingPane),$("#lists-modal").empty().append(this.$node).show(),this.userSearch.searchInput.$inputBox.focus(),this.$memberCount=this.memberList.$find(".js-member-count"),this.$editButton=this.$find(".js-edit"),this.$deleteButton=this.$find(".js-delete"),this.$doneButton=this.$find(".js-done"),this.$addColumnOption=this.$find(".js-add-column-option"),this.$addColumnCheckbox=this.$addColumnOption.find(".js-add-column-checkbox"),TD.storage.columnController.getColumnsContainingFeed(this.feedKey).length===0&&(this.$addColumnCheckbox.prop("checked",!0),this.$addColumnOption.show()),this.$editButton.click(_.bind(this._editDetails,this)),this.$deleteButton.click(_.bind(this._deleteList,this)),this.$doneButton.click(_.bind(this._handleDone,this)),this.$node.bind(TD.components.ListMember.ADD_REMOVE_EVENT,_.bind(this._addRemoveMember,this)),this.$node.bind(TD.components.TwitterUserSearch.SEARCH_COMPLETE,function(a,b){var d=b.target;c._checkResultsState(d),c.splitMenu.$leftPillarContainer.scrollTop(0)}),this._updateMemberCount();var d=this._addMembers(b);d.addBothWith(this,this._loadAllMembers),d.addCallback(function(){c.suggestedUsers.render(),c._checkResultsState(c.userSearch),c._checkResultsState(c.suggestedUsers)})}).methods({_addMembers:function(a){var b;if(_.isEmpty(a))b=TD.core.defer.succeed();else{b=new TD.core.defer.Deferred;var c=_.pluck(a,"screenName");this.client.addUsersToList(this.theList.id,c,_.bind(b.callback,b),_.bind(b.errback,b))}return b},_loadAllMembers:function(){var a=this,b,c=function(b){a._displayMembers(b.users,!1);if(b.next_cursor){var d=a._fetchMemberPage(b.next_cursor_str);return d.addCallback(c),d}};return b=this._fetchMemberPage(-1),b.addCallback(c),b},_fetchMemberPage:function(a){var b=new TD.core.defer.Deferred;return this.client.getListMembers(this.theList.id,a,_.bind(b.callback,b),_.bind(b.errback,b)),b},_displayMembers:function(a,b){var c=this;b&&a.reverse(),_.each(a,function(a){if(!c.membersIndex[a.id]){var d=new TD.components.ListMember(a);c.membersIndex[d.user.id]=d,b?c.memberList.prepend(d):c.memberList.append(d)}}),this.loadingPane&&(this.loadingPane.destroy(),this.loadingPane=null,this.splitMenu.setRightPillar(this.memberList))},_updateMemberCount:function(){this.$memberCount.text(this.theList.memberCount)},_editDetails:function(){this.destroy();var a=new TD.components.ListDetails(this.theList)},_deleteList:function(){var a=this,b={};b.title=TD.i("Deleting list!"),b.message=TD.i("Are you sure you want to delete this list?",{1:this.theList.fullName}),b.okLabel=TD.i("Delete"),b.cancelLabel=TD.i("Cancel"),b.okCallback=function(){a.client.destroyList(a.theList.id,function(){a.destroy()})},(new TD.components.ConfirmationDialog(b)).show()},_addRemoveMember:function(a,b){a.stopPropagation();var c=b.target;this.membersIndex[c.user.id]?this.removeMember(c.user):this.addMember(c.user)},addMember:function(a){var b=this;this._changeUserState(a.id,TD.components.ListMember.STATE_WORKING),this.client.addUserToList(this.theList.id,a.screenName,function(c){b._displayMembers([a],!0),b.theList.memberCount++,b._updateMemberCount(),b._changeUserState(a.id,TD.components.ListMember.STATE_MEMBER),b.changed=!0},function(c){b._changeUserState(a.id,TD.components.ListMember.STATE_NON_MEMBER);var d=TD.i("Problem adding {{userName}} to the list {{listName}}. Please try again",{userName:a.name,listName:b.theList.name});TD.controller.progressIndicator.addMessage(d)})},removeMember:function(a){var b=this;this._changeUserState(a.id,TD.components.ListMember.STATE_WORKING),this.client.removeUserFromList(this.theList.id,a.screenName,function(c){var d=b.membersIndex[a.id];d.destroy(),delete b.membersIndex[a.id],b.theList.memberCount--,b._updateMemberCount(),b._changeUserState(a.id,TD.components.ListMember.STATE_NON_MEMBER),b.changed=!0},function(c){b._changeUserState(a.id,TD.components.ListMember.STATE_MEMBER);var d=TD.i("Problem removing {{userName}} from the list {{listName}}. Please try again",{userName:a.name,listName:b.theList.name});TD.controller.progressIndicator.addMessage(d)})},_changeUserState:function(a,b){this.membersIndex[a]&&this.membersIndex[a].setState(b),b===TD.components.ListMember.STATE_MEMBER&&(b=TD.components.ListMember.STATE_MEMBER_CHECKED);var c=this.userSearch.items.concat(this.suggestedUsers.items);_.each(c,function(c){c.user.id==a&&c.setState(b)})},_checkResultsState:function(a){var b=this,c=a===this.suggestedUsers;_.each(a.items,function(a){b.membersIndex[a.user.id]?(a.setState(TD.components.ListMember.STATE_MEMBER_CHECKED),c&&a.hide()):(a.setState(TD.components.ListMember.STATE_NON_MEMBER),c&&a.show())})},_handleDone:function(){this.destroy();if(this.$addColumnCheckbox.prop("checked")){var a=new TD.components.TemporaryColumn;a.list(this.theList),a.makePermanent()}},destroy:function(){if(this.changed){TD.cache.lists.add(this.theList);var a=TD.controller.feedManager.getPoller(this.feedKey);a&&(a.removeAll(),a.refresh())}$("#lists-modal").hide(),this.splitMenu.destroy(),this.userSearch.destroy(),this.suggestedUsers.destroy(),this.memberList.destroy(),this.loadingPane&&this.loadingPane.destroy(),_.each(this.membersIndex,function(a,b){a.destroy()}),this.supr()}}),TD.components.ListMember=TD.components.Base.extend(function(a){this.user=a,this.state=null;var b={isTwitter:!0,fullname:a.name||a.screenName,username:a.screenName,profileImageURL:a.profileImageURL,description:a.description,isProtected:a.isProtected};this.$node=$(TD.ui.template.render("lists/member",b)),this.$addRemoveButton=this.$find(".js-add-remove"),this.$addRemoveButton.click(_.bind(this._handleAddRemoveClick,this)),this.setMember()}).statics({ADD_REMOVE_EVENT:"td-add-remove",STATE_MEMBER:"member",STATE_MEMBER_CHECKED:"member-checked",STATE_NON_MEMBER:"non-member",STATE_WORKING:"working"}).methods({_handleAddRemoveClick:function(){this.bubbleEvent(TD.components.ListMember.ADD_REMOVE_EVENT)},setState:function(a){switch(a){case TD.components.ListMember.STATE_MEMBER:this.setMember();break;case TD.components.ListMember.STATE_MEMBER_CHECKED:this.setMemberChecked();break;case TD.components.ListMember.STATE_NON_MEMBER:this.setNonMember();break;case TD.components.ListMember.STATE_WORKING:this.setWorking()}},setMember:function(){this.state=TD.components.ListMember.STATE_MEMBER,this.$addRemoveButton.removeClass("s-nonmember s-working s-checked").addClass("s-member"),this.$addRemoveButton.attr("disabled",!1)},setMemberChecked:function(){this.state=TD.components.ListMember.STATE_MEMBER_CHECKED,this.$addRemoveButton.removeClass("s-nonmember s-member s-working").addClass("s-checked"),this.$addRemoveButton.attr("disabled",!1)},setNonMember:function(){this.state=TD.components.ListMember.STATE_NON_MEMBER,this.$addRemoveButton.removeClass("s-member s-checked s-working").addClass("s-nonmember"),this.$addRemoveButton.attr("disabled",!1)},setWorking:function(){this.state=TD.components.ListMember.STATE_WORKING,this.$addRemoveButton.removeClass("s-member s-nonmember s-checked").addClass("s-working"),this.$addRemoveButton.attr("disabled",!0)}}),TD.components.ListMemberList=TD.components.Base.extend(function(){this.$node=$(TD.ui.template.render("lists/member_list")),this.$list=this.$find(".js-member-list")}).methods({append:function(a){this.$list.append(a.$node)},prepend:function(a){this.$list.prepend(a.$node)}}),TD.components.TwitterProfile=TD.components.Base.extend(function(a){this.username=null,this.twitterUser=null}).methods({_handleItemClick:function(a){var b=TD.util.maybeOpenClickExternally(a),c;if(!b){c=$(a.target),c.attr("href")||(c=c.closest("a"));if(c.data("action")==="open")return this.menu._handleItemClick(a),!1}return!0},go:function(a,b,c){var d=this;this.username=b[0],this.twitterUser=null;if(this.twitterUser)this.render();else{var e=TD.storage.accountController.getPreferredAccount("twitter"),f=TD.controller.clients.getClient(e.getKey()),g=TD.cache.twitterUsers.getByScreenName(this.username);g.addCallbacks(this.renderUser,this._handleError,null,null,this,this)}},renderUser:function(a){this.twitterUser=a,this.$node.append($(TD.ui.template.render("profile_card",this.twitterUser))),this.$node.find(".js-action-url").click(_.bind(this._handleItemClick,this)),this.menu&&this.menu.destroy(),this.menu=new TD.components.TwitterProfileMenu(this.username),this.$menuHolder=this.$find(".js-profile-columns"),this.$menuHolder.append(this.menu.$node),this.$followFromHolder=this.$find(".js-follow-from"),this.$followFromHolder.addClass("prf-follow-state");var b=TD.storage.accountController.getPreferredAccount("twitter");this.followFrom=new TD.components.FollowFrom(a,b,!0),this.followFrom.hideFromAccountName(),this.$followFromHolder.prepend(this.followFrom.$node)},_handleError:function(a){var b;a&&a.message&&a.message.status&&a.message.status===404?b=TD.i("Sorry, we could not display @{{1}} because that user does not exist",{1:this.username}):b=TD.i("Sorry, we couldn't retrieve user @{{1}} because something went wrong. Please try again shortly",{1:this.username});var c=TD.controller.progressIndicator.addMessage(b);this.bubbleEvent(TD.components.BaseModal.CLOSE_EVENT)},destroy:function(){this.menu&&this.menu.destroy(),this.supr()}}),TD.components.TwitterProfileMenu=TD.components.Base.extend(function(a){var b=TD.controller.columnManager.DISPLAY_ORDER_PROFILE;this.screenName=a,this.$node=$(TD.ui.template.render("open_column_profile",{options:b})),this.$launchers=this.$find(".js-item-launch"),this.$launchers.click(_.bind(this._handleItemClick,this))}).statics({URL_BASE:"/add"}).methods({_handleItemClick:function(a){var b=$(a.currentTarget),c=b.data("action"),d=b.data("type"),e=TD.components.OpenColumnHome.URL_BASE+"/"+d;if(c!=="open")return;this.screenName&&(e+="?screenName="+this.screenName),this.publishEvent(TD.components.OpenColumn.GO_EVENT,e)}}),TD.components.TweetSearch=TD.components.Base.extend(function(){var a=this;this.searchInput=new TD.components.SearchInput,this.recentSearches=new TD.components.RecentSearches,this.$node.append(this.searchInput.$node),this.$node.append(this.recentSearches.$node),this.$node.bind("td-search",_.bind(this._handleSearch,this))}).methods({_handleSearch:function(a,b){this.recentSearches.addQuery(b.data,!0),a.stopPropagation()},searchFor:function(a){this.searchInput.searchFor(a)},detachRecentSearches:function(){return this.recentSearches.$node.detach()},destroy:function(){this.searchInput.destroy(),this.recentSearches.destroy(),this.$node.remove()}}),TD.components.Lists=TD.components.Base.extend(function(a,b){var c=this,d={},e=TD.storage.clientController.client.getDefaultAccount(),f;this.owners=d,this.screenName=a,a?f=TD.i("@{{screenName}}'s lists",this):f=TD.i("My lists"),this.$node=$(TD.ui.template.render("open_column_list_multi_group",{groups:[{title:f,className:"js-my-lists"},{title:TD.i("Subscribed to"),className:"js-others-lists"}]})),this.$myLists=this.$find("ul.js-my-lists"),this.$otherLists=this.$find("ul.js-others-lists"),this.lists=[],this.listComponents=[],this.slug=b,this.listComparator=function(a,b){var c=TD.components.Lists,f,g;return d[a.user.id]&&!d[b.user.id]?-1:!d[a.user.id]&&d[b.user.id]?1:d[a.user.id]&&d[b.user.id]?(f=a.account.getKey()===e,g=b.account.getKey()===e,f===g?c.ownerNameComparator(a,b)||c.nameComparator(a,b):f?-1:1):c.nameComparator(a,b)||c.ownerNameComparator(a,b)};if(a){var g=TD.cache.twitterUsers.getByScreenName(a);g.addCallback(function(b){d[b.id]=!0;var e=TD.controller.clients.getClientsByService("twitter"),f=_.find(e,function(b){if(b.oauth.account.getUsername().toLowerCase()===a.toLowerCase())return b});f?(c._handleLists(TD.cache.lists.getListsFor(f.oauth.account.getKey())),c.bubbleEvent(TD.components.Lists.LOADED,c.lists.length)):(f=TD.controller.clients.getPreferredClient("twitter"),f.getLists(a,function(a){c._handleLists(a),c.bubbleEvent(TD.components.Lists.LOADED,c.lists.length)}))})}else{var h=TD.controller.clients.getClientsByService("twitter");_.each(h,function(a){d[a.oauth.account.getUserID()]=!0}),_.each(h,function(a){c._handleLists(TD.cache.lists.getListsFor(a.oauth.account.getKey()))}),this.bubbleEvent(TD.components.Lists.LOADED,c.lists.length)}}).statics({LOADED:"td-lists-loaded",nameComparator:function(a,b){var c=a.name.toLowerCase(),d=b.name.toLowerCase();return(c>d)-(c<d)},ownerNameComparator:function(a,b){var c=a.user.name.toLowerCase(),d=b.user.name.toLowerCase();return(c>d)-(c<d)}}).methods({_handleLists:function(a){var b=this;if(!_.isArray(a)||a.length===0)return;this.lists=this.lists.concat(a),this.lists.sort(this.listComparator);var c={};this.lists=_.select(this.lists,function(a){var b=!c[a.id];return c[a.id]=!0,b}),_.each(this.listComponents,function(a){a.destroy()});var d;this.listComponents=_.map(this.lists,function(a){var c=(new TD.components.MenuItem).list(a);return b.owners[a.user.id]?(b.$myLists.append(c.$node),b.slug&&a.slug.toLowerCase()===b.slug.toLowerCase()&&a.user.screenName.toLowerCase()===b.screenName.toLowerCase()&&(d=c)):b.$otherLists.append(c.$node),c}),!d&&this.screenName&&this.listComponents.length>0&&(d=this.listComponents[0]),d&&_.defer(function(){d.select()})}}),TD.components.SearchInput=TD.components.Base.extend(function(a){var b=this;_.isString(a)?this.promptText=a:this.promptText=TD.i("Enter a #hashtag or keyword"),this.$node=$(TD.ui.template.render("search_input",{promptText:this.promptText})),this.$form=this.$find("form"),this.$inputBox=this.$find(".js-search-input"),this.$spinner=this.$find(".js-spinner"),this.$clearButton=this.$find(".js-clear-search"),this.$form.submit(function(a){b._search(),a.preventDefault()}),this.$clearButton.click(function(a){b._clear(),a.preventDefault()})}).methods({_cancelSearch:function(){this.$inputBox.val("").blur()},_search:function(){this.bubbleEvent("td-search",this.$inputBox.val())},_clear:function(){this.$inputBox.val(""),this.$inputBox.focus(),this.bubbleEvent("td-search-clear")},searchFor:function(a){var b=this;this.$inputBox.val(a),this._search(),_.defer(function(){b.$inputBox.focus()})},showActivity:function(){this.$clearButton.hide(),this.$spinner.show()},hideActivity:function(){this.$clearButton.show(),this.$spinner.hide()},destroy:function(){this.$inputBox.unbind(),this.$node.remove()}}),TD.components.RecentSearches=TD.components.Base.extend(function(){this.titleText=TD.i("Recent"),this.$node=$(TD.ui.template.render("open_column_list_with_header",{title:this.titleText})),this.$list=this.$find(".js-list-container"),this.searches=[],this.searchComponents=[],this._load()}).methods({_load:function(){var a=this;_.each(this.searchComponents,function(a){a.destroy()}),this.searchComponents=[],this.searches=TD.storage.clientController.client.getRecentSearches(),_.each(this.searches,function(b){var c=(new TD.components.MenuItem).basic(b);a.$list.append(c.$node),a.searchComponents.push(c)})},addQuery:function(a,b){if(!a)return;TD.storage.clientController.client.addRecentSearch(a),this._load();if(b){var c=this.searches.indexOf(a);c!==-1&&this.searchComponents[0].select()}},removeQuery:function(a){a=a.toLowerCase();var b=_.detect(this.searchComponents,function(b){return b.title.toLowerCase()===a});b&&(b.destroy(),this.searchComponents=_.without(this.searchComponents,b))},destroy:function(){_.each(this.searchComponents,function(a){a.destroy()}),this.$node.remove()}}),TD.components.SavedSearches=TD.components.Base.extend(function(){var a=this;this.titleText=TD.i("Saved"),this.$node=$(TD.ui.template.render("open_column_list_with_header",{title:this.titleText})),this.$list=this.$find(".js-list-container"),this.searches=[],this.searchesIndex={},this.searchComponents=[];var b=TD.controller.clients.getClientsByService("twitter");_.each(b,function(b){a._handleTwitterSavedSearches(b.searches)})}).statics({searchComparator:function(a,b){var c=a.toLowerCase(),d=b.toLowerCase();return(c>d)-(c<d)}}).methods({addSearches:function(a){var b=this;_.each(a,function(a){var c=a.toLowerCase();b.searchesIndex[c]||(b.searchesIndex[c]=!0,b.searches.push(a))}),this.searches.sort(TD.components.SavedSearches.searchComparator),_.each(this.searchComponents,function(a){a.destroy()}),this.searchComponents=_.map(this.searches,function(a){var c=(new TD.components.MenuItem).basic(a);return b.$list.append(c.$node),c})},_handleTwitterSavedSearches:function(a){this.addSearches(_.pluck(a,"name"))},destroy:function(){_.each(this.searchComponents,function(a){a.destroy()}),this.$node.remove()}}),TD.components.MenuItemBase=TD.components.Base.extend(function(){this.eventSubscriptions=[],this.selected=!1,this.eventSubscriptions.push($.subscribe(TD.components.MenuItemBase.GLOBAL_SELECT_EVENT,_.bind(this._handleSelectionEvent,this))),_.defer(_.bind(this._addClickHandler,this))}).statics({GLOBAL_SELECT_EVENT:"/menuitem/select",BUBBLE_SELECT_EVENT:"td-menuitem-select",deselectAll:function(){var a={target:null};TD.storage.notification.notify(this.GLOBAL_SELECT_EVENT,a)}}).methods({_handleSelectionEvent:function(a){this.selected=a.target===this,this.$node.toggleClass("selected",this.selected)},_addClickHandler:function(){var a=this;this.$node.bind("click",function(b){a.selected||a.select()})},select:function(){this.publishEvent(TD.components.MenuItemBase.GLOBAL_SELECT_EVENT,null),this.bubbleEvent(TD.components.MenuItemBase.BUBBLE_SELECT_EVENT)},deselect:function(){this.selected=!1,this.$node.removeClass("selected")},destroy:function(){_.each(this.eventSubscriptions,function(a){$.unsubscribe(a)}),this.$node.remove()}}),TD.components.MenuItem=TD.components.MenuItemBase.extend(function(){this.type=null}).statics({BASIC:"basic",SUBTITLE:"subtitle",PERSON:"person",LIST:"list"}).methods({basic:function(a){return this.type=TD.components.MenuItem.BASIC,this.title=a,this.$node=$(TD.ui.template.render("list_module_list_item",{title:this.title})),this},subtitle:function(a,b){this.type=TD.components.MenuItem.SUBTITLE,this.title=a,this.subtitle=b;var c={title:a,subtitle:b};return this.$node=$(TD.ui.template.render("list_module_subtitle_item",c)),this},selfAccount:function(a){this.type=TD.components.MenuItem.PERSON,this.account=a;var b=a.getType(),c={isTwitter:b==="twitter",fullname:a.getName()||a.getUsername(),username:a.getUsername(),profileImageURL:a.getProfileImageURL()};return b==="facebook"?c.fullname="Facebook":b==="foursquare"&&(c.fullname="Foursquare"),this.$node=$(TD.ui.template.render("list_module_account_item",c)),this},twitterUser:function(a){this.type=TD.components.MenuItem.PERSON,this.twitterUser=a;var b={isTwitter:!0,fullname:a.name||a.screenName,username:a.screenName,profileImageURL:a.profileImageURL};return this.$node=$(TD.ui.template.render("list_module_account_item",b)),this},list:function(a){this.type=TD.components.MenuItem.LIST,this.list=a;var b={title:TD.i("{{1}}",{1:a.name}),by:TD.i("by {{1}}",{1:a.user.name}),description:a.description,subtitle:TD.i("{{1}} members",{1:a.memberCount}),miniProfileURL:a.user.miniProfileImageURL(),isPrivate:a.isPrivate};return this.$node=$(TD.ui.template.render("list_module_twitter_list_item",b)),this}}),TD.components.SelfAccounts=TD.components.Base.extend(function(a){var b=TD.storage.accountController.getPostingAccounts();this.titleText=TD.i("Your Accounts"),this.service=a,this.items=[],this.$node=$(TD.ui.template.render("open_column_list_with_header",{title:this.titleText})),this.$list=this.$find(".js-list-container");for(var c=0;c<b.length;c++){var d=b[c],e=d.getType();if(this.service&&e!==this.service)continue;var f=(new TD.components.MenuItem).selfAccount(b[c]);this.items.push(f),this.$list.append(f.$node)}}).methods({destroy:function(){_.each(this.items,function(a){a.destroy()}),this.$node.remove()}}),TD.components.ProfileAccount=TD.components.Base.extend(function(){this.titleText=TD.i("Profile Account"),this.screenName=null,this.twitterUser=null,this.$node=$(TD.ui.template.render("open_column_list_with_header",{title:this.titleText})),this.$list=this.$find(".js-list-container"),this.menuItem=null}).methods({setUser:function(a){this.screenName=a;var b=TD.cache.twitterUsers.getByScreenName(this.screenName);b.addCallbackWith(this,this._renderUser)},_renderUser:function(a){this.twitterUser=a,this.menuItem=(new TD.components.MenuItem).twitterUser(a),this.$list.append(this.menuItem.$node)},select:function(){this.menuItem.select()},destroy:function(){this.menuItem&&this.menuItem.destroy(),this.$node.remove()}}),TD.components.Trends=TD.components.Base.extend(function(){var a=this;this.woeid=1,this.locationName=TD.i("Worldwide"),this.$node=$(TD.ui.template.render("list_module_trends",{locationName:this.locationName})),this.$trendList=this.$find(".js-trend-list"),this.trendComponents=[],this.trendLocations=null,this.$changeLocation=this.$find("#change-trends"),this.$changeLocation.bind("click",function(b){a._showTrendLocations()}),this.account=TD.storage.accountController.getPreferredAccount("twitter"),this.client=TD.controller.clients.getClient(this.account.getKey()),a._showTrendsForLocation(this.woeid)}).statics({CLICK_URL_BASE:"/open/search/tweets/"}).methods({_showTrendLocations:function(){var a=this;$.isEmptyObject(a.trendLocations)?this.account&&this.client.getTrendLocations(_.bind(this._displayLocations,this)):this._displayLocations(a.trendLocations.locations)},_showTrendsForLocation:function(a){this.client.getTrends(a,_.bind(this._displayTrends,this))},_displayTrends:function(a){var a=a.trends,b=a.locations,c="",d;for(var e=0;e<a.length;e++){if(a[e].promotedContent)continue;d=(new TD.components.MenuItem).basic(a[e].name),this.trendComponents.push(d),this.$trendList.append(d.$node)}},_displayLocations:function(a){},destroy:function(){_.each(this.trendComponents,function(a){a.destroy()}),this.$trendList.unbind(),this.$changeLocation.unbind(),this.$node.remove()}}),TD.components.TwitterUserSearch=TD.components.Base.extend(function(a,b,c){a||(a=TD.storage.accountController.getPreferredAccount("twitter"));if(!a)return;this.listItemComponent=c,this.client=TD.controller.clients.getClient(a.getKey()),this.maxResults=b||TD.components.TwitterUserSearch.MAX_RESULTS,this.searchInput=new TD.components.SearchInput(TD.i("Enter a @name or full name")),this.items=[],this.resultsTitle=TD.i("Search results"),this.$searchResults=$(TD.ui.template.render("open_column_list_with_header",{title:this.resultsTitle})),this.$searchResults.hide(),this.$node=$(this.searchInput.$node),this.$node.append(this.$searchResults),this.$node.bind("td-search",_.bind(this._handleSearchSubmit,this)),this.$node.bind("td-search-clear",_.bind(this._handleSearchClear,this)),this.$searchResultsList=this.$find(".js-list-container")}).statics({SEARCH_COMPLETE:"td-search-complete",MAX_RESULTS:4}).methods({_handleSearchSubmit:function(a,b){this.searchInput.showActivity();var c=b.data;this._search(c),a.stopPropagation()},_search:function(a){a&&this.client.userSearch(a,_.bind(this._handleUsers,this))},_handleSearchClear:function(a){_.each(this.items,function(a){a.destroy()}),this.$searchResults.hide()},_handleUsers:function(a){this.searchInput.hideActivity();var b,c,d;a=_.first(a,this.maxResults),this.items=[],this.$searchResultsList.empty();for(b=0,c=a.length;b<c;b++)this.listItemComponent?d=new this.listItemComponent(a[b]):d=(new TD.components.MenuItem).twitterUser(a[b]),this.items.push(d),this.$searchResultsList.append(d.$node);this.$searchResults.show(),this.bubbleEvent(TD.components.TwitterUserSearch.SEARCH_COMPLETE)},detachResultsContainer:function(){return this.$searchResults.detach()},destroy:function(){_.each(this.items,function(a){a.destroy()}),this.supr()}}),TD.components.SuggestedUsers=TD.components.TwitterUserSearch.extend(function(a,b,c,d){this.searchTerm=d,this._ready=!1,this._userData=null,this.resultsTitle=TD.i("Suggested"),$(".js-title",this.$searchResults).text(this.resultsTitle),this.$node=this.$searchResults,this.searchInput.$node.detach(),this._search(d)}).methods({_handleUsers:function(a){this._ready?a&&a.length>0&&(this.supr(a),this._userData=null):this._userData=a},render:function(){this._ready||(this._ready=!0,this._handleUsers(this._userData))}}),TD.components.FacebookMenu=TD.components.Base.extend(function(){this.newsFeedMenuItem=(new TD.components.MenuItem).basic(TD.i("News Feed")),this.notificationMenuItem=(new TD.components.MenuItem).basic(TD.i("Notifications"));var a=$.createElement("ul");a.append(this.newsFeedMenuItem.$node),a.append(this.notificationMenuItem.$node),this.$node.addClass("lst-group"),this.$node.append(a)}),TD.components.TemporaryColumn=TD.components.Base.extend(function(){this.name=undefined,this.type=undefined,this.service=undefined,this.accountKey=undefined,this.metaString=undefined,this.column=null,this.$actionButton=null,this.$columnHeader=null}).methods({_init:function(a,b,c,d,e){this.name=a,this.type=b,this.service=c,this.accountKey=d,this.metaString=e,this.column=TD.controller.columnManager.makeColumnFor(a,b,c,d,e),this.column.visible=!0,this.column.temporary=!0,TD.controller.columnManager.add(this.column);var f=this.column.model,g={columnkey:f.getKey(),columntitle:f.getTitle(),columnclass:this.column.getColumnClass(),isTemporary:!0};this.$node=$(TD.ui.template.render("column_temp",g)),this.$actionButton=this.$find(".js-action-header-button"),this.$columnHeader=this.$find(".js-action-header")},populate:function(){TD.controller.scheduler.addColumn(this.column,!1)},makePermanent:function(){var a=TD.controller.columnManager.makeColumnFor(this.name,this.type,this.service,this.accountKey,this.metaString);a.setFeeds(this.column.getFeeds()),TD.controller.columnManager.addColumnToUI(a)},home:function(){this._init(undefined,"home","tweetdeck")},me:function(){this._init(undefined,"me","tweetdeck")},inbox:function(){this._init(undefined,"privateMe","tweetdeck")},scheduled:function(){this._init(undefined,"scheduled","tweetdeck")},genericTwitter:function(a,b,c){var d,e,f,g="twitter",h=b.getKey(),i=c?c.id:undefined;c?(d=c.screenName||c.name,f=TD.controller.columnManager.NON_SELF_FEED_TYPE[a]||a,a===TD.controller.columnManager.MENTIONS&&(i="@"+c.screenName)):(d=b.getUsername()||b.getName(),f=TD.controller.columnManager.SELF_FEED_TYPE[a]||a);switch(a){case TD.controller.columnManager.TIMELINE:e=TD.i("Timeline: {{1}}",{1:d});break;case TD.controller.columnManager.MENTIONS:e=TD.i("Mentions: {{1}}",{1:d});break;case TD.controller.columnManager.MESSAGES:e=TD.i("Messages: {{1}}",{1:d});break;case TD.controller.columnManager.TWEETS:e=TD.i("Tweets: {{1}}",{1:d});break;case TD.controller.columnManager.FAVORITES:e=TD.i("Favorites: {{1}}",{1:d});break;case TD.controller.columnManager.NETWORKACTIVITY:e=TD.i("Activity: {{1}}",{1:d});break;case TD.controller.columnManager.INTERACTIONS:e=TD.i("Interactions: {{1}}",{1:d})}this._init(e,f,g,h,i)},search:function(a,b){if(!b){var c=TD.storage.accountController.getPreferredAccount("twitter");b=c.getKey()}var d=TD.i("Search: {{1}}",{1:a});this._init(d,"search","twitter",b,a)},list:function(a){var b=this,c=TD.i("{{1}} by {{2}}",{1:a.name,2:a.user.screenName}),d=a.user.account.getKey(),e=a.user.id+"/"+a.id;this._init(c,"list","twitter",d,e),a.isOwnList()&&(this.$columnHeader.addClass("s-listedit"),this.$actionButton.text(TD.i("Edit")),this.$actionButton.removeClass("hide"),this.$actionButton.click(function(c){b.bubbleEvent(TD.components.BaseModal.CLOSE_EVENT);var d=new TD.components.ListMembers(a)}))},facebookNewsFeed:function(){var a=TD.storage.accountController.getPreferredAccount("facebook").getKey();this._init(TD.i("News Feed"),"home","facebook",a)},facebookNotifications:function(){var a=TD.storage.accountController.getPreferredAccount("facebook").getKey();this._init(TD.i("Notifications"),"notifications","facebook",a)},destroy:function(){this.column&&this.column.temporary&&TD.controller.columnManager.removeFromAppLayer(this.column.model.getKey()),this.$node.remove()}}),TD.components.ScheduledDatePicker=TD.components.Base.extend(function(a){var b=this;this.$node=$(TD.ui.template.render("compose/schedule")),a.append(this.$node),this.$minutes=$("#scheduled-minute"),this.$hours=$("#scheduled-hour"),this.$datepicker=$("#datepicker"),this.$nextMonth=$("#next-month"),this.$prevMonth=$("#prev-month"),this.$removeDate=$(".js-remove",this.$node),this.$amToggle=$("#amPm"),this.$hours.bind("change",function(){b._refreshDate(),b.publishDateChanged()}),this.$minutes.bind("change",function(){b._refreshDate(),b.publishDateChanged()}),this.$datepicker=this.$datepicker.dateinput({onHide:function(){return!1},change:function(){b._refreshDate(),b.publishDateChanged()},min:-1}),b.datePickerData=this.$datepicker.data("dateinput").show(),this.$nextMonth.bind("click",function(a){b.datePickerData.addMonth(1)}),this.$prevMonth.bind("click",function(a){b.datePickerData.addMonth(-1)}),this.$removeDate.bind("click",function(a){b.publishRemoval()}),this.$amToggle.bind("click",function(a){var c=$(this),d=c.data("value");b._setAmPm(!d)}),b.setDate(new Date)}).methods({_refreshDate:function(){var a=this.datePickerData.getValue(),b=this.$amToggle.data("value"),c=Number(this.$hours.val())%12;b?a.setHours(c+12):a.setHours(c),a.setMinutes(Number(this.$minutes.val())),this.date=a},_setAmPm:function(a){a?(this.$amToggle.text(TD.i("PM")),this.$amToggle.data("value",!0)):(this.$amToggle.text(TD.i("AM")),this.$amToggle.data("value",!1)),this._refreshDate(),this.publishDateChanged()},setDate:function(a){if(a){var b=a.getHours()%12||12,c=a.getHours()>11,d=c?TD.i("PM"):TD.i("AM"),e=a.getMinutes();this._setAmPm(c),this.datePickerData.setValue(a.getFullYear(),a.getMonth(),a.getDate()),this.$hours.val(b),this.$minutes.val(e)}this.date=a,this.publishDateChanged()},getDate:function(){return this.date},publishDateChanged:function(a){$.publish("/change/date",[a!==undefined?a:this.getDate()])},publishRemoval:function(){this.date=null,this.publishDateChanged(null),$.publish("/removed/date")}}),TD.components.LocationPicker=TD.components.Base.extend(function(a){var b=this,c;this.$node=$(TD.ui.template.render("compose/locations")),a.append(this.$node),this.$locationButton=a.find("button"),this.$locationList=this.$find(".js-location-list"),this.$locationSearchHolder=this.$find(".js-location-search"),this.$locationSearchBox=this.$find("#location-search").keyup(function(a){switch(a.keyCode){case TD.constants.keyCodes.enter:b.getPlaces(b.position,b.$locationSearchBox.val());break;case TD.constants.keyCodes.escape:b.hide()}}),this.$node.on("click",".js-location-item",function(a){b.setLocation(a.currentTarget)}),this.$removeLocation=this.$find(".js-location-remove").click(function(a){b.removeLocation()}),c=TD.controller.clients.getClientsByService("twitter");if(!c.length){this.removeLocation();return}this.client=c[0],TD.util.getCurrentLocation(6e3,_.bind(this.getPlaces,this))}).statics({SELECT:"td-select",canHazGeolocation:function(){return!1}}).methods({getPlaces:function(a,b){var c=a?a.coords:{};this.position=a,b=b||"",this.client.geoSearch(b,c.latitude,c.longitude,c.accuracy,null,_.bind(this.showTwitterPlaces,this),_.bind(this.removeLocation,this))},showTwitterPlaces:function(a){if(a&&a.length>0){this.places=a;var b=$(TD.ui.template.render("compose/location_list_item",this));this.$locationList.find(".js-location-item").remove(),b.insertAfter(this.$locationSearchHolder)}},setTwitterPlace:function(a,b){this.twitterPlaceID=a,this.twitterPlaceName=b},setLocation:function(a,b){var c=$(a).data("place-id"),d,e;for(d=0;d<this.places.length;d++){e=this.places[d];if(e.id==c){this.setTwitterPlace(e.id,e.full_name),this.$locationButton.addClass("set-content"),$("b",this.$locationButton).text(e.name),this.$node.trigger(TD.components.LocationPicker.SELECT),this.hide();break}}},hide:function(){this.$locationButton.removeClass("s-active"),this.$node.hide()},removeLocation:function(){this.setTwitterPlace(null,null),this.$locationButton.removeClass("set-content"),this.$node.trigger(TD.components.LocationPicker.SELECT),this.hide(),TD.storage.store.set(":CACHED_PLACES",null)}}),TD.components.DetailView=TD.components.Base.extend(function(a,b){TD.ui.columns.setTitleDisplay(a.model.getKey(),a.model.getTitle(),!0),this.initialised=!1,this.column=a,this.$column=b,this.$updatesContainer=$(".column-updates",b),this.$detailContainer=$(".column-detail",b),this.$holder=$(".holder",b),this.$header=$(".column-header",b),this.$detailContainer.addClass("active"),this.$column.addClass("detail"),b.on("click","header.column-header",_.bind(this._handleHeaderClick,this)),this._render(),this.$detailContainer.html(this.$node)}).statics({RETWEETER_COUNT:8}).methods({_render:function(){throw"DetailView._render not implemented"},_handleHeaderClick:function(a){a.stopPropagation(),this.destroy()},changed:function(a){},deleted:function(a){a.id===this.chirp.id&&this.destroy()},destroy:function(){var a=this;TD.ui.columns.setTitleDisplay(this.column.model.getKey(),this.column.model.getTitle(),!1),this.$column.off("click","header.column-header"),this.$column.removeClass("detail"),this.column.detailViewComponent=null;var b=function(a){this.$holder.unbind(TD.ui.main.TRANSITION_END_EVENTS),this._teardown(),this.$node.remove()};this.$holder.bind(TD.ui.main.TRANSITION_END_EVENTS,_.bind(b,this))}}),TD.components.TweetDetailView=TD.components.DetailView.extend(function(a,b){}).methods({_render:function(){this.$node=$(TD.ui.template.render("status/tweet_detail_wrapper"))},showId:function(a,b){var c=this.column.findChirp(a);if(c)this.showChirp(c);else{var d=TD.controller.clients.getClient(b);d.show(a,_.bind(this.showChirp,this),_.bind(this._chirpRetrievalError,this))}},_chirpRetrievalError:function(){var a="Sorry, it was not possible to retrieve this tweet";TD.controller.progressIndicator.addMessage(a),this.destroy()},showChirp:function(a){this.chirp=a,this.$find(".js-chirp").html($(TD.ui.template.render("status/tweet_detail",this.chirp.getMainTweet())));var b=this.$find(".spn-loading"),c=this.$header;this.replies=new TD.components.InReplyTo(this.chirp,this.$detailContainer),this.media=new TD.components.DetailMediaView(this.chirp),this.retweeters=new TD.components.Retweeters(this.chirp,TD.components.DetailView.RETWEETER_COUNT),this.repliesTo=new TD.components.RepliesTo(this.chirp),this.$find(".js-inreplyto").replaceWith(this.replies.$node),this.$find("footer .media").append(this.media.$node);var d=this.$find(".js-retweeters-reply");d.append(this.retweeters.$node),d.append(this.repliesTo.$node),this.replies.$node.bind(TD.components.InReplyTo.BEGIN,function(){b.show()}),this.replies.$node.bind(TD.components.InReplyTo.END,function(){c.addClass("gradient-top"),b.hide()}),this.$detailContainer.bind("scroll",_.bind(this._handleScroll,this)),this.initialised=!0},_handleScroll:function(a){var b=Math.abs(this.$node.position().top);if(b<=10){var c=b/10;$(".gradient-bar",this.$header).css({opacity:c})}},_teardown:function(){this.initialised&&(this.replies.destroy(),this.media.destroy(),this.retweeters.destroy(),this.repliesTo.destroy())},findChirp:function(a){return this.initialised?this.replies.findChirp(a)||this.repliesTo.findChirp(a):undefined}}),TD.components.MessageDetailView=TD.components.DetailView.extend(function(a,b){}).methods({_render:function(){},showChirp:function(a){var b=this;this.chirp=a;var c=_.map(this.chirp.messages,function(a){return a.render()});this.replyBar=new TD.components.ReplyBar(this.chirp),this.$node.append(this.replyBar.$node),this.$chirps=$.createElement("div").addClass("column-chirps l-column-scrollv s-with-reply scr-v"),this.$chirps.html(c.join("")),this.$node.append(this.$chirps),this.$node.bind(TD.components.ReplyBar.RESET_EVENT,function(a){b._setInactiveReplyMode()}),this.$node.bind(TD.components.ReplyBar.REPLYING_EVENT,function(a){b._setActiveReplyMode()}),this.$mainNode=this.$node,this.initialised=!0},_setActiveReplyMode:function(){var a=this.$find(".column-chirps");a.addClass("s-extended")},_setInactiveReplyMode:function(){var a=this.$find(".column-chirps");a.removeClass("s-extended")},changed:function(a){if(this.initialised&&a.id===this.chirp.id){var b=_.map(this.chirp.messages,function(a){return a.render()});this.$chirps.html(b.join(""))}},findChirp:function(a){return this.initialised?this.chirp.messageIndex[a]:undefined},_teardown:function(){this.initialised&&(this.replyBar.destroy(),this.chirp.setUnread(!1))}}),TD.components.ReplyBar=TD.components.Base.extend(function(a){if(!a||!a.postComment)return;var b=this,c=TD.ui.template.render("text/strong",{text:a.account.getUsername()}),d={from:TD.i("From {{{1}}}",{1:c})};this._boundHandleGlobalKeydown=_.bind(this._handleGlobalKeydown,this),this.$node=$(TD.ui.template.render("status/tweet_detail_replybar",d)),this.chirp=a,this.$inputBox=this.$find(".js-reply-tweetbox"),this.$charCount=this.$find(".js-reply-charcount"),this.$sendButton=this.$find(".js-send");switch(a.account.getType()){case"twitter":this.charLimit=140}this.$sendButton.bind("click",function(a){b.send()}),this._reset()}).statics({ACTIVITY_EVENTS:"click change focus blur input keydown keypress keyup mousedown mouseup paste",RESET_EVENT:"td-reset",REPLYING_EVENT:"td-replying",OVER_CHAR_COUNT_CLASS:"over-char-count"}).methods({_updateCharCount:function(){var a=TD.ui.compose.getTextLength(this.$inputBox.val()),b=this.charLimit-a;b<0||b===this.charLimit?this.$sendButton.attr("disabled",!0):this.$sendButton.attr("disabled",!1),b<0?this.$charCount.addClass(TD.components.ReplyBar.OVER_CHAR_COUNT_CLASS):this.$charCount.removeClass(TD.components.ReplyBar.OVER_CHAR_COUNT_CLASS),this.$charCount.val(b)},_reset:function(){var a=this,b="";if(this.chirp instanceof TD.services.TwitterStatus){var c=this.chirp.getMainTweet();b=TD.i("Reply to @{{1}}",{1:c.user.screenName})}else this.chirp instanceof TD.services.TwitterMessageThread&&(b=TD.i("Message @{{1}}",{1:this.chirp.correspondent.screenName}));this.$node.removeClass("s-replying"),this.$inputBox.val(b),this.$inputBox.blur().attr("disabled",!1),this.$sendButton.attr("disabled",!1),this.$inputBox.bind(TD.components.ReplyBar.ACTIVITY_EVENTS,_.bind(this._handleActivity,this)),this.bubbleEvent(TD.components.ReplyBar.RESET_EVENT,null),$(window).unbind("keydown",this._boundHandleGlobalKeydown)},_handleActivity:function(a){var b=this;this.$inputBox.unbind(),b.bubbleEvent(TD.components.ReplyBar.REPLYING_EVENT,null),this.$node.addClass("s-replying");var c="",d=[];this.chirp instanceof TD.services.TwitterStatus&&(d=TD.util.getReplyUsers(this.chirp)),d.length>0&&(c=d.join(" ")+" "),this.$inputBox.val(c),this._updateCharCount();var e=c.length,f=c.length;d.length>0&&(e=d[0].length+1),this.$inputBox.bind("keydown change",_.bind(this._handleKeydown,this)),_.defer(function(){b.$inputBox[0].setSelectionRange(e,f)}),this.$inputBox.bind("cut paste",_.bind(this._handleCutPaste,this)),this.$inputBox.bind("keyup",_.bind(this._updateCharCount,this))},_handleCutPaste:function(a){_.defer(_.bind(this._updateCharCount,this))},_handleGlobalKeydown:function(a){a.which===TD.constants.keyCodes.escape&&this._reset()},_handleKeydown:function(a){this._updateCharCount();switch(a.charCode||a.keyCode){case 10:case 13:a.ctrlKey&&(a.preventDefault(),this.send());break;case TD.constants.keyCodes.escape:this.$inputBox.blur(),$(window).bind("keydown",this._boundHandleGlobalKeydown)}},send:function(){var a=this.$inputBox.val(),b=this;if(!a)return;this.$sendButton.attr("disabled",!0),this.$inputBox.attr("disabled",!0),this.$inputBox.blur(),this.chirp.postComment(a,function(){b._reset()},function(){b.$sendButton.attr("disabled",!1),b.$inputBox.attr("disabled",!1),b.$inputBox.focus()})}}),TD.components.DetailMediaView=TD.components.Base.extend(function(a,b){if(!(a instanceof TD.services.TwitterStatus))return;var c=this,d=TD.util.isWrapperApp()&&TD.util.getOSName()==="windows";this.$node.addClass("embed");var e=function(a,b){var d,e;if(a.disabled)return;TD.settings.getUseNarrowColumns()&&(a.isVideo||a.type=="rich")?(e={embeds:a,showThumbs:!0},d=TD.ui.template.render("status/chirp_media_thumbs",e)):a.isYouTube?(e={id:a.id,width:TD.services.media.YOUTUBE_DETAIL_WIDTH,height:TD.services.media.YOUTUBE_DETAIL_HEIGHT},d=TD.ui.template.render("media/youtube",e)):a.isEmbedly?(e={embeds:a,showThumbs:!0},d=TD.ui.template.render("status/chirp_media_thumbs",e)):d=TD.ui.template.render("status/tweet_detail_mediaembed",a),c.$node.append(d)};TD.services.media.getEmbedableContent(a,e)}),TD.components.ColumnOptions=TD.components.Base.extend(function(a){var b=this;this.column=a,this.ownList=undefined,_.find(a.getFeeds(),function(a){if(a.getType()==="list"){var c=a.getMetadata();b.ownList=TD.cache.lists.find(c.listId,c.screenName,c.slug,!0)}return Boolean(b.ownList)});var c={isOwnList:Boolean(this.ownList),options:[{action:"sound",option:TD.i("Notification sounds"),on:a.model.getHasSound()}]};TD.controller.notifications.hasNotifications()&&c.options.push({action:"popups",option:TD.i("Notification popups"),on:a.model.getHasNotification()}),this.$node=$(TD.ui.template.render("column/column_options",c)),$("input",this.$node).bind("click",function(a){var c=a.target.getAttribute("data-action"),d=b.column.model.getKey();switch(c){case"remove":TD.controller.columnManager.deleteColumn(d);break;case"clear":b.column.clear();break;case"left":case"right":TD.controller.columnManager.move(d,c);break;case"sound":case"popups":b._toggleColumnSetting(c);break;case"edit-list":TD.ui.columns.exitEditMode(b.column.model.getKey());var e=new TD.components.ListMembers(b.ownList)}})}).methods({_toggleColumnSetting:function(a){var b;switch(a){case"popups":b=!this.column.model.getHasNotification(),this.column.model.setHasNotification(b);break;case"sound":b=!this.column.model.getHasSound(),this.column.model.setHasSound(b)}},_columnHas:function(a){return _.find(this.column.model.getFeedKeys(),function(b){var c=TD.storage.feedController.get(b);return c.getType()===a&&c.getService()==="twitter"})}}),TD.components.MediaGallery=TD.components.BaseModal.extend(function(a,b,c){var d=this,e=$(window);this.tweet=a,this.column=c,this.clickedLink=b,this.originalLinkHeight=20,this.$node=$(TD.ui.template.render("media/media_gallery")),this.$closeButton=this.$find(".js-dismiss"),this.$prevButton=this.$find("#media-gallery-prev"),this.$nextButton=this.$find("#media-gallery-next"),this.$embed=this.$find(".js-mediaembed"),this.$tray=this.$find("#media-gallery-tray"),this.$tweet=this.$find(".med-tweet"),this.$mainframe=this.$find(".js-embeditem"),this._sizeMedia=_.bind(this._sizeMedia,this),e.bind("resize",this._sizeMedia),this.$closeButton.bind("click",function(){d.destroy()}),this.$prevButton.bind("click",function(){d._prev()}),this.$nextButton.bind("click",function(){d._next()}),this._loadTweet(),this.showInModal(),a.embeds?a.embeds.length?(this.embeds=a.embeds,this._setupEmbeds()):(TD.util.openURL(b),this.destroy()):this._loadEmbeds()}).methods({showInModal:function(){var a=$("#open-modal");a.append(this.$node).show()},_prev:function(){var a=_.indexOf(this.embeds,this.currentEmbed);a==0&&(a=this.embeds.length),this.currentEmbed=this.embeds[a-1],this._renderEmbed()},_next:function(){var a=_.indexOf(this.embeds,this.currentEmbed);a==this.embeds.length-1&&(a=-1),this.currentEmbed=this.embeds[a+1],this._renderEmbed()},_setupEmbeds:function(){if(!this.embeds||this.embeds.length===0)return;var a=this;this.currentEmbed=this.embeds[0],this.clickedLink&&_.each(this.embeds,function(b){b.textUrl===a.clickedLink&&(a.currentEmbed=b)}),this._renderEmbed()},_loadTweet:function(){var a=this;this.$tweet.append(this.tweet.render(TD.services.ChirpBase.kMEDIA_CLASS)),this.$tweet.bind("click",function(b){$.publish("chirp/action",[b,a.tweet,a.column])})},_loadEmbeds:function(){if(!this.embeds){this.embeds=[];var a=this;TD.services.media.getEmbedableContent(this.tweet,function(b,c){a.embeds.push(b),a._setupEmbeds()})}},_sizeMedia:function(){var a=this,b=a.$mainframe,c=$("img",b);c.css({"max-width":b.width(),"max-height":b.height()-a.originalLinkHeight+"px"});var d=$("iframe",b);d.css({width:b.width(),height:b.height()-a.originalLinkHeight+"px"})},_fadeIn:function(){this.$embed.fadeTo("fast",1)},_renderEmbed:function(){var a=this,b=this.currentEmbed,c="";if(b.disabled){TD.util.openURL(b.textUrl),this.destroy();return}if(b.isYouTube){var d={id:b.id,width:TD.services.media.YOUTUBE_GALLERY_WIDTH,height:TD.services.media.YOUTUBE_GALLERY_HEIGHT};c=TD.ui.template.render("media/youtube",d)}else b.isEmbedly?c=b.html||b.code:c=TD.ui.template.render("status/tweet_detail_mediaembed",b);this.$embed.html(c),this.$embed.append(TD.ui.template.render("text/tweet_detail_originallink",b)),this.$embed.append(TD.ui.template.render("text/tweet_detail_flagmedia",{flagged:b.flaggedNSFW}));var e=$("img",this.$embed);e.length===0?_.delay(function(){a._fadeIn(),a._sizeMedia()},1e3):e.load(function(){e.attr("data-maxwidth",e.width()),e.attr("data-maxheight",e.height()),e.css({"max-width":e.width()+"px",width:"auto"}),a._sizeMedia(),a._fadeIn()}),this.$find(".js-media-flag-nsfw").click(function(c){var d;b.flaggedNSFW=!0,a.$find(".js-media-flag-nsfw").hide(),a.$find(".js-media-flagged-nsfw").show(),d=TD.controller.clients.getClient(a.tweet.account.getKey()),d.flagTweet(a.tweet.id,function(){},function(){var b=TD.i("Problem flagging media. Please try again");TD.controller.progressIndicator.addMessage(b),a.$find(".js-media-flag-nsfw").show(),a.$find(".js-media-flagged-nsfw").hide()})}),this.embeds.length>1?(this.$prevButton.show(),this.$nextButton.show(),this.$mainframe.addClass("s-shorter"),this.$tweet.find(".chp-media").show()):(this.$prevButton.hide(),this.$nextButton.hide(),this.$tweet.find(".chp-media").hide())},destroy:function(){var a=$(window);$("#open-modal").hide(),a.unbind("resize",this._sizeMedia),this.supr()}}),TD.components.AccountSelector=TD.components.Base.extend(function(a){var b=this;this.$node=$.createElement("ul").addClass("accs clear js-account-selector"),this.cachedSelectedAccounts=[],this.SELECTED_CLASS="acc-selected",this.accountIndex={},this.refreshPostingAccounts(),this.$node.delegate(".js-account-item","click",function(a){var c=$(a.currentTarget);a.stopPropagation(),a.shiftKey?($("li",b.$node).removeClass(b.SELECTED_CLASS),c.addClass(b.SELECTED_CLASS)):c.toggleClass(b.SELECTED_CLASS),b.updateSelectedAccounts()}),this.subscription=$.subscribe("/storage/client/account_whitelist_changed",_.bind(this.refreshPostingAccounts,this))}).statics({CHANGE:"td-accounts-change"}).methods({refreshPostingAccounts:function(){var a,b,c=TD.storage.accountController.getPostingAccounts(),d,e=[],f,g,h,i;this.accountIndex={};for(a=0;a<c.length;a++){d=c[a],h=d.getKey(),e.push(h),this.accountIndex[h]={account:h,uid:h,type:"account",username:d.getUsername(),service:d.getType(),picture:d.getProfileImageURL()};if(d.getType()=="facebook"){f=TD.controller.clients.getClient(d.getKey()).pages;for(b=0;b<f.length;b++)g=f[b],h=d.getKey()+"page"+g.id,this.accountIndex[h]={account:d.getKey(),username:TD.i("{{1}} (FB Page)",{1:g.name}),id:g.id,uid:h,type:"page",service:"facebook",picture:"http://graph.facebook.com/"+g.id+"/picture"},e.push(h)}}var j=function(a,b,c){var d={accounts:[],show_acc_toggle:c};return d.accounts=_.map(a,function(a){return b[a]}),d};e.length&&(i=TD.ui.template.render("compose/accounts",j(e,this.accountIndex,!0)),this.$node.html(i))},filterByServices:function(a){this.$node.find(".js-account-item").each(function(){var b=$(this);a.indexOf(b.data("service"))===-1?b.removeClass(this.SELECTED_CLASS).hide():b.show()}),this.updateSelectedAccounts()},reset:function(){this.$node.removeClass(this.SELECTED_CLASS),this.$node.find(".js-account-item").show()},getSelectedAccounts:function(){var a,b=[],c;if(this.cachedSelectedAccounts)return this.cachedSelectedAccounts.concat();a=$("."+this.SELECTED_CLASS,this.$node);for(var d=0;d<a.length;d++)c=a[d].attributes["data-id"].value,b.push(this.accountIndex[c]);return this.cachedSelectedAccounts=b,b},selectAccounts:function(a){var b=this.$node.find(".js-account-item"),c,d;if(!_.isArray(a))return;b.removeClass(this.SELECTED_CLASS);if(!a||!a.length)return;for(d=0;d<a.length;d++)a[d]&&b.filter("li[data-id='"+a[d]+"']").addClass(this.SELECTED_CLASS);this.updateSelectedAccounts()},selectDefaultAccount:function(){var a=TD.storage.accountController.getDefault();a&&this.selectAccounts([a.getKey()])},updateSelectedAccounts:function(){this.cachedSelectedAccounts=null;var a=this.getSelectedAccounts();this.$node.trigger(TD.components.AccountSelector.CHANGE)},destroy:function(){$.unsubscribe(this.subscription),$(".js-account-item",this.$node).die(),this.supr()}}),TD.components.FollowDialog=TD.components.BaseModal.extend(function(a){var b=this;this.$node.removeClass("s-tall-fixed").addClass("s-fluid s-nonav cmp"),this.$find(".js-header-title").html(TD.i("Your relationship to {{>text/user_link_screenname}}",a)),this.$followFromAccountHolder=this.$find(".js-mdl-content"),$("#actions-modal").html(this.$node);var c=TD.storage.accountController.getAccountsForService("twitter");$(".js-dismiss",this.$node).click(_.bind(this.destroy,this)),this.followAccounts=[],_.each(c,function(c){if(c.getUserID()==a.id)return;var d=new TD.components.FollowFrom(a,c);b.followAccounts.push(d),b.$followFromAccountHolder.append(d.$node)}),$("#actions-modal").show()}).methods({destroy:function(a){this.$node.remove(),$("#actions-modal").hide(),a&&a.preventDefault()}}),TD.components.FollowFrom=TD.components.Base.extend(function(a,b,c){var d=this;this.userToFollow=a,this.account=b,this.showAccountMenu=c,this.client=TD.controller.clients.getClient(b.getKey()),this.$node=$(TD.ui.template.render("actions/follow_from",this)),this.$followButton=this.$find(".js-follow-button:not(:disabled)").click(_.bind(this.handleClick,d)),this.$followButtonHolder=this.$find(".js-action-follow"),this.$followFromUsername=this.$find(".js-from-username"),this.state="stranger",c&&(this.$profileMenuButton=this.$find(".js-profile-menu").click(_.bind(this._handleProfileMenuButtonClick,this))),b.getUserID()==a.id?(this.state="me",this.updateButtonState()):this.client.showFriendship(b.getUserID(),a.id,_.bind(this.handleFollowInfoResponse,this),_.bind(this.handleFollowInfoError,this)),this.subscriptions=[$.subscribe("/user/"+this.userToFollow.screenName+"/block",_.bind(this._handleBlock,this)),$.subscribe("/user/"+this.userToFollow.screenName+"/blocked",_.bind(this._handleBlock,this))]}).methods({_handleProfileMenuButtonClick:function(a){if(!this.profileMenu||!this.profileMenu.$node)this.profileMenu=new TD.components.ProfileMenu(this.$profileMenuButton,this.userToFollow),this.profileMenu.setPosition(TD.components.DropDown.POSITION_LEFT),a.stopPropagation()},_handleBlock:function(a){a.getKey()===this.account.getKey()&&(this.state="blocked",this.updateButtonState())},handleFollowInfoResponse:function(a){var b=this;a.relationship.source.blocking===!0?this.state="blocked":a.relationship.source.following===!0?this.state="following":this.state="stranger",this.updateButtonState()},handleFollowInfoError:function(a){this.following=!1,this.blocking=!1,this.updateButtonState()},handleClick:function(a){var b=this.account;switch(this.state){case"me":TD.util.openURL("https://twitter.com/settings/profile");break;case"blocked":this.userToFollow.unblock(b,null,_.bind(this.unblockError,this)),this.state="stranger";break;case"pending":case"following":this.userToFollow.unfollow(b,null,_.bind(this.unfollowError,this)),this.state="stranger";break;case"stranger":this.userToFollow.follow(b,_.bind(this.followResponse,this),_.bind(this.followError,this)),this.state="following"}this.updateButtonState()},followError:function(){this.state="stranger",this.updateButtonState()},unfollowError:function(){this.state="following",this.updateButtonState()},unblockError:function(){this.state="blocked",this.updateButtonState()},followResponse:function(a){a.isProtected&&(this.state="pending",this.updateButtonState())},updateButtonState:function(){this.$followButton.attr("disabled",!1),this.$followButtonHolder.removeClass("s-not-following s-following s-pending s-blocking");switch(this.state){case"me":this.$followButtonHolder.addClass("s-thats-you");break;case"blocked":this.$followButtonHolder.addClass("s-blocking");break;case"pending":this.$followButtonHolder.addClass("s-pending");break;case"following":this.$followButtonHolder.addClass("s-following");break;case"stranger":this.$followButtonHolder.addClass("s-not-following")}},destroy:function(){_.each(this.subscriptions,function(a){$.unsubscribe(a)}),this.supr()},hideFromAccountName:function(){this.$followFromUsername.hide(),$("a",this.$followButtonHolder).addClass("js-show-tip")}}),TD.components.AddToListsDialog=TD.components.BaseModal.extend(function(a){var b=this,c=TD.storage.accountController.getAccountsForService("twitter");this.myLists=[],this.userToAdd=a,_.each(c,function(c){var d=TD.controller.clients.getClient(c.getKey());_.each(TD.cache.lists.getListsFor(c.getKey()),function(a){a.user.id==c.getUserID()&&b.myLists.push(a)}),d.getListMemberships(a.screenName,!0,function(a){_.each(a,function(a){b.$find("#"+a.id).attr("checked","checked")})})}),this.$node.removeClass("s-tall-fixed").addClass("s-fluid cmp"),this.$find(".js-header-title").text(TD.i("Your lists")).after(" "+TD.i("Include {{>text/user_link_screenname}} in:",a)),this.$find(".js-mdl-content").html(TD.ui.template.render("actions/add_to_list_dialog",this)).addClass("with-scroll scr-v-alt"),this.$listCheckboxes=this.$find(".js-mdl-content input").click(_.bind(this._changeSubscription,this)),this.$find(".mdl-buttonbar").html(TD.ui.template.render("actions/add_to_list_footer")),this.$createListButton=this.$find(".js-create-list"),$(".js-dismiss",this.$node).click(_.bind(this.destroy,this)),this.$createListButton.click(_.bind(this._createList,this)),$("#actions-modal").html(this.$node).show()}).methods({_changeSubscription:function(a){var b=$(a.target),c=b.attr("id"),d=b.attr("checked")==="checked",e=b.attr("data-account"),f=TD.controller.clients.getClient(e),g=TD.storage.Feed.generateKeyFor(e,"list",{listId:c}),h=TD.controller.feedManager.getPoller(g),i=this;d?f.addUserToList(c,this.userToAdd.screenName,function(){h&&_.delay(function(){h.refresh(!0,!0)},1e3)}):f.removeUserFromList(c,this.userToAdd.screenName,function(){h&&h.removeWhere(function(a){return i.userToAdd.id==a.user.id})})},_createList:function(a){this.destroy();var b=new TD.components.ListDetails;b.autoAddMember(this.userToAdd)},destroy:function(a){this.$node.remove(),$("#actions-modal").hide(),a&&a.preventDefault()}}),TD.components.ActionDialog=TD.components.BaseModal.extend(function(a){var b=this;this.tweet=a,this.$node=$(TD.ui.template.render("actions/action_dialog")),this.$inreplyToHolder=this.$find(".js-inreply"),$(".js-dismiss",this.$node).click(_.bind(this.destroy,this)),this.header=new TD.components.ActionHeader,this.header.$node.bind(TD.components.ActionHeader.CLOSE,function(a){b.destroy()}),this.$find(".mdl-header").prepend(this.header.$node),this.$buttons=this.$find(".js-action-button"),this.$buttons.click(function(c){var d=$(c.target),e=d.data("action"),f=b.header.accountSelector.getSelectedAccounts();switch(e){case"quote":TD.ui.compose.showComposeWindow(a.getMainTweet().getQuoteText()),TD.ui.compose.selectAccounts(_.map(f,function(a){return a.account})),b.destroy();break;case"retweet":_.each(f,function(c){var d=TD.controller.clients.getClient(c.account),e=d.create();b.$buttons.attr("disabled","disabled"),e.Retweet(a.id),e.Post(_.bind(b._handleRetweeted,b),_.bind(b._handleRetweetFailure,b))})}}),this.displayTweet(a),this.header.accountSelector.filterByServices(["twitter"]),this.header.accountSelector.selectAccounts([a.account.getKey()]),$("#actions-modal").html(this.$node).show()}).methods({displayTweet:function(a){a&&this.$inreplyToHolder.html(TD.ui.template.render("status/status_twitter_inreplyto",a)).show},_handleRetweeted:function(a){this.tweet.setRetweeted(!0),this.destroy()},_handleRetweetFailure:function(a,b,c){var d=c||TD.i("Sorry, we could not perform your retweet because something went wrong. Please try again later.");TD.controller.progressIndicator.addMessage(d),this.$buttons.removeAttr("disabled")},destroy:function(){$("#actions-modal").hide(),this.supr()}}),TD.components.ActionHeader=TD.components.Base.extend(function(){var a=this;this.accountsVisible=!1,this.$node=$.createElement("div"),this.$node.append($(TD.ui.template.render("actions/action_header"))),this.accountSelector=new TD.components.AccountSelector,this.$node.append(this.accountSelector.$node),this.$composeUsernames=this.$find("h3"),this.$actionText=this.$find("span"),this.$showAccountsToggle=this.$find(".js-accounts-toggle"),this.$showAccountsToggle.click(_.bind(this.toggleAccountsVisibility,this)),this.accountSelector.$node.bind(TD.components.AccountSelector.CHANGE,function(){var b=_.map(a.accountSelector.getSelectedAccounts(),function(a){return a.username}),c=TD.i("From {{accounts}}",{accounts:b.join(", ")});a.$composeUsernames.text(c)}),this.accountSelector.selectDefaultAccount(),this.toggleAccountsVisibility()}).statics({CHANGE:"td-accounts-change",CLOSE:"td-dialog-close"}).methods({toggleAccountsVisibility:function(){this.accountsVisible?(this.$actionText.text(TD.i("Change")),this.accountSelector.hide()):(this.$actionText.text(TD.i("Hide")),this.accountSelector.show()),this.accountsVisible=!this.accountsVisible}}),TD.components.GlobalSettings=TD.components.BaseModal.extend(function(){var a=this,b={tabs:[{title:TD.i("General"),action:"general"},{title:TD.i("Accounts"),action:"accounts",selected:!0},{title:TD.i("Services"),action:"services"},{title:TD.i("Global Filter"),action:"filter"}]};this.$find(".js-header-title").text(TD.i("Application Settings")),this.$node.removeClass("s-tall-fixed").addClass("s-short s-nonav"),this.$find(".js-mdl-content").html(TD.ui.template.render("settings/global_settings_modal",b)),this.$optionList=this.$find(".js-setting-list li"),$("#settings-modal").append(this.$node),$(".js-dismiss",this.$node).click(_.bind(this.destroy,this)),$("a.list-link",this.$node).click(function(b){var c=$(b.currentTarget),d=c.data("action");if(d===a.currentTabName)return;a.$optionList.removeClass("selected"),a.currentTab.destroy();switch(d){case"general":a.currentTab=new TD.components.GeneralSettings;break;case"accounts":a.currentTab=new TD.components.AccountSettings;break;case"services":a.currentTab=new TD.components.ServicesSettings;break;case"filter":a.currentTab=new TD.components.FilterSettings}a.currentTabName=d,c.parent("li").addClass("selected")}),this.currentTab=new TD.components.AccountSettings,this.currentTabName="accounts",$("#settings-modal").show()}).methods({destroy:function(a){this.currentTab&&this.currentTab.destroy(),$("#settings-modal").hide(),a&&a.preventDefault(),this.supr()}}),TD.components.AccountSettings=TD.components.Base.extend(function(){this.$node=$(TD.ui.template.render("settings/global_setting_account")),$("#global-settings").append(this.$node),this.$accountHolder=$(".js-account-container"),this.$addFacebookItems=this.$find(".js-add-facebook"),$(".js-remove-account").live("click",_.bind(this.handleRemoveAccount,this)),$(".js-add-account").live("click",_.bind(this.handleAddAccount,this)),$(".js-set-default").live("click",_.bind(this.handleSetDefaultClick,this)),this.boundRefreshAccounts=_.bind(this.refreshAccounts,this),this.subscriptions=[$.subscribe("/storage/account/new",this.boundRefreshAccounts),$.subscribe("/storage/account/blacklisted",this.boundRefreshAccounts),$.subscribe("/storage/client/default_account_changed",_.bind(this.setDefaultAccount,this))],this.refreshAccounts()}).methods({handleRemoveAccount:function(a){var b=$(a.target),c=b.data("account"),d={};d.title=TD.i("Removing account!"),d.message=TD.i("Are you sure you want to remove account '{{1}}' from TweetDeck?",{1:TD.storage.accountController.get(c).getUsername()}),d.okLabel=TD.i("Remove"),d.cancelLabel=TD.i("Cancel"),d.okCallback=function(){TD.controller.clients.removeClient(c)},(new TD.components.ConfirmationDialog(d)).show()},handleAddAccount:function(a){var b=$(a.target);TD.controller.clients.addClient(b.data("service"))},handleSetDefaultClick:function(a){var b=$(a.target),c=b.data("account");c&&TD.storage.clientController.client.setDefaultAccount(c)},refreshAccounts:function(){var a=TD.storage.accountController.getAccountsForService("twitter"),b=TD.storage.accountController.getAccountsForService("facebook"),c="";c+=TD.ui.template.render("settings/global_setting_account_row",{accounts:a,isTwitter:!0}),b.length?(c+=TD.ui.template.render("settings/global_setting_account_row",{accounts:b,isTwitter:!1}),this.$addFacebookItems.hide()):this.$addFacebookItems.show(),this.$accountHolder.html(c),this.setDefaultAccount()},setDefaultAccount:function(){var a=TD.storage.clientController.client.getDefaultAccount();this.$find('.js-set-default[data-account="'+a+'"]').attr("checked",!0)},destroy:function(a){this.$node.remove(),$(".js-remove-account").die("click"),$(".js-add-account").die("click"),$(".js-set-default").die("click"),_.each(this.subscriptions,function(a){$.unsubscribe(a)})}}),TD.components.FilterSettings=TD.components.Base.extend(function(){this.$globalSettings=$("#global-settings"),this.$globalSettings.submit(_.bind(this.handleAddFilter,this)),this.$node=$(TD.ui.template.render("settings/global_setting_filter",{})),this.$globalSettings.append(this.$node),this.$filterHolder=$("#filter-results"),$(".js-remove-filter").live("click",_.bind(this.handleRemoveFilter,this)),this.$addFilterInput=$("#filter-input"),this.$addFilterInput.keyup(_.bind(this._validateFilter,this)),this.$filterTypes=$("#filter-types"),this.$filterTypes.change(_.bind(this.handleFilterTypeChange,this)),this.$addFilterButton=$("#add-filter"),this.$addFilterButton.click(_.bind(this.handleAddFilter,this)),this.handleFilterTypeChange(),this.refreshFilters()}).methods({_validateFilter:function(a){var b=this.$filterTypes.val(),c=this.$addFilterInput.val(),d=TD.controller.filterManager.validateFilter(b,c);return d?this.$addFilterButton.removeAttr("disabled"):this.$addFilterButton.attr("disabled","disabled"),d},handleAddFilter:function(a){a.preventDefault();if(!this._validateFilter())return;var b=this.$filterTypes.val(),c=this.$addFilterInput.val();TD.controller.filterManager.addFilter(b,c),this.refreshFilters(),this.$addFilterInput.val("")},handleRemoveFilter:function(a){var b=$(a.target);TD.controller.filterManager.removeFilter(b.data("id")),this.refreshFilters()},handleFilterTypeChange:function(){var a=this.$filterTypes.val(),b;switch(a){case TD.vo.Filter.PHRASE:b=TD.i("eg iPad");break;case TD.vo.Filter.SENDER:b=TD.i("eg @JohnDoe123");break;case TD.vo.Filter.SOURCE:b=TD.i("eg TweetSpamApp")}this.$addFilterInput.attr("placeholder",b),this._validateFilter()},refreshFilters:function(){var a=TD.controller.filterManager.getAll(),b="";_.each(a,function(a){b+=TD.ui.template.render("settings/global_setting_filter_row",a)}),this.$filterHolder.html(b),this._validateFilter()},destroy:function(a){$(".js-remove-filter").die("click"),this.$globalSettings.unbind("submit"),this.$node.remove()}}),TD.components.ServicesSettings=TD.components.Base.extend(function(){this.$node=$(TD.ui.template.render("settings/global_setting_services",{}));var a=TD.storage.accountController.getAccountsForService("bitly");a.length>0&&(this.bitlyAccount=a[0]),$("#global-settings").append(this.$node),this.$bitlyForm=$("#bitly-form"),this.$bitlyUsername=$("#bitly-email"),this.$bitlyKey=$("#bitly-key"),this.$photoUpload=$("#photo-service"),this.$photoUpload.change(_.bind(this.handlePhotoServiceChange,this)),this.setPhotoService(),this.$linkShorteners=$("#link-shortening"),this.$linkShorteners.change(_.bind(this.handleLinkShortenerChange,this)),this.setLinkShortener()}).methods({handleLinkShortenerChange:function(a){var b=this.$linkShorteners.val();b=b.split("-")[1],TD.settings.setLinkShortener(b),this.setLinkShortener()},setLinkShortener:function(){var a=TD.settings.getLinkShortener();this.$linkShorteners.val("link-"+a),a=="bitly"?(this.$bitlyForm.show(),this.bitlyAccount&&(this.$bitlyUsername.val(this.bitlyAccount.getUserID()),this.$bitlyKey.val(this.bitlyAccount.getOAuthToken()))):this.$bitlyForm.hide()},handlePhotoServiceChange:function(a){var b=this.$photoUpload.val();b=b.split("-")[1],TD.settings.setImageService(b),this.setPhotoService()},setPhotoService:function(){this.$photoUpload.val("photo-"+TD.settings.getImageService())},commitBitlyChanges:function(a,b){var c=this.$bitlyUsername.val(),d=this.$bitlyKey.val();a&&b&&TD.storage.accountController.blacklistAccount(a);if(!a||b){a=new TD.storage.Account,a.setType("bitly"),a.setOAuthToken(d),a.setUserID(c),a.computeKey(),TD.storage.accountController.manage(a);return}a.setOAuthToken(d)},destroy:function(){var a=TD.settings.getLinkShortener();if(a=="bitly"){var b=this.bitlyAccount,c=this.$bitlyUsername.val(),d=this.$bitlyKey.val();c&&d&&(!b||b.getUserID()==c&&b.getOAuthToken()==d?b||this.commitBitlyChanges():this.commitBitlyChanges(b,b.getUserID()!=c))}this.$node.remove()}}),TD.components.GeneralSettings=TD.components.Base.extend(function(){this.$node=$(TD.ui.template.render("settings/global_setting_general",{version:TD.version,buildIDShort:TD.buildIDShort})),$("#global-settings").append(this.$node),this.$streamingForm=this.$find(".js-streaming-form"),this.$streamingUpdates=$("#streaming-updates"),this.$streamingUpdates.change(_.bind(this.handleStreamingChange,this)),this.setStreaming(),this.$checkForUpdatesForm=this.$find(".js-check-updates-form"),this.$checkForUpdates=$("#check-for-updates"),this.$checkForUpdates.change(_.bind(this.handleCheckForUpdatesChange,this)),this.setCheckForUpdates(),this.$inlineMedia=$("#inline-media"),this.$inlineMedia.change(_.bind(this.handleInlineMediaChange,this)),this.setInlineMedia(),this.$showStartupNotifications=$("#show-startup-notifications"),this.$showStartupNotifications.change(_.bind(this.handleShowStartupNotificationsChange,this)),this.setShowStartupNotifications(),this.$narrowColumns=$("#use-narrow-columns"),this.$narrowColumns.change(_.bind(this.handleNarrowColumnChange,this)),this.setNarrowColumns(),this.$resetPasswordButton=$(".js-reset-password"),this.$resetPasswordButton.click(_.bind(this.handleResetPassword,this)),this.$resetPasswordErrorMessage=this.$find(".js-reset-error"),this.$resetPasswordSuccessMessage=this.$find(".js-reset-success"),this.$resetProgressSpinner=this.$find(".js-reset-progress")}).methods({handleStreamingChange:function(a){var b=Boolean(this.$streamingUpdates.attr("checked"));TD.settings.setUseStream(b)},setStreaming:function(){TD.util.isChromeApp()||TD.util.isWrapperApp()?this.$streamingUpdates.attr("checked",TD.settings.getUseStream()):this.$streamingForm.hide()},handleInlineMediaChange:function(a){var b=Boolean(this.$inlineMedia.attr("checked"));TD.settings.setShowInlineMedia(b)},setInlineMedia:function(){this.$inlineMedia.attr("checked",TD.settings.getShowInlineMedia())},handleNarrowColumnChange:function(a){var b=Boolean(this.$narrowColumns.attr("checked"));TD.settings.setUseNarrowColumns(b)},setNarrowColumns:function(){this.$narrowColumns.attr("checked",TD.settings.getUseNarrowColumns())},handleCheckForUpdatesChange:function(a){var b=Boolean(this.$checkForUpdates.attr("checked"));TD.settings.setCheckForUpdates(b),this.setStreaming()},setCheckForUpdates:function(){this.$checkForUpdatesForm.hide()},handleShowStartupNotificationsChange:function(a){var b=Boolean(this.$showStartupNotifications.attr("checked"));TD.settings.setShowStartupNotifications(b)},setShowStartupNotifications:function(){this.$showStartupNotifications.attr("checked",TD.settings.getShowStartupNotifications())},handleResetPassword:function(a){var b,c;this.$resetPasswordButton.prop("disabled",!0),this.$resetPasswordErrorMessage.hide(),this.$resetProgressSpinner.show(),c=TD.storage.store.getTweetdeckAccount(),b=TD.controller.clients.getTDClient().forgotPassword(c),b.addCallbackWith(this,function(a){this.$resetPasswordSuccessMessage.show(),this.$resetPasswordErrorMessage.hide(),this.$resetProgressSpinner.hide()}),b.addErrbackWith(this,function(a){this.$resetPasswordErrorMessage.show(),this.$resetProgressSpinner.hide(),this.$resetPasswordButton.prop("disabled",!1)})}}),TD.components.AccountSelector=TD.components.Base.extend(function(a){var b=this;this.$node=$.createElement("ul").addClass("accs clear js-account-selector"),this.cachedSelectedAccounts=[],this.SELECTED_CLASS="acc-selected",this.accountIndex={},this.refreshPostingAccounts(),this.$node.delegate(".js-account-item","click",function(a){var c=$(a.currentTarget);a.stopPropagation(),a.shiftKey?($("li",b.$node).removeClass(b.SELECTED_CLASS),c.addClass(b.SELECTED_CLASS)):c.toggleClass(b.SELECTED_CLASS),b.updateSelectedAccounts()}),this.subscription=$.subscribe("/storage/client/account_whitelist_changed",_.bind(this.refreshPostingAccounts,this))}).statics({CHANGE:"td-accounts-change"}).methods({refreshPostingAccounts:function(){var a,b,c=TD.storage.accountController.getPostingAccounts(),d,e=[],f,g,h,i;this.accountIndex={};for(a=0;a<c.length;a++){d=c[a],h=d.getKey(),e.push(h),this.accountIndex[h]={account:h,uid:h,type:"account",username:d.getUsername(),service:d.getType(),picture:d.getProfileImageURL()};if(d.getType()=="facebook"){f=TD.controller.clients.getClient(d.getKey()).pages;for(b=0;b<f.length;b++)g=f[b],h=d.getKey()+"page"+g.id,this.accountIndex[h]={account:d.getKey(),username:TD.i("{{1}} (FB Page)",{1:g.name}),id:g.id,uid:h,type:"page",service:"facebook",picture:"http://graph.facebook.com/"+g.id+"/picture"},e.push(h)}}var j=function(a,b,c){var d={accounts:[],show_acc_toggle:c};return d.accounts=_.map(a,function(a){return b[a]}),d};e.length&&(i=TD.ui.template.render("compose/accounts",j(e,this.accountIndex,!0)),this.$node.html(i))},filterByServices:function(a){this.$node.find(".js-account-item").each(function(){var b=$(this);a.indexOf(b.data("service"))===-1?b.removeClass(this.SELECTED_CLASS).hide():b.show()}),this.updateSelectedAccounts()},reset:function(){this.$node.removeClass(this.SELECTED_CLASS),this.$node.find(".js-account-item").show()},getSelectedAccounts:function(){var a,b=[],c;if(this.cachedSelectedAccounts)return this.cachedSelectedAccounts.concat();a=$("."+this.SELECTED_CLASS,this.$node);for(var d=0;d<a.length;d++)c=a[d].attributes["data-id"].value,b.push(this.accountIndex[c]);return this.cachedSelectedAccounts=b,b},selectAccounts:function(a){var b=this.$node.find(".js-account-item"),c,d;if(!_.isArray(a))return;b.removeClass(this.SELECTED_CLASS);if(!a||!a.length)return;for(d=0;d<a.length;d++)a[d]&&b.filter("li[data-id='"+a[d]+"']").addClass(this.SELECTED_CLASS);this.updateSelectedAccounts()},selectDefaultAccount:function(){var a=TD.storage.accountController.getDefault();a&&this.selectAccounts([a.getKey()])},updateSelectedAccounts:function(){this.cachedSelectedAccounts=null;var a=this.getSelectedAccounts();this.$node.trigger(TD.components.AccountSelector.CHANGE)},destroy:function(){$.unsubscribe(this.subscription),$(".js-account-item",this.$node).die(),this.supr()}}),TD.components.DropDown=TD.components.Base.extend(function(a){this.$parent=a,this.$body=$("body"),this._handleKeydown=_.bind(this._handleKeydown,this),$(window).bind("keydown",this._handleKeydown),this._boundHandleGlobalClick=_.bind(this._handleGlobalClick,this)}).statics({CLOSE:"td-dropdown-close",POSITION_RIGHT:"td-dropdown-right",POSITION_LEFT:"td-dropdown-left",dropdown:null}).methods({addToDisplay:function(){var a=TD.components.DropDown.dropdown;if(a){a.destroy(),TD.components.DropDown.dropdown=null;if(a.$parent[0]===this.$parent[0]){this.destroy();return}}this.$parent.addClass("active"),this.$node.insertAfter(this.$parent),this.$node.show(),this.$body.on("click","*",this._boundHandleGlobalClick),TD.components.DropDown.dropdown=this},_handleGlobalClick:function(a){this.$node&&this.$find(a.currentTarget).length===0&&this.$parent.find(a.currentTarget).length===0&&this.destroy()},_handleKeydown:function(a){a.which===TD.constants.keyCodes.escape&&this.destroy()},destroy:function(){this.$parent.removeClass("active"),$(window).unbind("keydown",this._handleKeydown),this.$body.off("click","*",this._boundHandleGlobalClick),this.bubbleEvent(TD.components.DropDown.CLOSE),this.$node.remove(),this.$node=null,TD.components.DropDown.dropdown=null},setPosition:function(a){var b=this,c=this.$node.height()+this.$node.offset().top,d=$("#container").height();a===TD.components.DropDown.POSITION_RIGHT?this.$node.addClass("pos-r"):a===TD.components.DropDown.POSITION_LEFT&&this.$node.addClass("pos-l"),c>=d&&this.$node.addClass("pos-t")}}),TD.components.ProfileMenu=TD.components.DropDown.extend(function(a,b,c,d){this.user=b,this.chirp=c,this.showFollow=d||TD.storage.accountController.getAccountsForService("twitter").length>1,this.chirp instanceof TD.services.TwitterDirectMessage?this.$node=$(TD.ui.template.render("menus/profile_directmessage",this)):this.$node=$(TD.ui.template.render("menus/profile",this)),this.actionsMenu=a.closest("ul"),this.setChirpMenuState(),this.$find("a").click(_.bind(this.handleClick,this)),this.addToDisplay()}).methods({handleClick:function(a){var b=$(a.target).data("action");switch(b){case"mention":TD.ui.compose.mention(this.user.screenName,this.user.account.getKey());break;case"message":TD.ui.compose.directMessage(this.user.screenName,this.user.profileImageURL,this.user.account.getKey());break;case"lists":new TD.components.AddToListsDialog(this.user);break;case"block":this.user.block(this.user.account);break;case"report-spam":this.user.block(this.user.account,!0);break;case"follow":var c=new TD.components.FollowDialog(this.user);break;case"reference-to":this.chirp.referenceTo();break;case"email":this.chirp.email();break;case"destroy":this.chirp.destroy()}this.destroy()},setChirpMenuState:function(){this.actionsMenu.addClass("s-menuopen")},destroy:function(){this.supr(),this.actionsMenu.removeClass("s-menuopen")}}),TD.components.PhotoUpload=TD.components.Base.extend(function(a,b,c,d){var e=this;this.files=[],this.$cameraButton=c,this.$fileUploadInput=b,this.$fileUploadInput.change(_.bind(this.handleFileUploadInput,this)),this.$cameraButton.click(function(){e.$fileUploadInput.click()}),this.$thumbs=d,$("a",this.$thumbs).live("click",function(a){a.stopPropagation(),e.clear()})}).statics({ALLOWED_IMAGE_TYPES:["jpg","jpeg","gif","png"],MAX_ALLOWED_FILES:1,canUpload:window.File&&window.FormData}).methods({addFile:function(a){var b=TD.components.PhotoUpload,c=a.type.split("/")[1];if(this.files.length>=b.MAX_ALLOWED_FILES)return;if(!_.include(b.ALLOWED_IMAGE_TYPES,c))return;this.files.push(a);var d=TD.ui.template.toHtml(TD.i("Image will appear as a link")+' &middot; <a class="pretty-link"> '+TD.i("remove")+"</a>");this.$thumbs.html(d).show(),$.publish("/image/added")},clear:function(){this.files=[],this.$thumbs.empty().hide(),this.$fileUploadInput.attr({value:""}),$.publish("/image/removed")},getFilesToUpload:function(){return this.files},handleFileUploadInput:function(a){var b=a.target.files,c;for(var d=0;d<b.length;d++)c=b[d],this.addFile(c)}}),TD.components.ConfirmationDialog=TD.components.Base.extend(function(a){this.title=a.title,this.message=a.message,this.okCallback=a.okCallback||function(){},this.noCallback=a.noCallback||function(){}}).methods({show:function(){confirm(this.message)?this._okCallback():this._noCallback()},_okCallback:function(){this.okCallback(),this.close()},_noCallback:function(){this.noCallback(),this.close()},close:function(){}}),TD.components.TopbarMenu=TD.components.DropDown.extend(function(a){this.$node=$(TD.ui.template.render("menus/topbar_menu",{debug:Boolean(TD.config.debug_menu),tdAccount:TD.storage.store.getTweetdeckAccount()})),this.addToDisplay(),this.$find("a").click(_.bind(this.handleClick,this))}).methods({handleClick:function(a){var b=$(a.target),c=b.data("action");switch(c){case"signOut":TD.controller.init.signOut();break;case"url":TD.util.openURL(b.attr("href"));break;case"globalSettings":var d=new TD.components.GlobalSettings;break;case"do_debug":TD.sync.ui.dispatch_ui_event(b.data("type"));break;case"fileabug":this.sendBugReport()}a.preventDefault(),this.destroy()},sendBugReport:function(){var a,b=TD.config.fileabug,c;c={tdAccount:TD.storage.store.getTweetdeckAccount(),userAgent:navigator.userAgent,version:TD.version,buildID:TD.gitrevshort},a=TD.ui.template.render("emails/fileabug",c),TD.util.openEmail(b,"",a)}}),TD.components.ColumnNavMenu=TD.components.DropDown.extend(function(a){this.columns=TD.controller.columnManager.getAllOrdered(),this.extraPadding=40,this.$containerHeight=$("#container").height(),this.$node=$(TD.ui.template.render("menus/column_nav",{columns:this.columns})),this.$internalScrollElement=this.$find(".js-int-scroller"),this.$internalStaticElement=this.$find(".js-int-static"),this.$find("a").on("click",_.bind(this.handleClick,this)),this.$edit=this.$find(".edit-columns"),this.$edit.attr("data-default-text",this.$edit.text()),this.$internalScrollElement.dragdroplist({handle:".drag-handle",orientation:"vertical"}).bind("drop.dragdroplist",_.bind(this._handleDrop,this)),this.addToDisplay(),this.resizeToWindowHeight()}).statics({COLUMN_GLOW_DURATION:2e3}).methods({_handleDrop:function(a){var b=[],c=$(a.target).attr("data-column");TD.ui.columns.setMovingColumn(c),this.$internalScrollElement.find(".clm-unit").each(function(){b.push($(this).attr("data-column"))}),TD.storage.clientController.client.setColumnOrder(b)},handleClick:function(a){var b=$(a.target).data("action"),c=$(a.target).data("column");switch(b){case"jumpto":TD.controller.columnManager.showColumn(c);break;case"addcolumn":TD.ui.openColumn.showOpenColumn()}this.bubbleEvent(TD.components.BaseModal.CLOSE_EVENT),this.destroy()},resizeToWindowHeight:function(){var a;this.$node&&this.$containerHeight&&this.$node.height()>this.$containerHeight&&(a=this.$containerHeight-this.extraPadding-this.$internalStaticElement.height(),this.$internalScrollElement.addClass("scr-v-alt").css("max-height",a)),this.$node.visibility("visible")}}),TD.vo.URLInfo=function(a){var b;this.originalURL=a,this.synonyms=[a],TD.util.urls.isShortURL(a)&&(this.shortURL=a),b=TD.util.mediaURLs.getYouTubeVideoIDFromURL(a);if(b){this.addSynonym(TD.util.mediaURLs.getShortYouTubeURL(b));return}b=TD.util.mediaURLs.getFlickrPhotoIDFromURL(a);if(b){this.addSynonym(TD.util.mediaURLs.getFlickrShortURLFromPhotoID(b));return}},TD.vo.URLInfo.prototype.addSynonym=function(a){this.synonyms.push(a),this.shortURL=a},TD.vo.URLInfo.prototype.getNextSynonym=function(a){var b=this.synonyms.length;for(var c=0;c<b;c++)if(this.synonyms[c]==a)return nextIndex=(c+1)%b,this.synonyms[nextIndex];return a},TD.vo.URLInfo.prototype.shorten=function(a,b,c,d){var e=this;if(this.shortURL&&!b)return c(this.originalURL,this.shortURL),!1;this.shorteningInProgress=!0,TD.services.bitly.shorten(this.originalURL,function(a){a.data.url&&(e.shortURL=a.data.url,e.addSynonym(e.shortURL),c(e.originalURL,a.data.url))})},TD.vo.Column=function(a){TD.sync.util.assert(a,"must provide sColumn to create aColumn");var b=this;this.model=a,TD.sync.util.assert(this.model.getKey(),"vo.Column will most likely fail if your column has no key"),this._feeds=[],this.filters=[],this.description="",this.updateArray=[],this.holdingArray=[],this.updateIndex={},this._animating=!1,this._animationQueue=[],this.feedSubscriptions={},this.deleteSubscriptions={},this.visible=!0,this.temporary=!1,this.containerUpdatesSelector="[data-column='"+this.model.getKey()+"'] .js-chirp-container",this.tmpContainerUpdatesSelector="[data-column='"+this.model.getKey()+"'] .column-chirps",this.detailViewComponent=null,this.feedsFetched=0,this.isFirstFetch=!0,this.isFetchingOlderUpdates=!1,this.lastInfiniteScrollTime=null,this.CHIRP_BLOCK_SIZE=20,this.loadFeeds()},TD.vo.Column.CHIRP_STAGGERING_INTERVAL=400,TD.vo.Column.prototype.reset=function(){this.updateArray=[],this.holdingArray=[],this.updateIndex={},this.feedsFetched=0,this.isFirstFetch=!0,this.isFetchingOlderUpdates=!1,this.lastInfiniteScrollTime=null,this.refreshSubscriptions()},TD.vo.Column.prototype.loadFeeds=function(){if(!this.model.managed)return;var a=this.model.getFeedKeys();if(_.isUndefined(a)){TD.sync.util.stateLog("loadFeeds() not loading feeds for",this,"given",this.model.state);return}this._feeds=[];for(var b=0;b<a.length;b++){var c=TD.storage.feedController.get(a[b]);this._feeds.push(c)}this.refreshSubscriptions(),TD.controller.scheduler.checkColumn(this)},TD.vo.Column.prototype.getFeeds=function(){return this._feeds.concat()},TD.vo.Column.prototype.getFeedCount=function(){return this._feeds.length},TD.vo.Column.prototype.setFeeds=function(a){this._feeds=a;var b=[];for(var c=0;c<this._feeds.length;c++)b.push(this._feeds[c].getKey());this.model.setFeedKeys(b),this.refreshSubscriptions(),this.model.managed&&TD.storage.feedController.manageFeeds(this._feeds)},TD.vo.Column.prototype.addFeed=function(a){var b=[],c;for(var d=0;d<this._feeds.length;d++){c=_feeds[d].getKey();if(c===a.getKey())return;b.push(c)}this._feeds.push(a),b.push(a.getKey()),this.model.setFeedKeys(b),this.refreshSubscriptions(),this.model.managed&&TD.storage.feedController.manageFeeds(this._feeds)},TD.vo.Column.prototype.addFeeds=function(a){if(!a||a.length===0)return;var b=[],c={},d;a=this._feeds.concat(a);for(d=0;d<a.length;d++)c[a[d].getKey()]||(c[a[d].getKey()]=!0,b.push(a[d]));this.setFeeds(b)},TD.vo.Column.prototype.removeFeed=function(a){var b=[],c,d=0;for(var e=this._feeds.length-1;e>=0;e--)c=this._feeds[e].getKey(),c===a.getKey()?(this._feeds.splice(e,1),d++):b.push(c);return d>0&&(this.model.setFeedKeys(b),this.refreshSubscriptions(),this.checkChirpIndex()),d},TD.vo.Column.prototype.findChirp=function(a){var b=this.updateIndex[a];return!b&&this.detailViewComponent&&(b=this.detailViewComponent.findChirp(a)),b},TD.vo.Column.prototype.findMostInterestingChirp=function(a){var b=this.findChirp(a);return b&&b instanceof TD.services.TwitterAction&&(b=b.getRelatedTweet()||b),b},TD.vo.Column.prototype.getChirpContainerSelector=function(){return this.temporary?this.tmpContainerUpdatesSelector:this.containerUpdatesSelector},TD.vo.Column.prototype.setFilters=function(a){this.filters=a,this.reapplyFilters()},TD.vo.Column.prototype.checkChirpIndex=function(){var a=this.model.getFeedKeys(),b=_.map(a,TD.controller.feedManager.getPoller),c=_.filter(this.updateArray,function(a){return!_.find(b,function(b){return b.chirpIndex[a.id]})});this.removeFromIndex(null,c,!0)},TD.vo.Column.prototype.refreshSubscriptions=function(){var a,b={},c=this.model.getFeedKeys(),d=this;if(this.model.getType()==="me"){var e=!1,f=[];_.each(c,function(a){var b=TD.storage.feedController.get(a);if(!b)return;b.getType()==="interactions"&&(e=!0),b.getType()!=="mentions"&&f.push(a)}),e&&(c=f)}for(var g=0;g<c.length;g++)a=c[g],b[a]=!0,this.feedSubscriptions[a]||(this.feedSubscriptions[a]=$.subscribe("/feed/"+a,function(a,b,c){d.addToIndex(a,b,c)})),this.deleteSubscriptions[a]||(this.deleteSubscriptions[a]=$.subscribe("/delete/"+a,function(a,b){d.removeFromIndex(a,b,!0)}));for(a in this.feedSubscriptions)b[a]||($.unsubscribe(this.feedSubscriptions[a]),delete this.feedSubscriptions[a]);for(a in this.deleteSubscriptions)b[a]||($.unsubscribe(this.deleteSubscriptions[a]),delete this.deleteSubscriptions[a])},TD.vo.Column.prototype.removeSubscriptions=function(){var a;for(a in this.feedSubscriptions)$.unsubscribe(this.feedSubscriptions[a]),delete this.feedSubscriptions[a];for(a in this.deleteSubscriptions)$.unsubscribe(this.deleteSubscriptions[a]),delete this.deleteSubscriptions[a]},TD.vo.Column.prototype.fetchOlderUpdates=function(){if(this.isFetchingOlderUpdates)return;var a=this,b=this.updateArray[this.updateArray.length-1].created.getTime(),c=this.updateArray.length;this.isFetchingOlderUpdates=!0,this.addInfiniteScrollSpinner();var d=_.map(this.getFeeds(),function(c){var d=TD.controller.feedManager.getPoller(c.getKey()),e=d.fetchOlderChirps(b);return e.addCallback(function(b){return b=_.select(b,function(b){return!a.updateIndex[b.id]}),a.lastInfiniteScrollTime=(new Date).getTime(),a.addItemsToIndex(b,!0,c,c.getLatestTime()),b}),e}),e=new TD.core.defer.DeferredList(d);return e.addCallback(function(b){a.removeInfiniteScrollSpinner(),a.feedsFetched=0,a.isFetchingOlderUpdates=!1,a.truncate(c+a.CHIRP_BLOCK_SIZE)}),e},TD.vo.Column.prototype.sortFunction=function(a,b){return this.type=="scheduled"?TD.util.chirpAscSort(a,b):TD.util.chirpDescSort(a,b)},TD.vo.Column.prototype.addToIndex=function(a,b,c){var d=b.concat();d.splice(this.CHIRP_BLOCK_SIZE),this.addItemsToIndex(d,this.updateArray.length,a.feed,c),this.isFirstFetch&&(this.feedsFetched++,this.feedsFetched==this.getFeedCount()&&(this.truncate(this.CHIRP_BLOCK_SIZE),this.feedsFetched=0,this.isFirstFetch=!1))},TD.vo.Column.prototype.addItemsToIndex=function(a,b,c,d){var e,f=[],g,h=this.updateArray.length?this.updateArray[this.updateArray.length-1].created.getTime():0,i=this.model.getClearedTimestamp(),j=$(this.getChirpContainerSelector()),k=[],l=this;this.updateArray.length===0&&this.removeInfiniteScrollSpinner(),a.sort(this.sortFunction),a.splice(this.CHIRP_BLOCK_SIZE+this.updateArray.length),e=a.length;for(var m=0;m<e;m++){g=a[m];if(!b&&g.created.getTime()<h)continue;if(g.created.getTime()<=i)continue;if(g.broken)continue;_.isUndefined(this.updateIndex[g.id])||(this.removeFromIndex(null,[g],!1),this.detailViewComponent&&this.detailViewComponent.changed(g)),this.updateIndex[g.id]=g,f.push(g),_.isUndefined(d)||(k=k.concat(g.getUnreadChirps(d)))}if(f.length){var n="",o=[],p=this.updateArray;while(f.length>0||p.length>0)if(f.length===0)o=o.concat(p),p=[];else if(p.length===0)o=o.concat(f),this.addToView(c,n,f),f=[];else{var q=[],r=f[0].created.getTime(),s=p[0].created.getTime();while(r>s&&f.length>0)g=f.shift(),q.push(g),f.length>0&&(r=f[0].created.getTime());q.length>0?(this.addToView(c,n,q),o=o.concat(q)):(g=p.shift(),o.push(g),g.passFilters(this.filters)&&(n=g.id))}this.updateArray=o}TD.controller.notifications.newUpdates(this,c,k)},TD.vo.Column.prototype.removeFromIndex=function(a,b,c){for(var d=0;d<b.length;d++){var e=b[d];this.removeChirp(e),c&&this.detailViewComponent&&this.detailViewComponent.deleted(e)}},TD.vo.Column.prototype.removeChirp=function(a){var b=this.updateIndex[a.id];if(b){for(var c=0;c<this.updateArray.length;c++){a=this.updateArray[c];if(a===b){this.updateArray.splice(c,1);break}}delete this.updateIndex[a.id],$(this.getChirpContainerSelector()+" [data-key='"+a.id+"']").remove()}},TD.vo.Column.prototype.clear=function(){if(this.updateArray.length===0)return;var a=this.updateArray[0].created.getTime();this.model.setClearedTimestamp(a),this.truncate(0)},TD.vo.Column.prototype.truncate=function(a){var b,c,d,e=-1,f=this.getFeeds(),g=this;this.feedsFetched=0;for(b=0;b<f.length;b++){c=TD.controller.feedManager.getPoller(f[b].getKey());if(!c)continue;d=c.getRangeStartTime(),d>e&&(e=d)}var h=null;for(b=this.updateArray.length-1;b>=0;b--)if(this.updateArray[b].created.getTime()>=e){h=b;break}if(h===null)return;h=Math.min(a,h+1);var i=$(this.getChirpContainerSelector());for(b=this.updateArray.length-1;b>=h;b--)this.annihilateChirp(this.updateArray[b].id.toString(),i);this.updateArray.splice(h,Number.MAX_VALUE)},TD.vo.Column.prototype.trimUpdates=function(){var a=this,b,c;if(this.lastInfiniteScrollTime){b=(new Date).getTime()-this.lastInfiniteScrollTime;if(b<6e4)return;c=Math.floor((this.updateArray.length-20)*(1-b/6e5)),this.maxUpdatesPerColumn=Math.max(20+c,20)}var d=Math.max(this.maxUpdatesPerColumn||20,20),e=this.updateArray.splice(d,Math.max(this.updateArray.length-d,0)),f=e.length,g=$(this.getChirpContainerSelector());for(var h=0;h<f;h++)this.annihilateChirp(e[h].id.toString(),g)},TD.vo.Column.prototype.annihilateChirp=function(a,b){var c=this,d=this.findChirp(a);b.children('[data-key="'+a+'"]').remove(),delete this.updateIndex[a]},TD.vo.Column.prototype.addInfiniteScrollSpinner=function(){var a=$(this.getChirpContainerSelector());a.append(TD.ui.template.render("spinner_large"))},TD.vo.Column.prototype.removeInfiniteScrollSpinner=function(){$(this.getChirpContainerSelector()+" .js-infinitespinner").remove()},TD.vo.Column.prototype.addToView=function(a,b,c){var d=$(this.getChirpContainerSelector()),e=[],f,g,h=this,i,j=d.children("article").size()===0,k,l;c=_.filter(c,function(a){return a.passFilters(h.filters)});if(c.length===0)return;this.updateArray.length===0?(k=TD.util.getPreciseTime(),f=this.renderChirps(c),l=TD.util.getPreciseTime(),TD.util.logTimeToRenderColumn(l-k,c.length)):f=this.renderChirps(c),i=$(f).filter("article"),b===""?j?d.html(i):d.prepend(i):d.children('[data-key="'+b+'"]').after(i),j?this._fadeInChirps(i):this._slideInChirps(i)},TD.vo.Column.prototype.renderChirps=function(a){var b=[];for(var c=0;c<a.length;c++){var d;this.temporary&&(d=TD.services.ChirpBase.kTEMP_COM_CLASS);var e=a[c].render(d);b.push(e)}return b.join("")},TD.vo.Column.prototype._fadeInChirps=function(a){a.addClass("s-fade"),a.animate({opacity:1},350,function(){a.removeClass("s-fade")})},TD.vo.Column.prototype._slideInChirps=function(a){var b=this,c,d,e,f,g=[];a&&(a.each(function(){g.push($(this).addClass("s-animating"))}),g.reverse(),this._animationQueue=this._animationQueue.concat(g));if(this._animating||this._animationQueue.length===0)return;f=TD.ui.columns.freezeScroll(this.model.getKey()),f?(_.each(this._animationQueue,function(a){a.removeClass("s-animating")}),this._animationQueue=[],this.isFetchingOlderUpdates||TD.ui.columns.setHeaderState(this.model.getKey(),"true")):TD.controller.columnManager.isStreaming(this.model.getKey())?(_.each(this._animationQueue,this._slideInChirp),this._animationQueue=[]):(this._animating=!0,c=this._animationQueue.shift(),this._slideInChirp(c),setTimeout(function(){b._animating=!1,b._slideInChirps()},TD.vo.Column.CHIRP_STAGGERING_INTERVAL)),this.isFetchingOlderUpdates||TD.ui.columns.unfreezeScroll(this.model.getKey())},TD.vo.Column.prototype._slideInChirp=function(a){var b=a.find(".js-chirp"),c=b.outerHeight();a.animate({height:c},300),a.animate({opacity:1},150,function(){a.removeClass("s-animating"),a.removeAttr("style")})},TD.vo.Column.prototype.reapplyFilters=function(){var a,b=[],c="";for(var d=0,e=this.updateArray.length;d<e;d++)a=this.updateArray[d],a.passFilters(this.filters)?$(this.getChirpContainerSelector()+" [data-key='"+a.id+"']").length===0?b.push(a):(this.addToView(null,c,b),b=[],c=a.id):$(this.getChirpContainerSelector()+" [data-key='"+a.id+"']").remove();this.addToView(null,c,b)},TD.vo.Column.prototype.getColumnClass=function(){var a=this.getColumnType();switch(a){case"facebook":return"facebook";case"home":return"home";case"me":case"mentions":return"mentions";case"privateMe":case"direct":return"message";case"scheduled":return"scheduled";case"search":return"search";default:return"twitter"}},TD.vo.Column.prototype.getColumnType=function(){if(this.model.getType()!=="other")return this.model.getType();var a=[],b=!1,c=!1;_.each(this._feeds,function(d){var e=d.getService();e==="twitter"?(b=!0,a.push(d.getType())):e==="facebook"&&(a.push("facebook"),c=!0)});if(!b&&c)return"facebook";if(b&&!c){if(a.length===1)return a[0]==="home"?"home_timeline":a[0];if(a.length>1)return _.contains(a,"messages")?"messages":"twitter"}return""},TD.vo.Filter=function(a,b,c){this.id=_.uniqueId(),this.type=a,this.value=b,this.positive=c,_.isString(b)&&(this.value=b.toLowerCase());switch(this.type){case TD.vo.Filter.PHRASE:this.exact=!1;break;case TD.vo.Filter.SENDER:this.exact=!0,this.fuzzy=!0;break;case TD.vo.Filter.SOURCE:this.exact=!0,this.fuzzy=!1;break;case TD.vo.Filter.FOLLOWERS:this.exact=!1,this.range=!0}},TD.vo.Filter.PHRASE="phrase",TD.vo.Filter.SENDER="sender",TD.vo.Filter.SOURCE="source",TD.vo.Filter.FOLLOWERS="followers",TD.vo.Filter.prototype.id=null,TD.vo.Filter.prototype.value=null,TD.vo.Filter.prototype.type=TD.vo.Filter.PHRASE,TD.vo.Filter.prototype.positive=!0,TD.vo.Filter.prototype.exact=!0,TD.vo.Filter.prototype.fuzzy=!1,TD.vo.Filter.prototype.range=!1,TD.vo.Filter.prototype.pass=function(a,b,c){var d=this;switch(this.type){case TD.vo.Filter.PHRASE:return this._testString(a);case TD.vo.Filter.SENDER:return _.all(b,function(a){return d._testString(a)});case TD.vo.Filter.SOURCE:return this._testString(c);case TD.vo.Filter.FOLLOWERS:return this._testNumber(followers)}return!0},TD.vo.Filter.prototype.getDisplayType=function(){switch(this.type){case TD.vo.Filter.PHRASE:return TD.i("text content");case TD.vo.Filter.SENDER:return TD.i("author");case TD.vo.Filter.SOURCE:return TD.i("source");case TD.vo.Filter.FOLLOWERS:return TD.i("Followers")}return""},TD.vo.Filter.prototype._testString=function(a){if(!a||!this.value)return!0;if(this.exact){if(a===this.value)return this.positive;if(this.fuzzy&&"@"+a===this.value)return this.positive}else if(a.indexOf(this.value)!==-1)return this.positive;return!this.positive},TD.vo.Filter.prototype._testNumber=function(a){if(!_.isNumber(a)||!_.isNumber(this.value))return!0;if(this.exact){if(a===this.value)return this.positive}else if(this.range&&a>=this.value)return this.positive;return!this.positive},TD.vo.Filter.prototype._testBoolean=function(a){return!_.isBoolean(a)||!_.isBoolean(this.value)?!0:a===this.value?this.positive:!this.positive},TD.vo.Filter.prototype.toBackendState=function(){return{type:this.type,value:this.value,positive:this.positive,exact:this.exact,fuzzy:this.fuzzy,range:this.range}},TD.vo.Filter.prototype.fromBackendState=function(a){this.type=a.type,this.value=a.value,this.positive=a.positive,this.exact=a.exact,this.fuzzy=a.fuzzy,this.range=a.range},TD.util.urls=function(){var a={},b=new RegExp('((http|https|ftp):\\/\\/)?([-\\._a-z0-9]+@)?([-a-z0-9]+\\.)+([a-z][a-z]+\\.?)(:[\\d]+)?([/?][^\\s"]*)?(?!\\d)',"i"),c=" /~*?.;,:-%=_$&'@!+".split(""),d=["http://","https://","ftp://"],e=["ac","ad","ae","aero","af","ag","ai","al","am","an","ao","aq","ar","arpa","as","asia","at","au","aw","ax","az","ba","bb","bd","be","bf","bg","bh","bi","biz","bj","bm","bn","bo","br","bs","bt","bv","bw","by","bz","ca","cat","cc","cd","cf","cg","ch","ci","ck","cl","cm","cn","co","com","coop","cr","cu","cv","cx","cy","cz","de","dj","dk","dm","do","dz","ec","edu","ee","eg","er","es","et","eu","fi","fj","fk","fm","fo","fr","ga","gb","gd","ge","gf","gg","gh","gi","gl","gm","gn","gov","gp","gq","gr","gs","gt","gu","gw","gy","hk","hm","hn","hr","ht","hu","id","ie","il","im","in","info","int","io","iq","ir","is","it","je","jm","jo","jobs","jp","ke","kg","kh","ki","km","kn","kp","kr","kw","ky","kz","la","lb","lc","li","lk","lr","ls","lt","lu","lv","ly","ma","mc","md","me","mg","mh","mil","mk","ml","mm","mn","mo","mobi","mp","mq","mr","ms","mt","mu","museum","mv","mw","mx","my","mz","na","name","nc","ne","net","nf","ng","ni","nl","no","np","nr","nu","nz","om","org","pa","pe","pf","pg","ph","pk","pl","pm","pn","pr","pro","ps","pt","pw","py","qa","re","ro","rs","ru","rw","sa","sb","sc","sd","se","sg","sh","si","sj","sk","sl","sm","sn","so","sr","st","su","sv","sy","sz","tc","td","tel","tf","tg","th","tj","tk","tl","tm","tn","to","tp","tr","travel","tt","tv","tw","tz","ua","ug","uk","us","uy","uz","va","vc","ve","vg","vi","vn","vu","wf","ws","ye","yt","yu","za","zm","zw"],f=["deck.ly","deck.to","deckly.com","3.ly","alturl.com","awe.sm","bit.ly","bitly.tv","bkite.com","bte.tc","budurl.com","burnurl.com","buzzup.com","chilp.it","cli.gs","digg.com","doiop.com","eepurl.com","epr24.com","ff.im","fb.me","flic.kr","flic.kr","goo.gl","hopurl.com","ht.ly","htxt.it","icio.us","idek.net","ihid.us","inuiva.com","is.gd","j.mp","justin.tv","kl.am","link.reuters.com","lkbk.nu","lnk.ms","loopt.us","migre.me","mltp.ly","moby.to","mobypicture.com","om.ly","omg.ly","ow.ly","pic.gd","ping.fm","plixi.com","post.ly","qik.com","qik.ly","redirx.com","rep.ly","retwt.me","rubyurl.com","rurl.org","shar.es","short.ie","short.to","shortlinks.co.uk","sml.vg","sn.im","snipr.com","snipurl.com","snurl.com","su.pr","t.co","t.love.com","tiny.cc","tiny12.tv","tinychat.com","tinylink.com","tinysong.com","tinyurl.com","tl.gd","tlre.us","tobtr.com","tr.im","trim.su","trunc.it","tu.nu","twi.cc","twicli.com","twit.ac","twitpwr.com","twitthis.com","twitpic.com","twitvid.com","twlol.com","twurl.cc","twurl.nl","u.mavrev.com","u.nu","url4.eu","urlpire.com","ustre.am","viigo.im","wp.me","x.hypem.com","x.imeem.com","yep.it","yfrog.com","youtu.be","zipz.me","znl.me"];a.trim=function(a){var b,c;for(b=a.length;b>0;b--){c=a.substr(a.length-1);if(c.match(/[\.?!'",]/)!=null)a=a.slice(0,a.length-1);else{if(c!=")")break;if(_.contains(a,"("))break;a=a.slice(0,a.length-1)}}return a};var g=function(a){var b=i(a);return _.include(e,b.toLowerCase())},h=function(a){var b=a.toLowerCase(),c,e,f;for(c=0;c<d.length;c++)if(_.startsWith(b,d[c])){b=b.slice(d[c].length);break}return e=b.split("?")[0],e=e.split("/")[0],e=e.split(":")[0],e},i=function(a){var b=h(a);return parts=b.split("."),parts[parts.length-1]};return a.validate=function(a){var c=!1,d=b.exec(a);return d!=null&&a.length==d[0].length&&(c=g(a)),c},a.findEntities=function(a){var b=[],c=TD.util.urls.find(a);for(var d=0;d<c.length;d++){var e=c[d];b.push({start:e.startIndex,end:e.endIndex,value:e.url})}return b},a.find=function(c){var d=c,e=[],f,g;while(d.length>3)if(b.exec(d)!=null){f=b.exec(d)[0],f=a.trim(f);if(a.validate(f)){var h={};h.url=f,h.length=f.length,h.startIndex=c.indexOf(f,c.length-d.length),h.endIndex=h.startIndex+f.length,e.push(h)}g=d.indexOf(f)+f.length,d=d.substring(g)}else d="";return e},a.isShortURL=function(a){var b=h(a);return _.include(f,b)},a}(),TD.util.mediaURLs=function(){function g(a,b,c){c=c||1;var d=a.match(b);return!d||d.length==0?null:d[0].replace(b,"$"+c)}function h(a){var b=a.length,c=0,d=1;for(var e=b-1;e>=0;e--)c=c+d*f.indexOf(a.substr(e,1)),d=d*f.length;return c}function i(a){var b="",c=a;while(a>=58){c=a/58;var d=a-58*Math.floor(c);b=""+f.substr(d,1)+b,a=Math.floor(c)}return c?""+f.substr(c,1)+b:b}var a={},b=/(http:\/\/)?(www.)?flickr.com\/photos\/[A-Za-z0-9-_\@]+\/([0-9]+)/gi,c=/http:\/\/flic.kr\/p\/([A-Za-z0-9]+)/gi,d=/http:\/\/farm[0-9]+.static.flickr.com\/[0-9]+\/([0-9]+)_[0-9A-Za-z]+(_[mstb].jpg|.jpg|_o.(jpg|gif|png))/gi,e=/http:\/\/(youtu.be\/|www.youtube.com\/watch\?v=)([A-Za-z0-9_-]+)/gi,f="123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ";return a.getYouTubeVideoIDFromURL=function(a){return g(a,e,2)},a.getFlickrPhotoIDFromURL=function(a){matches=a.match(b);if(matches&&matches.length!=0)return matches[0].replace(b,"$3");matches=a.match(c);if(matches&&matches.length!=0){var e=matches[0].replace(c,"$1");return String(h(e))}return matches=a.match(d),matches&&matches.length!=0?matches[0].replace(d,"$1"):null},a.getShortYouTubeURL=function(a){return"http://youtu.be/"+a},a.getFlickrShortURLFromPhotoID=function(a){return"http://flic.kr/p/"+i(Number(a))},a}(),TD.cache.autocomplete=function(){var a=":CACHED_TWITTER_USERS_V2",b={},c={},d={};return b.add=function(a,b){var e=[a.id,a.screenName,a.name,a.profileImageURL],f=a.screenName.toLowerCase();b||c[f]?(c[f]=e,delete d[f]):d[f]=e},b.get=function(a){return a=a.toLowerCase(),c[a]||d[a]},b.getKeys=function(){var a=_.keys(c).concat(_.keys(d)).sort();return a},b.getValues=function(){return _.values(c).concat(_.values(d))},b.load=function(){c=TD.storage.store.get(a)},b.save=function(){TD.storage.store.set(a,c)},b}(),TD.cache.lists=function(){function c(b){var c=a[b]||{};return a[b]=c,c}var a={},b={};return b.add=function(a){var b=c(a.account.getKey()),d=b[a.id];b[a.id]=a;if(d){var e=TD.storage.Feed.generateKeyFor(a.account.getKey(),"list",{listId:a.id});if(d.name!==a.name||d.user.screenName!==a.user.screenName){var f=TD.i("{{1}} by {{2}}",{1:a.name,2:a.user.screenName}),g=TD.storage.columnController.getColumnsContainingFeed(e);_.each(g,function(a){a.getFeedKeys().length===1&&a.setTitle(f)})}}TD.controller.feedManager.fixListFeeds()},b.unsubscribe=function(a){var b=c(a.account.getKey());delete b[a.id]},b.purge=function(b){var c;_.each(a,function(a,d){c=c||a[b],delete a[b]});if(c){var d=TD.storage.Feed.generateKeyFor(c.account.getKey(),"list",{listId:b});TD.controller.feedManager.deleteFeedsWhere(function(a){return a.getKey()===d})}},b.getListsFor=function(a){return _.values(c(a))},b.find=function(b,c,d,e){var f="@"+c.toLowerCase()+"/"+d.toLowerCase(),g=undefined,h=undefined;return _.each(a,function(a,c){_.each(a,function(a,c){if(b&&a.id===b||a.fullName.toLowerCase()===f)a.isOwnList()?g=a:h=a})}),e?g:g||h},b}(),TD.cache.LRUQueue=klass(function(a){this.maxSize=a,this.length=0,this._first=undefined,this._last=undefined,this._index={},this._lefts={},this._rights={}}).methods({enqueue:function(a,b){this.dequeue(a),this.length==0?this._first=this._last=a:(this._lefts[this._first]=a,this._rights[a]=this._first,this._first=a),this._index[a]=b,this.length++,this.prune()},dequeue:function(a){if(_.isUndefined(this._index[a]))return;var b=this._lefts[a],c=this._rights[a];b?this._rights[b]=c:this._first=c,c?this._lefts[c]=b:this._last=b,delete this._index[a],delete this._rights[a],delete this._lefts[a],this.length--},prune:function(){while(this.maxSize&&this.length>this.maxSize)this.dequeue(this._last)},get:function(a){return this._index[a]},take:function(a){var b=[],c=this._first;a=Math.min(a,this.length);for(var d=0;d<a;d++)b.push(this._index[c]),c=this._rights[c];return b}}),TD.cache.twitterUsers=function(){function f(){_.each(d.splice(e),function(a){delete b[a.id],delete c[a.screenName.toLowerCase()]})}function g(a,d){var e=this,f,g,h,i;return a||d?(a?f=b[a]:f=c[d.toLowerCase()],f?i=TD.core.defer.succeed(f):(g=TD.storage.accountController.getPreferredAccount("twitter"),h=TD.controller.clients.getClient(g.getKey()),i=new TD.core.defer.Deferred,h.showUser(a,d,function(a){i.callback(a)},function(a){i.errback(a)}))):i=TD.core.defer.fail("Must provide user ID or screen name"),i}var a={},b={},c={},d=[],e=500;return a.add=function(a){var e=b[a.id];e?delete c[e.screenName.toLowerCase()]:d.unshift(a),b[a.id]=a,c[a.screenName.toLowerCase()]=a,f()},a.getById=function(a){return g(a,null)},a.getByScreenName=function(a){return g(null,a)},a}(),TD.controller.clients=function(){var a={};return{initialiseClients:function(){var b,c=TD.storage.accountController.getPostingAccounts();for(var d=0;d<c.length;d++)b=a[c[d].getKey()],b||(b=TD.services.makeServiceClient(c[d].getType(),c[d]),a[c[d].getKey()]=b);a.tweetdeck||(a.tweetdeck=new TD.services.TweetDeckClient)},getClient:function(b){return a[b]},getTDClient:function(){return a.tweetdeck},getClientsByService:function(b){var c=[];for(var d in a)a[d].type==b&&c.push(a[d]);return c},getPreferredClient:function(a){var b=TD.storage.accountController.getPreferredAccount(a);return b?this.getClient(b.getKey()):undefined},addClient:function(a,b){var c=this,d,e,f=function(){TD.storage.accountController.manage(b),c.initialiseClients();return};b?f():(b=new TD.storage.Account,b.setType(a),e=TD.controller.auth.create(a,b),e.start(b,f))},removeClient:function(b){var c=TD.storage.accountController.get(b);a[b]&&a[b].cleanUp&&a[b].cleanUp(),delete a[b],TD.controller.feedManager.deleteFeedsWhere(function(a){return a.getAccountKey()===b}),TD.storage.accountController.blacklistAccount(c)},refreshRetweetBlockLists:function(){if(!TD.util.shouldStream())return;var a=this.getClientsByService("twitter");_.each(a,function(a){a.populateRetweetBlockList()})}}}(),TD.controller.scheduler=function(){var a={},b,c=3e4,d=0,e=function(a){return TD.controller.feedManager.getPoller(a.getKey()).refresh()},f=function(b,c){var d={};_.each(a,function(a,c){a.trimUpdates();var e=a.getFeeds();for(var f=0;f<e.length;f++){if(b&&e[f].getAccountKey()!==b)continue;d[e[f].getKey()]=!0}});var e=[];return _.each(d,function(a,b){e.push(TD.controller.feedManager.getPoller(b).refresh(c))}),TD.core.defer.gatherResults(e)},g=function(){d++,TD.ui.updates.refreshTimestamps(),d%4==1&&(f(),TD.controller.feedManager.trimPollers(),h(),TD.cache.autocomplete.save(),TD.storage.store.set(":CACHED_HASHTAGS",TD.ui.compose.hashtagSet)),d%40==0&&TD.controller.clients.refreshRetweetBlockLists()},h=function(){var a=TD.storage.accountController.getAccountsForService("twitter"),b;for(b=0;b<a.length;b++)TD.controller.clients.getClient(a[b].getKey()).checkUserStream()};return{initialiseColumns:function(){b=setInterval(g,c),f(),h()},getClient:function(a){return clients[a]},removeColumn:function(b){var c=a[b],d,e,f;if(!c)return;delete a[b],TD.controller.feedManager.cleanupFeeds()},addColumn:function(b,c){var d,e=b.getFeeds();a[b.model.getKey()]=b;for(var f=0;f<e.length;f++)d=TD.controller.feedManager.addFeed(e[f]),d.publishChirpsOrFetch();c&&h()},checkColumn:function(b){a[b.model.getKey()]&&TD.controller.scheduler.addColumn(b)},refreshColumn:function(b){var c=a[b],d=c.getFeeds(),f=d.length,g=[];for(var h=0;h<f;h++)g.push(e(d[h]));return TD.core.defer.gatherResults(g)},refreshAccountColumns:function(a,b){f(a,b)},getColumns:function(){return a},getColumn:function(b){return a[b]},getColumnsByType:function(a){var b=this.getColumns(),c=_.select(b,function(b){return b.model.getType()===a});return c}}}(),TD.controller.FeedPoller=function(a){var b=this;this.OPTIMUM_ARRAY_LENGTH=100,this.CLEANUP_WAIT_PERIOD=12e4,this.TWEET_ID_QUEUE_LENGTH=500,this.feed=a,this.mark="",this.chirpArray=[],this.chirpIndex={},this.seenTweetIDs=new TD.cache.LRUQueue(this.TWEET_ID_QUEUE_LENGTH),this.refreshLock=0,this.REFRESH_LOCK_EXPIRY=6e4,this.isExhausted=!1,this.lastInfiniteScrollTime=0,this.shouldSetLatestTime=!1,this._checkNotifications=function(){var b=this;this.shouldSetLatestTime=!1;if(this.feed.getService()==="twitter"&&this.feed.getType()==="direct")this.shouldSetLatestTime=!0;else{var c=TD.storage.columnController.getColumnsContainingFeed(a.getKey());this.shouldSetLatestTime=Boolean(_.find(c,function(a){return a.getHasSound()||a.getHasNotification()}))}};var c=function(b,c,d){if(b!=="has_notification"&&b!=="has_sound")return;d&&_.include(d.getFeedKeys(),a.getKey())&&this._checkNotifications()};this.subscription=$.subscribe("/storage/column/column_flags_changed",_.bind(c,this)),this._checkNotifications(),this.reorderChirp=function(a){var b=this.chirpIndex[a];b&&(this.removeChirp(a),this.acceptChirps([b]))},this.sortFunction=function(a,b){return b.created.getTime()-a.created.getTime()},this.removeChirp=function(a){var b=this.chirpIndex[a],c;if(b){for(var d=0;d<this.chirpArray.length;d++){c=this.chirpArray[d];if(c===b){this.chirpArray.splice(d,1);break}}delete this.chirpIndex[a],$.publish("/delete/"+this.feed.getKey(),[this,[b]])}},this.removeWhere=function(a){var b=_.filter(this.chirpArray,a),c=b.length;while(c--)this.removeChirp(b[c].id)},this.removeAll=function(){var a=this.chirpArray.length;while(a--)this.removeChirp(this.chirpArray[a].id)},this.getRangeStartTime=function(){var a,b,c=Number.MAX_VALUE,d=this.feed;return this.isExhausted?0:d.getService()==="facebook"&&d.getType()==="notifications"?0:d.getService()==="twitter"&&d.getType()==="direct"?0:d.getService()==="tweetdeck"?0:(a=this.getOldestChirp(),a?a.created.getTime():0)},this.acceptChirps=function(b){var c;if(b){c=this.addChirpsToMemCache(b),this.publishChirps(c);var d=0;for(var e=0;e<c.length;e++)d=Math.max(d,c[e].created.getTime());this.shouldSetLatestTime&&a.setLatestTime(Math.max(a.getLatestTime(),d))}},this.refresh=function(a,b){var c=this,d=this.feed,e=c.chirpArray,f=(new Date).getTime();if(!(!this.refreshLock||f>this.refreshLock+this.REFRESH_LOCK_EXPIRY))return TD.core.defer.succeed();var g=TD.controller.clients.getClient(d.getAccountKey());if(!g)return TD.core.defer.fail();this.refreshLock=f;try{var h=new TD.core.defer.Deferred;return h.addCallback(function(a){c.refreshLock=0,c.acceptChirps(a)}),h.addErrback(function(){c.refreshLock=0}),g.refreshFeed(this,!1,_.bind(h.callback,h),_.bind(h.errback,h),a,b),h}catch(i){return console.log("Error refreshing",this,":",i),this.refreshLock=0,TD.core.defer.fail()}},this.publishChirpsOrFetch=function(){this.chirpArray&&this.chirpArray.length?this.publishAll():this.refresh()},this.getOldestChirp=function(){return this.chirpArray[this.chirpArray.length-1]},this.addChirpsToMemCache=function(a){var b,c,d=this.chirpIndex,e=this.chirpArray,f=[],g,h;for(b=0;b<a.length;b++)c=a[b],g=d[c.id],h=this.isRepeatedRetweet(c),g?g.update(c)&&f.push(g):h||(f.push(c),d[c.id]=c,e.push(c));return e.sort(TD.util.chirpDescSort),f},this.isRepeatedRetweet=function(a){var b=!1,c,d;return a instanceof TD.services.TwitterStatus&&(c=a.getMainTweet().id,d=this.seenTweetIDs.get(c)||0,b=a.isRetweetedStatus()&&d>0,this.seenTweetIDs.enqueue(c,d+1)),b},this.fetchOlderChirps=function(a){this.lastInfiniteScrollTime=(new Date).getTime();var b=this,c=b.feed,d=new TD.core.defer.Deferred;if(this.getRangeStartTime()<a)d.callback(this.chirpArray);else{var e=TD.controller.clients.getClient(c.getAccountKey());e.refreshFeed(this,!0,function(a){b.addChirpsToMemCache(a),a.length===0&&(b.isExhausted=!0),d.callback(b.chirpArray)},function(a){d.errback(a)})}return d},this.trimChirps=function(){if(this.chirpArray.length<this.OPTIMUM_ARRAY_LENGTH)return;var a=(new Date).getTime()-this.lastInfiniteScrollTime;if(a<this.CLEANUP_WAIT_PERIOD)return;var b=this.chirpArray.splice(this.OPTIMUM_ARRAY_LENGTH,Number.MAX_VALUE);for(var c=0;c<b.length;c++)delete this.chirpIndex[b[c].id];this.isExhaused=!1},this.addChirps=function(a){var b=this.addChirpsToMemCache(a);this.publishChirps(b)},this.publishAll=function(){this.publishChirps(this.chirpArray)},this.publishChirps=function(a){a.length&&$.publish("/feed/"+this.feed.getKey(),[this,a,this.feed.getLatestTime()])},this.destroy=function(){var a,b=this.feed;this.chirpArray=[],this.chirpIndex={},$.unsubscribeAll("/feed/"+b.getKey()),$.unsubscribeAll("/delete/"+b.getKey()),$.unsubscribe(this.subscription)}},TD.controller.feedManager=function(){function c(){var a=TD.storage.accountController.getDefault(),b=a.getKey(),c;a.getType()==="twitter"&&(c=TD.storage.feedController.getAll(),c=_.filter(c,function(a){return a.getType()==="search"&&a.getAccountKey()!==b}),_.each(c,function(a){var c=TD.storage.feedController.getOrCreateFeed(a.getType(),a.getService(),b,a.getMetadata());TD.controller.feedManager.replaceFeed(a,c)}))}var a={},b={};return a.init=function(){var a=TD.storage.feedController.getAll(),d=this,e;for(e=0;e<a.length;e++){var f=a[e];b[f.getKey()]=new TD.controller.FeedPoller(f)}$.subscribe("/user/removeTweets",function(a,b,c){d.deleteUserChirps(a,b,c)}),$.subscribe("/storage/client/default_account_changed",c)},a.getPoller=function(a){return b[a]},a.trimPollers=function(){for(var a in b)b[a].trimChirps()},a.addFeed=function(a){var c=a.getKey(),d=b[c];return d?d:(d=new TD.controller.FeedPoller(a),b[c]=d,d)},a.removeFeed=function(a){var c=a.getKey(),d=b[c];delete b[c],d.destroy(),a.getService()=="twitter"&&(client=TD.controller.clients.getClient(a.getAccountKey()),client&&client.checkUserStream())},a.cleanupFeeds=function(){var c=TD.controller.columnManager.getAll(),d={};for(var e in c){var f=c[e].getFeeds();for(var g=0;g<f.length;g++)d[f[g].getKey()]=!0}for(var h in b)if(!d[h]){var i=b[h].feed;a.removeFeed(i),TD.storage.feedController.remove(i.getKey())}},a.deleteChirp=function(a){for(var c in b)b[c].removeChirp(a)},a.deleteWhere=function(a,c){var d,e;for(var f in b)d=b[f],e=d.feed.getType(),(!c||e==="home"||e==="networkactivity")&&d.removeWhere(a)},a.deleteUserChirps=function(b,c,d){b=b.toLowerCase();var e=function(a){try{var d=a.getCreator&&a.getCreator();return d&&d.screenName.toLowerCase()===b&&a.account.getUserID()==c}catch(e){}return!1};a.deleteWhere(e,d)},a.deleteFeedsWhere=function(a){var b=TD.storage.clientController.client.getColumnOrder(),c,d,e,f,g;for(f=0;f<b.length;f++){c=TD.controller.columnManager.get(b[f]),d=c.getFeeds();for(g=d.length-1;g>=0;g--)e=d[g],a(e)&&(TD.storage.feedController.remove(e),c.removeFeed(e));c.getFeedCount()===0&&TD.controller.columnManager.deleteColumn(c.model.getKey())}},a.replaceFeed=function(b,c){_.each(TD.controller.columnManager.getAll(),function(a){a.removeFeed(b)>0&&a.addFeed(c)}),a.cleanupFeeds()},a.fixListFeeds=_.debounce(_.once(function(){var a=function(a,b){var c=TD.storage.feedController.getOrCreateFeed(a.getType(),a.getService(),a.getAccountKey(),{listId:b.id,ownerId:b.user.id});TD.controller.feedManager.replaceFeed(a,c)},b=[],c=TD.storage.feedController.getAll();c=_.filter(c,function(a){var b=a.getType(),c=a.getMetadata();if(a.getType()==="list")if(!c.listId||!c.ownerId)return!0;return!1}),_.each(c,function(c){var d=c.getMetadata(),e=TD.cache.lists.find(null,d.screenName,d.slug);e?a(c,e):b.push(c)}),_.each(b,function(b){var c=TD.controller.clients.getClient(b.getAccountKey()),d=b.getMetadata(),e=function(c){a(b,c)},f=function(){};c.getList(null,d.screenName,d.slug,e,f)})}),5e3),a.isStreaming=function(a){var b=this.getPoller(a),c=!1,d,e;return b&&(d=b.feed,e=TD.controller.clients.getClient(d.getAccountKey()),c=e.feedIsStreaming(a)),c},a}(),TD.controller.progressIndicator=function(){function l(){var c,e=[];_.each(k,function(c){switch(c.state){case d:e.push({message:TD.i("Failed: {{1}}",{1:c.message})});break;case a:e.push({message:TD.i("Success: {{1}}",{1:c.message})});break;case b:case f:e.push({message:c.message})}});if(e.length>0){var g=TD.ui.template.render("topbar/alert_message",{messages:e});i.html(g)}else m()}function m(){i.find(".alrt-message").fadeOut("fast",function(a){i.empty(),k={}})}var a="complete",b="working",c="ok",d="failed",e="warning",f="message",g=7e3,h=3e3,i=$("#action-messages"),j={},k={};return i.on("click",".js-dismiss",m),j.addTask=function(a){var c=_.uniqueId("msg_");return k[c]={message:a,state:b,timeout:null},l(),c},j.addMessage=function(a){var b=_.uniqueId("msg_"),c={message:a,state:f,timeout:null};return c.timeout=setTimeout(function(){j.deleteTask(b)},g),k[b]=c,l(),b},j.deleteTask=function(a){delete k[a],l()},j.taskComplete=function(b,c){var d=k[b];d&&(d.state=a,d.message=c||d.message,d.timeout=setTimeout(function(){j.deleteTask(b)},h),l())},j.taskFailed=function(a,b){var c=k[a];c&&(c.state=d,c.message=b||c.message,c.timeout=setTimeout(function(){j.deleteTask(a)},g),l())},j.changeMessage=function(a,b){var c=k[a];c&&(c.message=b,l())},j}(),TD.controller.notifications=function(){var a=500,b={},c,d=!1,e,f=[],g={},h=!1,i,j=window.webkitNotifications,k=!1,l="growl",m="webkit",n=function(b,d){var j=[];if(b.model.getHasNotification()&&k)for(var n=0;n<d.length;n++){var q=d[n];if(q.isOwnChirp())continue;if(q.ids&&q.ids.length>1)continue;var r=g[q.id];if(r)p(b.type)>p(r.columnType)&&(r.columnKey=b.model.getKey(),r.columnTitle=b.model.getTitle(),r.columnType=b.model.getType(),r.accountKey=q.account.getKey());else{var s={chirpID:q.id,accountKey:q.account.getKey(),columnKey:b.model.getKey(),columnTitle:b.model.getTitle(),columnType:b.model.getType()};if(k===l){var t=q.getGrowlData();if(!t)continue;t.img=t.img||"/web/assets/logos/32.png",_.extend(s,t)}else if(k===m){s.html=q.renderNotification();if(!s.html)continue}j.push(s),g[d[n].id]=s}}e?c.port.postMessage({updates:j}):(h=h||b.model.getHasSound(),f=f.concat(j),!i&&(f.length>0||h)&&(i=setTimeout(o,a)))},o=function(){i=null,h&&(TD.util.isWrapperApp()?deck.playSound("tweet.wav"):document.getElementById("update-sound").play(),h=!1);if(f.length!==0&&k)if(k===l){for(var a=0;a<Math.min(f.length,5);a++)s(f[a]);h=!1,g={},f=[]}else k===m&&(e=webkitNotifications.createHTMLNotification("/web/templates/notification.html"),e.onclose=b.reset,e.show())},p=function(a){switch(a){case"privateMe":return 5;case"direct":return 4;case"me":return 3;case"mentions":return 2;case"home":return 1;case"search":return-1;default:return 0}},q=function(a){var b=$("#"+a.info.columnKey),d=$('article[data-key="'+a.info.chirpID+'"]',b),e=!0,f=!0,g=!1;switch(a.action){case"retweet":$('a[rel="retweet"]',d).trigger("click");break;case"reply":g=!0,$('a[rel="reply"]',d).trigger("click");break;case"favorite":$('a[rel="favorite"]',d).trigger("click"),e=!1,f=!1;break;case"like":$('a[rel="like"]',d).trigger("click"),e=!1,f=!1;break;case"comments":g=!0,$('a[rel="comments"]',d).trigger("click");break;case"url":var h=window.open(a.href);h.focus();break;case"user":break;case"hashtag":TD.ui.accounts.showSearch("#"+a.text);break;case"showColumn":g=!0}e&&(TD.util.isChromeApp()?chrome.extension.getBackgroundPage().TD.bg.utils.showTDTab():TD.util.isWrapperApp()&&deck.showPrimaryWindow());if(g){var i=$("#container"),j=b.position(),k=j.left+b.width()/2-i.width()/2;$("#container").scrollLeft(k)}f&&c.port.postMessage("closeNotification")},r=function(){return TD.util.isWrapperApp()?!0:j.checkPermission()===0},s=function(a){var b=new Image;b.onload=function(){deck.doGrowl(a.title,a.text,b),delete b},b.src=a.img};return b.init=function(){if(!TD.settings.getShowStartupNotifications()){var a=(new Date).getTime();_.each(TD.storage.feedController.getAll(),function(b){var c=TD.storage.columnController.getColumnsContainingFeed(b.getKey()),d=Boolean(_.find(c,function(a){return a.getHasSound()||a.getHasNotification()}));d&&b.setLatestTime(a)})}TD.util.isWrapperApp()?deck.showNotification?k=m:k=l:j&&window.SharedWorker&&b.getPermission(),k===m&&b.setUpWorker()},b.hasNotifications=function(){return k!==!1},b.setUpWorker=function(){c=new SharedWorker("/web/scripts/unbundled/nfn_worker.js"),c.port.addEventListener("message",function(a){a.data==="ready"?(d=!0,c.port.postMessage({updates:f}),f=[]):a.data.action&&q(a.data)}),c.port.start()},b.newUpdates=function(a,b,c){var d=Boolean(TD.storage.feedController.get(b.getKey()));if(c.length===0||!d)return;n(a,c)},b.reRender=function(a){var b=g[a.id];if(b){var e=a.renderNotification();b.html=e,d&&c.port.postMessage({replaceID:a.id,accountKey:a.account.getKey(),html:e})}},b.getPermission=function(){r()?k=m:j.requestPermission(function(){r()&&(k=m,b.setUpWorker())})},b.reset=function(){e=null,g={},h=!1},b}(),TD.controller.stats=function(){var a={},b="app_open",c="ping",d="image_upload",e="post",f="retweet",g="button_click",h="spam",i="favourite",j="unfavourite",k="column_create",l="column_delete",m="webdeck-warning",n="webdeck-error",o="performance",p={INIT:"init",MAIN:"main_init",COLUMN_MANAGER:"column_manager_init",COLUMN_SCHEDULER:"column_scheduler_init",NOTIFICATIONS:"notifications_init",FILTER_MANAGER:"filter_manager_init",RENDER_TWEET:"render_tweet"},q="ver",r="tz",s="cl",t="twid",u="interval",v="oid",w="type",x="tsn",y="spam_uid",z="token",A="tw",B="fb",C="td",D=2,E=3,F=4,G=5,H=8,I=15,J=22,K=28,L=32,M=33,N=34,O=35,P=36,Q=37,R=38,S={home_timeline:E,mentions:D,search:F,list:J,direct:G,facebook:I,scheduled:K,privateMe:P,usertweets:L,networkactivity:R,interactions:Q,home:N,me:O,favorites:H,usertimeline:M},T="http://tracking.tweetdeck.com/track/",U,V,W,X=function(a){U.attr("src",a)},Y=function(){if(!W){var a=TD.storage.store.getTweetdeckAccount();a&&(W=TD.core.sha1(a))}return W},Z=function(a,b){var c=TD.storage.accountController.get(b),d={twitter:A,facebook:B},e;if(!c)return;e=d[c.getType()],a[e]=c.getUserID()},_=function(a,b){var c;b.v=2,b.cl=V,b.tz=0,b.f=TD.controller.feather.latestFeatherId;var d=Y();d&&(b.td=d),b.cache=Math.round(Math.random()*1e5),c=T+a+"?"+TD.net.util.urlencode(b),X(c)},ba=function(){var a=TD.storage.accountController.getPreferredAccount("twitter"),b=TD.storage.accountController.getPreferredAccount("facebook"),c={};return a&&(c[A]=a.getUserID()),b&&(c[B]=b.getUserID()),c},bb=function(a,b,c,d,e){a[A]=e,a[v]=c,a[t]=d,_(b,a)};return a.init=function(){U=$("#tracking_image"),V=TD.config.client_name+"-"+TD.util.getAppEnv(),a.appOpen(),setInterval(function(){a.ping()},9e5)},a.appOpen=function(){var a=ba();a[q]=TD.version,_(b,a)},a.ping=function(){var a=ba();a[u]="900",_(c,a)},a.favorite=function(a,b,c){bb({},i,a,b,c)},a.unfavorite=function(a,b,c){bb({},j,a,b,c)},a.retweet=function(a,b,c){bb({},f,a,b,c)},a.spam=function(a,b,c){var d=TD.core.sha1(String(c)),e={};e[x]=a,e[y]=b,e[z]=d,_(h,e)},a.addColumn=function(a){var b={};b[w]=S[a],_(k,b)},a.removeColumn=function(a){var b={};b[w]=S[a],_(l,b)},a.post=function(a){var b={};Z(b,a),_(e,b)},a.performance=function(){var a={},b=function(){return a[p.RENDER_TWEET]&&a[p.INIT]&&a[p.MAIN]&&a[p.COLUMN_MANAGER]&&a[p.COLUMN_SCHEDULER]&&a[p.FILTER_MANAGER]&&a[p.NOTIFICATIONS]};return{log:function(c,d){a[c]=d,b()&&(_(o,a),a={})},keys:p}}(),a.trackWebdeckProblem=function(a,b,c){var d={message:b,error:Boolean(a),data:c,useragent:navigator.userAgent,platform:navigator.platform},e=T+(a?n:m);$.ajax({url:e,method:"POST",body:JSON.stringify(d),error:function(a,b,c){console.log("Error logging error",a,b,c,d)}})},a}(),TD.controller.filterManager=function(){var a={},b=[],c=function(){var a=[];_.each(b,function(b){a.push(b.toBackendState())}),TD.settings.setGlobalFilter(a)};return a.init=function(){var c=TD.settings.getGlobalFilter();_.each(c,function(a){var c=new TD.vo.Filter;c.fromBackendState(a),b.push(c)}),a.reapplyAllFilters()},a.reapplyAllFilters=function(){_.each(TD.controller.columnManager.getAll(),function(a){a.reapplyFilters()})},a.pass=function(a,c,d,e){var f,g;c=c?c.toLowerCase():null,d=d?_.map(d,function(a){return a.toLowerCase()}):null,e=e?e.toLowerCase():null;for(f=0,g=b.length;f<g;f++)if(!b[f].pass(c,d,e))return!1;if(a)for(f=0,g=a.length;f<g;f++)if(!a[f].pass(c,d,e))return!1;return!0},a.getAll=function(a,c){return b},a.addFilter=function(d,e){b.push(new TD.vo.Filter(d,e,!1)),a.reapplyAllFilters(),c()},a.validateFilter=function(a,c){return!a||!c?!1:_.trim(c).length==0?!1:_.any(b,function(b){return b.type===a&&b.value===c})?!1:!0},a.removeFilter=function(d){var e;_.each(b,function(a,b){a.id===d&&(e=b)}),b.splice(e,1),a.reapplyAllFilters(),c()},a}(),TD.sync.util=function(a){var b={},c=0,d=2,e=4,f=8,g;_.isUndefined(console)?g={log:function(){return}}:g=console,b.maybe_log=function(a,b){var c=_.isUndefined(b)?1:b;TD.config.debug_level>=c&&g.log(a)},b.NotJsonable=function(a){_.extend(this,a),this.___=a.toString()},b.NotJsonable.prototype={};var h=function(a){g.log(_.map(a,function(a){if(_.isUndefined(a))return void 0;try{return JSON.parse(JSON.stringify(a))}catch(c){return new b.NotJsonable(a)}}))};return b.stateLog=function(){TD.config.debug_level>=d&&h(_.toArray(arguments))},b.verboseLog=function(){TD.config.debug_level>=e&&h(_.toArray(arguments))},b.warn=function(){TD.config.debug_level>=c&&g.log.apply(g,_.toArray(arguments))},b.trace=function(a,c){b.maybe_log("TRACE: "+a+": "+(c||""),1)},b.printStacktrace=function(){if(!TD.config.debug_menu)return;try{throw new Error("stack trace or gtfo")}catch(a){g.log(a.stack)}},b.getStack=function(){try{throw new Error("stack trace or gtfo")}catch(a){return TD.util.isChromeApp()?a.stack.split("\n").slice(2).join("\n"):""}},b.errmark=function(a,c){return a||(a=c,c="missing message"),g.log("---ERROR--->>>>>->>>>->>>->>->--"+c+"--<-<<--"),b.maybe_log(a),g.log(a.stack),a},b.assert=function(a,c,d){if(!a)throw g.log("------------------------------------------"),g.log(["ASSERT FAILURE",c,d]),b.printStacktrace(),g.log("------------------------------------------"),TD.sync.trace&&TD.sync.trace.assert(c,d),"AssertionError"},b.precondition=function(a,c,d){if(!a)throw g.log("------------------------------------------"),g.log(["PRECONDITION FAILURE",c,d]),b.printStacktrace(),g.log("------------------------------------------"),TD.sync.trace&&TD.sync.trace.assert("PRECONDITION "+c,d),"PreconditionAssertionError"},b._break=function(){g.log("you might want to set a breakpoint here ;-)")},b.warning=function(a){data=_.toArray(arguments).slice(1),g.log(["WARNING",a,b.pformat(data)]),TD.controller.stats.trackWebdeckProblem(!1,a,data)},b.error=function(a){data=_.toArray(arguments).slice(1),g.log(["ERROR",a,b.pformat(data)]),TD.controller.stats.trackWebdeckProblem(!0,a,data)},b.list_to_set=function(a){var b={};return _.each(a,function(a){b[a]=!0}),b},b.pprint=function(a){return b.maybe_log(JSON.stringify(a,null,"  "),d),a},b.pformat=function(a){return JSON.stringify(a,null,"  ")},b.repr=function(a){return JSON.stringify(a)},b.clone=function(a){if(a===null||_.isUndefined(a))return a;try{return JSON.parse(JSON.stringify(a))}catch(c){return b.stateLog("util.clone couldn't parse object",a,c),["<not jsonable>",a]}},b.dictMap=function(a,b,c){var d={};return _.each(_.map(a,b,c),function(a){d[a[0]]=a[1]}),d},b.stall=function(b,c){_.isUndefined(c)&&(c=0);var d=new a.Deferred;return _.delay(_.bind(d.callback,d),1e3*c,b),d},b.makeThingScheduler=function(c,d,e,g,h){var i=!1,j=!1;g=g||function(){return!0},h=_.isUndefined(h)?1:h;var k=[],l=function(){b.maybe_log(["_maybe_do_stuff",e,"want stuff done:",i,"am doing stuff:",j],f);if(!i){b.maybe_log("not doing stuff; someone else did stuff before us",f);return}if(j){b.maybe_log("am already doing stuff",f);return}j=!0,i=!1;var g=TD.controller.progressIndicator;if(d)var h=g.addTask(d);var m=a.maybeDeferred(c);m.addCallback(function(a){j=!1,d&&g.deleteTask(h);if(i)l();else{var b=k;k=[];for(var c=0;c<b.length;c++)try{b[c].callback(a)}catch(e){_.defer(_.bind(b[c].errback,b[c]),e)}}}),m.addErrback(function(a){b.errmark(a,'do_stuff for "'+e+'" yielded error when calling; '+c),j=!1,d&&g.taskFailed(h);var f=k;k=[];for(var i=0;i<f.length;i++)try{f[i].errback(a)}catch(l){_.defer(_.bind(f[i].errback,f[i]),l)}})};return function(c){if(!g())return b.maybe_log("not triggering (guarded): "+e,f),a.succeed();c=_.isUndefined(c)?h:c,b.maybe_log('trigger func called "'+e+'"',f),i=!0;var d=new a.Deferred;return k.push(d),setTimeout(l,c*1e3),d}},b}(TD.core.defer),TD.storage.store=function(a,b){var c={},d=null,e="TweetDeck",f=function(b){return b?b:d?d:(a.stateLog("store.getStorage(): no storage",[a.getStack()]),null)};c.getTweetdeckAccount=function(b){b=f(b);if(b){var c=b.getItem("tweetdeck_account");if(c){c=JSON.parse(c);if(c.email)return c.email;a.stateLog("store.getTweetdeckAccount(): tdacct invalid",c)}return null}},c.setTweetdeckAccount=function(b,c){c=f(c);if(!c)throw new Error("No storage given or configured");a.assert(b,"email must be given to set tweetdeck account");var d={email:b};c.setItem("tweetdeck_account",JSON.stringify(d))},b.isWrapperApp()&&!TD.config.suppress_keychain&&(c.getTweetdeckAccountAndPasshash=function(b){b=f(b);if(!b)return null;var d=b.getItem("tweetdeck_account");if(d){d=JSON.parse(d);if(d.email){var e=c.getSecret(d.email,b);e&&(d.passhash=TD.core.sha1(e));if(d.passhash)return d}a.stateLog("store.getTweetdeckAccountAndPassword(): invalid",d)}return null},c.setTweetdeckAccountAndPassword=function(b,d,e){e=f(e);if(!e)throw new Error("No storage given or configured");a.assert(b,"email must be given to set tweetdeck account"),c.storeSecret(b,d);var g={email:b};e.setItem("tweetdeck_account",JSON.stringify(g))},c.storeSecret=function(a,b){var d=deck.storePassword(a,e,b);if(deck.osname()==="windows"){var f=c.get("hoard");f[a]=d,c.set("hoard",f)}},c.getSecret=function(b,f){var g;if(deck.osname()==="windows"){if(_.isUndefined(f))a.assert(d!==null,"can't read hoard: storage is not set up!"),g=c.get("hoard");else{var h=f.getItem("hoard");if(h)g=JSON.parse(h);else return""}var i=g[b];return deck.getPassword(b,e,i)}return deck.getPassword(b,e)},c.deleteSecrets=function(a){if(deck.osname()==="osx")_.each(a,function(a){deck.deletePassword(a,e)});else{var b=c.get("hoard");_.each(a,function(a){delete b[a]}),c.set("hoard",b)}}),c.init=function(b,c){var e="pbTest";TD.sync.util.trace("store.init",JSON.stringify([b,c])),a.assert(!d,"Store must not be initialised already!"),b&&(d=localStorage);try{d.getItem("tweetdeck_account")}catch(f){a.stateLog("_storage not defined, falling back to sessionStorage",f),d=sessionStorage}try{d.getItem("tweetdeck_account")}catch(g){a.stateLog("_storage not defined, falling back to MemoryStore",g),d=new h}try{d.setItem(e,"1"),d.removeItem(e)}catch(g){if(g.code===DOMException.QUOTA_EXCEEDED_ERR&&d.length===0)d=new h;else throw g}c&&d.clear()},c.reset=function(){d=null},c.get=function(b){a.assert(d!==null,"can't read ("+b+") storage is not set up!");var c=d.getItem(b);try{return JSON.parse(c)||{}}catch(e){return console.log("ERROR: failed to parse store key ("+b+") value;"),console.log(c),console.log(e),c}},c.set=function(a,b){d.setItem(a,JSON.stringify(b))},c.size=function(){return d.length},c.remove=function(a){d.removeItem(a)},c.dumpAll=function(){_.each({local:localStorage,session:sessionStorage},function(a,b){console.log("--------------------------------",b,"storage");var c=a.length;for(var d=0;d<c;d++){var e=a.key(d);console.log(e,":");var f=a.getItem(e);try{TD.sync.util.pprint(JSON.parse(f))}catch(g){console.log("Not JSON:",f)}}}),console.log("------------------------------------------")},c.jsonDump=function(){var a={};return _.each({local:localStorage,session:sessionStorage},function(b,c){console.log("--------------------------------",c,"storage"),a[c]={};var d=b.length;for(var e=0;e<d;e++){var f=b.key(e);console.log(f,":");var g=b.getItem(f);a[c][f]=g}}),a},c.dbgCapture=function(a){var b={};_.isUndefined(a)&&(a=localStorage);var c=a.length;for(var d=0;d<c;d++){var e=a.key(d);console.log(e,":");var f=a.getItem(e);console.log(":",f),console.log("X",b),b[e]=f}return TD.core.base64.encode(JSON.stringify(b))},c.dbgImport=function(a,b){_.isUndefined(b)&&(b=localStorage);var c=JSON.parse(TD.core.base64.decode(a));_.each(c,function(a,c){b.setItem(c,a)})},c.storageKeys=function(a){var b=[],c=a.length;for(var d=0;d<c;d++)b.push(a.key(d));return b};var g="__upgrade__";c.stashUpgrade=function(a,b,c,d){a.setItem(g,JSON.stringify({from:b,to:c,data:d}))},c.getUpgradeState=function(){var a=d.getItem(g);return a===null&&d===sessionStorage&&(a=localStorage.getItem(g)),a===null?null:JSON.parse(a)},c.flushUpgradeState=function(){d===sessionStorage&&localStorage.getItem(g)!==null&&localStorage.removeItem(g),d.getItem(g)!==null&&d.removeItem(g)},c.recordVersion=function(a){var b=d.getItem("__version__");if(b!==null&&Number(b)!==a)throw new Error("Attempt to record wrong version number (curr "+b+")");d.setItem("__version__",a)};var h=function(){};return h.prototype.clear=function(){for(var a in this)this.hasOwnProperty(a)&&this.removeItem(a)},h.prototype.getItem=function(a){var b=null;return this.hasOwnProperty(a)&&(b=this[a]),b!==undefined?b:null},h.prototype.key=function(a){throw"MemoryStore.key not implemented"},h.prototype.removeItem=function(a){this.hasOwnProperty(a)&&delete this[a]},h.prototype.setItem=function(a,b){this[a]=b},c}(TD.sync.util,TD.util),TD.sync.trace=function(a){var b={},c=[];return b.record=function(){var b=(new Date).toLocaleTimeString();c.push([b].concat(_.toArray(arguments))),TD.config.debug_trace&&a.stateLog.apply(null,["-------- TRACE: "+b].concat(_.toArray(arguments))),TD.config.debug_menu||c.length>200&&c.splice(0,100)},b.request=function(a,c,d){b.record("request",a,d.type,c,_.clone(d))},b.response=function(a,c,d,e){b.record("response",a,c,_.clone(d),_.clone(e))},b.objInit=function(a,c,d){b.record("obj init",a,_.clone(c),_.clone(d))},b.manage=function(c,d){b.record("manage",c,d,a.clone(d.getStateForLocalstorage()))},b.update=function(a,c,d){b.record("update",a,c,_.clone(d))},b.push=function(c,d,e,f){b.record("push",c,d,_.clone(e),a.clone(f))},b.tsResults=function(a,c,d,e,f,g){b.record("t+s results",a,_.clone(c),_.clone(d),_.clone(e),_.clone(f),g)},b.tsResult=function(a,c,d,e,f,g){b.record("t+s result",a,_.clone(c),_.clone(d),e,_.clone(f),g)},b.conflicts=function(a,c,d,e,f){b.record("conflicts",a,_.clone(c),_.clone(d),_.clone(e),f)},b.conflict=function(a,c,d,e,f){b.record("conflict",a,_.clone(c),_.clone(d),_.clone(e),f)},b.assert=function(c,d){b.record("ASSERT",c,d,a.getStack())},b.clear=function(){c=[]},b.logDump=function(){var a="-------------------------------------------------------------";console.log(a+" TRACE dump "+a),_.each(c,function(a){console.log.call(console,a)}),console.log(a+"  END dump  "+a)},b.logSummarise=function(){var b="-------------------------------------------------------------";console.log(b+" TRACE dump "+b);var d=a.list_to_set(["obj init","update"]);_.each(c,function(a){d[a[1]]||console.log.call(console,a)}),console.log(b+"  END dump  "+b)},b}(TD.sync.util),TD.sync.tdapi=function(a,b,c,d){var e={},f=null,g=null,h=null,i=function(a,b){return"Basic "+d.encode(a+":"+b)},j=function(){if(!f)throw new Error("Not Logged In");return"X-TD-Session "+f};e.getAccounts=function(a){var b="/verify_user?accounts=true";return a&&(b="/verify_user?all=true"),e.drequest(b,e.getReq())};var k=function(a){return _.isUndefined(a.session)||(f=a.session),a},l=function(a){return f=null,a};e.login=function(a,b){var c="/login?session=true",d={type:"GET",headers:{Authorization:i(a,b)}},f=e.drequest(c,d,{});return f.addCallback(k),f},e.logout=function(){var a=e.drequest("/logout");return a.addCallback(l),a},e.isLoggedIn=function(){return Boolean(f)},e.loadSession=function(a,b){var c=null;a?c=a.get("_session"):b&&(c=JSON.parse(b.getItem("_session"))),c&&(f=c)},e.saveSession=function(a,b){f&&(a?a.set("_session",f):b&&b.setItem("_session",JSON.stringify(f)))},e.onAuthFail=function(a,b){g=b,h=a},e.createAccount=function(a,b,c,d){var f=TD.util.iso8601(new Date),g="/user"+TD.config.td_create_key+f,h=new window.jsSHA(g,"ASCII"),j=h.getHMAC(TD.config.td_create_secret,"ASCII","SHA-256","B64"),l="/user?session=true&mail_list=False",m={type:"PUT",headers:{Authorization:i(a,b),"x-td-sig":j,"x-td-timestamp":f,"x-td-create":TD.config.td_create_key}},n=e.drequest(l,m);return n.addCallback(k),n},e.Conflict=function(a){this.body=a};var m=new RegExp("^([^:]*): (.*)$"),n=function(a,b){_.isUndefined(b)&&(b={});var c=a.getAllResponseHeaders(),d=c.split("\r\n");return d.length==1&&(d=c.split("\n")),_.each(d,function(a){var c=a.match(m);c&&(b[c[1].toLowerCase()]=c[2])}),b};return e.drequest=function(d,f,i,k){var l=_.uniqueId(f&&f.reqid?"["+f.reqid+"]rq:":"rq:");a.stateLog("drequest",l,d,f);if(f===null||_.isUndefined(f))f=e.getReq();c.request(l,d,f),d.charAt(0)=="/"&&(d=TD.config.api_root+d);if(!_.startsWith(d,"http://")&&!_.startsWith(d,"https://"))return b.fail(new Error("Malformed url"));var m=function(c,d){var e=jQuery.ajax(c,d),f=new b.Deferred;return e.done(function(a,b,c){f.callback(c)}),e.fail(function(c,d,e){c.status===409?(a.assert(e==="Conflict","409 should be Conflict"),f.callback(c)):f.errback(new b.XMLHttpRequestError(c,e))}),f},o=m(d,f);o.reqid=l;var p=function(a){var b=a.req;if(b.status===401&&!k){var c=n(b);if(c["www-authenticate"]==="X-TD-Session"){if(g&&g.getTweetdeckAccountAndPasshash){var i=g.getTweetdeckAccountAndPasshash();if(i&&i.email&&i.passhash){var l=e.login(i.email,i.passhash);return l.addCallback(function(){return e.saveSession(g),f.headers.Authorization=j(),m(d,f)}),l.addErrback(function(){h&&h()}),l}}if(h)throw h(),a}}throw a};o.addErrback(p);var q=function(b,g){var h,j,k=function(b){if(b==="")return b;try{return JSON.parse(b)}catch(c){return _.isEmpty(b)||a.warn(["failed to json parse drequest response;",b,"for request",d,f]),b}},m;return b.status===409?m=new e.Conflict(k(b.responseText)):m=k(b.responseText),i&&n(b,i),i&&i.date&&TD.storage.notification.notify("/date",i.date),a.stateLog("drequest ret",l,d,m,b.getAllResponseHeaders().split("\n")),c.response(l,d,m,i),m};return o.addCallback(q,l),o},e.requestWithBody=function(a,b,c,d,f,g,h){var i=e.getReq({type:b,reqid:g,headers:f||{},data:JSON.stringify(c),contentType:"application/json"});return e.drequest(a,i,d,h)},e.getReq=function(a){var b={type:"GET",headers:{}};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b.headers.Authorization=j(),a&&a.method&&(b.type=a.method),b},e}(TD.sync.util,TD.core.defer,TD.sync.trace,TD.core.base64),TD.storage.notification=function(a){var b={},c=[],d=function(){var a=c.splice(0,c.length);_.each(a,function(a){if(a.topic)try{jQuery.publish(a.topic,a.args)}catch(b){console.log("FAILURE publishing event",a)}else a.d&&a.d.callback()})};return b.notify=function(a){var b=Array.prototype.slice.call(arguments,1);c.push({topic:a,args:b}),_.defer(d)},b.flush=function(){var b=new a.Deferred;return c.push({d:b}),_.defer(d),b},b}(TD.core.defer),TD.storage.StoredObj=function(a,b,c,d,e,f,g,h){function i(a){this.controller=a}return i.prototype.controller=null,i.prototype.managed=!1,i.prototype.stateCache=null,i.prototype.state=null,i.prototype.privateState=null,i.prototype.eventname="/storage/object",i.prototype._init=function(c,d){d?b.assert(c===null||_.isUndefined(c),"provide state or storedState"):c?b.assert(d===null||_.isUndefined(d),"provide state or storedState"):c||(c={}),h.objInit(this,c,d);if(d){this.state=d.state,this.privateState=d["private"],this.deltaQ=a.StoredDelta.deserialiseDeltas(d["ÎQ"]);if(_.isEmpty(this.deltaQ))this.stateCache=null;else{var e=!1;_.each(this.deltaQ,function(a){a.type==="init"&&(e=!0)}),e&&b.assert(_.isEqual(this.state,{}),"must have empty state if an initÎ in Q"),b.stateLog("rebuilding stateCache from ",this.state,"+",this.deltaQ),this.stateCache=a.StoredDelta.applyMultiple(this.deltaQ,this.state)}}else this.state={},this.privateState={},_.isEmpty(c)?(this.deltaQ=[],this.stateCache=null):(this.deltaQ=[new a.StoredDelta("init",c)],this.stateCache=_.clone(c)),b.verboseLog("StoredObj.init",this,c,this.deltaQ)},i.prototype.getApiid=function(){var a=this.getPrivate("apiid");return b.assert(a,"missing apiid",this),a},i.prototype.hasApiid=function(){return Boolean(this.getPrivate("apiid"))},i.prototype.setApiid=function(a){return h.update("set apiid",this,[a]),this.setPrivate("apiid",a)},i.prototype.getKey=function(){return this.getPrivate("key")},i.prototype.setKey=function(a){return this.setPrivate("key",a)},i.prototype._prepCache=function(){return this.stateCache===null&&(b.assert(this.deltaQ.length===0,"empty stateCache must coincide with empty ÎQ"),this.stateCache=_.clone(this.state)),this.stateCache},i.prototype.set=function(c,d){return h.update("set",this,[c,d]),b.assert(c!=="columns","you should be setting column_order, not columns"),this._prepCache(),this.deltaQ.push(new a.StoredDelta("set",c,d)),this.stateCache[c]=d,this.controller.saveToLocalStore(this),g.notify(this.eventname+"/change",this),this.controller.triggerPush()},i.prototype.setListPermutation=function(c,d){TD.config.debug_checks&&this.checkCache();var e=this.get(c);if(_.isEqual(d,e))return h.update("set null list permutation",this,[c,e,d]),b.stateLog("ignoring request to change list at",c),f.succeed();h.update("set list permutation",this,[c,e,d]);var i=a.StoredDelta.listPermutator(c,e,d);return b.verboseLog("set list permutation",e,"â",d,"Îs:",i),this.deltaQ=this.deltaQ.concat(i),this.stateCache=a.StoredDelta.applyMultiple(this.deltaQ,this.state),TD.config.debug_checks&&this.checkCache(),this.controller.saveToLocalStore(this),g.notify(this.eventname+"/change",this),this.controller.triggerPush()},i.prototype.listPrepend=function(b,c){h.update("list prepend",this,[b,c]);var d=this.get(b);return d||(d=[]),this._prepCache(),this.deltaQ.push(new a.StoredDelta("linsert",b,c,-1)),this.stateCache[b]=[c].concat(d),this.controller.saveToLocalStore(this),g.notify(this.eventname+"/change",this),this.controller.triggerPush()},i.prototype.listAppend=function(b,c){h.update("list append",this,[b,c]);var d=this.get(b);return d||(d=[]),this._prepCache(),this.deltaQ.push(new a.StoredDelta("linsert",b,c,d.length)),this.stateCache[b]=d.concat([c]),this.controller.saveToLocalStore(this),g.notify(this.eventname+"/change",this),this.controller.triggerPush()},i.prototype.listTruncate=function(b,c){h.update("list truncate",this,[b,c]);var d=this.get(b);return d||(d=[]),this._prepCache(),this.deltaQ.push(new a.StoredDelta("ltrunc",b,c)),d.length>c&&d.splice(c,d.length-c),this.stateCache[b]=d,this.controller.saveToLocalStore(this),g.notify(this.eventname+"/change",this),this.controller.triggerPush()},i.prototype.listRemove=function(b,c){h.update("list remove",this,[b,c]);var d=this.get(b)||[];return this._prepCache(),this.deltaQ.push(new a.StoredDelta("ldel",b,c)),this.stateCache[b]=_.without(d,c),this.controller.saveToLocalStore(this),g.notify(this.eventname+"/change",this),this.controller.triggerPush()},i.prototype.dictSet=function(b,c,d){h.update("dict set",this,[b,c,d]),this._prepCache();var e=_.clone(this.get(b));return this.deltaQ.push(new a.StoredDelta("hset",b,c,d)),e||(e={}),e[c]=d,this.stateCache[b]=e,this.controller.saveToLocalStore(this),g.notify(this.eventname+"/change",this),this.controller.triggerPush()},i.prototype.setPrivate=function(a,b){return this.privateState[a]=b,this.managed&&this.controller.saveToLocalStore(this),f.succeed()},i.prototype.getPrivate=function(a){return this.privateState[a]},i.prototype.immutableSet=function(a,c){var d=this.state[a];if(c!=d)throw b.warn("ERROR: attempt to change",a,"of",this,"from",d,"to",c),new Error("attempt to modify immutable field "+a);return f.succeed()},i.prototype.setValueIffDifferent=function(a,c,d,e){var h=this.get(a);return _.isEqual(h,c)?f.succeed(null):(b.verboseLog(this,"setValueIffDifferent",a,"from",h,"to",c),d&&g.notify(d,c,h,this),e&&e(c,h),g.notify(this.eventname+"/change",this),this.set(a,c))},i.prototype.get=function(a){return this.stateCache===null?this.state[a]:this.stateCache[a]},i.prototype.latestDelta=function(){return _.isEmpty(this.deltaQ)?null:this.deltaQ[this.deltaQ.length-1].id},i.prototype.getStateForLocalstorage=function(){return{"ÎQ":_.map(this.deltaQ,function(a){return a.serialise()}),"private":this.privateState,state:this.state}},i.prototype.getStateForBackend=function(){TD.config.debug_checks&&(b.precondition(this.isDirty(),"don't call getStateForBackend unless isDirty"),this.checkCache());var a=_.clone(this.stateCache!==null?this.stateCache:this.state);return!a.mtime&&this.state.mtime&&(a.mtime=this.state.mtime),{"Îid":this.latestDelta(),state:this.transformForRemote(a,this.privateState)}},i.prototype.postProcessNewRemoteState=function(){},i.prototype.newRemoteState=function(c){h.update("new remote state",this,c),TD.config.debug_checks&&(b.stateLog("checking cache"),this.checkCache()),b.verboseLog("transforming to local:",this,b.clone(c)),this.state=this.transformToLocal(c),this.deltaQ.length!==0?(b.assert(this.stateCache!==null,"if we have Îs, we should have cache"),b.verboseLog("applying pending deltas",this,b.clone(this.deltaQ)),this.stateCache=a.StoredDelta.applyMultiple(this.deltaQ,this.state)):b.assert(this.stateCache===null,"if no Îs, should have no cache"),this.postProcessNewRemoteState(),TD.config.debug_checks&&(b.stateLog("checking cache"),this.checkCache()),this.controller.saveToLocalStore(this),g.notify(this.eventname+"/change",this)},i.prototype.commit=function(c,d){h.update("commit",this,[c+" : "+d]);var e=_.pluck(this.deltaQ,"id").indexOf(c);if(e===-1)throw b.stateLog("asked to commit "+c+" but it doesn't exist in "+_.map(this.deltaQ,function(a){return a.toString()})),new Error("invalid deltaId supplied");TD.config.debug_checks&&this.checkCache();if(e===this.deltaQ.length-1)this.deltaQ=[],this.state=_.clone(this.stateCache),this.state.mtime=d,this.stateCache=null,TD.config.debug_checks&&this.checkCache();else{var f=this.deltaQ.splice(0,e+1),g=a.StoredDelta.applyMultiple(f,this.state);return this.state=g,this.state.mtime=d,TD.config.debug_checks&&this.checkCache(),this.controller.triggerPush()}},i.prototype.checkCache=function(){var c=a.StoredDelta.checkStateCache(this.state,this.deltaQ,this.stateCache);b.assert(c,"cache != state+Îs")},i.prototype.checkInvariants=function(){this.hasApiid()||b.assert(_.isEmpty(this.state),'must have no "state" if no apiid'),b.assert(this.state&&_.isUndefined(this.state.apiid),"apiid in non-priv state, bad"),this.isDirty()?(b.assert(!_.isEmpty(this.deltaQ),"deltaQ must be non-empty if dirty"),b.assert(this.stateCache!==null,"cache must be present if dirty"),this.checkCache(),this.hasApiid()&&b.assert(this.latestDelta()!==null,"latestDelta() must not return null for Îid for dirty object")):(b.assert(_.isEmpty(this.deltaQ),"deltaQ must be empty if not dirty"),b.assert(this.stateCache===null,"cache must be absent if not dirty"))},i.prototype.isDirty=function(){return this.hasApiid()?this.deltaQ.length!==0:(b.assert(this.deltaQ.length!==0,"should be dirty if no apiid"),!0)},i}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.storage.store,TD.util,TD.core.defer,TD.storage.notification,TD.sync.trace),TD.storage.StoredDelta=function(a,b,c,d,e,f){function g(b){this.type=b,a.assert(j[b]&&h,"unknown type "+b),this.args=_.toArray(arguments).slice(1),this.id="Î"+(new Date).getTime()+_.uniqueId(":"),i(b,this.args),b==="init"&&(a.verboseLog("initialisation delta",this.id,this.args[0]),"mtime"in this.args[0]&&(a.warn("WARNING init Î contains mtime!",a.clone(this.args[0])),a._break()))}var h={init:1,set:2,del:1,lmove:3,ldel:2,linsert:3,ladd:3,ltrunc:2,hset:3,other:0},i=function(b,c){var d=h[b];a.assert(c.length===d,"wrong no. args for "+b+", expected "+d+" got "+c.length);switch(b){case"ltrunc":a.assert(typeof c[1]=="number","ltrunc: length must be number");break;case"linsert":case"ladd":case"ldel":case"lmove":a.assert(typeof c[1]=="string","list elements must be strings")}};g.prototype.toString=function(){return"StoredDelta["+this.id+"]("+this.type+": "+JSON.stringify(this.args)+")"},g.prototype.serialise=function(){return[this.type].concat(this.args)};var j={init:function(b,c){if(!_.isEqual(b,{})){var d=a.clone(b),e=a.clone(c);delete d.mtime,delete e.mtime;if(_.isEqual(d,e))return a.warn("WARNING Î init_state === state",a.clone(b),"init:",c.mtime,"state:",b.mtime),b;a.warn("WARNING discarding init_state",a.clone(c),"in favour of",a.clone(b));return}return _.clone(c)},set:function(a,b,c){return a[b]=c,a},del:function(a,b){return delete a[b],a},lmove:function(a,b,c,d){var e=_.clone(a[b]),f=e.indexOf(c);if(f==-1)return;return e.splice(f,1),e.splice(f+d,0,c),a[b]=e,a},ldel:function(a,b,c){var d;return _.isUndefined(a[b])?d=[]:d=_.without(a[b],c),a[b]=d,a},linsert:function(a,b,c,d){var e;return _.isUndefined(a[b])?e=[]:e=_.clone(a[b]),e.splice(d,0,c),a[b]=e,a},ladd:function(a,b,c,d){if(_.include(a[b],c))return a;var e;return _.isUndefined(a[b])?e=[]:e=_.clone(a[b]),e.splice(d,0,c),a[b]=e,a},ltrunc:function(a,b,c){var d;return _.isUndefined(a[b])?d=[]:d=a[b],d.length>c&&d.splice(c,d.length-c),a[b]=d,a},hset:function(a,b,c,d){var e=_.clone(a[b]);return e||(e={}),e[c]=d,a[b]=e,a}};g.prototype.apply=function(b){var c=_.clone(b),d=j[this.type],e=d.apply(this,[c].concat(this.args));return e?e:(a.warn("WARNING: unable to apply Î",this.toString(),"to",a.clone(b)),_.clone(b))},g.listPermutator=function(b,c,d){var e=[],f=_.clone(c);a.verboseLog("StoredDelta.listPermutator",c,"â",d);if(c.length!=_.union(c).length||d.length!=_.union(d).length)throw a.stateLog("Duplicate error in listPermutator",{original:c,original_:_.union(c),target:d,targetu:_.union(d)}),new TypeError("lists must not contain duplicates");_.each(_.difference(c,d),function(a){e.push(new g("ldel",b,a)),f.splice(f.indexOf(a),1)});for(var h=0;h<d.length;h++)if(f[h]!=d[h]){var i=d[h],j=f.indexOf(i);j===-1?(e.push(new g("ladd",b,i,h)),f.splice(h,0,i)):(e.push(new g("lmove",b,i,h-j)),f.splice(j,1),f.splice(h,0,i))}return e},g.applyMultiple=function(a,b){return _.reduce(a,function(a,b){return b.apply(a)},b)};var k=function(a,b){function c(){return a.apply(this,b)}return c.prototype=a.prototype,new c};return g.deserialiseDeltas=function(a){return _.map(a,function(a){return k(g,a)})},g.checkStateCache=function(b,c,d){if(d===null&&c.length===0)return!0;ccache=_.clone(d),delete ccache.mtime;var e=g.applyMultiple(c,_.clone(b));return delete e.mtime,_.isEqual(ccache,e)?!0:(a.stateLog("cache",d,"!= goal",e,"for",b,"+",c),!1)},g}(TD.sync.util,TD.sync.tdapi,TD.storage.store,TD.util,TD.core.defer,TD.storage.notification),TD.storage.SobjController=function(a,b,c,d,e,f,g){var h=function(){var a=this;this._objects=null,this._objectsByApiid=null,this._localStorage=null,this.reqsinflight=null,this.apiEndpoint=null,this._localStorageKey=null};return h.prototype.toString=function(){return"<SobjController["+(this._localStorageKey||"unknown")+"]>"},h.prototype.triggerPush=function(){throw b.printStacktrace(),new Error("NotImplemented")},h.prototype.bindTrigger=function(c){var d=b.makeThingScheduler,e=a.store.getTweetdeckAccount;this.triggerPush=d(_.bind(this.pushDirty,this),c,c,e)},h.prototype.saveToLocalStore=function(a){var b=a.getKey();if(b&&this._objects[b]){var c=this._localStorage.get(this._localStorageKey);c[b]=a.getStateForLocalstorage(),this._localStorage.set(this._localStorageKey,c)}TD.config.debug_checks&&this.checkInvariants()},h.prototype.saveAll=function(){var a={};_.each(this._objects,function(b,c){a[c]=b.getStateForLocalstorage()}),this._localStorage.set(this._localStorageKey,a),TD.config.debug_checks&&this.checkInvariants()},h.prototype.remove=function(a){var b=this._objects[a];b&&(b.managed=!1,b.hasApiid()&&delete this._objectsByApiid[b.getApiid()]),delete this._objects[a],this.saveAll()},h.prototype.getAll=function(){return _.values(this._objects)},h.prototype.getByApiid=function(a){return b.assert(a,"must provide apiid; "+b.repr(a)),b.assert(a!="undefined","huh? where did that come from?"),this._objectsByApiid[a]},h.prototype.pushPreflight=function(){return f.succeed(null)},h.prototype.pushDirty=function(){TD.config.debug_checks&&this.checkInvariants();var a=_.uniqueId("pD:");g.push(this,"pushDirty",null,a);var b=this,c=this.pushPreflight();return c.addCallback(function(){var c=_.filter(b._objects,function(a){return a.isDirty()});if(_.isEmpty(c))return g.push(b,"(not dirty)",null,a),f.succeed();var d=b.pushObjects(c,a);return d.addCallback(function(){return b.pushDirty()}),d}),c},h.prototype.prePushCheckInvariants=function(a){return},h.prototype.pushObjects=function(a,d){b.verboseLog(this.toString()+".pushObjects()",this,a),d||(d=_.uniqueId("pO:")),g.push(this,"pushObjects",a,d),b.assert(this.apiEndpoint,"api endpoint must be set");if(_.isEmpty(a))return g.push(this,"(empty)",a,d),f.succeed([]);TD.config.debug_checks&&this.prePushCheckInvariants(a);var e=_.map(a,function(a){return a.getStateForBackend()}),h=_.pluck(e,"Îid"),i=_.pluck(e,"state");g.push(this,"objs+Îs",a,h,d),TD.config.debug_checks&&(_.each(i,function(a){b.assert(a.mtime||!a.id,"for a test and set request, we expect (require) either mtime (modify) or absence of id (create) for every object")}),_.isEmpty(this.reqsinflight)||(b.warn("WARNING! called pushObjects",a,"when already have requests in flight",b.clone(this.reqsinflight)),b._break()));var j={},k=c.requestWithBody(this.apiEndpoint,"POST",i,j,{"x-td-mtime-check":"partial"},d);if(TD.config.debug_checks){this.reqsinflight.push(k.reqid);var l=this;k.addBoth(function(a){return l.reqsinflight=_.without(l.reqsinflight,k.reqid),a})}return k.addCallbackWith(this,this._processTSResults,a,h,j,d),k},h.prototype._processTSResults=function(a,d,e,f,h){g.tsResults(this,a,d,e,f,h),a instanceof c.Conflict&&(g.conflicts(this,a.body,d,f,h),a=a.body),b.assert(a.length==d.length,"wrong number of responses/objects!"),b.assert(a.length==e.length,"wrong number of responses/deltas!"),b.verboseLog("objects",d,"deltas",e),_.each(e,function(a){b.assert(a!==null,"Îid must not be null")});var i=f["x-td-mtime"];b.assert(i,"require x-td-mtime header in object PUT");var j,k=this,l=function(a,c){b.verboseLog("_processTSResults:check_set_apiid",a,c),a.hasApiid()?b.assert(a.getApiid()==c,"apiid mismatch"):(k._objectsByApiid[c]=a,a.setApiid(c))};for(var m=0;m<a.length;m++)j=a[m],_.isString(j)?(b.verboseLog("_processTSResults",d[m],a[m]),l(d[m],a[m]),d[m].commit(e[m],i)):(g.conflict(this,j,d[m],f,h),b.verboseLog("_processTSResults: not an apiid:",j),d[m].newRemoteState(a[m]));this.saveAll()},h.prototype.pushObject=function(a,d){b.verboseLog(this.toString()+".pushObject()",this,a,d),g.push(this,"object",a);var e=a.getStateForBackend(),f=e["Îid"],h=e.state;b.assert(h.mtime,"for a test and set request, we expect (require) mtime");var i={},j=c.requestWithBody(d,"PUT",h,i,{"x-td-iff-mtime":h.mtime});return j.addCallbackWith(this,this._processTSResult,a,f,i),j},h.prototype._processTSResult=function(a,d,e,f){g.tsResult(this,a,d,e,f),b.verboseLog("object",d,"delta",e),b.assert(e!==null,"Îid must not be null");var h;if(a instanceof c.Conflict)b.verboseLog("_processTSResult: got a conflict:",a),h=d.newRemoteState(a.body);else{b.assert(_.isString(a),"don't know how to handle response");var i=f["x-td-mtime"];b.assert(i,"require x-td-mtime header in object PUT"),b.verboseLog("_processTSResult",d,a),h=d.commit(e,i)}return this.saveAll(),h},h.prototype.checkInvariants=function(){var c=this;_.each(this._objects,function(a){var d=a.checkInvariants;d&&d.call(a),a.hasApiid()&&b.assert(c._objectsByApiid[a.getApiid()],"all managed objects with apiid must be in _objectsByApiid")});var d=this._localStorage.get(this._localStorageKey);for(var e in d){var f=d[e],g=a.StoredDelta.deserialiseDeltas(f["ÎQ"]);_.isEmpty(g)||_.each(g,function(a){a.type==="init"&&b.assert(_.isEqual(f.state,{}),"must have empty state if an initÎ in Q")})}},h}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.storage.notification,TD.storage.store,TD.core.defer,TD.sync.trace),TD.storage.FeedController=function(a,b,c,d,e,f){var g=function(){var c=this;this.apiEndpoint="/feeds",this._localStorageKey="feeds",this._localStorage=null,this.reqsinflight=[],this.bindTrigger(),c._objects={},c._objectsByApiid={},this.toString=function(){return"<FeedController>"},this.init=function(c){b.trace("feedController init"),this._localStorage=c,TD.config.debug_checks&&this.checkInvariants();var d=this._localStorage.get(this._localStorageKey);for(var e in d){var f=new a.Feed(null,d[e]);f.managed=!0,this._objects[f.getKey()]=f,f.hasApiid()&&(this._objectsByApiid[f.getApiid()]=f)}TD.config.debug_checks&&this.checkInvariants()},this.reset=function(){this._objects={},this._objectsByApiid={}},this.updateFromBackend=function(c){var e=this;b.stateLog("feedController.updateFromBackend:",c),_.each(c,function(b,c){var f=e._objectsByApiid[c];f?(f.newRemoteState(b),d.notify("/storage/feed/updated",f)):(f=a.Feed.newFromBackendState(b),f.setApiid(c),e.manage(f),d.notify("/storage/feed/new",f))}),e.saveAll()},this.get=function(a){return this._objects[a]},this.manage=function(a){a.managed=!0;var d=this._objects[a.getKey()];return d&&a===d?(this.saveToLocalStore(a),c.triggerPush()):(d&&(b.warn("WARNING replacing feed",d,"with",a,"please use feedController.getOrCreateFeed",[b.getStack().split("\n")]),d.getLatestTime()>a.getLatestTime()&&b.warn("Warning: latestTime weirdness:",d.getLatestTime(),a.getLatestTime()),d.hasApiid()&&a.setApiid(d.getApiid()),d.isDirty()&&(!!_.isEmpty(d.deltaQ)||d.deltaQ[0].type!="init")&&b.assert(!d.isDirty(),"houston, we have a problem")),this._objects[a.getKey()]=a,a.hasApiid()&&(this._objectsByApiid[a.getApiid()]=a),this.saveToLocalStore(a),c.triggerPush())},this.manageFeeds=function(a){for(var b=0;b<a.length;b++)c.manage(a[b])},this._selfcheckapiids=function(){for(var a in this._objects){var b=this._objects[a];b.apiid&&_assert(b==c.getByApiid(b.apiid),"lookup failed")}},c.isEmpty=function(){return _.isEmpty(this._objects)},c.getOrCreateFeed=function(b,c,d,e,f){var g=a.Feed.generateKeyFor(d,b,e),h=this._objects[g];b==="list"&&(e.screenName=e.ownerId,e.slug=e.listId);if(!h){var i={type:b,service:c,accountkey:d,metadata:e,apiid:f};h=new a.Feed(i)}return f&&(h.apiid=f,this._objectsByApiid[f]=h),h}};return g.prototype=new a.SobjController,a.feedController=new g,g}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.storage.notification,TD.storage.store,TD.core.defer),TD.storage.ColumnController=function(a,b,c,d,e,f){var g=function(){var c=this;this.apiEndpoint="/columns",this._localStorageKey="columns",this._localStorage=null,this.reqsinflight=[],this.bindTrigger(),$.subscribe("/storage/account/new",function(a){c.addToCombinedColumns(a)}),this._objects={},this._objectsByApiid={},this.toString=function(){return"<ColumnController>"},this.init=function(c){b.trace("columnController init"),this._localStorage=c,TD.config.debug_checks&&this.checkInvariants();var d=this._localStorage.get(this._localStorageKey);for(var e in d){var f=new a.Column(null,d[e]);f.managed=!0,this._objects[f.getKey()]=f,f.hasApiid()&&(this._objectsByApiid[f.getApiid()]=f)}TD.config.debug_checks&&this.checkInvariants()},this.reset=function(){this._objects={},this._objectsByApiid={}},this.updateFromBackend=function(c){var e=this;b.stateLog("columnController.updateFromBackend:",c),_.each(c,function(b,c){var f=e._objectsByApiid[c];f?f.newRemoteState(b):(f=a.Column.newFromBackendState(b),f.setApiid(c),e.manage(f),d.notify("/storage/column/new",f))}),e.saveAll()},this.get=function(a){return this._objects[a]},this.getColumnsContainingFeed=function(a){var b=[];return _.each(this._objects,function(c){_.each(c.getFeedKeys(),function(d){d==a&&b.push(c)})}),b},this.getColumnsByType=function(a){return _.filter(this._objects,function(b){return b.getType()===a})},this.manage=function(a){return a.managed=!0,b.assert(a.getKey(),"columns must have valid keys to be managed!"),this._objects[a.getKey()]=a,a.hasApiid()&&(this._objectsByApiid[a.getApiid()]=a),this.saveToLocalStore(a),this.triggerPush()},this.remove=function(a){var b=this._objects[a];b&&(b.managed=!1),delete this._objects[a],c.saveAll()},this.getAll=function(){return _.values(this._objects)},this.getByApiid=function(a){b.assert(a,"must provide apiid; "+b.repr(a)),b.assert(a!=="undefined","huh? where did that come from?");var c=this._objectsByApiid[a];return c||(b.warn("WARNING: col ",a," not found in cols_by_apiid ",_.keys(this._objectsByApiid)),b.stateLog("this._objects, apiids; ",b.pformat(_.map(this._objects,function(a,b){return[b,a.getApiid()]})))),c},this.isEmpty=function(){return _.isEmpty(this._objects)},this._selfcheckapiids=function(){for(var a in this._objects){var b=this._objects[a];b.hasApiid()&&_assert(b==this.getByApiid(b.getApiid()),"lookup failed")}},this.addToCombinedColumns=function(c){b.stateLog("ADDING ACCOUNT TO COMBINED COLS",c);var d=a.clientController.client.getColumnOrder(),e,f={home:!0,me:!0,privateMe:!0},g,h,i,j,k,l=function(a){return a.getKey()};m:for(var n=0;n<d.length;n++){e=this.get(d[n]);if(!e){b.warn("Warning: Column not found!"),b._break();continue}g=e.getType();if(f[g]){j=null;switch(g){case"home":i=e.getFeedKeys();for(var o=0;o<i.length;o++){h=a.feedController.get(i[o]);if(h&&h.getService()===c.getType())continue m}j=this.getHomeFeeds([c]);break;case"me":j=this.getMeFeeds([c]);break;case"privateMe":j=this.getInboxFeeds([c])}j&&(k=_.map(j,l),e.setFeedKeys(e.getFeedKeys().concat(k)),e.managed&&a.feedController.manageFeeds(j))}}};var e=function(b,c){var d=a.feedController;return d.getOrCreateFeed(b,c.getType(),c.getKey(),{})};this.getHomeFeeds=function(a){var b=[];for(var c=0;c<a.length;c++)switch(a[c].getType()){case"twitter":case"facebook":b.push(e("home",a[c]))}return b},this.getMeFeeds=function(a){var b=[];for(var c=0;c<a.length;c++)switch(a[c].getType()){case"facebook":b.push(e("notifications",a[c]));break;case"twitter":b.push(e("mentions",a[c]))}return b},this.getInboxFeeds=function(a){var b=[];for(var c=0;c<a.length;c++)a[c].getType()==="twitter"&&b.push(e("direct",a[c]));return b},this.prePushCheckInvariants=function(c){_.each(c,function(c){_.each(c.getFeedKeys(),function(c){b.assert(a.feedController.get(c),"feeds must exist + be managed in columns push; "+c),b.assert(a.feedController.get(c).hasApiid(),"feeds must all have apiid in columns push; "+c)})})}};return g.prototype=new a.SobjController,g.prototype.pushPreflight=function(){return a.feedController.triggerPush(.05)},a.columnController=new g,g}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.storage.notification,TD.storage.store,TD.core.defer),TD.storage.AccountController=function(a,b,c,d,e){var f=function(){var f=this,g=864e5;this._localStorageKey="accounts",this._localStorage=null,this.reqsinflight=[],f.ACCEPTED_ACCOUNT_TYPES={twitter:!0,facebook:!0,bitly:!0},this._objects={};var h={};f.blacklistAccount=function(c){b.stateLog("blacklisting",c);var e=c.getKey();a.clientController.client.addToAccountBlacklist(e),this._objects[e]&&f.remove(e),a.clientController.client.delFromAccountWhitelist(e),d.notify("/storage/account/blacklisted",c)},f.whitelistAccounts=function(c){b.stateLog("whitelisting",c),a.clientController.client?_.each(c,function(b){a.clientController.client.addToAccountWhitelist(b.getKey()),a.clientController.client.delFromAccountBlacklist(b.getKey())}):b.warn("Can't update whitelist: client not initialised")},f.isEmpty=function(){return _.isEmpty(this._objects)},f.getDefault=function(){var b=a.clientController.client.getDefaultAccount();return b&&this._objects[b]?this._objects[b]:f.isEmpty()?null:(f.setDefault(f.getAll()[0].getKey()),this._objects[a.clientController.client.getDefaultAccount()])},f.setDefault=function(b){a.clientController.client.setDefaultAccount(b)},f.getAccountsForService=function(a){return _.select(this._objects,function(b){return b.getType()===a})},f.getPreferredAccount=function(a){var b=f.getDefault();return b&&(!a||b.getType()==a)?b:f.getAccountsForService(a)[0]},this.init=function(a){b.trace("accountController init"),this._localStorage=a;var c=this._localStorage.get(this._localStorageKey);c&&!_.isEmpty(c)&&this._localStorage.remove(this._localStorageKey),jQuery.subscribe("/storage/client/change",function(a){_.each(a.getAccountBlacklist(),function(a){f._objects[a]&&f.remove(a)})})},this.reset=function(){this._objects={}},this.triggerPush=function(){b.assert(!1,"triggerPush() should not be called on account controller")};var i=function(c,d){var e=b.list_to_set(d.settings.account_whitelist||[]),g=b.list_to_set(d.settings.account_blacklist||[]),i={},j=c||[],k=[],l=[];return _.each(j,function(b){var c=a.Account.generateKeyFor(b.service,b.uid);if(g[c])return;if(e[c]){if(!f.ACCEPTED_ACCOUNT_TYPES[b.service])return;i[b.service]=!0,k.push(b)}else{if(!f.ACCEPTED_ACCOUNT_TYPES[b.service])return;if(b.uid==1e3)return;if(b.service!=="facebook"&&b.service!=="bitly"&&(!b.key||!b.secret))return;if(b.service==="facebook"&&!b.token)return;if(b.service==="bitly"&&!b.key)return;l.push(b)}}),_.each(f.getAll(),function(a){g[a.getKey()]||(i[a.getType()]=!0)}),l.sort(f.accountComparator),l=_.select(l,function(b){var c=a.Account.generateKeyFor(b.service,b.uid);if(b.service==="twitter"||!i[b.service]){i[b.service]=!0;if(!f._objects[c])return!0}return!1}),h=_.map(l,function(b){return a.Account.newFromBackendState(b)}),k};this.updateFromBackend=function(c,d){b.stateLog("accountController.updateFromBackend:",c),c=i(c,d);var e=this;_.each(c,function(c){var d=a.Account.generateKeyFor(c.service,c.uid),f=e._objects[d];f?(b.stateLog("updating existing",f,"with",c),f.newRemoteState(c)):(b.stateLog("creating new Account with",c),f=a.Account.newFromBackendState(c),e.manage(f))})},this.get=function(a){return a==="tweetdeck"?{getKey:function(){return"tweetdeck"},getUserID:function(){return"tweetdeck"}}:this._objects[a]},this.manage=function(a){if(!a.getKey())throw{name:"TypeError",message:"account must have its .key set"};return a.managed=!0,this._objects[a.getKey()]||d.notify("/storage/account/new",a),this._objects[a.getKey()]=a,this.whitelistAccounts([a]),this.pushAccount(a)},this.saveToLocalStore=function(a){},this.saveAll=function(){},f.remove=function(a){var b=this._objects[a];b.managed=!1,delete this._objects[a],d.notify("/storage/account/removed",b)},f.getAll=function(){var a=_.values(this._objects);return a.sort(f.accountComparator),a},f.getPostingAccounts=function(){return _.filter(f.getAll(),function(a){return a.getType()!=="bitly"})},f.accountComparator=function(a,b){var c=a.getType?a.getType():a.service,d=b.getType?b.getType():b.service,e=a.getUserID?a.getUserID():a.uid,f=b.getUserID?b.getUserID():b.uid,g=c=="twitter"?2:1,h=d=="twitter"?2:1;return g<h?1:g>h?-1:g==2&&h==2?e>f?1:-1:c>d?1:-1},f.getDefaults=function(){var a=f.getAll(),b=f.getDefault(),c=[],d={};b&&(d[b.getType()]=!0,c.push(b));for(var e=0;e<a.length;e++)d[a[e].getType()]||(d[a[e].getType()]=!0,c.push(a[e]));return c},f.loginTweetdeck=function(a,d,e){b.stateLog("aC.loginTweetdeck()",a,d,e),d!==null&&(e=TD.core.sha1(d));var f=c.login(a,e);return f.addCallback(function(b){return{tweetdeck_account:{email:a,password:e,plaintext_password:d},data:b}}),f},f.createTweetdeckAccount=function(a,d){b.stateLog("aC.createTweetdeckAccount()",a,d);var e=TD.core.sha1(d),f=c.createAccount(a,e);return f.addErrback(b.errmark,"accountController.js:createTweetDeckAccount():->tdapi.createAccount()"),f.addCallback(function(){return{tweetdeck_account:{email:a,password:e,plaintext_password:d},data:{accounts:[]}}}),f.addErrback(b.errmark,"accountController.js:createTweetDeckAccount()"),f},f.pushAccounts=function(){return e.gatherResults(_.map(this._objects,function(a){return f.pushAccount(a)}))},f.pushAccount=function(a){if(!c.isLoggedIn())return;var b=a.getKey();if(!b||!this._objects[b])return;var d=a.getStateForBackend(),e="/accounts/"+a.getType()+"/"+a.getUserID();return c.requestWithBody(e,"POST",d)},f.deleteAccount=function(a){b.stateLog("sync.controller.deleteAccount:",a);var d="/accounts/"+a.getType()+"/"+a.getUserID();return c.drequest(d,c.getReq({method:"DELETE"}))},f.verifyStoredAccounts=function(){var a=!0,b=!1,c=[],d=(new Date).getTime()-g,i=f.getAll(),j=function(a,b){var c=TD.controller.auth.create(a.getType(),a),d=new e.Deferred;return c.verifyAccount(_.bind(d.callback,d),_.bind(d.errback,d)),b&&d.addErrback(function(){}),d.addCallback(function(){TD.storage.accountController.manage(a)}),d};return _.each(i,function(a){(b||!a.getUpdated()||a.getUpdated()<d||!a.getProfileImageURL()||!a.getUsername())&&c.push(j(a,!0))}),a&&(_.each(h,function(a){c.push(j(a,!1))}),h=[]),new e.DeferredList(c)}};return f.prototype=new a.SobjController,a.accountController=new f,f}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.storage.notification,TD.core.defer),TD.storage.ClientController=function(a,b,c,d,e,f,g,h){var i=function(){var c=this;this.apiEndpoint="/clients",_.defer(function(){var d=b.makeThingScheduler,e=a.store.getTweetdeckAccount;c.triggerPush=d(_.bind(c.pushIfDirty,c),null,"Syncing Client",e)}),this._localStorageKey="clients",this._localStorage=null,this.reqsinflight=[],this._objects={},this._objectsByApiid=this._objects,this.client=null,this.toString=function(){return"<ClientController>"},this.init=function(a){b.stateLog("client controller init start",this.client),b.trace("clientController init"),this._localStorage=a,this.loadFromStore(),TD.config.sync_name in this._objects?(this.client=this._objects[TD.config.sync_name],b.assert(this.client.getName(),"need name!"),b.stateLog("client controller new client:",this.client)):b.stateLog("no initial client state; deferring client creation"),b.stateLog("clientController.init: client: ",this.client)},this.reset=function(){this._localStorage=null,this.client=null},this.loadFromStore=function(){b.trace("clientController loadStore");var c=this._localStorage.get(this._localStorageKey);for(var d in c){var e=new a.Client(null,c[d]);e.managed=!0,this._objects[e.getName()]=e}},this.createNewClient=function(){b.stateLog("clientController.createNewClient()");var c=this,e={name:TD.config.sync_name,columns:[],settings:{}},f={},g=d.requestWithBody("/clients","POST",e,f);return g.addCallback(function(){b.stateLog("createNewClient resp headers; ",f);var d=f["x-td-mtime"];return b.assert(d,"require x-td-mtime header in client POST"),e.mtime=d,c.client=a.Client.newFromBackendState(e),b.assert(c.client.getName(),"Client should have name at this point"),c._objects[c.client.getName()]=c.client,b.stateLog("clientController.createNewClient with",c.client.state),c.triggerPush()}),g},this.updateFromBackend=function(d){this.client===null?(this.client=a.Client.newFromBackendState(d),this._objects[this.client.getName()]=this.client,b.stateLog("client controller (ufb) new client:",this.client)):this.client.newRemoteState(d),c.saveAll()},this.pushIfDirty=function(){TD.config.debug_checks&&this.checkInvariants(),h.push(this,"dirty",null);if(this.client.isDirty()){h.push(this,"dirty",this.client);var c=this,d=a.columnController.triggerPush();return d.addCallback(function(){return b.assert(c.client.isDirty(),"?!? push dirty, but not dirty"),c.pushObject(c.client,"/clients/"+c.client.getName())}),d.addCallback(function(){return c.pushIfDirty()}),d}return h.push(this,"not dirty",null),g.succeed()},this.saveToLocalStore=function(a){this.saveAll()}};return i.prototype=new a.SobjController,a.clientController=new i,i}(TD.storage,TD.sync.util,TD.util,TD.sync.tdapi,TD.storage.notification,TD.storage.store,TD.core.defer,TD.sync.trace),TD.storage.Feed=function(a,b,c,d,e){var f=function(a,b,c){this._init(a,b),_.isUndefined(c)||(this.state=this.transformToLocal(c)),this.setKey(f.generateKeyFor(this.getAccountKey(),this.getType(),this.getMetadata()))};return f.prototype=new a.StoredObj(a.feedController),f.prototype.eventname="/storage/feed",f.generateKeyFor=function(a,c,d){var e;b.assert(a,"accountkey not set in Feed.generateKey"),b.assert(c,"type not set in Feed.generateKey");switch(c){case"search":e=d.term;break;case"list":d.listId?e=d.listId:e=d.screenName+d.slug;break;case"group":case"page":e=d.id;break;case"favorites":e=d.id||"";break;case"usertimeline":case"usertweets":e=d.id;break;case"useractivity":e=d.screenName;break;default:e=""}return encodeURI(a+c+e)},f.prototype.getType=function(){return this.get("type")},f.prototype.setType=function(a){return this.immutableSet("type",a)},f.prototype.getService=function(){return this.get("service")},f.prototype.setService=function(a){return this.immutableSet("service",a)},f.prototype.getAccountKey=function(){return this.get("accountkey")},f.prototype.setAccountKey=function(a){return this.immutableSet("accountkey",a)},f.prototype.getLatestTime=function(){var a=this.get("marks");if(!a||_.isEmpty(a))return 0;var b=a[0];return b.last_notification||0},f.prototype.setLatestTime=function(a){var b=this.get("marks");return!b||_.isEmpty(b)?this.set("marks",[{last_notification:a}]):(b[0].last_notification=a,this.set("marks",b))},f.prototype.getMetadata=function(){return _.clone(this.get("metadata"))},f.prototype.setMetadata=function(a){return this.immutableSet("metadata",a)},f.prototype.transformForRemote=function(c,d){var e=a.accountController.get(c.accountkey);b.assert(e&&e.getUserID(),"must have acct + uid for feed transform");var f=e.getUserID(),g={type:c.type,service:c.service,account:{userid:f.toString()},metadata:JSON.stringify(c.metadata),marks:c.marks};return c.mtime&&(g.mtime=c.mtime),d.apiid&&(g.id=d.apiid),g},f.prototype.reprocessNotificationMarks=function(a,b){var c=null,d=null;b&&b.marks&&!_.isEmpty(b.marks)&&(c=b.marks[0].last_notification,d=b.marks);if(a.marks&&!_.isEmpty(a.marks)){d=a.marks;var e=a.marks[0].last_notification;c&&e?c=Math.max(c,e):e&&(c=e)}return d?d[0].last_notification=c:c?d=[{last_notification:c}]:d=[],d},f.prototype.transformToLocal=function(b){var c={type:b.type,service:b.service,accountkey:a.Account.generateKeyFor(b.service,b.account.userid),metadata:JSON.parse(b.metadata),mtime:b.mtime,marks:b.marks};return c},f.newFromBackendState=function(a){return new f(null,null,a)},f}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.storage.store,TD.util),TD.storage.Column=function(a,b,c,d,e,f){var g=function(a,b){this._init(a,b),this.privateState.key||(this.privateState.key="c"+(new Date).getTime()+_.uniqueId("s"))};g.prototype=new a.StoredObj(a.columnController),g.prototype.eventname="/storage/column",g.prototype.getTitle=function(){var a=this.get("title");return _.isUndefined(a)?"loadingâ¦":a},g.prototype.setTitle=function(a){return this.set("title",a)},g.prototype.getDescription=function(){return this.get("description")},g.prototype.setDescription=function(a){return this.set("description",a)},g.prototype.getType=function(){return this.get("type")},g.prototype.setType=function(a){return this.set("type",a)},g.prototype.getHasSound=function(){var a=this.get("settings");return Boolean(a&&a.has_sound)},g.prototype.setHasSound=function(a){return a=Boolean(a),f.notify("/storage/column/column_flags_changed","has_sound",a,this),this.dictSet("settings","has_sound",a)},g.prototype.getHasNotification=function(){var a=this.get("settings");return Boolean(a&&a.has_notification)},g.prototype.setHasNotification=function(a){return a=Boolean(a),f.notify("/storage/column/column_flags_changed","has_notification",a,this),this.dictSet("settings","has_notification",a)},g.prototype.getClearedTimestamp=function(){var a=this.get("settings");return a&&a.cleared_timestamp?a.cleared_timestamp:0},g.prototype.setClearedTimestamp=function(a){return f.notify("/storage/column/column_marks_changed","cleared_timestamp",a,this),this.dictSet("settings","cleared_timestamp",a)},g.prototype.getFeedKeys=function(){return this.get("feedkeys")},g.prototype.setFeedKeys=function(a){return this.setValueIffDifferent("feedkeys",_.isArray(a)?_.uniq(a.sort(),!0):a,"/storage/column/feeds_changed")};var h=["mtime","type","title","description","settings","position","bookmarks","filters"];return g.prototype.transformForRemote=function(c,d){var e=function(c){var d=a.feedController.get(c);return b.assert(d&&d.hasApiid(),"feeds must have apiid when transforming column for remote"),d.getApiid()},f={};return _.each(h,function(a){f[a]=c[a]}),f.feeds=_.map(c.feedkeys,e),c.mtime&&(f.mtime=c.mtime),d.apiid&&(f.id=d.apiid),f},g.prototype.transformToLocal=function(c){TD.config.debug_checks&&_.each(c.feeds,function(d){b.assert(a.feedController.getByApiid(d),"feed not found by apiid in "+b.pformat(c.feeds))});var d={};return _.each(h,function(a){d[a]=c[a]}),d.feedkeys=_.map(c.feeds,function(b){return a.feedController.getByApiid(b).getKey()}),d.apiid=c.id,d},g.newFromBackendState=function(a){var b=new g;return b.newRemoteState(a),b},g}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.storage.store,TD.util,TD.storage.notification),TD.storage.Account=function(a,b,c,d,e){var f={oauth_token:"t",token_secret:"s"},g=function(c,d){d?(b.assert(c===null||_.isUndefined(c),"must provide either state or storedState"),this.privateState=_.clone(d["private"]),this.state=_.clone(d.state)):c?(b.assert(d===null||_.isUndefined(d),"must provide either state or storedState"),this.state=_.clone(c),this.privateState={}):c||(this.state={},this.privateState={});var e=this,f=function(){e.controller.pushAccount(e)},g=a.store.getTweetdeckAccount;this.triggerPush=b.makeThingScheduler(f,null,null,g,.2)};g.prototype=new a.StoredObj(a.accountController),g.prototype.eventname="/storage/account",g.generateKeyFor=function(a,b){return a==="tweetdeck"?"tweetdeck":encodeURI(a+":"+b)},g.prototype.computeKey=function(){if(!this.getType()||!this.getUserID())throw{name:"NotReadyError",message:"cannot computeKey on account; insufficient data"};this.setKey(g.generateKeyFor(this.getType(),this.getUserID()))},g.prototype.set=function(a,b){return this.state[a]=b,this.controller.saveToLocalStore(this),c.notify(this.eventname+"/change",this),this.triggerPush()},g.prototype.checkInvariants=function(){b.assert(_.isEmpty(this.deltaQ),"Accounts must not have Îs"),b.assert(this.stateCache===null,"Accounts do not use stateCache")},g.prototype.getUsername=function(){return this.get("username")},g.prototype.setUsername=function(a){return this.set("username",a)},g.prototype.getName=function(){return this.get("name")},g.prototype.setName=function(a){return this.set("name",a)},g.prototype.getUserID=function(){return this.get("userId")},g.prototype.setUserID=function(a){return this.set("userId",a)},g.prototype.getType=function(){return this.get("type")},g.prototype.setType=function(a){return this.set("type",a)},g.prototype.getOAuthToken=function(){return this.get("oauth_token")},g.prototype.setOAuthToken=function(a){return this.set("oauth_token",a)},g.prototype.getTokenSecret=function(){return this.get("token_secret")},g.prototype.setTokenSecret=function(a){return this.set("token_secret",a)},g.prototype.getProfileImageURL=function(){return this.get("profileImageURL")},g.prototype.setProfileImageURL=function(a){return this.set("profileImageURL",a)},g.prototype.getIsPrivate=function(){return this.getPrivate("isPrivate")},g.prototype.setIsPrivate=function(a){return this.setPrivate("isPrivate",a)},g.prototype.getUpdated=function(){return this.getPrivate("updated")},g.prototype.setUpdated=function(a){return this.setPrivate("updated",a)},g.prototype.getStateForBackend=function(){var a=this.getType(),b={secret:this.getTokenSecret(),screen_name:this.getUsername(),name:this.getName(),avatar:this.getProfileImageURL()};return a==="facebook"?b.token=this.getOAuthToken():b.key=this.getOAuthToken(),b};var h={key:"oauth_token",token:"oauth_token",secret:"token_secret",screen_name:"username",service:"type",uid:"userId",avatar:"profileImageURL"};return g.prototype.newRemoteState=function(a){var c=this;b.stateLog(this,".updateFromBackend(",a,")"),_.each(h,function(b,d){a[d]&&c.set(b,a[d])}),this.getType()==="facebook"&&!this.getProfileImageURL()&&this.setProfileImageURL("http://graph.facebook.com/"+this.getUserID()+"/picture")},g.newFromBackendState=function(a){var b=new g;return b.newRemoteState(a),b.computeKey(),b},g}(TD.storage,TD.sync.util,TD.storage.notification,TD.util,TD.core.base64),TD.storage.Client=function(a,b,c,d,e,f,g,h){var i=4,j=function(a,c){b.trace("Client constructor:"),b.stateLog("Client constructor: ",a);var d=a&&a.column_order;d&&!_.isEqual(d,_.union(d))&&(b.warn("WARNING! removing duplicates in column_order",_.clone(d)),a.column_order=_.union(d)),b.assert(!a||!a.columns,'"columns" should not be in local client state'),this._init(a,c),this.managed=!0,TD.config.debug_checks&&this.checkInvariants()};j.prototype=new a.StoredObj(a.clientController),j.prototype.eventname="/storage/client",j.prototype.recent_searches_limit=i,j.prototype.getName=function(){return this.get("name")},j.prototype.getApiid=function(){return this.get("name")},j.prototype.hasApiid=function(){return!0},j.prototype.getColumnOrder=function(){return _.clone(this.get("column_order")||[])},j.prototype.setColumnOrder=function(a){_.each(a,function(a){b.precondition(typeof a=="string","must provide string column keys")});var c=this.get("column_order");if(!_.isEqual(a,_.union(a)))throw b.warn("ERROR: column_order contains duplicates:",a),new Error("column_order must not contain duplicates");return f.notify("/storage/client/column_order_changed"),this.setListPermutation("column_order",a)},j.prototype.removeColumn=function(a){return f.notify("/storage/client/column_order_changed"),this.listRemove("column_order",a)},j.prototype.appendColumn=function(a){return f.notify("/storage/client/column_order_changed"),this.listAppend("column_order",a)},j.prototype.getAccountBlacklist=function(){return _.clone(this.get("account_blacklist")||[])},j.prototype.addToAccountBlacklist=function(b){var c=this.get("account_blacklist")||[];if(_.include(c,b))return g.succeed(null);var d=this.listAppend("account_blacklist",b);return f.notify("/storage/client/account_blacklist_changed",c,this.get("account_blacklist"),this),a.accountController.remove(b),d},j.prototype.delFromAccountWhitelist=function(a){var b=this.get("account_whitelist")||[];if(!_.include(b,a))return g.succeed(null);var c=this.listRemove("account_whitelist",a);return f.notify("/storage/client/account_whitelist_changed",b,this.get("account_whitelist"),this),c},j.prototype.addToAccountWhitelist=function(a){var b=this.get("account_whitelist")||[];if(_.include(b,a))return g.succeed(null);var c=this.listAppend("account_whitelist",a);return f.notify("/storage/client/account_whitelist_changed",b,this.get("account_whitelist"),this),c},j.prototype.delFromAccountBlacklist=function(a){var b=this.get("account_blacklist")||[];if(!_.include(b,a))return g.succeed(null);var c=this.listRemove("account_blacklist",a);return f.notify("/storage/client/account_blacklist_changed",b,this.get("account_blacklist"),this),c},j.prototype.getAccountWhitelist=function(){return _.clone(this.get("account_whitelist"))},j.prototype.getDefaultAccount=function(){return this.get("default_account")},j.prototype.addRecentSearch=function(a){return g.gatherResults([this.listRemove("recent_searches",a),this.listPrepend("recent_searches",a),this.listTruncate("recent_searches",this.recent_searches_limit)])},j.prototype.getRecentSearches=function(){return this.get("recent_searches")||[]},j.prototype.postProcessNewRemoteState=function(){var a=this.getColumnOrder(),c=_.union(a);_.isEqual(c,a)||(b.warn("WARNING! found duplicates in column order, collapsing",a),this.state.column_order=c)},j.prototype.setDefaultAccount=function(a){return b.assert(!_.isUndefined(a),"huh? you wanted to do what now?"),this.setValueIffDifferent("default_account",a,"/storage/client/default_account_changed")};var k=["account_blacklist","account_whitelist","default_account","settings","recent_searches"];return j.prototype.transformForRemote=function(c,d){b.stateLog("Client.transformToLocal L",c);var e={};_.each(k,function(a){c[a]&&(e[a]=c[a])});var f={settings:e,name:c.name};return f.columns=_.map(c.column_order||[],function(c){var d=a.columnController.get(c);return b.assert(d.hasApiid(),"Column "+c+" does not have apiid",d),d.getApiid()}),c.mtime&&(f.mtime=c.mtime),b.stateLog("Client.transformToLocal R",f),f},j.prototype.transformToLocal=function(c){b.stateLog("Client.transformToLocal R",c);var d={},e=!1;d.column_order=_.filter(_.map(c.columns,function(d){if(!d)return b.warn("WARNING: bogus data in rstate.columns!",b.pformat(c.columns)),null;var f=a.columnController.getByApiid(d);return f||(b.stateLog("allocating new empty local sColumn for",d),f=new a.Column,f.setApiid(d),a.columnController.manage(f),e=!0),f.getKey()}),Boolean),e&&TD.sync.controller.ueberpull();var f=c.settings||{};return _.each(k,function(a){f[a]&&(d[a]=f[a])}),d.mtime=c.mtime,d.name=c.name,b.stateLog("Client.transformToLocal L",d),d},j.prototype.setApiid=function(a){b.assert(!1,"no-one should ever set apiid on Client")},j.newFromBackendState=function(a){var b=new j;return b.newRemoteState(a),b},j}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.storage.store,TD.util,TD.storage.notification,TD.core.defer,TD.sync.trace),TD.settings=function(a,b){function t(a,c){return b.notify(e+a,c),f.dictSet("settings",a,c)}function u(a){var b=f.get("settings"),c=void 0;return b&&(c=b[a]),_.isUndefined(c)&&(c=d[a]),c}var c={},d={},e="/storage/client/settings/",f,g="use_stream",h="use_notification_sound",i="language",j="check_for_updates",k="show_inline_media",l="use_narrow_columns",m="scheduled_col_autoadded",n="link_shortener",o="use_jmp",p="image_service",q="global_filter",r="previous_splash_version",s="show_startup_notifications";return c.linkShorteners=[{id:"twitter",title:"Twitter"},{id:"bitly",title:"Bit.ly"}],c.imageServices=[{id:"twitter",title:"Twitter"},{id:"yfrog",title:"yfrog"},{id:"twitpic",title:"Twitpic"},{id:"mobypicture",title:"Mobypicture"},{id:"twitgoo",title:"Mobypicture"},{id:"imgly",title:"Img.ly"}],c.displayNames=[{id:"realname",title:"Real Name"},{id:"username",title:"Username"}],c.init=function(){f=a.clientController.client},d[g]=!0,c.getUseStream=function(){return Boolean(u(g))},c.setUseStream=function(a){return t(g,Boolean(a))},d[h]=!0,c.getUseNotificationSound=function(){return Boolean(u(h))},c.setUseNotificationSound=function(a){return t(h,Boolean(a))},c.getLanguage=function(){return String(u(i))},c.setLanguage=function(a){return t(i,String(a))},d[j]=!0,c.getCheckForUpdates=function(){return Boolean(u(j))},c.setCheckForUpdates=function(a){return t(j,Boolean(a))},d[k]=!0,c.getShowInlineMedia=function(){return Boolean(u(k))},c.setShowInlineMedia=function(a){return t(k,Boolean(a))},d[l]=!1,c.getUseNarrowColumns=function(){return Boolean(u(l))},c.setUseNarrowColumns=function(a){return t(l,Boolean(a))},d[n]="twitter",c.getLinkShortener=function(){return String(u(n))},c.setLinkShortener=function(a){return t(n,String(a))},d[o]=!1,c.getUseJmp=function(){return Boolean(u(o))},c.setUseJmp=function(a){return t(o,Boolean(a))},d[p]="twitter",c.getImageService=function(){return String(u(p))},c.setImageService=function(a){return t(p,String(a))},c.getGlobalFilter=function(){return u(q)},c.setGlobalFilter=function(a){return t(q,a)},d[s]=!0,c.getShowStartupNotifications=function(){return Boolean(u(s))},c.setShowStartupNotifications=function(a){return t(s,Boolean(a))},d[m]=!1,c.getScheduledColAdded=function(){return Boolean(u(m))},c.setScheduledColAdded=function(a){return t(m,Boolean(a))},d[r]="0",c.getPreviousSplashVersion=function(){return u(r)},c.setPreviousSplashVersion=function(a){return t(r,String(a))},c}(TD.storage,TD.storage.notification),TD.storage.upgrade=function(a,b,c,d){var e={};e.CURRENT_VERSION=2,e.getVersion=function(a){var b=a.getItem("__version__");return b===null?e.guessVersion(a):Number(b)},e.guessVersion=function(a){var b=a.getItem("settings"),c=a.getItem("clients");if(c&&!b){c=JSON.parse(c);if(!_.isEmpty(c)){var d=_.values(c)[0];if("ÎQ"in d)return 2}}return!c&&b&&a.getItem("columns")?0:null},e.doUpgrade=function(a,b){_.isUndefined(b)&&(b=e.getVersion(a));if(b===0)return g(a);console.log("WARNING!: unable to determine upgrade steps for stored data!")},e.doMigration=function(){var b=a.store.getUpgradeState();if(b===null)return null;if(b.from!==0||b.to!==2)throw c.warn("Don't have code to migrate from",b.from,"to",b.to),new Error("Can't upgrade store (v"+b.from+"->v"+b.to+")");var d=h(b.data);a.store.flushUpgradeState()};var f=function(a,b,d){var e=a.getItem(b),f=e?JSON.parse(e):{};c.stateLog("updating",b,f);var g=c.dictMap(f,d);a.setItem(b,JSON.stringify(g))},g=function(c){console.log("Upgrading stored data to v2");var d={},e=c.getItem("settings"),f=e?JSON.parse(e):{},g={name:b.sync_name,column_order:f.column_order||[],settings:{}},h=f[":ACCOUNTS_BLACKLIST"];h&&(g.account_blacklist=_.keys(h));var i=c.getItem(":DEFAULT_ACCOUNT");i&&(g.default_account=JSON.parse(i)[0]),c.getItem(":SCHEDULED_COLUMN_AUTOADDED")==="true"&&(g.settings.scheduled_col_autoadded=!0),c.removeItem("settings"),_.each(["accounts","columns","feeds"],function(a){d[a]=JSON.parse(c.getItem(a)),c.removeItem(a)}),d.clients={},d.clients[b.sync_name]=g,a.store.stashUpgrade(c,0,2,d),_.each(_.select(a.store.storageKeys(c),function(a){return a&&a[0]===":"}),function(a){c.removeItem(a)});return},h=function(e){console.log("Migrating stashed data from v0 to v2"),c.stateLog("_migrateFromV0toV2",e);var f=a.clientController.client,g=[];_.each(e.feeds,function(b,d){var e=a.feedController.get(d);c.stateLog("migrating feed",d,b,"existing:",e);if(e){c.assert(e.getType()===b.type,"feed data problem"),c.assert(e.getService()===b.service,"feed data problem"),c.assert(e.getAccountKey()===b.accountkey,"feed data problem"),c.assert(_.isEqual(e.getMetadata(),b.metadata)||_.isEmpty(e.getMetadata())&&b.metadata==="","feed data problem");var f=e.getLatestTime();b.latestTime>f&&g.push(e.setLatestTime(b.latestTime))}else typeof b.metadata=="string"&&(b.metadata={}),e=a.feedController.getOrCreateFeed(b.type,b.service,b.accountkey,b.metadata),c.assert(e.getKey()===d,"feed data led to wrong feed key!"),g.push(a.feedController.manage(e))});var h=function(b,d){var e=_.map(d,function(b){return a.feedController.get(b)});switch(b){case"home":case"me":case"privateMe":case"scheduled":return b;case"usertweets":case"search":case"other":if(e[0].getType()==="search")return"s:"+e[0].getMetadata().term;if(e[0].getType()==="usertweets")return"ut:"+e[0].getMetadata().id;c._break();return;default:c._break();return}},i={};_.each(f.getColumnOrder(),function(b){var d=a.columnController.get(b),e=h(d.getType(),d.getFeedKeys());e&&!(e in i)&&(c.stateLog("capturing known column",d,"as",e),i[e]=d)});var j=[];_.each(e.columns,function(b,d){var e=h(b.type,b.feedkeys);if(e&&e in i){var f=i[e];c.stateLog("merging column",d,b,"into",f);var k=_.union(f.getFeedKeys(),b.feedkeys);g.push(f.setFeedKeys(k)),j.push(b.key)}else{c.stateLog("migrating column",d,b,"(creating new)");var l={feedkeys:b.feedkeys,title:b.title,type:b.type,settings:{has_notification:b.hasNotification,has_sound:b.hasSound}},m=new a.Column(l);m.setKey(d),e!==null&&(i[e]=m),g.push(a.columnController.manage(m))}}),_.each(e.accounts,function(b,d){var e=a.accountController.get(d);c.stateLog("migrating account",d,b,"existing:",e);if(!e){var f=["isDefault","oauth_token","profileImageURL","token_secret","type","userId","username"],h=["isPrivate","updated"],i={};_.each(f,function(a){a in b&&(i[a]=b[a])}),e=new a.Account(i),_.each(h,function(a){a in b&&e.setPrivate(a,b[a])}),e.computeKey(),c.assert(e.getKey()===d,"account data led to wrong account key!"),g.push(a.accountController.manage(e))}});var k=e.clients[b.sync_name];c.stateLog("client_state",k),_.each(k.account_blacklist,function(b){a.accountController.get(b)?g.push(f.addToAccountBlacklist(b)):c.warn("locally blacklisted account",b,"not present")}),k.default_account&&!f.getDefaultAccount()&&g.push(f.setDefaultAccount(k.default_account)),k.settings.scheduled_col_autoadded&&g.push(f.dictSet("settings","scheduled_col_autoadded",!0));var l=_.difference(k.column_order,j),m=_cols=_.difference(l,f.getColumnOrder());_.each(m,function(a){g.push(f.appendColumn(a))});var n=_.map(a.accountController.getAll(),function(a){return a.getKey()});return _.each(_.difference(n,f.getAccountWhitelist()),function(a){f.addToAccountWhitelist(a)}),a.store.recordVersion(2),d.gatherResults(g)};return e}(TD.storage,TD.config,TD.sync.util,TD.core.defer),TD.sync.controller=function(a,b,c,d){var e={};return e.PERSISTENT_STORAGE_ITEMS=["tweetdeck_account","_session","__hasAlreadyReloaded","hoard"],e.debugFlushAndReload=function(a,b){var c=TD.storage.store.getTweetdeckAccount(),d=c||localStorage.getItem("__debug_email__");sessionStorage.clear(),localStorage.clear(),d&&localStorage.setItem("__debug_email__",d),TD.util.isWrapperApp()&&deck.tearDown(),window.location.reload()},e.flushSyncDataAndReload=function(){var a={};_.each(e.PERSISTENT_STORAGE_ITEMS,function(b){var c=localStorage.getItem(b);c&&(a[b]=c)}),sessionStorage.clear(),localStorage.clear(),_.each(a,function(a,b){localStorage.setItem(b,a)}),TD.util.isWrapperApp()&&deck.tearDown(),window.location.reload()},e.debugInstallOldChromeData=function(){sessionStorage.clear(),localStorage.clear();var a=/^[a-zA-Z0-9\+\/=]*$/,b=TD.debug.spoof_data;b.match(a)&&(b=TD.core.base64.decode(b));var c=JSON.parse(b);_.each(c,function(a,b){localStorage.setItem(b,a)})},e.debugQueryRemote=function(a,c){var d=e.fetchAllBackendData();return d.addCallback(b.pprint),d},e.fetchAllBackendData=function(){var e=c.drequest("/accounts"),f=a.clientController,g=f.client&&f.client.getName()||TD.config.sync_name,h="/clients/"+g+"/all",i=c.drequest(h);i.addErrback(function(a){if(a.number==404){b.stateLog("Controller.fetchAllBackendData(): client didn't exist!");var d=f.createNewClient();return d.addCallback(function(){return c.drequest(h)}),d}return a});var j=new d.gatherResults([e,i]);return j.addCallback(function(a){var b;return b=a[1],b.accounts=a[0],b}),j},e.ueberpull=function(){b.trace("Ã¼berpull");var c=d.succeed();return c.addCallback(function(){return a.columnController.triggerPush(.05)}),c.addErrback(b.errmark,"d.Eb:triggerPush"),c.addCallback(function(){return e.fetchAllBackendData()}),c.addErrback(b.errmark,"d.Eb:fetchAllBackendData"),c.addCallback(function(b){a.accountController.updateFromBackend(b.accounts,b.client),a.feedController.updateFromBackend(b.feeds),a.columnController.updateFromBackend(b.columns),a.clientController.updateFromBackend(b.client)}),c.addErrback(b.errmark,"d.Eb:sync.controller.updateFromBackend"),c},e.initFromTdLogin=function(c){var f=d.succeed(c);return f.addCallback(e.init),f.addErrback(function(a){return b.warn("WARNING! sync.controller.init() failed",a),a}),f.addCallback(e.fetchAllBackendData),f.addErrback(function(a){return b.warn("WARNING! sync.controller get all sunc data failed",a),a}),f.addCallback(function(b){a.accountController.updateFromBackend(b.accounts,b.client),a.feedController.updateFromBackend(b.feeds),a.columnController.updateFromBackend(b.columns),a.clientController.updateFromBackend(b.client)}),f.addErrback(function(a){return b.warn("WARNING! sync.controller update all failed",a),a}),f.addCallback(a.upgrade.doMigration),f.addBoth(function(a){return b.stateLog("initFromTdLogin()->",a),a}),f},e.debuggery=function(){jQuery.subscribe("/storage/object/change",function(){b.warn("ERROR; untyped StoredObj change notification",_.toArray(arguments)),b._break()})},e.checkInvariants=function(){var b=[a.feedController,a.columnController,a.accountController,a.clientController];_.each(b,function(a){var b=a.checkInvariants;b&&b.call(a)})},e.init=function(c){b.trace("sync controller init"),e.store=c,e.debuggery(),a.feedController.init(c),a.columnController.init(c),a.accountController.init(c),a.clientController.init(c);var d=TD.config.sync_period;_.isUndefined(d)&&(d=600),e.loop=setInterval(e.ueberpull,d*1e3)},e.reset=function(){e.loop&&(clearInterval(e.loop),delete e.loop),a.columnController.reset(),a.feedController.reset(),a.accountController.reset(),a.clientController.reset()},e}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.core.defer),TD.sync.ui=function(a,b){var c={};return c.dispatch_ui_event=function(c){var d={flushreload:a.debugFlushAndReload,dumptrace:TD.sync.trace.logDump,cleartrace:TD.sync.trace.clear,queryremote:a.debugQueryRemote,ueberpull:a.ueberpull,junk:function(){console.log("junk fondled")}}[c];if(!d)alert('no handler for event "'+c+'"');else{var e;try{e=b.maybeDeferred(d)}catch(f){console.log(f);return}e.addCallback(function(a,b){util.stateLog('result for event "'+b+'": ',a)},c),e.addErrback(function(a,b){util.warn("ERROR for event",b,": ",a),console.log(a.stack)},c)}},c}(TD.sync.controller,TD.core.defer),TD.ui.template=function(){function h(a){var b;try{b=$.ajax(a,{async:!1,isLocal:TD.util.getAppEnv()!=="web"})}catch(c){return null}return b.status!==200?"":b.responseText}function i(f){f=f.replace(b,"/");var g=c[f];return g===undefined&&(g=a.getHogan(f),g=e.compile(g,d),c[f]=g),g}function j(a,b){var c=this.partials[a];return b=b||{},b[c.name]||(b[c.name]=i(c.name)),Hogan.Template.prototype.ep.call(this,a,b)}function k(a,b,c){var d=Hogan.parse.call(this,a,b,c),e="";for(var f=0;f<d.length;f++)if(d[f].tag==="_v"&&d[f].n.indexOf("%TRANSLATION-HINT")===0){var g=d.splice(f,1)[0];f--,e=g.n.substring(g.n.indexOf("mode=")+"mode=".length)}return l(d,e,b,c)}function l(a,b,c,d){var e=[];for(var f=0;f<a.length;f++)if(a[f].tag==="#"&&a[f].n==="_i"){var g=n(c.substring(a[f].i,a[f].end),b);g.tag==="raw"?e.push(g):Array.prototype.push.apply(e,Hogan.parse(Hogan.scan(g,d.delimiters),c,d))}else a[f].tag==="#"||a[f].tag==="^"?(a[f].nodes=l(a[f].nodes,b,c,d),e.push(a[f])):e.push(a[f]);return m(e)}function m(a){if(a.length===0)return a;var b=[a[0]];for(var c=1;c<a.length;c++)b[b.length-1].tag!=="_t"||a[c].tag!=="\n"&&a[c].tag!=="_t"?b.push(a[c]):b[b.length-1].text+=a[c].text||"\n";return b}function n(a,b){var c;return b!==""?c={text:a,mode:b}:c=a,TD.i(c,null,!0)}var a={},b=/\\/g,c={},d={sectionTags:[{o:"_i",c:"i"}]},e,f,g;return g=function(a,b,c,d){this.ep=j,Hogan.Template.call(this,a,b,c,d)},g.prototype=Hogan.Template.prototype,f=function(){},f.prototype=Hogan,e=new f,e.template=g,e.parse=k,a.getHogan=function(a){var b=TD.mustaches[a+".mustache"];return b===undefined&&(b=h("../mustaches/"+a+".mustache"),b===""&&(b=a),TD.mustaches[a+".mustache"]=b),b},a.render=function(a,b,c){var d=i(a);return d.render(b,c)},a.toHtml=function(a,b,c){var f=e.compile(a,d);return f.render(b,c)},a}(),TD.ui.startflow=function(a,b,c,d){function B(a){a.preventDefault();var b=$(a.currentTarget),c=b.data("action");switch(c){case"url":var d=window.open(b.attr("href"));d.focus();break;case"signin":D();break;case"showRegister":M(i);break;case"login":M(h);break;case"forgotPassword":C();break;case"resetReload":TD.sync.controller.debugFlushAndReload();break;case"spoofData":TD.sync.controller.debugInstallOldChromeData()}}function C(){if(w)return;var a=$("#tdRegEmail",m).val();if(!a||!a.match(f)){K([p],TD.i("Please enter a valid email address."));return}var b=new TD.services.TweetDeckClient;w=!0,K([p],TD.i("Sending password reset instructionsâ¦"));var c=b.forgotPassword(a);c.addCallback(function(){K([p],TD.i("We have sent an email to {{email}} with instructions to reset your password.",{email:a})),w=!1}),c.addErrback(function(){K([p],TD.i("Sorry, we could not send you reset instructions because something went wrong. Please try again later.")),w=!1})}function D(){var a=$("#tdRegEmail",m).val(),b=$("#tdRegPassword",m).val(),c=$("#tdRegRememberMe",m)[0].checked;E(a,b,c)}function E(a,b,d){if(a&&b!==""){M(j);var e=c.accountController.loginTweetdeck(a,b);e.addCallbacks(F,G,[d])}else M(h),K([q,p],TD.i("Please check your email & password."))}function F(a,b){a.stay_signed_in=b,z(),v.callback(a)}function G(a){M(h);var b,c=[];if(a.req.status===401)b=TD.i("Please check your password. Remember: TweetDeck accounts are different from Twitter accounts."),c=[q];else if(a.req.status===0)b=TD.i("Unable to connect. Please check your network.");else{var d;try{d=JSON.parse(a.req.responseText).error,b=TD.i("Unable to sign in: {{{1}}}",{1:d})}catch(e){b=TD.i("There was a problem signing in. Please try again in a moment."),console.log("An unknown error occurred at sign in"),console.log(a.req.responseText)}}A(a,c,b)}function H(){var a=$("#tdRegEmail",m).val(),b=$("#tdRegPassword",m).val(),c=$("#tdRegPasswordConfirm",m).val(),d=$("#tdRegRememberMe",m)[0].checked;if(!a||!a.match(f)){K([p],TD.i("Please use a valid email address."));return}if(b!==c){K([q],TD.i("Passwords must match!"));return}if(b.length<7){K([q],TD.i("Your password must be 7 characters or longer."));return}var e=I(a,b,d);e.addErrback(J),M(j)}function I(a,b,e){var f=c.accountController.loginTweetdeck(a,b);return f.addCallback(F,e),f.addErrback(function(){d.trace("register//login failed//going to try to create account");var f=c.accountController.createTweetdeckAccount(a,b);return f.addCallback(function(a){return a.created_account=!0,a}),f.addCallback(F,e),f}),f}function J(a){M(i),A(a,[q,p],TD.i("Registration unsuccessful. Please check your email & password"))}function K(a,b){b&&(n.text(b).show(),n.show()),a&&_.each(a,function(a){a.addClass("s-error")})}function L(){q.removeClass("s-error"),p.removeClass("s-error"),n.hide()}function M(a){k=a,L();switch(a){case h:t.fadeOut("fast"),$("#tdRegPasswordConfirm").attr("disabled",!0),r.attr("disabled",!1),l.addClass("s-login").removeClass("s-register s-loading");break;case i:t.fadeOut("fast"),$("#tdRegPasswordConfirm").attr("disabled",!1),s.attr("disabled",!1),l.addClass("s-register").removeClass("s-login s-loading");break;case j:t.fadeIn("fast"),r.attr("disabled",!0),s.attr("disabled",!0)}}var e={},f=/^[a-zA-Z0-9_\-\.+]+@[a-zA-Z0-9_\-\.]+\.[a-zA-Z]{2,4}$/,g=-1,h=0,i=1,j=2,k=g,l=$("#startflow-modal"),m=null,n,o,p,q,r,s,t,u="form-error",v=null,w;e.doLogin=function(b,c,d){v=new a.Deferred;try{x(b,c),y(),d&&K(null,d)}catch(e){var f="Unable to initialise login UI. Please contact your friendly dev team for assistance.";$("body").html(f),console.log("login UI init error:",[e]),TD.util.isChromeApp()&&console.log("stack trace:",[e.stack.split("\n")])}return v};var x=function(a,c){var d=localStorage.getItem("__debug_email__"),e={email:a||d||"",spoofData:Boolean(TD.debug.spoof_data),debugMenu:Boolean(TD.config.debug_menu),version:TD.version},f=b.render("startup/signin",e);$(".js-start-container",l).html(f),m=$("#startup-form"),n=$(".srt-error-msg",m),p=$(".js-email"),q=$(".js-password"),r=$(".js-signin"),s=$(".js-register"),t=$(".js-loader"),$("#tdRegRememberMe",m)[0].checked=Boolean(c),$("#tdAccountForm").submit(function(a){return k===h?D():H(),a.preventDefault(),!1}),$("a",m).live("click",B),m.live("keypress",function(a){a.keyCode==13&&$("tdAccountForm").submit()})},y=function(){$("#topbar").hide(),l.show(),$("#container").hide(),M(h)},z=function(){$("#topbar").show(),l.hide(),$("#container").show(),$(".js-start-container",l).empty()},A=function(a,b,c){a&&d.warn(a.message,a),K(b,c)};return e}(TD.core.defer,TD.ui.template,TD.storage,TD.sync.util),TD.net.util=function(){var a={};return a.addURLParam=function(a,b,c){var d=a.indexOf("?")>=0?"&":"?";return a+d+encodeURIComponent(b)+"="+encodeURIComponent(c)},a.formDecode=function(a){var b=a.split("&"),c={};for(var d=0,e;e=b[d];d++){var f=e.split("=");f.length==2&&(c[decodeURIComponent(f[0])]=decodeURIComponent(f[1]))}return c},a.decodeURL=function(b){var c=b.split("?");return c.length>1?a.formDecode(c[1]):b},a.formEncode=function(a){var b=[];for(var c in a)b.push(c+"="+encodeURIComponent(a[c]));return b.join("&")},a.getQueryStringParams=function(){var a=window.location.href.split("?");if(a.length>=2){var b=a.slice(1).join("?");return this.formDecode(b)}return{}},a.urlencode=function(a){var b=[],c;for(var d in a)c=d+"="+encodeURIComponent(a[d]),b.push(c);return b.join("&")},a}(),TD.controller.init=function(a,b,c,d,e,f,g,h,i){var j={},k=null;j.purgedServices=[],j.start=function(b,e){var f=TD.core.defer.succeed(),i,k,n,o;if(TD.util.isChromeApp()&&chrome.extension.getViews({type:"tab"}).length>1){d.warn("Duplicate Chrome App tab. Aborting init.");return}f.addCallback(function(){TD.util.getAppEnv()==="win"&&$("html").addClass("win-wrapped"),i=TD.controller.feather.loadFeathers(!1),j.certCheck();try{j.upgradeStore()}catch(b){d.warn("ERROR in store upgrade:",b.message,b),d.printStacktrace(),e=b.message}return k=j.findAndOpenStore(),n=null,k&&(n=a.store.getTweetdeckAccount(k)),o=k!==sessionStorage,j.doLogin(n,k,o,e)}),f.addCallback(function(a){return i.addBoth(function(){return a}),i});var q=!1;f.addCallback(function(a){return q=a.created_account,a}),f.addCallback(l,k),f.addCallback(a.notification.flush),f.addCallback(m),f.addCallback(function(){return h.gatherResults([a.feedController.triggerPush(.05),a.columnController.triggerPush(.05)])}),f.addCallback(function(){a.store.recordVersion(a.upgrade.CURRENT_VERSION)}),f.addCallback(m),f.addCallback(function(){if(q){var b=a.clientController.client,d=c.upgrade.CURRENT_VERSION;return console.log("freshly created account; no upgrades, recording v",d),b.dictSet("settings","version",d)}return c.upgrade.doUpgrades()}),f.addCallback(a.accountController.verifyStoredAccounts);var r="__hasAlreadyReloaded";return f.addCallback(function(){localStorage.removeItem(r)}),f.addErrback(function(a){var b=localStorage.getItem(r);throw b||(localStorage.setItem(r,!0),TD.sync.controller.flushSyncDataAndReload()),a}),f.addCallback(p),f.addErrback(function(b){d.warn(b,"controller.init.start failed, restarting",b.message);if(b.stackTrace)try{console.log(b.stackTrace.join("\n"))}catch(c){console.log("Unable to get stackTrace to report error:",c)}return a.store.reset(),g.controller.reset(),j.start(null,b.message)}),f},j.certCheck=function(){var a=TD.config.cert_reminder||TD.config.api_root==="https://testnet.monkeysphere.org";a&&e.isChromeApp()&&jQuery.ajax(TD.config.api_root+"/time").fail(function(){chrome.tabs.create({selected:!0,url:TD.config.api_root})})},j.upgradeStore=function(){d.trace("init.upgradeStore()");var b=a.upgrade;_.each({local:localStorage,session:sessionStorage},function(a,c){var e=b.getVersion(a);if(e===null)return;e<b.CURRENT_VERSION&&(d.stateLog("upgrading "+c+"Storage to v"+b.CURRENT_VERSION),b.doUpgrade(a,e))})},j.findAndOpenStore=function(){return d.trace("init.findAndOpenStore()"),localStorage&&a.store.getTweetdeckAccount(localStorage)?(d.stateLog("init.findAndOpenStore: found tdacct in localStorage"),localStorage):sessionStorage&&a.store.getTweetdeckAccount(sessionStorage)?(d.stateLog("init.findAndOpenStore: found tdacct in sessionStorage"),sessionStorage):localStorage&&localStorage.getItem("accounts")?(d.stateLog("init.findAndOpenStore: found accounts in localStorage"),localStorage):sessionStorage&&sessionStorage.getItem("accounts")?(d.stateLog("init.findAndOpenStore: found accounts in sessionStorage"),sessionStorage):null},j.doLogin=function(c,e,f,g){d.trace("init.doLogin()");var j=null;if(!c)return b.startflow.doLogin(null,f,g);if(g)return b.startflow.doLogin(c,f,g);var k=function(b,c){return j=a.accountController.loginTweetdeck(b,null,c),j.addCallback(function(a){return a.stay_signed_in=f,a}),j};if(a.store.getTweetdeckAccountAndPasshash){var l=a.store.getTweetdeckAccountAndPasshash(e);l&&l.email&&l.passhash&&(j=k(l.email,l.passhash))}if(j===null&&e){var m=e.getItem("tweetdeck_account");if(m){var l=JSON.parse(m);if(l.password){var n=l.password;d.warn("Removing old password from store"),delete l.password,e.setItem("tweetdeck_account",JSON.stringify(l)),j=k(l.email,n)}}}return j===null&&(i.loadSession(null,e),i.isLoggedIn()&&(j=i.drequest("/verify_user",null,null,!0),j.addCallback(function(a){var b={tweetdeck_account:{email:c},stay_signed_in:f};return b}))),j===null&&(j=h.fail(!1)),j.addErrback(function(a){d.warn("TD login of existing account/session failed",a);var e=TD.i("Session expired. Please re-enter your email & password.");return b.startflow.doLogin(c,f,e)}),j};var l=function(b,c){d.trace("init.initFromLogin()");var e=a.store.getTweetdeckAccount(c),f=e!==b.tweetdeck_account.email;a.store.init(b.stay_signed_in,f),i.saveSession(a.store),i.onAuthFail(j.abort,a.store);var h=b.tweetdeck_account;return h.plaintext_password!==null&&(a.store.setTweetdeckAccountAndPassword?a.store.setTweetdeckAccountAndPassword(h.email,h.plaintext_password):a.store.setTweetdeckAccount(h.email)),g.controller.initFromTdLogin(a.store)},m=function(){d.trace("init.purgeDeprecatedAccounts()"),n("buzz"),n("foursquare"),o(function(a){return a.getService()==="facebook"&&a.getType()==="group"}),o(function(a){return a.getService()==="twitter"&&a.getType()==="sentdirect"}),o(function(b){return _.isUndefined(a.accountController.get(b.getAccountKey()))})},n=function(b){var c=a.accountController.getAccountsForService(b);_.isEmpty(c)||(j.purgedServices.push(b),_.each(c,function(b){a.accountController.blacklistAccount(b)})),o(function(a){return a.getService()===b})},o=function(b){var c,d,e,f;c=_.filter(a.feedController.getAll(),b),d=_.map(c,function(b){var c=b.getKey();return a.feedController.remove(c),c}),e=_.filter(a.columnController.getAll(),function(a){var b=_.difference(a.getFeedKeys(),d);return a.setFeedKeys(b),_.isEmpty(b)}),f=_.map(e,function(a){return a.getKey()});if(!_.isEmpty(f)){var g=a.clientController.client;g.setColumnOrder(_.difference(g.getColumnOrder(),f)),_.each(f,function(b){a.columnController.remove(b)})}},p=function(){TD.util.fnPerformanceWrapper(q,null,c.stats.performance.keys.INIT)()},q=function(){d.trace("init.initControllerAndUI()");var e;TD.settings.init(),c.clients.initialiseClients(),c.feedManager.init(),c.stats.init(),TD.util.fnPerformanceWrapper(b.main.init,b.main,c.stats.performance.keys.MAIN)(),TD.util.fnPerformanceWrapper(c.columnManager.init,c.columnManager,c.stats.performance.keys.COLUMN_MANAGER)(),TD.util.fnPerformanceWrapper(c.scheduler.initialiseColumns,c.scheduler,c.stats.performance.keys.COLUMN_SCHEDULER)(),TD.util.fnPerformanceWrapper(c.notifications.init,c.notifications,c.stats.performance.keys.NOTIFICATIONS)(),TD.util.fnPerformanceWrapper(c.filterManager.init,c.filterManager.init,c.stats.performance.keys.FILTER_MANAGER)(),a.accountController.isEmpty()?(new TD.components.GlobalSettings,TD.components.NewFeaturesSplash.updateSeenVersion()):TD.components.NewFeaturesSplash.shouldShow()&&new TD.components.NewFeaturesSplash,TD.ready=!0,d.trace("init: TD.ready")};return j.signOut=function(){if(e.isWrapperApp()&&deck.osname()==="osx"){var b=a.store.getTweetdeckAccount();b&&a.store.deleteSecrets([b]);var c=_.map(TD.storage.accountController.getAll(),function(a){return a.getKey()});a.store.deleteSecrets(c)}localStorage.clear(),sessionStorage.clear();var d=i.logout();return TD.util.isWrapperApp()&&d.addBoth(function(){deck.tearDown()}),d.addBoth(function(){window.location.reload()}),d},j.abort=function(){window.location.reload()},j}(TD.storage,TD.ui,TD.controller,TD.sync.util,TD.util,TD.net.util,TD.sync,TD.core.defer,TD.sync.tdapi),TD.controller.upgrade=function(a,b,c,d){var e={};return e.CURRENT_VERSION=0,e.doUpgrades=function(){var b=null,f=a.clientController.client.get("settings");_.isUndefined(f)||_.isUndefined(f.version)?b=0:b=Number(f.version);var g=function(b,c){return a.clientController.client.dictSet("settings","version",c)},h=d.succeed();for(var i=1;i<=e.CURRENT_VERSION;i++)if(b<i){var j="version_"+i.toString();e.hasOwnProperty(j)&&(console.log("performing upgrade to v",i,j),h.addCallback(e[j]),h.addCallback(g,i))}return h.addErrback(function(a){throw c.warn("WARNING: controller.upgrade failed!!!"),console.log(a),a}),h},e}(TD.storage,TD.config,TD.sync.util,TD.core.defer),TD.controller.columnManager=function(a,b,c){var d={},e={},f=[];d.TIMELINE="timeline",d.MENTIONS="mentions",d.SEARCH="search",d.LISTS="lists",d.MESSAGES="messages",d.TRENDS="trends",d.TWEETS="tweets",d.FAVORITES="favorites",d.FACEBOOK="facebook",d.HOME="home",d.ME="me",d.INBOX="privateMe",d.SCHEDULED="scheduled",d.NETWORKACTIVITY="networkactivity",d.INTERACTIONS="interactions",d.SELF_ACCOUNTS_ONLY={},d.SELF_ACCOUNTS_ONLY[d.MESSAGES]=!0,d.SELF_ACCOUNTS_ONLY[d.ACTIONS]=!0,d.SELF_ACCOUNTS_ONLY[d.NETWORKACTIVITY]=!0,d.SELF_ACCOUNTS_ONLY[d.INTERACTIONS]=!0,d.TWITTER_GENERIC={},d.TWITTER_GENERIC[d.TIMELINE]=!0,d.TWITTER_GENERIC[d.MENTIONS]=!0,d.TWITTER_GENERIC[d.MESSAGES]=!0,d.TWITTER_GENERIC[d.ACTIONS]=!0,d.TWITTER_GENERIC[d.TWEETS]=!0,d.TWITTER_GENERIC[d.FAVORITES]=!0,d.TWITTER_GENERIC[d.NETWORKACTIVITY]=!0,d.TWITTER_GENERIC[d.INTERACTIONS]=!0,d.SELF_FEED_TYPE={},d.SELF_FEED_TYPE[d.TIMELINE]="home",d.SELF_FEED_TYPE[d.MESSAGES]="direct",d.SELF_FEED_TYPE[d.TWEETS]="usertweets",d.NON_SELF_FEED_TYPE={},d.NON_SELF_FEED_TYPE[d.TIMELINE]="usertimeline",d.NON_SELF_FEED_TYPE[d.TWEETS]="usertweets",d.NON_SELF_FEED_TYPE[d.MENTIONS]="search",d.MENU_TITLE={},d.MENU_TITLE[d.TIMELINE]=TD.i("Timeline"),d.MENU_TITLE[d.MENTIONS]=TD.i("Mentions"),d.MENU_TITLE[d.SEARCH]=TD.i("Search"),d.MENU_TITLE[d.LISTS]=TD.i("Lists"),d.MENU_TITLE[d.MESSAGES]=TD.i("Messages"),d.MENU_TITLE[d.TRENDS]=TD.i("Trends"),d.MENU_TITLE[d.TWEETS]=TD.i("Tweets"),d.MENU_TITLE[d.FAVORITES]=TD.i("Favorites"),d.MENU_TITLE[d.FACEBOOK]=TD.i("Facebook"),d.MENU_TITLE[d.HOME]=TD.i("Home"),d.MENU_TITLE[d.ME]=TD.i("Me"),d.MENU_TITLE[d.INBOX]=TD.i("Inbox"),d.MENU_TITLE[d.SCHEDULED]=TD.i("Scheduled"),d.MENU_TITLE[d.NETWORKACTIVITY]=TD.i("Activity"),d.MENU_TITLE[d.INTERACTIONS]=TD.i("Interactions"),d.DISPLAY_ORDER=[{type:d.TIMELINE,service:"twitter"},{type:d.INTERACTIONS,service:"twitter"},{type:d.MENTIONS,service:"twitter"},{type:d.SEARCH,service:"twitter"},{type:d.LISTS,service:"twitter"},{type:d.MESSAGES,service:"twitter"},{type:d.TRENDS,service:"twitter"},{type:d.TWEETS,service:"twitter"},{type:d.FAVORITES,service:"twitter"},{type:d.NETWORKACTIVITY,service:"twitter"},{type:d.FACEBOOK,service:"facebook"}],d.DISPLAY_ORDER_SINGLETONS=[{type:d.HOME},{type:d.ME},{type:d.INBOX},{type:d.SCHEDULED}],d.DISPLAY_ORDER_PROFILE=[{type:d.TWEETS,service:"twitter",profile:!0},{type:d.MENTIONS,service:"twitter",profile:!0},{type:d.LISTS,service:"twitter",profile:!0},{type:d.TIMELINE,service:"twitter",profile:!0},{type:d.FAVORITES,service:"twitter",profile:!0}];var g=d.DISPLAY_ORDER.concat(d.DISPLAY_ORDER_SINGLETONS).concat(d.DISPLAY_ORDER_PROFILE);_.each(g,function(a){a.title=d.MENU_TITLE[a.type]}),d.HELP_TEXT={},d.HELP_TEXT[d.TIMELINE]=TD.i("Add a Timeline column for your own accounts, or search for a user and add theirs"),d.HELP_TEXT[d.MENTIONS]=TD.i("Add a Mentions column for your own accounts, or search for a user and add theirs"),d.HELP_TEXT[d.SEARCH]=TD.i("Add a column for a saved or recent Search, or enter a new search in the box"),d.HELP_TEXT[d.LISTS]=TD.i("Create a new list, or select an existing list to edit or add a column"),d.HELP_TEXT[d.MESSAGES]=TD.i("Add a Direct Messages column for your accounts"),d.HELP_TEXT[d.TRENDS]=TD.i("Add a column to monitor Tweets for any Trend"),d.HELP_TEXT[d.TWEETS]=TD.i("Add a column for Tweets sent from your own accounts, or search for a user and add theirs"),d.HELP_TEXT[d.FAVORITES]=TD.i("Add a Favorites column for your own accounts, or search for a user and add theirs"),d.HELP_TEXT[d.FACEBOOK]=TD.i("Add a column for your Facebook News Feed or Notifications"),d.HELP_TEXT[d.INTERACTIONS]=TD.i("Add a column to monitor your mentions, retweets, favourites, follows and list additions in real time"),d.HELP_TEXT[d.NETWORKACTIVITY]=TD.i("Add a column to view favourites, follows and list additions by your friends in real time"),d.STREAMING_FULL="streaming_full",d.STREAMING_NONE="streaming_none",d.STREAMING_PARTIAL="streaming_partial",d.init=function(){h(),d.checkColumns(),$.subscribe("/storage/client/column_order_changed",h),$.subscribe("/storage/column/feeds_changed",function(a,b,c){var e=d.get(c.getKey());e&&e.loadFeeds()}),$.subscribe("/storage/column/change",function(a){var c=d.get(a.getKey());if(c){var e=c.model.getFeedKeys(),f=a.getFeedKeys();_.isEqual(e,f)||c.loadFeeds(),a.managed&&TD.ui.columns.setTitleDisplay(a.getKey(),a.getTitle())}else b.stateLog("loading new new column",a),h()}),$.subscribe("/storage/client/settings/show_inline_media",function(a){if(a){$(".chp-media").show();var b=TD.controller.columnManager.getAll();_.each(b,function(a,b){_.each(a.updateArray,function(a){a.scanForMedia()})})}else $(".chp-media").hide()}),$.subscribe("/storage/account/new",function(a){TD.storage.accountController.getAll().length===1&&d.checkColumns()}),window.onresize=_.debounce(function(){},100)},d.checkColumns=function(){var b=TD.storage.accountController.getPreferredAccount("twitter")||TD.storage.accountController.getPreferredAccount("facebook");a.clientController.client.getColumnOrder().length===0&&b&&d.makeDefaultColumns(b)},d.get=function(a){return e[a]},d.getAll=function(){return _.clone(e)},d.getAllOrdered=function(){var a=this.getAll(),b=[];for(var c=0;c<f.length;c++)b.push(a[f[c]]);return b},d.add=function(a){e[a.model.getKey()]=a},d.deleteColumn=function(b){var c=e[b];c&&!c.temporary&&TD.controller.stats.removeColumn(c.getColumnType());var d=a.clientController.client.removeColumn(b)},d.removeFromAppLayer=function(b){var c=e[b];c&&c.removeSubscriptions(),delete e[b],a.columnController.remove(b),TD.controller.scheduler.removeColumn(b)},d.move=function(a,b){var c=f.indexOf(a),e,g=f.concat(),i;if(b==="right")i=Math.min(c+1,f.length-1);else if(b==="left")i=Math.max(c-1,0);else return;e=f[i],g[i]=g[c],g[c]=e,TD.storage.clientController.client.setColumnOrder(g),h(),d.showColumn(a)};var h=function(b){var c=a.clientController.client.getColumnOrder(),d=!_.isEqual(f,c);d&&i(c,b)},i=function(c,e){var g=_.difference(f,c),h=_.difference(c,f),i=[];_.each(g,function(a){d.removeFromAppLayer(a),TD.ui.columns.removeColumn(a)}),_.each(h,function(e){var f=d.get(e),g;if(!f){g=a.columnController.get(e);if(!g){b.stateLog("WARNING: column not found for",e,"all columns:",a.columnController.getAll(),"in column_order",c);return}f=new TD.vo.Column(g),d.add(f)}TD.controller.scheduler.addColumn(f,!0),i.push(f)}),TD.ui.columns.addColumnsToView(i),TD.ui.columns.reorderColumns(c,e),f=c};return d.addColumnToUI=function(b){var c=b.model.getKey(),e;return b.reset(),d.add(b),a.feedController.manageFeeds(b.getFeeds()),a.columnController.manage(b.model),e=a.clientController.client.appendColumn(c),h(),_.defer(d.showColumn,c),TD.controller.stats.addColumn(b.getColumnType()),e},d.makeColumnFor=function(b,c,e,f,g){var h=this,i={},j,k;if(e=="tweetdeck")switch(c){case"home":k=a.columnController.getHomeFeeds(a.accountController.getDefaults()),j=d.makeColumn(d.MENU_TITLE[d.HOME],"home",k);break;case"me":k=a.columnController.getMeFeeds(a.accountController.getAll()),j=d.makeColumn(d.MENU_TITLE[d.ME],"me",k);break;case"privateMe":k=a.columnController.getInboxFeeds(a.accountController.getAll()),j=d.makeColumn(d.MENU_TITLE[d.INBOX],"privateMe",k);break;case"scheduled":k=[a.feedController.getOrCreateFeed("scheduled","tweetdeck","tweetdeck",{})],j=d.makeColumn(d.MENU_TITLE[d.SCHEDULED],"scheduled",k)}else{switch(c){case"usertimeline":case"favorites":case"usertweets":g&&(i.id=parseInt(g,10));break;case"search":i.term=g;break;case"list":var l=g.split("/");TD.sync.util.assert(l.length===2,"List meta should contain both ownerId and listId",l),i.ownerId=l[0],i.listId=l[1];break;case"group":case"page":i.id=g}j||(j=d.makeOtherColumnAndFeeds(b,c,e,f,i))}return j},d.makeDefaultColumns=function(a){var b;a.getType()==="twitter"?(b=d.makeColumnFor(TD.i("Timeline: {{1}}",{1:a.getUsername()}),"home",a.getType(),a.getKey()),d.addColumnToUI(b),b=d.makeColumnFor(TD.i("Interactions: {{1}}",{1:a.getUsername()}),"interactions",a.getType(),a.getKey()),d.addColumnToUI(b),b=d.makeColumnFor(TD.i("Messages: {{1}}",{1:a.getUsername()}),"direct",a.getType(),a.getKey()),d.addColumnToUI(b)):a.getType()==="facebook"&&(b=d.makeColumnFor(TD.i("News Feed"),"home",a.getType(),a.getKey()),d.addColumnToUI(b),b=d.makeColumnFor(TD.i("Notifications"),"notifications",a.getType(),a.getKey()),d.addColumnToUI(b))},d.makeColumn=function(b,c,d){var e={title:b,type:c,feedkeys:[],settings:{}};if(c==="me"||c==="privateMe")e.settings.has_notification=!0,e.settings.has_sound=!0;var f=new TD.vo.Column(new a.Column(e));return f.setFeeds(d),f},d.makeOtherColumnAndFeeds=function(b,c,e,f,g){var h=a.feedController,i=[];return i.push(h.getOrCreateFeed(c,e,f,g)),d.makeColumn(b,"other",i)},d.resetHomeFeeds=function(){var b=a.clientController.client.getColumnOrder(),c,d;for(var f=0;f<b.length;f++)c=e[b[f]],c.model.getType()==="home"&&(d=a.columnController.getHomeFeeds(a.accountController.getDefaults()),c.setFeeds(d))},d.showColumn=function(a){TD.ui.columns.scrollToColumn(a)},d.isStreaming=function(a){var b=d.getStreamingState(a);return b!==d.STREAMING_NONE},d.getStreamingState=function(a){var b=d.STREAMING_NONE,c=d.get(a),e=0,f;return c&&(f=c.model.getFeedKeys(),_.each(f,function(a){TD.controller.feedManager.isStreaming(a)&&e++}),e===0?b=d.STREAMING_NONE:e===f.length?b=d.STREAMING_FULL:b=d.STREAMING_PARTIAL),b},d}(TD.storage,TD.sync.util,TD.core.defer),TD.controller.auth=function(){var a={},b={twitter:"TwitterAuth",facebook:"FacebookAuth",bitly:"BitlyValidate"};return a.create=function(a,c){return TD.sync.util.assert(b[a],'bad name for auth "'+a+'"'),new TD.controller.auth[b[a]](c)},a}(),TD.controller.auth.AuthorisationProcessor=function(){this.start=function(a,b){TD.util.isChromeApp()?this.start_chrome(a,b):TD.util.isWrapperApp()?this.start_wrapper(a,b):this.start_web(a,b)},this.start_wrapper=function(a,b){var c=deck.authenticateOn(this.getAuthURL(a.getType())),d=this,e=function(e){var f=d.getTokenFromURL(a.getType(),e);f&&(f.access_token?d.updateAccount(f.access_token,b):d.updateAccount(f.oauth_token,f.oauth_token_secret,b),c.hide(),c.deleteLater())};c.loadedUrl.connect(e),c.show()},this.start_web=function(a,b){var c=window.open(this.getAuthURL(a.getType()),"mywindow","width=800,height=450"),d=this,e=function(){var f,g;try{c&&c.location&&c.location.href&&(f=c.location.href)}catch(h){console.log(h)}if(f){g=d.getTokenFromURL(a.getType(),f);if(g){g.access_token?d.updateAccount(g.access_token,b):d.updateAccount(g.oauth_token,g.oauth_token_secret,b),c.close();return}}setTimeout(e,100)};setTimeout(e,500)},this.getAuthURL=function(a){var b="oauth";switch(a){case"facebook":b="oauth2"}return TD.config.api_root+"/"+b+"/authorize/"+a},this.getTokenFromURL=function(a,b){var c,d;if(_.contains(b,"/oauth/success/"+a)||_.contains(b,"/oauth2/success/"+a))d=b.split("?")[1],c=TD.net.util.formDecode(d);return c},this.start_chrome=function(a,b){var c=this,d,e;chrome.tabs.getSelected(null,function(a){d=a.id}),e={url:this.getAuthURL(a.getType())},chrome.tabs.create(e,function(e){var f=e.id;chrome.tabs.onUpdated.addListener(function(e,g,h){var i,j;e===f&&h.url&&h.status=="complete"&&(j=c.getTokenFromURL(a.getType(),h.url),j&&(j.access_token?c.updateAccount(j.access_token,b):c.updateAccount(j.oauth_token,j.oauth_token_secret,b),chrome.tabs.update(d,{selected:!0}),chrome.tabs.remove(e)))})})}},TD.controller.auth.TwitterAuth=function(a){var b=this;b.account=a,this.verifyAccount=function(a,c){var d=b.account,e="https://api.twitter.com/1/account/verify_credentials.json",f=function(b,e){var f=d.getUserID();f&&f!=b.id?(console.log("Attempting to update wrong account:",d,"Using data:",b),TD.sync.util.printStacktrace(),c()):(d.setUsername(b.screen_name),d.setName(b.name),d.setProfileImageURL(b.profile_image_url),d.setUserID(b.id),d.setIsPrivate(b["protected"]),d.setUpdated((new Date).getTime()),d.computeKey(),a(d))};c||(c=function(a){console.log(["TwitterAuth.verifyAccount: no errback provided",a])}),TD.util.isChromeApp()?TD.net.ajax.bounce(e,f,{method:"GET"},d,c):TD.net.ajax.proxy(e,f,{method:"GET"},d,c)},this.updateAccount=function(a,c,d){var e=b.account;e.setUsername(""),e.setUserID(""),e.setType("twitter"),e.setOAuthToken(a),e.setTokenSecret(c),this.verifyAccount(d)}},TD.controller.auth.FacebookAuth=function(a){var b=this;b.account=a,this.verifyAccount=function(a,c){var d=b.account,e,f,g=function(a){console.log(["FacebookAuth.verifyAccount:errhandler",a]),c?c():TD.sync.util.printStacktrace()},h=function(b,c){if(!b||b.error){g(b);return}try{d.setUserID(b.id),d.setProfileImageURL("http://graph.facebook.com/"+b.id+"/picture"),d.setUsername(b.name),d.setUpdated((new Date).getTime()),d.computeKey(),a(d);return}catch(e){g(e);return}};f={access_token:d.getOAuthToken()},e="https://graph.facebook.com/me",TD.net.ajax.jsonp(e,f,h,g)},this.updateAccount=function(a,c,d){var e=b.account;e.setUsername("Facebook"),e.setOAuthToken(a),this.verifyAccount(c,d)}},TD.controller.auth.BitlyValidate=function(a){var b=this;b.account=a,this.updateAccount=function(a,b){this.verifyAccount(b)},this.verifyAccount=function(a,c){var d=b.account,e="http://api.bitly.com/v3/validate",f={x_login:d.get("userId"),x_apiKey:d.get("oauth_token"),apiKey:"R_b8032856b71a14fabfe64f6845689ddf",login:"tweetdeckapi",format:"json"},g=function(b,e){if(!b.data||b.data.valid!=1){c();return}d.setUpdated((new Date).getTime()),d.computeKey(),a(d)};TD.net.ajax.request({method:"GET",url:e,params:f},g,c)}},TD.controller.auth.TwitterAuth.prototype=new TD.controller.auth.AuthorisationProcessor,TD.controller.auth.FacebookAuth.prototype=new TD.controller.auth.AuthorisationProcessor,TD.services.makeServiceClient=function(a,b){switch(a){case"twitter":return new TD.services.TwitterClient(b);case"facebook":return new TD.services.FacebookClient(b);case"tweetdeck":return new TD.services.TweetDeckClient}},TD.services.ServiceClient=function(){},TD.services.ServiceClient.prototype.profileCache={},TD.services.ServiceClient.prototype.get=function(a,b,c,d,e){c?TD.util.isChromeApp()?TD.net.ajax.bounce(a,d,{method:"GET",parameters:b},this.oauth.account,e):TD.net.ajax.proxy(a,d,{method:"GET",parameters:b},this.oauth.account,e):TD.net.ajax.request({url:a,method:"GET",params:b},d,e)},TD.services.ServiceClient.prototype.post=function(a,b,c,d,e,f){TD.util.isChromeApp()?TD.net.ajax.bounce(a,e,{method:"POST",parameters:b,body:c,headers:d},this.oauth.account,f):TD.net.ajax.proxy(a,e,{method:"POST",parameters:b,body:c,headers:d},this.oauth.account,f)},TD.services.ServiceClient.prototype.put=function(a,b,c,d,e,f){TD.util.isChromeApp()?TD.net.ajax.bounce(a,e,{method:"PUT",parameters:b,body:c,headers:d},this.oauth.account,f):TD.net.ajax.proxy(a,e,{method:"PUT",parameters:b,body:c,headers:d},this.oauth.account,f)},TD.services.ServiceClient.prototype.del=function(a,b,c,d,e,f){TD.util.isChromeApp()?TD.net.ajax.bounce(a,e,{method:"DELETE",parameters:b,body:c,headers:d},this.oauth.account,f):TD.net.ajax.proxy(a,e,{method:"DELETE",parameters:b,body:c,headers:d},this.oauth.account,f)},TD.services.ChirpBase=function(a){this.account=a},TD.services.ChirpBase.kTEMP_COM_CLASS="s-inverted",TD.services.ChirpBase.kMEDIA_CLASS="s-media",TD.services.ChirpBase.RETWEET_CLASS="retweet",TD.services.ChirpBase.FAVORITE_CLASS="favorite",TD.services.ChirpBase.UNREAD_CLASS="unread",TD.services.ChirpBase.prototype.id="",TD.services.ChirpBase.prototype.text="",TD.services.ChirpBase.prototype.created=null,TD.services.ChirpBase.prototype.htmlText="",TD.services.ChirpBase.prototype.creatorAccount=null,TD.services.ChirpBase.prototype.embeds=null,TD.services.ChirpBase.prototype.fromJSONObject=function(){throw"fromJSONObject Not Implemented"},TD.services.ChirpBase.prototype.isOwnChirp=function(){throw"isOwnChirp Not Implemented"},TD.services.ChirpBase.prototype.destroy=function(){throw"destroy Not Implemented"},TD.services.ChirpBase.prototype.render=function(a){throw"render Not Implemented"},TD.services.ChirpBase.prototype.renderNotification=function(){return null},TD.services.ChirpBase.prototype.getGrowlData=function(){return null},TD.services.ChirpBase.prototype.email=function(){throw"email Not Implemented"},TD.services.ChirpBase.prototype.postComment=function(){throw"postComment Not Implemented"},TD.services.ChirpBase.prototype.getChirpURL=function(){throw"getChirpURL Not Implemented"},TD.services.ChirpBase.prototype.toHTML=function(a){return TD.util.transform(a)},TD.services.ChirpBase.prototype._changed=function(){TD.controller.notifications.reRender(this)},TD.services.ChirpBase.prototype.getDOMChirps=function(){var a="article[data-key='"+this.id+"'][data-account-key='"+this.account.getKey()+"']";return $(a)},TD.services.ChirpBase.prototype.update=function(a){return!1},TD.services.ChirpBase.prototype.passFilters=function(a){return TD.controller.filterManager.pass(a,this.getFilterableText(),null,null)},TD.services.ChirpBase.prototype._generateHTMLText=function(){this.htmlText=this.toHTML(this.text)},TD.services.ChirpBase.prototype.createdPretty=function(){return TD.util.prettyDate(this.created)},TD.services.ChirpBase.prototype.createdPrettyFull=function(){return TD.util.prettyTimeString(this.created)},TD.services.ChirpBase.prototype.reorder=function(){TD.controller.feedManager.reorderChirp(this.id)},TD.services.ChirpBase.prototype.getSinceId=function(){return this.id},TD.services.ChirpBase.prototype.getUnreadChirps=function(a){return!this.isOwnChirp()&&this.created.getTime()>a?[this]:[]},TD.services.ChirpBase.prototype.getFilterableText=function(){return this.text},TD.services.ChirpBase.prototype.scanForMedia=function(a){},TD.services.ChirpBase.prototype.hasEmbeds=function(){return this.embeds&&this.embeds.length>0},TD.services.ChirpBase.msFudge=0,TD.services.ChirpBase.prototype.fudgeCreatedTime=function(a){var b=TD.services.ChirpBase.msFudge;a.setMilliseconds(b),b++,b%=1e3,TD.services.ChirpBase.msFudge=b},TD.services.TwitterStatus=function(a){this.account=a},TD.services.TwitterStatus.prototype=new TD.services.ChirpBase,TD.services.TwitterStatus.prototype.user=null,TD.services.TwitterStatus.prototype.inReplyToID="",TD.services.TwitterStatus.prototype.inReplyToUserID="",TD.services.TwitterStatus.prototype.inReplyToScreenName="",TD.services.TwitterStatus.prototype.isFavorite=!1,TD.services.TwitterStatus.prototype.isRetweeted=!1,TD.services.TwitterStatus.prototype.retweetCount=0,TD.services.TwitterStatus.prototype.retweetedStatus=null,TD.services.TwitterStatus.prototype.entities=null,TD.services.TwitterStatus.prototype.location=null,TD.services.TwitterStatus.prototype.place=null,TD.services.TwitterStatus.prototype.locationName="",TD.services.TwitterStatus.prototype.country="",TD.services.TwitterStatus.prototype.coordinates=null,TD.services.TwitterStatus.prototype.source="",TD.services.TwitterStatus.prototype.sourceNoHTML="",TD.services.TwitterStatus.prototype._filterableText=null,TD.services.TwitterStatus.prototype.fromJSONObject=function(a){var b,c,d,e;return this.id=a.id_str||a.id,this.user=new TD.services.TwitterUser(this.account),a.from_user?(this.inReplyToScreenName=a.to_user,this.user.id=a.from_user_id,this.user.screenName=a.from_user,this.user.profileImageURL=a.profile_image_url_https,this.user.name=a.from_user_name,this.source=TD.util.removeHTMLCodes(a.source)):a.user&&(this.user=this.user.fromJSONObject(a.user),this.source=a.source,this.inReplyToUserID=a.in_reply_to_user_id,this.inReplyToScreenName=a.in_reply_to_screen_name,this.isFavorite=a.favorited,this.isRetweeted=a.retweeted,this.retweetCount=a.retweet_count,this.currentUserRetweet=a.current_user_retweet),this.sourceNoHTML=TD.util.stripHTMLTags(this.source),this.inReplyToID=a.in_reply_to_status_id_str||a.in_reply_to_status_id,a.retweeted_status?(this.text=a.retweeted_status.text,this.retweetedStatus=(new TD.services.TwitterStatus(this.account)).fromJSONObject(a.retweeted_status),a.retweeted_status.entities&&(this.entities=a.retweeted_status.entities)):(this.text=a.text,a.entities&&(this.entities=a.entities)),this.creatorAccount=TD.storage.accountController.get(TD.storage.Account.generateKeyFor("twitter",this.user.id)),this.entities||(this.entities={urls:[],hashtags:[],user_mentions:[],media:[],other:[]}),this.location=null,this.coordinates=a.coordinates,this.place=a.place,this.locationName="",this.embeds=null,this.place?(this.locationName=this.place.full_name,this.place.country_code&&(this.locationName+=", "+this.place.country_code)):this.coordinates&&(this.locationName=this.coordinates.coordinates[1]+", "+this.coordinates.coordinates[0]),e=TD.util.parseDateString(a.created_at),this.fudgeCreatedTime(e),this.created=a.created=e,this._generateHTMLText(),this},TD.services.TwitterStatus.prototype.toHTML=function(a){return TD.util.transform(a,this.entities)},TD.services.TwitterStatus.prototype.passFilters=function(a){var b=[this.user.screenName];return this.retweetedStatus&&b.push(this.retweetedStatus.user.screenName),TD.controller.filterManager.pass(a,this.getFilterableText(),b,this.sourceNoHTML)},TD.services.TwitterStatus.prototype.getMainUser=function(){return this.retweetedStatus?this.retweetedStatus.user:this.user},TD.services.TwitterStatus.prototype.getCreator=function(){return this.user},TD.services.TwitterStatus.prototype.getMainTweet=function(){return this.retweetedStatus?this.retweetedStatus:this},TD.services.TwitterStatus.prototype.hasLocationData=function(){var a=this.getMainTweet();return a.coordinates||a.place},TD.services.TwitterStatus.prototype.isOwnChirp=function(){return Boolean(this.creatorAccount)},TD.services.TwitterStatus.prototype.isRetweetedStatus=function(){return Boolean(this.retweetedStatus)},TD.services.TwitterStatus.prototype.getLocationMapURL=function(){var a=this.getMainTweet();if(!a.coordinates)return;return"http://maps.google.com?q="+a.coordinates.coordinates[1]+","+a.coordinates.coordinates[0]},TD.services.TwitterStatus.prototype.getChirpURL=function(){var a=this.getMainTweet();return"https://twitter.com/"+a.user.screenName+"/status/"+a.id},TD.services.TwitterStatus.prototype.destroy=function(){if(!this.isOwnChirp()){TD.controller.progressIndicator.addMessage(TD.i("You don't own this account - can't delete"));return}this._action("delete",function(a){TD.controller.feedManager.deleteChirp(a.id)})},TD.services.TwitterStatus.prototype.getQuoteText=function(){var a={username:this.user.screenName,text:TD.util.removeHTMLCodes(this.text)};return TD.ui.template.toHtml("RT @{{username}}: {{{text}}}",a)},TD.services.TwitterStatus.prototype.render=function(a){return this.scanForMedia(a),TD.ui.template.render("status/tweet",{extraClasses:a,tweet:this})},TD.services.TwitterStatus.prototype.renderNotification=function(){return TD.ui.template.render("status/tweet",{tweet:this,isPopup:!0})},TD.services.TwitterStatus.prototype.getGrowlData=function(){var a=this.getMainTweet(),b={};return a.sender?b.title=a.sender.screenName+" > "+a.recipient.screenName:a.user&&a.user.screenName&&(b.title=a.user.screenName),b.img=a.user.profileImageURL,b.text=a.text,b},TD.services.TwitterStatus.prototype.renderAsReply=function(){return TD.ui.template.render("status/tweet",{tweet:this,isInConvo:!0})},TD.services.TwitterStatus.prototype.favorite=function(a){function h(){TD.controller.progressIndicator.taskFailed(c)}function i(a){a.error?h():(b.setFavorite(!b.isFavorite),TD.controller.progressIndicator.taskComplete(c))}var b=this,c,d=b.getMainUser(),e=b.getMainTweet(),f,g;this.isFavorite?(g=TD.i("Unfavoriting"),TD.controller.clients.getClient(b.account.getKey()).unfavorite(b.id,i,h),f=TD.controller.stats.unfavorite):(g=TD.i("Favoriting"),TD.controller.clients.getClient(b.account.getKey()).favorite(b.id,i,h),f=TD.controller.stats.favorite),c=TD.controller.progressIndicator.addTask(g),f(d.id,e.id,b.account.getUserID())},TD.services.TwitterStatus.prototype.email=function(){var a=TD.i("Tweet forwarded by @{{1}}",{1:this.account.getUsername()}),b=[],c;b.push(this.text),b.push(TD.i("Original Tweet: {{1}}",{1:this.getChirpURL()})),b.push(TD.i("Sent via TweetDeck")),c=b.join("\n\n"),TD.util.openEmail(null,a,c)},TD.services.TwitterStatus.prototype.postComment=function(a,b,c){function j(a){TD.controller.progressIndicator.taskComplete(i),b(a)}function k(){TD.controller.progressIndicator.taskFailed(i),c()}var d=this.getMainTweet(),e=d.id,f=TD.controller.clients.getClient(this.account.getKey()),g=f.create(),h="@"+d.user.screenName.toLowerCase(),i;if(!a.length){TD.controller.progressIndicator.addMessage(TD.i("Sorry, empty updates are not allowed"));return}if(a.length>140)return;a.substr(0,h.length).toLowerCase()!=h&&(e=""),e!==""&&g.InReplyTo(e),g.WithMessage(a),i=TD.controller.progressIndicator.addTask(TD.i("Replying")),g.Post(j,k)},TD.services.TwitterStatus.prototype.reply=function(){TD.ui.compose.reply(this,this.account.getKey())},TD.services.TwitterStatus.prototype.retweet=function(){var a=new TD.components.ActionDialog(this)},TD.services.TwitterStatus.prototype.dm=function(){this.user.message()},TD.services.TwitterStatus.prototype.referenceTo=function(){var a=this.account.getKey();TD.ui.compose.referenceTo(this.getChirpURL(),a)},TD.services.TwitterStatus.prototype.follow=function(){this._action("follow",function(a){a.user.following=!0})},TD.services.TwitterStatus.prototype.unfollow=function(){this._action("unfollow",function(a){a.user.following=!1})},TD.services.TwitterStatus.prototype.block=function(){this._action("block")},TD.services.TwitterStatus.prototype.reportSpam=function(){var a=this,b=a.getMainUser();a._action("reportSpam"),TD.controller.stats.spam(b.screenName,b.id,a.account.userId)},TD.services.TwitterStatus.prototype.scanForMedia=function(){var a=TD.settings.getShowInlineMedia();if(a&&!this.embeds){this.embeds=[];var b=this;TD.services.media.getEmbedableContent(this,function(a,c){b.embeds.push(a);var d=TD.ui.template.render("status/chirp_media_thumbs",b);TD.ui.updates.insertMediaEmbed(b.id,d)})}},TD.services.TwitterStatus.prototype._action=function(a,b){function h(){TD.controller.progressIndicator.taskFailed(e)}function i(a){a.error?(TD.controller.progressIndicator.changeMessage(e,f+" - "+a.error),h()):(TD.controller.progressIndicator.taskComplete(e),b&&b(c))}var c=this,d=TD.controller.clients.getClient(this.account.getKey()),e,f,g;switch(a){case"delete":this.retweetedStatus?f=TD.i("Undoing Retweet"):f=TD.i("Deleting"),d=TD.controller.clients.getClient(this.creatorAccount.getKey()),d.destroy(this.id,i,h);break;case"deleteDM":f=TD.i("Deleting"),this.creatorAccount&&(d=TD.controller.clients.getClient(this.creatorAccount.getKey())),d.destroyDM(this.id,i,h);break;case"block":g=this.getMainUser(),f=TD.i("Block {{1}}",{1:this.user.screenName}),d.blockUser(g.screenName,i,h);break;case"reportSpam":g=this.getMainUser(),f=TD.i("Report {{1}} for spam",{1:this.user.screenName}),d.blockAndReportUser(g.screenName,i,h)}e=TD.controller.progressIndicator.addTask(f)},TD.services.TwitterStatus.prototype._entitySort=function(a,b){return b.indices[0]-a.indices[0]},TD.services.TwitterStatus.prototype.getFilterableText=function(){var a="",b;return this._filterableText?a=this._filterableText:this.entities.urls.length===0&&this.entities.media.length===0?a=this.text:(b=[this.text],b=b.concat(_.pluck(this.entities.urls,"expanded_url")),b=b.concat(_.pluck(this.entities.media,"expanded_url")),b=_.compact(b),a=b.join(" "),this._filterableText=a),a},TD.services.TwitterStatus.prototype.setRetweeted=function(a){this.isRetweeted=a,this.getDOMChirps().toggleClass(TD.services.ChirpBase.RETWEET_CLASS,a),this._changed()},TD.services.TwitterStatus.prototype.setFavorite=function(a){this.isFavorite=a,this.getDOMChirps().toggleClass(TD.services.ChirpBase.FAVORITE_CLASS,a).find('a[rel="favorite"]').attr("title",TD.ui.template.render("text/favorite_action",this)),this._changed()},TD.services.TwitterStatus.prototype.isMention=function(){var a=String(this.account.getUserID()),b=this.account.getUsername().toLowerCase(),c=this.entities.user_mentions.length,d;for(var e=0;e<c;e++){d=this.entities.user_mentions[e];if(d.id_str){if(d.id_str===a)return!0}else if(d.screen_name.toLowerCase()===b)return!0}return!1},TD.services.TwitterDirectMessage=function(a){this.account=a},TD.services.TwitterDirectMessage.prototype=new TD.services.TwitterStatus,TD.services.TwitterDirectMessage.prototype.fromJSONObject=function(a){return this.id=a.id_str||String(a.id),this.text=a.text,this.sender=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.sender),this.recipient=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.recipient),this.creatorAccount=TD.storage.accountController.get(TD.storage.Account.generateKeyFor("twitter",this.sender.id)),this.created=TD.util.parseDateString(a.created_at),this.createdDate=TD.util.prettyDate(this.created),this.entities=a.entities||{urls:[],hashtags:[],user_mentions:[],media:[],other:[]},this.htmlText=TD.util.transform(this.text,this.entities),this},TD.services.TwitterDirectMessage.prototype.hasLocationData=function(){return!1},TD.services.TwitterDirectMessage.prototype.getMainUser=function(){return this.sender},TD.services.TwitterDirectMessage.prototype.isOwnChirp=function(){return Boolean(this.creatorAccount)},TD.services.TwitterDirectMessage.prototype.dm=function(){var a=this.sender;this.isOwnChirp()&&(a=this.recipient),TD.ui.compose.directMessage(a.screenName,this.account.getKey())},TD.services.TwitterDirectMessage.prototype.getChirpURL=function(){return""},TD.services.TwitterDirectMessage.prototype.destroy=function(){var a=this;this._action("deleteDM",function(){var b=TD.controller.clients.getClient(a.account.getKey());b.deleteMessage(a.id)})},TD.services.TwitterDirectMessage.prototype.render=function(a){return TD.ui.template.render("status/message_twitter",{tweets:[this],extraClasses:a})},TD.services.TwitterDirectMessage.prototype.renderNotification=function(){return TD.ui.template.render("status/message_twitter",{tweets:[this],isPopup:!0})},TD.services.TwitterDirectMessage.prototype.toggleFavorite=function(){return},TD.services.TwitterDirectMessage.prototype.passFilters=function(a){return TD.controller.filterManager.pass(a,this.text,this.sender.screenName,null)},TD.services.TwitterDirectMessage.prototype.getCorrespondent=function(){var a=this.account.getUserID();return this.sender.id==a?this.recipient:this.sender},TD.services.TwitterMessageThread=function(a,b){this.account=a,this.correspondent=b,this.id="messagethread-"+a.getUserID()+"-"+b.id,this.messages=[],this.messageIndex={}},TD.services.TwitterMessageThread.prototype=new TD.services.ChirpBase,TD.services.TwitterMessageThread.prototype.correspondent=null,TD.services.TwitterMessageThread.prototype.unread=!1,TD.services.TwitterMessageThread.prototype.replied=!1,TD.services.TwitterMessageThread.prototype.messages=null,TD.services.TwitterMessageThread.prototype.messageIndex=null,TD.services.TwitterMessageThread.prototype.addMessages=function(a){var b,c,d=!1,e=this.account.getUserID();if(a.length===0)return;for(b=0,c=a.length;b<c;b++){var f=a[b];if(this.messageIndex[f.id])continue;d=!0;if(f.recipient.id!=e||f.sender.id!=this.correspondent.id)if(f.recipient.id!=this.correspondent.id||f.sender.id!=e)throw new Error("Wrong thread!");this.messages.push(f),this.messageIndex[f.id]=f}return this.messages.sort(TD.util.chirpDescSort),this.calculateAttributes(),d},TD.services.TwitterMessageThread.prototype.removeMessage=function(a){var b=this.messageIndex[a];return b?(delete this.messageIndex[a],this.messages=_.select(this.messages,function(b){return b.id!==a}),this.calculateAttributes(),!0):!1},TD.services.TwitterMessageThread.prototype.calculateAttributes=function(){var a=this.account.getUserID();if(this.messages.length===0)return;this.messages[0].sender.id==a&&(this.replied=!0,this.unread=!1),this.created=this.messages[0].created;var b=_.detect(this.messages,function(b){return b.recipient.id==a});b?(this.text=b.text,this.htmlText=b.htmlText):this.messages.length>0&&(this.text=this.messages[0].text,this.htmlText=this.messages[0].htmlText)},TD.services.TwitterMessageThread.prototype.render=function(a){return TD.ui.template.render("status/message_thread",{extraClasses:a,chirp:this})},TD.services.TwitterMessageThread.prototype.update=function(a){return!0},TD.services.TwitterMessageThread.prototype.getSinceId=function(){var a="",b=_.first(this.messages);return b&&(a=b.id),a},TD.services.TwitterMessageThread.prototype.getUnreadChirps=function(a){var b,c=[];for(var d=0,e=this.messages.length;d<e;d++){b=this.messages[d];if(b.created.getTime()<=a)break;b.isOwnChirp()||(c.push(b),d===0&&(this.unread=!0,this.replied=!1))}return c},TD.services.TwitterMessageThread.prototype.postComment=function(a,b,c){function g(a){TD.controller.progressIndicator.taskComplete(f),b&&b()}function h(){TD.controller.progressIndicator.taskFailed(f),c&&c()}var d=TD.controller.clients.getClient(this.account.getKey()),e=d.create(),f;if(!a.length){c();return}e.DirectlyTo(this.correspondent.screenName),e.WithMessage(a),f=TD.controller.progressIndicator.addTask(TD.i("Sending...")),e.Post(g,h)},TD.services.TwitterMessageThread.prototype.setUnread=function(a){this.unread=a,this.getDOMChirps().toggleClass(TD.services.ChirpBase.UNREAD_CLASS,a),this._changed()},TD.services.TwitterUser=function(a){this.account=a},TD.services.TwitterUser.prototype.fromJSONObject=function(a){return this.id=a.id_str,this.screenName=a.screen_name,this.profileImageURL=a.profile_image_url_https,this.name=a.name,this.location=a.location,this.description=a.description,this.entities=a.entities,this.friendsCount=a.friends_count,this.listedCount=a.listed_count,this.followersCount=a.followers_count,this.statusesCount=a.statuses_count,this.favoritesCount=a.favourites_count,this.listedCount=a.listed_count,this.url=a.url,this.isProtected=a["protected"],this.isVerified=a.verified,this.isTranslator=a.is_translator,this.following=a.following,a.status&&(this.lastStatus=(new TD.services.TwitterStatus(this.account)).fromJSONObject(a.status),this.lastStatus.user=this),TD.cache.twitterUsers.add(this),this.following&&TD.cache.autocomplete.add(this,!0),this},TD.services.TwitterUser.prototype.isMe=function(){return this.account.getUserID()==this.id},TD.services.TwitterUser.prototype.largeProfileImageURL=function(){return this.profileImageURL.replace("_normal","")},TD.services.TwitterUser.prototype.reasonablySmallProfileImageURL=function(){return this.profileImageURL.replace("_normal","_reasonably_small")},TD.services.TwitterUser.prototype.biggerProfileImageURL=function(){return this.profileImageURL.replace("_normal","_bigger")},TD.services.TwitterUser.prototype.miniProfileImageURL=function(){return this.profileImageURL.replace("_normal","_mini")},TD.services.TwitterUser.prototype.prettyFollowersCount=function(){return TD.util.prettyNumber(this.followersCount)},TD.services.TwitterUser.prototype.prettyFriendsCount=function(){return TD.util.prettyNumber(this.friendsCount)},TD.services.TwitterUser.prototype.prettyListedCount=function(){return TD.util.prettyNumber(this.listedCount)},TD.services.TwitterUser.prototype.prettyStatusesCount=function(){return TD.util.prettyNumber(this.statusesCount)},TD.services.TwitterUser.prototype.follow=function(a,b,c){var d=TD.controller.clients.getClient(a.getKey()),e=this,f=function(a){e.following=!0,b&&b(a)};d.followUser(this.screenName,f,c)},TD.services.TwitterUser.prototype.unfollow=function(a,b,c){var d=TD.controller.clients.getClient(a.getKey()),e=this,f=function(){e.removeFromView(a,!0),e.following=!1,b&&b()};d.unfollowUser(this.screenName,f,c)},TD.services.TwitterUser.prototype.unblock=function(a,b,c){var d=TD.controller.clients.getClient(a.getKey());d.unfollowUser(this.screenName,b,c)},TD.services.TwitterUser.prototype.block=function(a,b,c,d){var e=this,f=TD.controller.clients.getClient(a.getKey()),g=function(b){TD.controller.progressIndicator.addMessage(h),e.following=!1,$.publish("/user/"+e.screenName+"/blocked",[e.account]),e.removeFromView(a,!1)},h;$.publish("/user/"+this.screenName+"/block",[this.account]),b?(f.blockAndReportUser(this.screenName,g,d),h=TD.i("Successfully blocked and reported @{{screenName}}",{screenName:this.screenName})):(f.blockUser(this.screenName,g,d),h=TD.i("Successfully blocked @{{screenName}}",{screenName:this.screenName}))},TD.services.TwitterUser.prototype.removeFromView=function(a,b){$.publish("/user/removeTweets",[this.screenName,a.getUserID(),b])},TD.services.TwitterUser.prototype.bio=function(){var a=this.entities&&this.entities.description||{};return TD.util.transform(this.description,a)},TD.services.TwitterUser.prototype.htmlLocation=function(){var a=this.entities&&this.entities.location||{};return TD.util.transform(this.location,a)},TD.services.TwitterUser.prototype.hasLocation=function(){return Boolean(this.htmlLocation())},TD.services.TwitterUser.prototype.isUserOwner=function(){return this.id==this.account.getUserID()},TD.services.TwitterUser.prototype.getFollowerURL=function(){return"http://twitter.com/"+this.screenName+"/followers"},TD.services.TwitterUser.prototype.getFriendURL=function(){return"http://twitter.com/"+this.screenName+"/following"},TD.services.TwitterUser.prototype.getProfileURL=function(){return"http://twitter.com/"+this.screenName},TD.services.TwitterUser.prototype.getListedURL=function(){return"http://twitter.com/"+this.screenName+"/lists/memberships"},TD.services.TwitterUser.prototype.getDisplayURL=function(){var a=this.entities;return a&&a.url&&a.url.urls&&a.url.urls.length&&a.url.urls[0].display_url?a.url.urls[0].display_url:this.url},TD.services.TrendingTopic=function(){},TD.services.TrendingTopic.prototype.name="",TD.services.TrendingTopic.prototype.query="",TD.services.TrendingTopic.prototype.url="",TD.services.TrendingTopic.prototype.description="",TD.services.TrendingTopic.prototype.attribution="",TD.services.TrendingTopic.prototype.created=0,TD.services.TrendingTopic.prototype.promotedContent=null,TD.services.TrendingTopic.prototype.events=null,TD.services.TrendingTopic.prototype.fromJSONObject=function(a){return this.name=a.name,this.query=a.query,this.promotedContent=a.promoted_content,this.events=a.events,this.created=(new Date).getTime(),this.query=encodeURIComponent(this.name),this.url||(this.url="http://search.twitter.com/search?q="+this.query),this.promotedContent&&this.promotedContent.description&&(this.description=TD.util.escape(this.promotedContent.description)),this},TD.services.TrendLocation=function(){},TD.services.TrendLocation.prototype.PLACE_TYPE_SUPERNAME=19,TD.services.TrendLocation.prototype.PLACE_TYPE_COUNTRY=12,TD.services.TrendLocation.prototype.PLACE_TYPE_TOWN=7,TD.services.TrendLocation.prototype.placeType=null,TD.services.TrendLocation.prototype.name="",TD.services.TrendLocation.prototype.woeid=-1,TD.services.TrendLocation.prototype.url="",TD.services.TrendLocation.prototype.countryCode="",TD.services.TrendLocation.prototype.country="",TD.services.TrendLocation.prototype.label="",TD.services.TrendLocation.prototype.sortString="",TD.services.TrendLocation.prototype.isTown=!1,TD.services.TrendLocation.prototype.fromJSONObject=function(a){this.name=a.name,this.woeid=a.woeid,this.url=a.url,this.countryCode=a.countryCode,this.country=a.country,this.placeType=a.placeType;switch(this.placeType.code){case this.PLACE_TYPE_TOWN:this.label="â"+this.name,this.sortString=this.country+this.name,this.isTown=!0;break;case this.PLACE_TYPE_SUPERNAME:this.label=this.name.toUpperCase(),this.sortString="";break;default:this.label=this.name,this.sortString=this.name}return this},TD.services.TwitterList=function(a){this.account=a},TD.services.TwitterList.prototype.fromJSONObject=function(a){return this.id=a.id_str,this.name=a.name,this.description=a.description,this.slug=a.slug,this.fullName=a.full_name,this.memberCount=a.member_count,this.isPrivate=a.mode==="private",this.user=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.user),this},TD.services.TwitterList.prototype.isOwnList=function(){var a=TD.storage.Account.generateKeyFor("twitter",this.user.id),b=TD.storage.accountController.get(a);return Boolean(b)},TD.services.TwitterSearchParser=function(a){this.query=a,this.terms=[],this.init()},TD.services.TwitterSearchParser.PUNCT=new RegExp("["+twttr.txt.regexen.punct.source+"]","g"),TD.services.TwitterSearchParser.ALLOWED_CHARS=["@","#",'"',"-"],TD.services.TwitterSearchParser.isStreamable=function(a){var b=a.match(TD.services.TwitterSearchParser.PUNCT),c=_.difference(b,TD.services.TwitterSearchParser.ALLOWED_CHARS);return c.length===0},TD.services.TwitterSearchParser.prototype.PHRASE="phrase",TD.services.TwitterSearchParser.prototype.NEGATIVE_PHRASE="negPhrase",TD.services.TwitterSearchParser.prototype.AND="and",TD.services.TwitterSearchParser.prototype.OR="or",TD.services.TwitterSearchParser.prototype.query="",TD.services.TwitterSearchParser.prototype.trackQuery="",TD.services.TwitterSearchParser.prototype.thePhrase="",TD.services.TwitterSearchParser.prototype.type="",TD.services.TwitterSearchParser.prototype.init=function(){if(this.trackQuery)return;var a,b;typeof this.query=="string"?b=this.extractPhrases(this.query):b=this.query;if(b.length!==0)if(b.length===1)this.thePhrase=b[0].toLowerCase(),this.thePhrase.charAt(0)==="-"&&this.thePhrase.indexOf(" ")===-1?(this.type=this.NEGATIVE_PHRASE,this.thePhrase=this.thePhrase.slice(1),this.trackQuery=""):(this.type=this.PHRASE,this.trackQuery=this.thePhrase);else{var c=[[]],d=!0,e;for(e=0;e<b.length;e++){a=b[e];if(a==="OR"){_.last(c).push(a),d=!0;continue}if(a==="AND")continue;d?_.last(c).push(a):c.push([a]),d=!1}c=_.reject(c,function(a){return _.isEmpty(a)});if(c.length>1){this.type=this.AND;for(e=0;e<c.length;e++){var f=c[e];f.length>0&&this.terms.push(new TD.services.TwitterSearchParser(f))}this.trackQuery=this.calculateANDTrackQuery(c)}else{this.type=this.OR;for(e=0;e<c[0].length;e++)a=c[0][e],a!="OR"&&(this.terms.push(new TD.services.TwitterSearchParser([a])),a.charAt(0)!="-"&&(this.trackQuery&&(this.trackQuery+=","),this.trackQuery+=a))}}},TD.services.TwitterSearchParser.prototype.calculateANDTrackQuery=function(a){var b=[""];for(var c=0;c<a.length;c++){var d=a[c],e=[];for(var f=0;f<d.length;f++){var g=d[f];if(g=="OR")continue;if(g.charAt(0)=="-")e=b;else for(var h=0;h<b.length;h++){var i=b[h],j=i?i+" ":"";j+=g,e.push(j)}}b=e}return b.join(",")},TD.services.TwitterSearchParser.prototype.extractPhrases=function(a){var b,c=[],d=a.split('"');for(var e=0;e<d.length;e++){if(!d[e])continue;if(e%2==1&&e<d.length-1)b=d[e].trim(),b&&c.push(b);else{var f=d[e].split(" ");for(var g=0;g<f.length;g++)b=f[g],b=b.trim(),b&&c.push(b)}}return c},TD.services.TwitterSearchParser.prototype.match=function(a,b){var c,d;b||(a=a.toLowerCase());switch(this.type){case this.PHRASE:return a.indexOf(this.thePhrase)!==-1;case this.NEGATIVE_PHRASE:return a.indexOf(this.thePhrase)===-1;case this.AND:for(c=0;c<this.terms.length;c++){d=this.terms[c];if(!d.match(a,!0))return!1}return!0;case this.OR:for(c=0;c<this.terms.length;c++){d=this.terms[c];if(d.match(a,!0))return!0}return!1;default:return!1}},TD.services.StreamEngine=klass(function(a,b){this._account=a,this._callback=b,this._url="",this._state=TD.services.StreamEngine.DISCONNECTED,this._stream=null,this._backoffLimit=0,this._backoffTimeout=null,this._keepaliveTimeout=null,this._handleData=TD.util.bind(this._handleData,this),this._handleStreamInterruption=TD.util.bind(this._handleStreamInterruption,this)}).statics({BACKOFF_PERIOD_MIN:2e4,BACKOFF_PERIOD_MAX:24e4,BACKOFF_PERIOD_MAX_EXTENDED:72e4,KEEPALIVE_PERIOD:9e4,CHROME_BYTE_LIMIT:5e7,DISCONNECTED:"disconnected",CONNECTING:"connecting",STREAMING:"streaming",DEBUG:!1}).methods({log:function(){TD.services.StreamEngine.DEBUG&&(console.log((new Date).toUTCString(),">",this._account.getUsername(),">",arguments),TD.util.insertLogDivider())},connect:function(a){if(a===this._url){this.log("Connect",a,"Already connecting/connected. Do nothing");return}a?(this.log("Connect",a),this.disconnect(),this._url=a,this._startNewStream()):(this.log("Connect",a,"Nothing to stream. Disconnecting"),this.disconnect())},disconnect:function(){this.log("Disconnect completely"),this._state=TD.services.StreamEngine.DISCONNECTED,this._disconnectStream(),this._url="",this._backoffLimit=0},isStreaming:function(){var a=this._state===TD.services.StreamEngine.STREAMING;return this.log("isStreaming",a),a},_startNewStream:function(){this._disconnectStream(),this.log("Start stream"),this._state=TD.services.StreamEngine.CONNECTING,this._stream=this._createStreamRequest(),this._stream.goStreaming()},_disconnectStream:function(){this._stream&&(this.log("Disconnect stream"),this._stream.onStreaming.disconnect&&(this._stream.onStreaming.disconnect(this._handleData),this._stream.onFailure.disconnect(this._handleStreamInterruption)),this._stream.deleteLater(),this._stream=null),clearTimeout(this._backoffTimeout),clearTimeout(this._keepaliveTimeout),this._backoffTimeout=null,this._keepaliveTimeout=null},_handleData:function(a){var b=this;switch(this._state){case TD.services.StreamEngine.DISCONNECTED:return;case TD.services.StreamEngine.CONNECTING:this._state=TD.services.StreamEngine.STREAMING,this._backoffLimit=0,this.log("Stream is functioning")}a&&(a=_.strip(a),a.length&&this._callback(JSON.parse(a))),clearTimeout(this._keepaliveTimeout),this._keepaliveTimeout=setTimeout(function(){b._handleStreamInterruption("Keepalive timeout",0)},TD.services.StreamEngine.KEEPALIVE_PERIOD),TD.util.isChromeApp()&&this._stream.receivedChars>TD.services.StreamEngine.CHROME_BYTE_LIMIT&&(this.log("Reached chrome byte limit, reconnecting"),this._startNewStream())},_handleStreamInterruption:function(a,b){this.log("Stream interrupted",a,b);switch(this._state){case TD.services.StreamEngine.DISCONNECTED:break;case TD.services.StreamEngine.CONNECTING:this._disconnectStream(),this._setBackoffTimeout(b);break;case TD.services.StreamEngine.STREAMING:this._startNewStream()}},_setBackoffTimeout:function(a){var b=this;this._backoffLimit=Math.max(this._backoffLimit,TD.services.StreamEngine.BACKOFF_PERIOD_MIN),this._backoffLimit*=2,String(a)==="420"?this._backoffLimit=Math.min(this._backoffLimit,TD.services.StreamEngine.BACKOFF_PERIOD_MAX_EXTENDED):this._backoffLimit=Math.min(this._backoffLimit,TD.services.StreamEngine.BACKOFF_PERIOD_MAX);var c=this._backoffLimit/2,d=c+Math.ceil(Math.random()*c);this.log("Set backoff timeout",(d/1e3).toString()+"s"),this._state=TD.services.StreamEngine.CONNECTING,this._backoffTimeout=setTimeout(function(){b.log("Backoff complete, attempting reconnect"),b._startNewStream()},d)},_createStreamRequest:function(){var a;if(TD.util.isChromeApp()){var b=chrome.extension.getBackgroundPage();a=new b.TD.bg.StreamRequest(this._url,TD.config.api_root,this._account)}else TD.util.isWrapperApp()&&(a=deck.signedRequestFactory("GET",this._url,"","","",this._account.getOAuthToken(),this._account.getTokenSecret()));return a.onStreaming.connect(this._handleData),a.onFailure.connect(this._handleStreamInterruption),a}}),TD.services.TwitterAction=function(a){this.account=a},TD.services.TwitterAction.FAVORITE="favorite",TD.services.TwitterAction.RETWEET="retweet",TD.services.TwitterAction.FOLLOW="follow",TD.services.TwitterAction.LIST_MEMBER_ADDED="list_member_added",TD.services.TwitterAction.LIST_CREATED="list_created",TD.services.TwitterAction.UNFAVORITE="unfavorite",TD.services.TwitterAction.LIST_MEMBER_REMOVED="list_member_removed",TD.services.TwitterAction.LIST_DESTROYED="list_destroyed",TD.services.TwitterAction.UNFOLLOW="unfollow",TD.services.TwitterAction.processStreamAction=function(a,b){var c=TD.services.TwitterAction._getActionConstructor(a.event);return(new c(b)).fromJSONObject(a,null,!0)},TD.services.TwitterAction.processRESTAction=function(a,b){var c=TD.services.TwitterAction._getActionConstructor(a.action),d=a.sources,e=a.targets_size>0?a.targets:[undefined],f=a.target_objects_size>0?a.target_objects:[undefined],g=[];for(var h=0;h<d.length;h++){if(a.action===TD.services.TwitterAction.RETWEET){if(f[0].user.id!=b.getUserID())continue;g.push([a,d[h],e[h],f[0]]);continue}for(var i=0;i<e.length;i++)for(var j=0;j<f.length;j++)g.push([a,d[h],e[i],f[j]])}var k=_.map(g,function(d){return(new c(b)).fromJSONObject(a,d,!1)});return k},TD.services.TwitterAction._getActionConstructor=function(a){switch(a){case TD.services.TwitterAction.FAVORITE:case TD.services.TwitterAction.UNFAVORITE:return TD.services.TwitterActionFavorite;case TD.services.TwitterAction.RETWEET:return TD.services.TwitterActionRetweet;case TD.services.TwitterAction.FOLLOW:case TD.services.TwitterAction.UNFOLLOW:return TD.services.TwitterActionFollow;case TD.services.TwitterAction.LIST_MEMBER_ADDED:case TD.services.TwitterAction.LIST_MEMBER_REMOVED:return TD.services.TwitterActionListMemberAdded;case TD.services.TwitterAction.LIST_CREATED:case TD.services.TwitterAction.LIST_DESTROYED:return TD.services.TwitterActionListCreated;default:return TD.services.TwitterAction}},TD.services.TwitterAction.prototype=new TD.services.ChirpBase,TD.services.TwitterAction.prototype.action=null,TD.services.TwitterAction.prototype.maxPosition=null,TD.services.TwitterAction.prototype.minPosition=null,TD.services.TwitterAction.msFudge=0,TD.services.TwitterAction.prototype.fromJSONObject=function(a,b,c){return c?this.fromStreamData(a):this.fromRESTData.apply(this,b),this.created=TD.util.parseDateString(a.created_at),this.fudgeCreatedTime(this.created),this.maxPosition=a.max_position||this.created.getTime().toString(),this.minPosition=a.min_position||this.created.getTime().toString(),this.generateInternalID(),this.generateText(),this},TD.services.TwitterAction.prototype.fromRESTData=function(a,b,c,d){throw"TwitterAction.fromRESTData not implemented"},TD.services.TwitterAction.prototype.fromStreamData=function(a){throw"TwitterAction.fromStreamData not implemented"},TD.services.TwitterAction.prototype.generateInternalID=function(){throw"TwitterAction.generateInternalID not implemented"},TD.services.TwitterAction.prototype.generateText=function(){},TD.services.TwitterAction.prototype.render=function(a){throw"TwitterAction.render not implemented"},TD.services.TwitterAction.prototype.renderNotification=function(){throw"TwitterAction.renderNotification not implemented"},TD.services.TwitterAction.prototype.isAboutYou=function(){throw"TwitterAction.isAboutYou not implemented"},TD.services.TwitterAction.prototype.isOwnChirp=function(){throw"TwitterAction.isOwnChirp not implemented"},TD.services.TwitterAction.prototype.getChirpURL=function(){return"http://twitter.com/activity"},TD.services.TwitterAction.prototype.getRelatedTweet=function(){return null},TD.services.TwitterActionRetweet=function(a){this.account=a},TD.services.TwitterActionRetweet.prototype=new TD.services.TwitterAction,TD.services.TwitterActionRetweet.prototype.action=TD.services.TwitterAction.RETWEET,TD.services.TwitterActionRetweet.prototype.user=null,TD.services.TwitterActionRetweet.prototype.retweet=null,TD.services.TwitterActionRetweet.prototype.retweetedStatus=null,TD.services.TwitterActionRetweet.prototype.fromRESTData=function(a,b,c,d){this.user=(new TD.services.TwitterUser(this.account)).fromJSONObject(b),this.retweet=(new TD.services.TwitterStatus(this.account)).fromJSONObject(c),this.retweetedStatus=(new TD.services.TwitterStatus(this.account)).fromJSONObject(d)},TD.services.TwitterActionRetweet.prototype.fromStreamData=function(a){this.user=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.source),this.retweet=(new TD.services.TwitterStatus(this.account)).fromJSONObject(a.target),this.retweetedStatus=this.retweet.retweetedStatus},TD.services.TwitterActionRetweet.prototype.generateInternalID=function(){this.id=[this.action,this.user.id,this.retweetedStatus.id].join("_")},TD.services.TwitterActionRetweet.prototype.fromRetweet=function(a){return this.user=a.user,this.retweet=a,this.retweetedStatus=a.retweetedStatus,this.created=new Date(a.created),this.fudgeCreatedTime(this.created),this.generateInternalID(),this.maxPosition=this.minPosition=this.created.getTime().toString(),this},TD.services.TwitterActionRetweet.prototype.render=function(a){return this.retweet.scanForMedia(),TD.ui.template.render("status/action_retweet",{isAboutYou:this.isAboutYou(),data:this,extraClasses:a})},TD.services.TwitterActionRetweet.prototype.renderNotification=function(){return TD.ui.template.render("status/action_retweet",{isAboutYou:this.isAboutYou(),data:this,isPopup:!0})},TD.services.TwitterActionRetweet.prototype.isAboutYou=function(){return this.retweetedStatus.user.id==this.account.getUserID()},TD.services.TwitterActionRetweet.prototype.isOwnChirp=function(){return this.user.id==this.account.getUserID()},TD.services.TwitterActionRetweet.prototype.getCreator=function(){return this.user},TD.services.TwitterActionRetweet.prototype.getGrowlData=function(){return{title:this.isOwnChirp()?TD.i("{{1}} retweeted your Tweet:",{1:this.user.name}):TD.i("{{1}} retweeted:",{1:this.user.name}),img:this.user.profileImageURL,text:this.retweet.text}},TD.services.TwitterActionRetweet.prototype.getRelatedTweet=function(){return this.retweetedStatus},TD.services.TwitterActionRetweet.prototype.passFilters=function(a){return this.getRelatedTweet().passFilters(a)&&TD.controller.filterManager.pass(a,null,[this.user.screenName],null)},TD.services.TwitterActionListCreated=function(a){this.account=a},TD.services.TwitterActionListCreated.prototype=new TD.services.TwitterAction,TD.services.TwitterActionListCreated.prototype.action=TD.services.TwitterAction.LIST_CREATED,TD.services.TwitterActionListCreated.prototype.owner=null,TD.services.TwitterActionListCreated.prototype.list=null,TD.services.TwitterActionListCreated.prototype.fromRESTData=function(a,b,c){this.owner=(new TD.services.TwitterUser(this.account)).fromJSONObject(b),this.list=(new TD.services.TwitterList(this.account)).fromJSONObject(c)},TD.services.TwitterActionListCreated.prototype.fromStreamData=function(a){this.owner=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.source),this.list=(new TD.services.TwitterList(this.account)).fromJSONObject(a.target_object)},TD.services.TwitterActionListCreated.prototype.generateInternalID=function(){this.id=[this.action,this.owner.id,this.list.id].join("_")},TD.services.TwitterActionListCreated.prototype.generateText=function(){var a=TD.i("{{{owner}}} created list {{{list}}}",null,!0);this.text=TD.ui.template.toHtml(a,{owner:this.owner.name,list:this.list.fullName}),this.htmlText=TD.ui.template.toHtml(a,{owner:TD.ui.template.render("text/user_link_fullname",this.owner),list:TD.ui.template.render("text/list_link",this.list)})},TD.services.TwitterActionListCreated.prototype.isOwnChirp=function(){return this.owner.id==this.account.getUserID()},TD.services.TwitterActionListCreated.prototype.isAboutYou=function(){return!1},TD.services.TwitterActionListCreated.prototype.getCreator=function(){return this.owner},TD.services.TwitterActionListCreated.prototype.render=function(a){var b={chirp:this,extraClasses:a};return TD.ui.template.render("status/action_list",b)},TD.services.TwitterActionListCreated.prototype.renderNotification=function(){return this.render(null)},TD.services.TwitterActionListCreated.prototype.getGrowlData=function(){return{title:this.text,img:null,text:this.list.description}},TD.services.TwitterActionListCreated.prototype.passFilters=function(a){return TD.controller.filterManager.pass(a,this.getFilterableText(),[this.owner.screenName],null)},TD.services.TwitterActionListMemberAdded=function(a){this.account=a},TD.services.TwitterActionListMemberAdded.prototype=new TD.services.TwitterAction,TD.services.TwitterActionListMemberAdded.prototype.action=TD.services.TwitterAction.LIST_MEMBER_ADDED,TD.services.TwitterActionListMemberAdded.prototype.owner=null,TD.services.TwitterActionListMemberAdded.prototype.added=null,TD.services.TwitterActionListMemberAdded.prototype.list=null,TD.services.TwitterActionListMemberAdded.prototype.fromRESTData=function(a,b,c,d){this.owner=(new TD.services.TwitterUser(this.account)).fromJSONObject(b),this.added=(new TD.services.TwitterUser(this.account)).fromJSONObject(c),this.list=(new TD.services.TwitterList(this.account)).fromJSONObject(d)},TD.services.TwitterActionListMemberAdded.prototype.fromStreamData=function(a){this.owner=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.source),this.added=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.target),this.list=(new TD.services.TwitterList(this.account)).fromJSONObject(a.target_object)},TD.services.TwitterActionListMemberAdded.prototype.generateInternalID=function(){this.id=[this.action,this.owner.id,this.added.id,this.list.id].join("_")},TD.services.TwitterActionListMemberAdded.prototype.generateText=function(){var a;this.isAboutYou()?a=TD.i("{{{owner}}} added you to list {{{list}}}",null,!0):a=TD.i("{{{owner}}} added {{{added}}} to list {{{list}}}",null,!0),this.text=TD.ui.template.toHtml(a,{owner:this.owner.name,added:this.added.name,list:this.list.fullName}),this.htmlText=TD.ui.template.toHtml(a,{owner:TD.ui.template.render("text/user_link_fullname",this.owner),added:TD.ui.template.render("text/user_link_fullname",this.added),list:TD.ui.template.render("text/list_link",this.list)})},TD.services.TwitterActionListMemberAdded.prototype.isOwnChirp=function(){return this.owner.id==this.account.getUserID()},TD.services.TwitterActionListMemberAdded.prototype.isAboutYou=function(){return this.added.id==this.account.getUserID()},TD.services.TwitterActionListMemberAdded.prototype.getCreator=function(){return this.owner},TD.services.TwitterActionListMemberAdded.prototype.render=function(a){var b={chirp:this,extraClasses:a};return TD.ui.template.render("status/action_list",b)},TD.services.TwitterActionListMemberAdded.prototype.renderNotification=function(){return this.render(null)},TD.services.TwitterActionListMemberAdded.prototype.getGrowlData=function(){return{title:this.text,img:null,text:this.list.description}},TD.services.TwitterActionListMemberAdded.prototype.passFilters=function(a){return TD.controller.filterManager.pass(a,this.getFilterableText(),[this.owner.screenName],null)},TD.services.TwitterActionMultiListMemberAdded=function(a){this.account=a},TD.services.TwitterActionMultiListMemberAdded.prototype=new TD.services.TwitterAction,TD.services.TwitterActionMultiListMemberAdded.prototype.action="multi_list_member_added",TD.services.TwitterActionMultiListMemberAdded.prototype.owner=null,TD.services.TwitterActionMultiListMemberAdded.prototype.added=null,TD.services.TwitterActionMultiListMemberAdded.prototype.lists=null,TD.services.TwitterActionMultiListMemberAdded.prototype.fromRESTData=function(a){this.owner=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.sources[0]),this.added=_.map(a.targets,function(a){return(new TD.services.TwitterUser(this.account)).fromJSONObject(a)}),this.lists=_.map(a.target_objects,function(a){return(new TD.services.TwitterList(this.account)).fromJSONObject(a)})},TD.services.TwitterActionMultiListMemberAdded.prototype.generateInternalID=function(){var a=_.pluck(this.added,"id").sort().join("-"),b=_.pluck(this.lists,"id").sort().join("-");this.id=[this.action,this.owner.id,a,b].join("_")},TD.services.TwitterActionMultiListMemberAdded.prototype.generateText=function(){var a=TD.i("{{{owner}}} added {{{added}}} to lists {{{lists}}}",null,!0),b=[],c=[],d=[],e=[];_.each(this.added,function(a){b.push(a.name),c.push(TD.ui.template.render("text/user_link_fullname",a))}),_.each(this.lists,function(a){d.push(a.fullName),e.push(TD.ui.template.render("text/list_link",a))}),this.text=TD.ui.template.toHtml(a,{owner:this.owner.name,added:b.join(", "),lists:d.join(", ")}),this.htmlText=TD.ui.template.toHtml(a,{owner:TD.ui.template.render("text/user_link_fullname",this.owner),added:c.join(", "),lists:e.join(", ")})},TD.services.TwitterActionMultiListMemberAdded.prototype.isOwnChirp=function(){return!1},TD.services.TwitterActionMultiListMemberAdded.prototype.isAboutYou=function(){return!1},TD.services.TwitterActionMultiListMemberAdded.prototype.getCreator=function(){return this.owner},TD.services.TwitterActionMultiListMemberAdded.prototype.render=function(a){var b={chirp:this,extraClasses:a};return TD.ui.template.render("status/action_list",b)},TD.services.TwitterActionMultiListMemberAdded.prototype.renderNotification=function(){return this.render(null)},TD.services.TwitterActionMultiListMemberAdded.prototype.getGrowlData=function(){return{title:null,img:null,text:this.text}},TD.services.TwitterActionMultiListMemberAdded.prototype.passFilters=function(a){return TD.controller.filterManager.pass(a,this.getFilterableText(),[this.owner.screenName],null)},TD.services.TwitterActionFavorite=function(a){this.account=a},TD.services.TwitterActionFavorite.prototype=new TD.services.TwitterAction,TD.services.TwitterActionFavorite.prototype.action=TD.services.TwitterAction.FAVORITE,TD.services.TwitterActionFavorite.prototype.favoritedBy=null,TD.services.TwitterActionFavorite.prototype.favoritedTweet=null,TD.services.TwitterActionFavorite.prototype.fromRESTData=function(a,b,c,d){this.favoritedBy=(new TD.services.TwitterUser(this.account)).fromJSONObject(b),this.favoritedTweet=(new TD.services.TwitterStatus(this.account)).fromJSONObject(c)},TD.services.TwitterActionFavorite.prototype.fromStreamData=function(a){this.favoritedBy=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.source),this.favoritedTweet=(new TD.services.TwitterStatus(this.account)).fromJSONObject(a.target_object)},TD.services.TwitterActionFavorite.prototype.generateInternalID=function(){this.id=[this.action,this.favoritedBy.id,this.favoritedTweet.id].join("_")},TD.services.TwitterActionFavorite.prototype.generateText=function(){var a;this.isAboutYou()?a=TD.i("{{{user}}} favorited your Tweet:",null,!0):a=TD.i("{{{user}}} favorited:",null,!0),this.text=TD.ui.template.toHtml(a,{user:this.favoritedBy.name}),this.htmlText=TD.ui.template.toHtml(a,{user:TD.ui.template.render("text/user_link_fullname",this.favoritedBy)})},TD.services.TwitterActionFavorite.prototype.isOwnChirp=function(){return this.favoritedBy.id==this.account.getUserID()},TD.services.TwitterActionFavorite.prototype.isAboutYou=function(){return this.favoritedTweet.user.id==this.account.getUserID()},TD.services.TwitterActionFavorite.prototype.render=function(a){this.favoritedTweet.scanForMedia();var b={chirp:this,extraClasses:a};return TD.ui.template.render("status/action_favorite",b)},TD.services.TwitterActionFavorite.prototype.renderNotification=function(){return this.render(null)},TD.services.TwitterActionFavorite.prototype.getGrowlData=function(){var a;this.isAboutYou()?a="{{{user}}} favorited your Tweet:":a="{{{user}}} favorited {{{tweeter}}}'s Tweet:";var b=TD.i(a,{user:this.favoritedBy.name,tweeter:this.favoritedTweet.getMainUser().name});return{title:b,img:this.favoritedTweet.user.profileImageURL,text:this.favoritedTweet.text}},TD.services.TwitterActionFavorite.prototype.getRelatedTweet=function(){return this.favoritedTweet},TD.services.TwitterActionFavorite.prototype.getCreator=function(){return this.favoritedBy},TD.services.TwitterActionFavorite.prototype.passFilters=function(a){return this.getRelatedTweet().passFilters(a)&&TD.controller.filterManager.pass(a,null,[this.favoritedBy.screenName],null)},TD.services.TwitterActionFollow=function(a){this.account=a},TD.services.TwitterActionFollow.prototype=new TD.services.TwitterAction,TD.services.TwitterActionFollow.prototype.action=TD.services.TwitterAction.FOLLOW,TD.services.TwitterActionFollow.prototype.following=null,TD.services.TwitterActionFollow.prototype.followed=null,TD.services.TwitterActionFollow.prototype.fromRESTData=function(a,b,c,d){this.following=(new TD.services.TwitterUser(this.account)).fromJSONObject(b),this.followed=(new TD.services.TwitterUser(this.account)).fromJSONObject(c)},TD.services.TwitterActionFollow.prototype.fromStreamData=function(a){this.following=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.source),this.followed=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.target)},TD.services.TwitterActionFollow.prototype.generateInternalID=function(){this.id=[this.action,this.following.id,this.followed.id].join("_")},TD.services.TwitterActionFollow.prototype.generateText=function(){var a;this.isAboutYou()?a=TD.i("{{{user}}} followed you",null,!0):a=TD.i("{{{user}}} followed:",null,!0),this.text=TD.ui.template.toHtml(a,{user:this.following.name}),this.htmlText=TD.ui.template.toHtml(a,{user:TD.ui.template.render("text/user_link_fullname",this.following)})},TD.services.TwitterActionFollow.prototype.render=function(a){return TD.ui.template.render("status/action_follow",{isAboutYou:this.isAboutYou(),data:this,showUserMenu:!0,extraClasses:a})},TD.services.TwitterActionFollow.prototype.renderNotification=function(){return TD.ui.template.render("status/action_follow",{isAboutYou:this.isAboutYou(),data:this,isPopup:!0})},TD.services.TwitterActionFollow.prototype.isAboutYou=function(){return this.followed.id==this.account.getUserID()},TD.services.TwitterActionFollow.prototype.isOwnChirp=function(){return this.following.id==this.account.getUserID()},TD.services.TwitterActionFollow.prototype.getGrowlData=function(){var a=this.getRelatedUser();return{title:this.text,img:a.profileImageURL,text:TD.util.removeHTMLCodes(a.description)}},TD.services.TwitterActionFollow.prototype.getRelatedUser=function(){return this.isAboutYou()?this.following:this.followed},TD.services.TwitterActionFollow.prototype.getCreator=function(){return this.following},TD.services.TwitterActionFollow.prototype.passFilters=function(a){return TD.controller.filterManager.pass(a,this.getFilterableText(),[this.following.screenName],null)},TD.services.TwitterActionFollow.prototype.getFilterableText=function(){return this.followed.screenName},TD.services.TwitterList=function(a){this.account=a},TD.services.TwitterList.prototype.fromJSONObject=function(a){return this.id=a.id_str,this.name=a.name,this.description=a.description,this.slug=a.slug,this.fullName=a.full_name,this.memberCount=a.member_count,this.isPrivate=a.mode==="private",this.user=(new TD.services.TwitterUser(this.account)).fromJSONObject(a.user),this},TD.services.TwitterList.prototype.isOwnList=function(){var a=TD.storage.Account.generateKeyFor("twitter",this.user.id),b=TD.storage.accountController.get(a);return Boolean(b)},TD.services.TweetDeckClient=function(){var a={},b=TD.core.defer,c=TD.sync.tdapi;a.type="tweetdeck",a.statusMenuTemplate="",a.scheduledUpdates=[];var d,e=function(){var b=a.scheduledUpdates.length;for(var c=0;c<b;c++)TD.controller.feedManager.deleteChirp(a.scheduledUpdates[c].id);a.scheduledUpdates=[]},f=function(a){var b=new TD.services.ScheduledStatus;return b.fromJSONObject(a),b},g=function(a){var b,c,d,e,g={};for(b=0,e=a.length;b<e;b++){c=f(a[b]);if(!c.update)continue;g[c.token]||(g[c.token]=new TD.services.ScheduledGroup(c.token));try{g[c.token].addUpdate(c)}catch(h){console.log("Error processing scheduled update",c,h);continue}}return d=_.values(g),d=_.select(d,function(a){return a.pendingCount||a.retryingCount||a.failedCount}),d},h=function(){var a=TD.controller.scheduler.getColumnsByType("scheduled");if(a.length>0)return TD.controller.scheduler.refreshColumn(a[0].model.getKey());if(!TD.settings.getScheduledColAdded()){var b=TD.controller.columnManager.makeColumnFor(undefined,"scheduled","tweetdeck");TD.controller.columnManager.addColumnToUI(b),TD.settings.setScheduledColAdded(!0)}return TD.core.defer.succeed()},i=function(){return c.isLoggedIn()?c.drequest("/scheduled_update"):b.fail()};return a.removeScheduleGroup=function(a){return c.isLoggedIn()?c.drequest("/scheduled_update/"+a,c.getReq({method:"DELETE"})):b.fail()},a.scheduleGroup=function(d,e,f){if(!c.isLoggedIn())return b.fail();var g=TD.util.iso8601(e);for(var i=0;i<d.length;i++)d[i].timestamp=g;var j=c.requestWithBody("/scheduled_update","POST",d);return f&&j.addCallback(function(){a.removeScheduleGroup(f)}),j.addCallback(function(){var a=h();return a.addErrback(function(a){TD.sync.util.stateLog("refresh yielded unexpected error:",a)}),a}),j},a.refreshFeed=function(b,d,f,g){if(!c.isLoggedIn()){g&&g();return}if(d)return[];var h=a.getScheduledUpdates();return h.addCallback(function(b){return e(),a.scheduledUpdates=b,a.scheduledUpdates}),h.addCallback(f),g&&h.addErrback(g),h},a.getScheduledUpdates=function(){var a=i();return a.addCallback(function(a){if(a)return g(a)}),a},a.forgotPassword=function(a,b,d){var e={type:"DELETE",headers:{Authorization:"Basic "+TD.core.base64.encode(a+":junk")}};return c.drequest("/password",e)},a.feedIsStreaming=function(a){return!1},a},TD.services.ScheduledStatus=function(){},TD.services.ScheduledStatus.prototype.status=null,TD.services.ScheduledStatus.prototype.service="",TD.services.ScheduledStatus.prototype.token="",TD.services.ScheduledStatus.prototype.created="",TD.services.ScheduledStatus.prototype.timestamp="",TD.services.ScheduledStatus.prototype.uid="",TD.services.ScheduledStatus.prototype.update=null,TD.services.ScheduledStatus.prototype.meta=null,TD.services.ScheduledStatus.prototype.resultID=null,TD.services.ScheduledStatus.prototype.profileUrl="",TD.services.ScheduledStatus.prototype.isTwitter=!1,TD.services.ScheduledStatus.prototype.username="",TD.services.ScheduledStatus.prototype.avatar="",TD.services.ScheduledStatus.prototype.fromJSONObject=function(a){return this.status=a.status,this.service=a.service,this.token=a.token,this.created=a.created,this.timestamp=a.timestamp,this.uid=a.uid,this.update=a.update,this.meta=a.meta,this.resultID=a.result_id,this.username=a.meta.user.name,a.meta.user.avatar_url&&(this.avatar=TD.util.transformTwitterAvatar(a.meta.user.avatar_url,"mini")),a.service==="twitter"&&(this.isTwitter=!0),this._generateProfileUrl(),this},TD.services.ScheduledStatus.prototype._generateProfileUrl=function(){switch(this.service){case"twitter":this.meta&&this.meta.user&&(this.profileUrl="http://twitter.com/"+this.meta.user.name);break;case"facebook":this.profileUrl="http://facebook.com/profile.php?id="+this.uid;break;case"foursquare":case"foursquare2":this.profileUrl="http://foursquare.com/user/"+this.uid}},TD.services.ScheduledGroup=function(a){this.token=a,this.id=a,this.updates=[]},TD.services.ScheduledGroup.prototype=new TD.services.ChirpBase,TD.services.ScheduledGroup.prototype.token="",TD.services.ScheduledGroup.prototype.updates=null,TD.services.ScheduledGroup.prototype.time=null,TD.services.ScheduledGroup.prototype.pendingCount=0,TD.services.ScheduledGroup.prototype.failedCount=0,TD.services.ScheduledGroup.prototype.retryingCount=0,TD.services.ScheduledGroup.prototype.avatarURL=null,TD.services.ScheduledGroup.prototype.service=null,TD.services.ScheduledGroup.prototype.title="",TD.services.ScheduledGroup.prototype.location="",TD.services.ScheduledGroup.prototype.latitude=NaN,TD.services.ScheduledGroup.prototype.longitude=NaN,TD.services.ScheduledGroup.prototype.mapURL=null,TD.services.ScheduledGroup.prototype.htmlText="",TD.services.ScheduledGroup.prototype.twitterInReplyToStatusID=null,TD.services.ScheduledGroup.prototype.twitterDMTargetScreenName=null,TD.services.ScheduledGroup.prototype.twitterPlaceID=null,TD.services.ScheduledGroup.prototype.facebookWallPostTargetID=null,TD.services.ScheduledGroup.prototype.facebookPageID=null,TD.services.ScheduledGroup.prototype.foursquareVenueID=null,TD.services.ScheduledGroup.prototype.buzzRequest=null,TD.services.ScheduledGroup.prototype.addUpdate=function(a){if(!this.time){var b=a.timestamp;b.indexOf("+")===-1&&(b+="+00:00"),this.time=TD.util.parseISO8601(b),this.created=this.time}switch(a.service){case"twitter":this.twitterPlaceID=this.twitterPlaceID||a.update.place_id,this.twitterInReplyToStatusID=this.twitterInReplyToStatusID||a.update.in_reply_to_status_id,a.update.type==="direct_message"&&(this.twitterDMTargetScreenName=this.twitterDMTargetScreenName||a.update.screen_name);break;case"facebook":this.facebookWallPostTargetID=this.facebookWallPostTargetID||a.update.target_id;break;case"fbpage":this.facebookPageID=this.facebookPageID||a.update.uid;break;case"foursquare":this.foursquareVenueID=this.foursquareVenueID||a.update.vid,this.foursquareVenueID=this.foursquareVenueID||a.update.venueId}if(!this.text)if(a.service==="twitter"&&a.update.type==="direct_message")this.text=a.update.body,this.title=TD.i("Direct message to {{1}}",{1:a.update.screen_name});else if(a.service==="facebook"||a.service==="fbpage")this.text=a.update.message,a.update.type==="stream"&&a.update.target_id&&(a.meta&&a.meta.target&&a.meta.target.name?this.title=TD.i("Wall post to {{1}}",{1:a.meta.target.name}):this.title=TD.i("Wall post to {{1}}",{1:"#"+a.update.target_id}));else if(a.service==="foursquare")this.text=a.update.shout,a.meta&&a.meta.location?this.title=TD.i("Check-in to {{1}}",{1:a.meta.location}):this.foursquareVenueID&&(this.title=TD.i("Check-in to {{1}}",{1:"#"+this.foursquareVenueID}));else if(a.service==="buzz"){try{this.buzzRequest=JSON.parse(a.update.body)}catch(c){var d=$(a.update.body).find("content").text();this.buzzRequest={data:{object:{content:d}}}}this.text=this.buzzRequest.data.object.content}else this.text=a.update.body;this.text&&(this.htmlText=TD.util.transform(this.text)),!this.location&&a.meta&&(this.latitude=a.meta.geolat,this.longitude=a.meta.geolong,a.meta.location&&(this.location=a.meta.location,this.mapURL="http://maps.google.com/?q="+encodeURIComponent(this.location)),this.latitude&&this.longitude&&(this.location||(this.location=this.latitude.toPrecision(6)+","+this.longitude.toPrecision(6)),this.mapURL="http://maps.google.com/?q="+this.latitude+","+this.longitude)),a.meta&&a.meta.user&&(this.avatarURL=a.meta.user.avatar_url),this.service=a.service,a.status==="pending"?this.pendingCount++:a.status==="retrying"?this.retryingCount++:a.status==="failed"&&this.failedCount++,this.updates.push(a)},TD.services.ScheduledGroup.prototype.render=function(){return TD.ui.template.render("status/tweet_scheduled",{items:[this]})},TD.services.ScheduledGroup.prototype.edit=function(){TD.ui.compose.editScheduledUpdate(this)},TD.services.ScheduledGroup.prototype.destroy=function(a){var b=this,c={};c.title=TD.i("Deleting scheduled update!"),c.message=TD.i("Are you sure you want to delete this scheduled update?"),c.okLabel=TD.i("Delete"),c.cancelLabel=TD.i("Cancel"),c.okCallback=function(){TD.controller.feedManager.deleteChirp(b.id);var a=TD.controller.clients.getTDClient().removeScheduleGroup(b.token);a.addBoth(function(){var a=TD.controller.scheduler.getColumnsByType("scheduled");a.length&&TD.controller.scheduler.refreshColumn(a[0].model.getKey())})},(new TD.components.ConfirmationDialog(c)).show()},TD.services.ScheduledGroup.prototype.prettyTime=function(){return TD.util.prettyTimeString(this.time)},TD.services.ScheduledGroup.prototype.isOwnChirp=function(){return!0},TD.services.FacebookClient=function(a){var b=this;FB._apiKey="56212371378",FB._session={access_token:a.getOAuthToken(),expires:0,uid:a.getUserID()};var c=a.getKey();this.type="facebook",this.oauth=TD.controller.auth.create("facebook",a),this.statusMenuTemplate="menus/facebook",this.pages=[],this.pagesIndex={},this.getPages(function(a){var c,d,e=[];if(a&&a.length)for(c=0;c<a.length;c++){d=a[c];if(!d.name)continue;d.name=TD.util.escape(d.name),e.push(d),b.pagesIndex[d.id]=d}b.pages=e}),this.create=function(){return new d},this.refreshFeed=function(a,c,d,e){var f=1,g=null,h=a.feed;a.chirpArray&&a.chirpArray.length&&(c?g=Math.ceil(a.getOldestChirp().created.getTime()/1e3):f=Math.floor(a.chirpArray[0].created.getTime()/1e3));switch(h.getType()){case"home":b.getNewsFeed(f,g,d,e);break;case"notifications":b.getNotifications(f,d,e);break;case"page":b.getPageFeed(h.getMetadata().id,f,g,d,e)}return this};var d=function(){var a=undefined,c,d={feed:"/feed"},e={message:""},f;this.Retweet=function(a){return this},this.WithMessage=function(a,b){return b||(b="feed"),c=d[b],e.message=a,this},this.InReplyTo=function(a){return this},this.toPage=function(a){return c="/"+a+"/feed",e.access_token=b.pagesIndex[a].access_token,f=a,this},this.DirectlyTo=function(a){return this},this.WithLatLng=function(a,b){return this},this.Post=function(a,b){FB.api(c,"post",e,function(c){!c||c.error?(c.errorMessage=c.error.message,b(c)):a()})},this.toSchedulableObject=function(){var a={};a.service="facebook",a.user={id:f||b.oauth.account.getUserID()};var c={};f?(c.user={name:b.pagesIndex[f].name,avatar_url:"http://graph.facebook.com/"+f+"/picture"},a.service="fbpage"):c.user={name:b.oauth.account.getUsername(),avatar_url:b.oauth.account.getProfileImageURL()};var d=e;return d.type="graph",f&&(d.target_id=f),a.meta=c,a.update=d,a}}},TD.services.FacebookClient.prototype=new TD.services.ServiceClient,TD.services.FacebookClient.prototype.constructor=TD.services.ServiceClient,TD.services.FacebookClient.prototype.makeFBCall=function(a,b,c,d,e,f){var g=this;f=f||function(c){console.log(["Warning: Unhandled FB error",c,a,b])};var h=function(a){if(!a||a.error){console.log("Error from Facebook",a),f(a);return}if(d)try{a=d.call(g,a)}catch(b){console.log("Error processing Facebook data",a,b),f(b);return}e(a)};FB.api(a,c,b,h)},TD.services.FacebookClient.prototype.getPages=function(a,b){this.makeFBCall("/me/accounts",{},"GET",this.processPages,a,b)},TD.services.FacebookClient.prototype.getFeedInternal=function(a,b,c,d,e){var f={date_format:"U"};b&&(f.since=b),c&&(f.until=c),this.makeFBCall(a,f,"GET",this.processUpdates,d,e)},TD.services.FacebookClient.prototype.getPost=function(a,b,c){this.makeFBCall(a,{},"GET",this.processUpdate,b,c)},TD.services.FacebookClient.prototype.getNewsFeed=function(a,b,c,d){this.getFeedInternal("/me/home",a,b,c,d)},TD.services.FacebookClient.prototype.getPageFeed=function(a,b,c,d,e){this.getFeedInternal("/"+a+"/feed",b,c,d,e)},TD.services.FacebookClient.prototype.getNotifications=function(a,b,c){var d=this,e={method:"fql.multiquery"};c=c||function(a){console.log(["Warning: Unhandled FB error",a,url,data])};var f=function(a){if(!a||a.error){console.log("Error from Facebook",a),c(a);return}try{a=d.processNotifications.call(d,a)}catch(e){console.log("Error processing Facebook data",a,e),c(e);return}b(a)},g="SELECT notification_id, sender_id, title_html, title_text, body_text, created_time, href, object_type, object_id FROM notification WHERE recipient_id="+this.oauth.account.getUserID();e.queries=JSON.stringify({query1:g}),FB.api(e,f)},TD.services.FacebookClient.prototype.getPhotoInfo=function(a,b,c){var d=TD.net.util.decodeURL(a);if(!d||!d.fbid){c();return}var e=d.fbid;this.makeFBCall(e,{},"GET",this.processPhotos,b)},TD.services.FacebookClient.prototype.processPhotos=function(a){return a},TD.services.FacebookClient.prototype.getComments=function(a,b,c){this.makeFBCall(a+"/comments",{date_format:"U"},"GET",this.processComments,b)},TD.services.FacebookClient.prototype.addComment=function(a,b,c,d){var e=this,f=function(a){return a.message=b,a.created=new Date,a.from={id:e.oauth.account.userId,name:e.oauth.account.username},e.processComment(a)};this.makeFBCall(a+"/comments",{message:b},"POST",f,c)},TD.services.FacebookClient.prototype.likeUpdate=function(a,b,c){this.makeFBCall(a+"/likes",{},"POST",null,b)},TD.services.FacebookClient.prototype.unlikeUpdate=function(a,b,c){this.makeFBCall(a+"/likes",{},"DELETE",null,b)},TD.services.FacebookClient.prototype.deleteObject=function(a,b,c){var d={};this.makeFBCall(a,d,"DELETE",null,b)},TD.services.FacebookClient.prototype.processUpdate=function(a){return(new TD.services.FacebookUpdate(this.oauth.account)).fromJSONObject(a)},TD.services.FacebookClient.prototype.processNotification=function(a){return(new TD.services.FacebookNotification(this.oauth.account)).fromJSONObject(a)},TD.services.FacebookClient.prototype.processComment=function(a){return(new TD.services.FacebookComment(this.oauth.account)).fromJSONObject(a)},TD.services.FacebookClient.prototype.processUpdates=function(a){var b=a.data,c,d=[];if(!b)return[];c=b.length;for(var e=0;e<c;e++)try{d.push(this.processUpdate(b[e]))}catch(f){console.log("Error processing Facebook data",b[e],f)}return d},TD.services.FacebookClient.prototype.processNotifications=function(a){var b=[],c=a[0].fql_result_set,d,e=c.length,f;for(f=0;f<e;f++)d=c[f],(d.body_text||d.title_html)&&b.push(this.processNotification(d));return b},TD.services.FacebookClient.prototype.processComments=function(a){var b=a.data,c=b.length;for(var d=0;d<c;d++)b[d]=this.processComment(b[d]);return b},TD.services.FacebookClient.prototype.processAccounts=function(a){return a.data||[]},TD.services.FacebookClient.prototype.processPages=function(a){var b=a.data||[];return _.each(b,function(a){a.picture="https://graph.facebook.com/"+a.id+"/picture"}),b},TD.services.FacebookClient.prototype.feedIsStreaming=function(a){return!1},TD.services.FacebookUpdate=function(a){this.account=a},TD.services.FacebookUpdate.prototype=new TD.services.ChirpBase,TD.services.FacebookUpdate.prototype.fromJSONObject=function(a){var b,c={},d={},e,f,g,h,i,j;this.id=a.id,this.type=a.type,this.place=a.place,this.picture=a.picture,this.name=a.name,this.caption=a.caption,this.description=a.description,this.nameHtml=TD.util.transform(a.name),this.captionHtml=TD.util.transform(a.caption),this.descriptionHtml=TD.util.transform(a.description),a.from&&(a.from.name=TD.util.escape(a.from.name)),this.from=a.from,this.to=[],this.place&&(this.mapURL="http://maps.google.com/?q="+this.place.location.latitude+","+this.place.location.longitude,this.locationName=TD.util.escape(a.place.name)),this.link=a.link;if(a.message){this.text=a.message,this.htmlText=TD.util.transform(a.message);if(a.to&&a.to.data&&a.to.data.length){b=a.to.data.length;for(g=0;g<b;g++)e=a.to.data[g],e&&(f=e.name,e.name=TD.util.escape(f),c[f]=(c[f]||0)+1,d[f]=e);for(f in c)j=!1,h=new RegExp(f,"g"),i=a.message.match(h),!i||!i.length?this.to.push(d[f]):i.length<c[f]?(this.to.push(d[f]),j=!0):j=!0,j&&(this.htmlText=this.htmlText.replace(h,this.getFacebookProfileLink(d[f].id,f)))}}a.comments&&(this.comments=a.comments);if(a.likes){this.likes=a.likes;if(a.likes.data&&a.likes.data.length>0)for(g=0;g<a.likes.data.length;g++)if(this.account.getUserID()==a.likes.data[g].id){this.isLiked=!0;break}}this.isLiked=this.isLiked||!1,this.created=new Date(Number(a.created_time)*1e3),this.created_time=TD.util.prettyDate(this.created);if(this.type=="video"){var k,l;a.embed_html?(k=a.embed_html,l=!1):(k=a.source,l=!0),a.link&&k&&(TD.services.media.createVideoEmbed(a.name,a.link,k,l),this.isVideo=!0)}return this},TD.services.FacebookUpdate.prototype.render=function(a){return TD.ui.template.render("status/facebook_status",{extraClasses:a,update:this})},TD.services.FacebookUpdate.prototype.renderNotification=function(){return TD.ui.template.render("status/facebook_status",{update:this,isPopup:!0})},TD.services.FacebookUpdate.prototype.getChirpURL=function(){return"http://www.facebook.com/permalink.php?story_fbid="+this.id.split("_")[1]+"&id="+this.from.id},TD.services.FacebookUpdate.prototype.isOwnChirp=function(){return this.account.getUserID()==this.from.id},TD.services.FacebookUpdate.prototype.isCheckin=function(){return this.type==="checkin"},TD.services.FacebookUpdate.prototype.isLink=function(){return this.type==="link"},TD.services.FacebookUpdate.prototype.isMedia=function(){return this.type==="video"||this.type==="photo"},TD.services.FacebookUpdate.prototype.isWallToWall=function(){return this.to&&this.to.length},TD.services.FacebookUpdate.prototype.hasComments=function(){return this.comments&&this.comments.count},TD.services.FacebookUpdate.prototype.facebookProfileLink=function(){return this.from?this.getFacebookProfileLink(this.from.id,this.from.name):""},TD.services.FacebookUpdate.prototype.facebookProfileLinkTo=function(){return this.isWallToWall?this.getFacebookProfileLink(this.to[0].id,this.to[0].name):""},TD.services.FacebookUpdate.prototype.isDeletable=function(){var a=this.isOwnChirp(),b;if(!a){b=TD.controller.clients.getClient(this.account.getKey());if(b.pagesIndex[this.from.id]||this.to&&this.to.length&&b.pagesIndex[this.to[0].id])a=!0}return a},TD.services.FacebookUpdate.prototype.getActionAccount=function(){var a=TD.controller.clients.getClient(this.account.getKey());return a.pagesIndex[this.from.id]?this.from.id:this.to&&this.to.length&&a.pagesIndex[this.to[0].id]?this.to[0].id:this.account.getUserID()},TD.services.FacebookUpdate.prototype.destroy=function(){var a=this,b;if(!this.isDeletable()){TD.controller.progressIndicator.addMessage(TD.i("You don't own this account - can't delete"));return}var c=TD.controller.progressIndicator.addTask(TD.i("Deleting"));b=TD.controller.clients.getClient(this.account.getKey()),b.deleteObject(this.id,function(){$(a.id).remove(),TD.controller.progressIndicator.taskComplete(c)})},TD.services.FacebookUpdate.prototype.like=function(){function d(){TD.controller.progressIndicator.taskFailed(b)}var a=this,b,c=function(){a.isLiked=!a.isLiked;var c="article[data-key='"+a.id+"'][data-account-key='"+a.account.getKey()+"'] [title='"+TD.i("Like")+"']";$(c).each(function(){a.isLiked?$(this).addClass("show"):$(this).removeClass("show")}),TD.controller.progressIndicator.taskComplete(b)};this.isLiked?(b=TD.controller.progressIndicator.addTask(TD.i("Un-liking")),TD.controller.clients.getClient(this.account.getKey()).unlikeUpdate(this.id,c,d)):(b=TD.controller.progressIndicator.addTask(TD.i("Liking")),TD.controller.clients.getClient(this.account.getKey()).likeUpdate(this.id,c,d)),TD.controller.clients.getClient(this.account.getKey()).likeUpdate(this.id,function(){})},TD.services.FacebookUpdate.prototype.wallToWall=function(){if(!this.to||!this.to.length)return;window.open("http://www.facebook.com/walltowall.php?id="+this.from.id+"&banter_id="+this.to[0].id)},TD.services.FacebookUpdate.prototype.getFacebookProfileLink=function(a,b){return'<a rel="url" href="http://facebook.com/profile.php?id='+a+'"><strong class="fb-fullname">'+b+"</strong></a>"},TD.services.FacebookUpdate.prototype.getFilterableText=function(){var a=[this.text||"",this.name||"",this.caption||"",this.description||""];return a.join(" ")},TD.services.FacebookNotification=function(a){this.account=a},TD.services.FacebookNotification.prototype=new TD.services.FacebookUpdate,TD.services.FacebookNotification.prototype.constructor=TD.services.FacebookUpdate,TD.services.FacebookNotification.prototype.fromJSONObject=function(a){var b,c=$("<div>");return this.getNotificationType(a),this.id=a.notification_id,this.isNotification=!0,this.type=a.type,this.objectId=a.object_id,this.href=a.href,this.text=a.title_text||"",this.htmlText=a.title_html||"",this.htmlText&&(c.append(this.htmlText),c.contents("a.uiTooltip").replaceWith(function(a,b){return $(this).contents(":not(span)").text()}),c.contents("a").attr("rel","urlUsr"),this.htmlText=c.html()),this.description=a.body_text,this.descriptionHtml=TD.util.transform(a.body_text),this.from={id:a.sender_id},b=new Date(Number(a.created_time)*1e3),b!==undefined&&(this.created=b,this.created_time=TD.util.prettyDate(this.created)),this},TD.services.FacebookNotification.prototype.getChirpURL=function(a){return this.href||"http://www.facebook.com/notifications.php"},TD.services.FacebookNotification.prototype.isCommentable=function(){return this.type=="wall_post"&&this.objectId},TD.services.FacebookNotification.prototype.getNotificationType=function(a){var b="",c=a.href,d;try{d=TD.net.util.decodeURL(c),(_.contains(c,"profile.php")||_.contains(c,"permalink.php"))&&d.id&&d.story_fbid?(b="wall_post",a.type.length>0&&d.id&&d.story_fbid&&(a.object_id=d.id+"_"+d.story_fbid)):_.contains(c,"/posts/")&&a.object_id&&a.object_type&&a.object_id.indexOf("_")!=-1&&a.object_type==="stream"&&(b="wall_post")}catch(e){}a.type=b},TD.services.FacebookNotification.prototype.update=function(a){var b=!1;return this.text!==a.text&&(this.text=a.text,this.htmlText=a.htmlText,b=!0),this.description!==a.description&&(this.description=a.description,this.descriptionHtml=a.descriptionHtml,b=!0),b&&(this.created=a.created),b},TD.services.TwitterClient=function(a){var b=this;this.type="twitter",this.STREAMING_BASE_URL="https://userstream.twitter.com/2/user.json",this.streamEngine=new TD.services.StreamEngine(a,_.bind(this.processStreamData,this)),this.firstStreamConnect=!0,this.cachedStreamingQueries={},this.friends={},this.blocks={},this.retweetBlocks={},this.messageThreadCache={},this.searches=[],this.streamingFeeds={},this.STREAMING_FEED_TYPES={home:!0,mentions:!0,direct:!0,favorites:!0,search:!0,interactions:!0,networkactivity:!0},this.ACTIVITY_FEED_TYPES={interactions:!0,networkactivity:!0,useractivity:!0},this.ACTIVITY_EVENT_TYPES={favorite:!0,follow:!0,list_member_added:!0,list_created:!0,retweet:!0},this.DELETE_ACTIVITY_EVENT_TYPES={unfavorite:!0,unfollow:!0,list_member_removed:!0,list_destroyed:!0},this.STREAM_LIST_EVENTS={list_created:!0,list_updated:!0,list_destroyed:!0,list_member_added:!0,list_member_removed:!0,list_user_subscribed:!0,list_user_unsubscribed:!0},this.oauth=TD.controller.auth.create("twitter",a),this.getLists(null,function(a){_.each(a,TD.cache.lists.add)}),this.getSavedSearches(function(a){b.searches=a}),this.populateBlockList(),this.populateRetweetBlockList(),this.refreshFeed=function(a,c,d,e,f,g){var h=this,i=1,j=null,k=a.feed,l=k.getMetadata(),m=this.streamEngine.isStreaming(),n=this.ACTIVITY_FEED_TYPES[k.getType()],o=function(a,b,c){return b>a.length-1?a:a.substr(0,b)+c+a.substr(b+1)};if(g)i=1;else if(a.chirpArray&&a.chirpArray.length)if(c){j=a.getOldestChirp().id;if(n)j=a.getOldestChirp().minPosition||a.getOldestChirp().created.getTime().toString();else if(typeof j=="string"){var p;for(var q=j.length-1;q>=0;q--){p=j.charAt(q);if(p=="0"){j=o(j,q,9);continue}p=String(Number(p)-1),j=o(j,q,p);break}}else j--}else n?i=a.chirpArray[0].maxPosition||a.chirpArray[0].created.getTime().toString():i=a.chirpArray[0].getSinceId();var r=b.STREAMING_FEED_TYPES[k.getType()];switch(k.getType()){case"favorites":r=l.id===this.oauth.account.getUserID();break;case"search":r=TD.services.TwitterSearchParser.isStreamable(l.term)}var s=f||!m||i===1;if(r){this.streamingFeeds[k.getKey()]=k;if(!s)return e(),this}switch(k.getType()){case"home":b.getHomeTimeline(i,j,null,d,e);break;case"mentions":b.getMentionsTimeline(i,j,null,d,e);break;case"direct":b.getMessageTimelines(i,j,null,d,e);break;case"favorites":b.getFavoritesTimeline(i,l.id,j,null,d,e);break;case"list":b.getListTimeline(l.listId,l.screenName,l.slug,i,j,null,d,e);break;case"search":b.getSearchTimeline(l.term,i,j,null,d,e);break;case"usertweets":b.getProfileTimeline(l.id,null,i,j,d,e);break;case"usertimeline":b.getUserTimeline(l.id,i,j,null,d,e);break;case"interactions":b.getInteractionsTimeline(i,j,null,d,e);break;case"networkactivity":b.getNetworkActivityTimeline(i,j,null,d,e);break;case"useractivity":b.getUserActivityTimeline(l.screenName,i,j,null,d,e);break;default:e()}return this},this.feedIsStreaming=function(a){return this.streamingFeeds[a]&&this.streamEngine.isStreaming()};var c=function(){var a={include_entities:1,include_user_entities:1},c,d=b.API_BASE_URL+"statuses/update.json",e=!1,f=!1,g,h,i;this.Retweet=function(a){return d=b.API_BASE_URL+"statuses/retweet/:id.json".replace(":id",a),f=!0,h=a,this},this.DirectlyTo=function(c){return d=b.API_BASE_URL+"direct_messages/new.json",e=!0,a.screen_name=c,this},this.InReplyTo=function(b){return b&&(a.in_reply_to_status_id=b),e=!1,this},this.WithLatLng=function(b,c){return a.lat=b,a["long"]=c,this},this.WithLocation=function(b,c){a.place_id=b,a.placeName=c},this.WithMessage=function(b){return e?a.text=b:a.status=b,this},this.WithMedia=function(a){this.file=a},this.Post=function(c,f){var g=b,h=function(a){var b;a.error?f&&(a.errorMessage=a.error,f(a)):(e?(b=g.processDM(a),g.processMessages([b],!0)):(b=g.processTweet(a),g.processMiscTweet(b)),c&&c(b))},i=function(a,b,c){var d=a.responseText||"",e;a.status===403?d.indexOf("direct_messages")!==-1?e=TD.i("You can't send a message to a user who is not following you."):d.indexOf("retweet")!==-1?e=TD.i("Whoops! You already retweeted that..."):d.indexOf("duplicate")!==-1?e=TD.i("Whoops! You already tweeted that..."):d.indexOf("Share validations failed")!==-1?e=TD.i("Sorry, we could not perform your retweet because the tweet is protected."):e=TD.i("We couldn't complete your request because you are being rate limited. Please try again shortly."):a.status===404&&(d.indexOf("direct_messages")!==-1?e=TD.i("Sorry, we couldn't send your message because that user doesn't exist."):e=TD.i("We could not complete your request because the tweet may be protected or deleted.")),f(a,b,e)};if(this.file){var j=b.oauth.account;d=TD.config.api_root+"/oauth/media/"+TD.settings.getImageService();var k=new FormData;_.each(a,function(a,b){k.append(b,a)}),k.append("media[]",this.file),TD.net.ajax.upload(d,k,j,h,i)}else g.post(d,a,null,null,h,i)},this.toSchedulableObject=function(){var c={};c.service="twitter",c.user={id:b.oauth.account.getUserID()};var d={};d.user={name:b.oauth.account.getUsername(),avatar_url:b.oauth.account.getProfileImageURL()},a.lat&&(d.geolat=a.lat),a["long"]&&(d.geolong=a["long"]),a.placeName&&(d.location=a.placeName);var g={};return f?(g.type="retweet",g.body=h):e?(g.type="direct_message",g.screen_name=a.screen_name,g.body=a.text):(g.type="tweet",g.body=a.status,a.in_reply_to_status_id&&(g.in_reply_to_status_id=a.in_reply_to_status_id),a.lat&&(g.geolat=a.lat),a["long"]&&(g.geolong=a["long"]),a.place_id&&(g.place_id=a.place_id)),c.meta=d,c.update=g,c}};this.create=function(){return new c},this._checkUserStream=_.bind(this.checkUserStream,this),this.subscription=$.subscribe("/storage/client/settings/use_stream",this._checkUserStream)},TD.services.TwitterClient.prototype=new TD.services.ServiceClient,TD.services.TwitterClient.prototype.constructor=TD.services.ServiceClient,TD.services.TwitterClient.prototype.INTERNAL_API_BASE_URL=TD.config.TWITTER_INTERNAL_API_ROOT||"https://api.twitter.com/i/",TD.services.TwitterClient.prototype.API_BASE_URL=TD.config.TWITTER_API_ROOT||"https://api.twitter.com/1/",TD.services.TwitterClient.prototype.SEARCH_BASE_URL=TD.config.TWITTER_SEARCH_API_ROOT||"https://search.twitter.com/",TD.services.TwitterClient.prototype.getOAuthEchoHeader=function(a,b,c){var d=c?"json":"xml",e=TD.config.api_root+"/oauth/echo/twitter/"+encodeURIComponent(this.API_BASE_URL+"account/verify_credentials."+d),f={};f["x-td-oauth-key"]=this.oauth.account.oauth_token,f["x-td-oauth-secret"]=this.oauth.account.token_secret,f["x-td-oauth-service"]="twitter",TD.net.ajax.request({url:e,headers:f},a,b)},TD.services.TwitterClient.prototype.makeTwitterCall=function(a,b,c,d,e,f,g){var h=this,i=function(a){if(e)try{a=e.call(h,a)}catch(b){console.log("Error processing Twitter data",a,b),g(b);return}f&&f(a)};b&&(b.include_entities=1,b.include_user_entities=1),c=="GET"?this.get(a,b,d,i,g):this.post(a,b,null,null,i,g)},TD.services.TwitterClient.prototype.processTweet=function(a){var b=new TD.services.TwitterStatus(this.oauth.account),c;return b.fromJSONObject(a),c=b.getMainUser(),this.profileCache[c.screenName.toLowerCase()]=c,b},TD.services.TwitterClient.prototype.processDM=function(a){var b=new TD.services.TwitterDirectMessage(this.oauth.account);return b.fromJSONObject(a),b},TD.services.TwitterClient.prototype.processMessages=function(a,b){var c={},d=[],e,f=this;return _.each(a,function(a){var b=a.getCorrespondent(),d=f.messageThreadCache[b.id],e=c[b.id];d||(d=new TD.services.TwitterMessageThread(f.oauth.account,b),f.messageThreadCache[b.id]=d),e||(e=[],c[b.id]=e),e.push(a)}),_.each(c,function(a,b){var c=f.messageThreadCache[b],e=c.addMessages(a);e&&d.push(c)}),b&&this.publishChirpsInternal("publish","direct",d),d.sort(TD.util.chirpDescSort)},TD.services.TwitterClient.prototype.deleteMessage=function(a){var b=[],c=[],d=[],e=this;_.each(this.messageThreadCache,function(b,e){b.removeMessage(a)&&(b.messages.length===0?d.push(b):c.push(b))}),_.each(d,function(a){delete e.messageThreadCache[a.id],TD.controller.feedManager.deleteChirp(a.id)}),this.publishChirpsInternal("publish","direct",c)},TD.services.TwitterClient.prototype.processPlaces=function(a){return a.result.places},TD.services.TwitterClient.prototype.processTimeline=function(a){var b,c;a=a.results?a.results:a;if(!a.length)return[];for(b=a.length;b--;)c=a[b],c.sender?c=this.processDM(c):c=this.processTweet(c),a[b]=c;return a},TD.services.TwitterClient.prototype.processRelatedResults=function(a){var b={ancestors:[],descendants:[],forks:[]},c=[],d=this;return _.each(a,function(a){a.groupName==="TweetsWithConversation"&&(c=c.concat(a.results||[]))}),_.each(c,function(a){if(a.kind!=="Tweet"||!a.annotations)return;var c=d.processTweet(a.value);switch(a.annotations.ConversationRole){case"Ancestor":b.ancestors.push(c);break;case"Descendant":b.descendants.push(c);break;case"Fork":b.forks.push(c)}}),b.ancestors.sort(TD.util.chirpDescSort),b.descendants.sort(TD.util.chirpDescSort),b.forks.sort(TD.util.chirpDescSort),b},TD.services.TwitterClient.prototype.processTrends=function(a){var b={locations:a[0].locations,trends:[]},c=a[0].trends,d;for(var e=0;e<c.length;e++)d=(new TD.services.TrendingTopic).fromJSONObject(c[e]),b.trends.push(d);return b},TD.services.TwitterClient.prototype.processTrendLocations=function(a){function e(a,b){var c=a.sortString,d=b.sortString;return c<d?-1:c>d?1:0}var b=[],c,d;for(d=0;d<a.length;d++)c=(new TD.services.TrendLocation).fromJSONObject(a[d]),b.push(c);return b.sort(e)},TD.services.TwitterClient.prototype.processList=function(a){return(new TD.services.TwitterList(this.oauth.account)).fromJSONObject(a)},TD.services.TwitterClient.prototype.processLists=function(a){return _.map(a,_.bind(this.processList,this))},TD.services.TwitterClient.prototype.processUser=function(a){return(new TD.services.TwitterUser(this.oauth.account)).fromJSONObject(a)},TD.services.TwitterClient.prototype.processUsers=function(a){var b=[];for(var c=0;c<a.length;c++)b.push(this.processUser(a[c]));return b},TD.services.TwitterClient.prototype.processActions=function(a){var b=[],c=this;for(var d=0;d<a.length;d++){var e=a[d];if(e.action==="reply")_.each(e.targets,function(a){b.push(c.processTweet(a))});else if(e.action==="mention")_.each(e.target_objects,function(a){b.push(c.processTweet(a))});else if(e.action==="list_member_added"&&e.targets_size>1&&e.target_objects_size>1){var f=new TD.services.TwitterActionMultiListMemberAdded(this.oauth.account);f.fromJSONObject(e,[e],!1),b.push(f)}else b=b.concat(TD.services.TwitterAction.processRESTAction(e,this.oauth.account))}return b},TD.services.TwitterClient.prototype.showUser=function(a,b,c,d){var e={};a?e.user_id=a:e.screen_name=b,this.makeTwitterCall(this.API_BASE_URL+"users/show.json",e,"GET",!0,this.processUser,c,d)},TD.services.TwitterClient.prototype.followUser=function(a,b,c){this.makeTwitterCall(this.API_BASE_URL+"friendships/create.json",{screen_name:a},"POST",!0,this.processUser,b,c)},TD.services.TwitterClient.prototype.unfollowUser=function(a,b,c){this.makeTwitterCall(this.API_BASE_URL+"friendships/destroy.json",{screen_name:a},"POST",!0,this.processUser,b,c)},TD.services.TwitterClient.prototype.userSearch=function(a,b,c){var d=this,e=function(b){var c,e=a.toLowerCase(),f;b=d.processUsers(b);for(c=0;c<b.length;c++){f=b[c];if(f.screenName.toLowerCase()==e&&c!==0){b.splice(c,1),b=[f].concat(b);break}}return b};this.makeTwitterCall(this.API_BASE_URL+"users/search.json",{q:a},"GET",!0,e,b,c)},TD.services.TwitterClient.prototype.getRetweetedBy=function(a,b,c,d,e){var f={count:b||12,page:c||1};this.makeTwitterCall(this.API_BASE_URL+"statuses/"+a+"/retweeted_by.json",f,"GET",!0,this.processUsers,d,e)},TD.services.TwitterClient.prototype.showFriendship=function(a,b,c,d){this.makeTwitterCall(this.API_BASE_URL+"friendships/show.json",{source_id:a,target_id:b},"GET",!0,null,c,d)},TD.services.TwitterClient.prototype.blockUser=function(a,b,c){this.makeTwitterCall(this.API_BASE_URL+"blocks/create.json",{screen_name:a},"POST",!0,this.processUser,b,c)},TD.services.TwitterClient.prototype.unblockUser=function(a,b,c){var d=this;this.makeTwitterCall(this.API_BASE_URL+"blocks/destroy.json",{screen_name:a},"DELETE",!0,this.processUser,b,c)},TD.services.TwitterClient.prototype.blockAndReportUser=function(a,b,c){this.makeTwitterCall(this.API_BASE_URL+"report_spam.json",{screen_name:a},"POST",!0,this.processUser,b,c)},TD.services.TwitterClient.prototype.flagTweet=function(a,b,c){this.makeTwitterCall(this.API_BASE_URL+"statuses/flag_possibly_sensitive.json",{id:a},"POST",!0,null,b,c)},TD.services.TwitterClient.prototype.getList=function(a,b,c,d,e){var f={};a?f.list_id=a:(f.slug=c,f.owner_screen_name=b),this.makeTwitterCall(this.API_BASE_URL+"lists/show.json",f,"GET",!0,this.processList,d,e)},TD.services.TwitterClient.prototype.createList=function(a,b,c,d,e){var f=this,g={name:a,description:b||"",mode:c?"private":"public"},h=function(a){TD.cache.lists.add(a),d(a)};this.makeTwitterCall(this.API_BASE_URL+"lists/create.json",g,"POST",!0,this.processList,h,e)},TD.services.TwitterClient.prototype.updateList=function(a,b,c,d,e,f){var g=this,h={list_id:a,name:b,description:c||"",mode:d?"private":"public"},i=function(a){TD.cache.lists.add(a),e(a)};this.makeTwitterCall(this.API_BASE_URL+"lists/update.json",h,"POST",!0,this.processList,i,f)},TD.services.TwitterClient.prototype.destroyList=function(a,b,c){var d=this,e=function(a){TD.cache.lists.purge(a.id),b(a)};this.makeTwitterCall(this.API_BASE_URL+"lists/destroy.json",{list_id:a},"POST",!0,this.processList,e,c)},TD.services.TwitterClient.prototype.getListMembers=function(a,b,c,d){var e=this,f=function(a){a.users=e.processUsers(a.users),c(a)};_.isUndefined(b)&&(b=-1),this.makeTwitterCall(this.API_BASE_URL+"lists/members.json",{list_id:a,skip_status:1,cursor:b},"GET",!0,null,f,d)},TD.services.TwitterClient.prototype.addUserToList=function(a,b,c,d){var e=function(a){TD.cache.lists.add(a),c(a)};this.makeTwitterCall(this.API_BASE_URL+"lists/members/create.json",{screen_name:b,list_id:a},"POST",!0,this.processList,e,d)},TD.services.TwitterClient.prototype.addUsersToList=function(a,b,c,d){var e=function(a){TD.cache.lists.add(a),c(a)};this.makeTwitterCall(this.API_BASE_URL+"lists/members/create.json",{screen_name:b.join(","),list_id:a},"POST",!0,this.processList,e,d)},TD.services.TwitterClient.prototype.removeUserFromList=function(a,b,c,d){var e=function(a){TD.cache.lists.add(a),c(a)};this.makeTwitterCall(this.API_BASE_URL+"lists/members/destroy.json",{screen_name:b,list_id:a},"POST",!0,this.processList,e,d)},TD.services.TwitterClient.prototype.getBlockIDs=function(a,b){this.makeTwitterCall(this.API_BASE_URL+"blocks/blocking/ids.json",null,"GET",!0,null,a,b)},TD.services.TwitterClient.prototype.getNoRetweetIDs=function(a,b){this.makeTwitterCall(this.API_BASE_URL+"friendships/no_retweet_ids.json",null,"GET",!0,null,a,b)},TD.services.TwitterClient.prototype.getTweetSummary=function(a,b,c){var d={};this.makeTwitterCall(this.INTERNAL_API_BASE_URL+"statuses/"+a+"/activity/summary.json",d,"GET",!0,null,b,c)},TD.services.TwitterClient.prototype.getHomeTimeline=function(a,b,c,d,e){this.getTimeline("statuses/home_timeline.json",a,b,c,d,e)},TD.services.TwitterClient.prototype.getUserTimeline=function(a,b,c,d,e,f){var g={user_id:a};this.getTimeline("statuses/following_timeline.json",b,c,d,e,f,g)},TD.services.TwitterClient.prototype.getInteractionsTimeline=function(a,b,c,d,e){this.getActivityTimeline("/i/activity/about_me.json",a,b,c,d,e)},TD.services.TwitterClient.prototype.getNetworkActivityTimeline=function(a,b,c,d,e){this.getActivityTimeline("/i/activity/by_friends.json",a,b,c,d,e)},TD.services.TwitterClient.prototype.getUserActivityTimeline=function(a,b,c,d,e,f){var g={screen_name:a};this.getActivityTimeline("/i/activity/by_user.json",b,c,d,e,f,g)},TD.services.TwitterClient.prototype.getActivityTimeline=function(a,b,c,d,e,f,g){g=g||{},c&&(g.max_id=c),b&&(g.min_id=b),d&&(g.count=d),this.makeTwitterCall("https://api.twitter.com"+a,g,"GET",!0,this.processActions,e,f)},TD.services.TwitterClient.prototype.getMentionsTimeline=function(a,b,c,d,e){this.getTimeline("statuses/mentions.json",a,b,c,d,e)},TD.services.TwitterClient.prototype.getMessageTimelines=function(a,b,c,d,e){function j(a){f++,g++,h=h.concat(a),f===2&&d(i.processMessages(h,!1))}function k(){f++,f===2&&(g>0?d(i.processMessages(h,!1)):e.apply(null,arguments))}var f=0,g=0,h=[],i=this;a==1&&(this.messageThreadCache={}),this.getDMTimeline(a,b,null,j,k),this.getSentDMTimeline(a,b,null,j,k)},TD.services.TwitterClient.prototype.getDMTimeline=function(a,b,c,d,e){this.getTimeline("direct_messages.json",a,b,c,d,e)},TD.services.TwitterClient.prototype.getSentDMTimeline=function(a,b,c,d,e){this.getTimeline("direct_messages/sent.json",a,b,c,d,e)},TD.services.TwitterClient.prototype.getFavoritesTimeline=function(a,b,c,d,e,f){b?this.getTimeline("favorites/:id.json".replace(":id",b),a,c,d,e,f):this.getTimeline("favorites.json",a,c,d,e,f)},TD.services.TwitterClient.prototype.getListTimeline=function(a,b,c,d,e,f,g,h){var i="lists/statuses.json",j={include_rts:1};a?j.list_id=a:(j.owner_screen_name=b,j.slug=c),this.getTimeline(i,d,e,f,g,h,j)},TD.services.TwitterClient.prototype.getProfileTimeline=function(a,b,c,d,e,f){var g="statuses/user_timeline.json",h={include_rts:1};a&&a!==this.oauth.account.getUserID()&&(h.user_id=a),this.getTimeline(g,c,d,b,e,f,h)},TD.services.TwitterClient.prototype.getSearchTimeline=function(a,b,c,d,e,f){var g={count:d||20,q:a,include_entities:!0},h=this,i=h.SEARCH_BASE_URL+"search.json",j;c&&(g.max_id=c),b&&b!=1&&(g.since_id=b),TD.util.isChromeApp()?this.makeTwitterCall(i,g,"GET",!1,this.processTimeline,e,f):(j=function(a){e(h.processTimeline(a))},TD.net.ajax.jsonp(i,g,j,f))},TD.services.TwitterClient.prototype.getTimeline=function(a,b,c,d,e,f,g){var h={since_id:b||1,count:d||50,include_my_retweet:1};c&&(h.max_id=c),g&&_.extend(h,g),this.makeTwitterCall(this.API_BASE_URL+a,h,"GET",!0,this.processTimeline,e,f)},TD.services.TwitterClient.prototype.pendingRelatedResults={},TD.services.TwitterClient.prototype.getRelatedResults=function(a){var b=this;if(this.pendingRelatedResults[a])return;var c=function(c){delete b.pendingRelatedResults[a],$.publish("/tweets/related/"+a,[c])},d=function(){delete b.pendingRelatedResults[a];var c={ancestors:[],descendants:[],forks:[]};$.publish("/tweets/related/"+a,[c])};this.pendingRelatedResults[a]=!0,this.makeTwitterCall(this.API_BASE_URL+"related_results/show/:id.json".replace(":id",a),{},"GET",!0,this.processRelatedResults,c,d)},TD.services.TwitterClient.prototype.getConversation=function(a,b,c){this.makeTwitterCall(TD.config.api_root+"/conversation/"+a,{trim_future:1,trim_branches:1},"GET",!0,this.processTimeline,b,c)},TD.services.TwitterClient.prototype.destroy=function(a,b,c){this.makeTwitterCall(this.API_BASE_URL+"statuses/destroy/:id.json".replace(":id",a),{},"POST",!0,this.processTweet,b,c)},TD.services.TwitterClient.prototype.show=function(a,b,c){this.makeTwitterCall(this.API_BASE_URL+"statuses/show/:id.json".replace(":id",a),{},"GET",!0,this.processTweet,b,c)},TD.services.TwitterClient.prototype.update=function(a,b,c,d,e,f,g){var h={status:a};h.in_reply_to_status_id=b,h.lat=c,h["long"]=d,h.place_id=e,this.makeTwitterCall(this.API_BASE_URL+"statuses/update.json",h,"POST",!0,this.processTweet,f,g)},TD.services.TwitterClient.prototype.getLists=function(a,b,c){var d={};a&&(d.screen_name=a),this.makeTwitterCall(this.API_BASE_URL+"lists/all.json",d,"GET",!0,this.processLists,b,c)},TD.services.TwitterClient.prototype.getListMemberships=function(a,b,c,d){var e={},f=this;a&&(e.screen_name=a),b&&(e.filter_to_owned_lists=1);var g=function(a){return f.processLists(a.lists)};this.makeTwitterCall(this.API_BASE_URL+"lists/memberships.json",e,"GET",!0,g,c,d)},TD.services.TwitterClient.prototype.getSavedSearches=function(a,b){var c={};this.makeTwitterCall(this.API_BASE_URL+"saved_searches.json",c,"GET",!0,null,a,b)},TD.services.TwitterClient.prototype.retweet=function(a,b,c){this.makeTwitterCall(this.API_BASE_URL+"statuses/retweet/:id.json".replace(":id",a),{},"POST",!0,this.processTweet,b,c)},TD.services.TwitterClient.prototype.favorite=function(a,b,c){var d=this,e=function(a){d.updateFavoriteInternal(a,!0),b(a)};this.makeTwitterCall(this.API_BASE_URL+"favorites/create/:id.json".replace(":id",a),{},"POST",!0,this.processTweet,e,c)},TD.services.TwitterClient.prototype.unfavorite=function(a,b,c){var d=this,e=function(a){d.updateFavoriteInternal(a,!1),b(a)};this.makeTwitterCall(this.API_BASE_URL+"favorites/destroy/:id.json".replace(":id",a),{},"POST",!0,this.processTweet,e,c)},TD.services.TwitterClient.prototype.updateFavoriteInternal=function(a,b){a.setFavorite(b);var c=b?"publish":"remove";this.publishChirpsInternal(c,"favorites",[a])},TD.services.TwitterClient.prototype.createDM=function(a,b,c,d){var e={screen_name:a,text:b};this.makeTwitterCall(this.API_BASE_URL+"direct_messages/new.json",e,"POST",!0,this.processDM,c,d)},TD.services.TwitterClient.prototype.destroyDM=function(a,b,c){this.makeTwitterCall(this.API_BASE_URL+"direct_messages/destroy/:id.json".replace(":id",a),{},"POST",!0,this.processDM,b,c)},TD.services.TwitterClient.prototype.geoSearch=function(a,b,c,d,e,f,g){var h={};b&&(h.lat=b),c&&(h["long"]=c),d&&(h.accuracy=d),a&&(h.query=a),h.granularity=e||"neighborhood",this.makeTwitterCall(this.API_BASE_URL+"geo/search.json",h,"GET",!0,this.processPlaces,f,g)},TD.services.TwitterClient.prototype.getTrends=function(a,b,c){a=a||1,this.makeTwitterCall(this.API_BASE_URL+"trends/"+a+".json",{pc:"false"},"GET",!0,this.processTrends,b,c)},TD.services.TwitterClient.prototype.getTrendLocations=function(a,b){this.makeTwitterCall(this.API_BASE_URL+"trends/available.json",null,"GET",!0,this.processTrendLocations,a,b)},TD.services.TwitterClient.prototype.removeAction=function(a){var b=TD.services.TwitterAction.processStreamAction(a,this.oauth.account);return b.isAboutYou()?this.publishChirpsInternal("remove","interactions",[b]):b.isOwnChirp()||this.publishChirpsInternal("remove","networkactivity",[b]),b},TD.services.TwitterClient.prototype.publishAction=function(a){var b=TD.services.TwitterAction.processStreamAction(a,this.oauth.account);b.isAboutYou()?this.publishChirpsInternal("publish","interactions",[b]):b.isOwnChirp()||this.publishChirpsInternal("publish","networkactivity",[b])},TD.services.TwitterClient.prototype.publishChirpsInternal=function(a,b,c,d){var e={},f,g;switch(b){case"search":e.term=d;break;case"usertweets":e.id=d}f=TD.storage.Feed.generateKeyFor(this.oauth.account.getKey(),b,e),g=TD.controller.feedManager.getPoller(f),g&&(a=="publish"?g.acceptChirps(c):a=="remove"&&_.each(c,function(a){g.removeChirp(a.id)}))},TD.services.TwitterClient.prototype.populateBlockList=function(){var a=this;this.getBlockIDs(function(b){var c=b.length;a.blocks={};while(c--)a.blocks[b[c]]=!0})},TD.services.TwitterClient.prototype.populateRetweetBlockList=function(){this.getNoRetweetIDs(function(a){var b=a.length;self.retweetBlocks={};while(b--)self.retweetBlocks[a[b]]=!0})},TD.services.TwitterClient.prototype.constructStreamingUrl=function(){var a=this,b={},c=!1,d=!0;_.each(this.streamingFeeds,function(e,f){var g=e.getMetadata(),h=TD.controller.feedManager.getPoller(f);if(h){d=!1;if(e.managed&&e.getType()=="search"){var i=g.term,j=i.toLowerCase(),k=new TD.services.TwitterSearchParser(i);b[j]=k}else e.getType()=="home"&&(c=!0)}else delete a.streamingFeeds[f]});var e=[];for(var f in b)e.push(b[f].trackQuery);e=_.uniq(e.join(",").split(","));var g=e.join(","),h={};g&&(h.track=g),c||(h["with"]="user");var i=!1;_.each(TD.storage.feedController.getAll(),function(b){b.getType()==="networkactivity"&&b.getService()==="twitter"&&a.oauth.account.getKey()===b.getAccountKey()&&(i=!0)}),i&&(h.include_followings_activity=!0);if(!d){var j=TD.net.util.urlencode(h);return this.STREAMING_BASE_URL+(j?"?"+j:"")}return null},TD.services.TwitterClient.prototype.checkUserStream=function(){TD.util.shouldStream()?this.streamEngine.connect(this.constructStreamingUrl()):this.streamEngine.disconnect()},TD.services.TwitterClient.prototype.processDeleteChirpEvent=function(a){a["delete"].status?TD.controller.feedManager.deleteChirp(a["delete"].status.id_str):a["delete"].direct_message&&this.deleteMessage(a["delete"].direct_message.id_str)},TD.services.TwitterClient.prototype.processStreamData=function(a){var b=this;if(a.friends){for(var c=0;c<a.friends.length;c++)this.friends[a.friends[c]]=!0;try{this.firstStreamConnect||TD.controller.scheduler.refreshAccountColumns(this.oauth.account.getKey(),!0)}finally{this.firstStreamConnect=!1}}else if(a.event)this.processStreamEvent(a);else if(!a.limit)if(a["delete"])this.processDeleteChirpEvent(a);else if(a.direct_message){var d=this.processDM(a.direct_message);this.processMessages([d],!0)}else{var e=this.processTweet(a);this.processMiscTweet(e)}},TD.services.TwitterClient.prototype.processMiscTweet=function(a){var b=this,c=Boolean(this.friends[a.user.id]),d=a.user.id==this.oauth.account.getUserID(),e=Boolean(a.inReplyToUserID),f=e&&Boolean(this.friends[a.inReplyToUserID]),g=a.isMention(),h=Boolean(a.retweetedStatus),i=h&&a.retweetedStatus.user.id==this.oauth.account.getUserID(),j=h&&(a.retweetedStatus.user.following||this.friends[a.retweetedStatus.user.id]);if(this.blocks[a.user.id]||h&&this.blocks[a.retweetedStatus.user.id])return;if(h&&this.retweetBlocks[a.retweetedStatus.user.id])return;d&&h&&(a.setRetweeted(!0),a.retweetedStatus.setRetweeted(!0)),(d||c&&(!e||f||g))&&!i&&!j&&this.publishChirpsInternal("publish","home",[a]);if(i){var k=(new TD.services.TwitterActionRetweet(this.oauth.account)).fromRetweet(a);this.publishChirpsInternal("publish","interactions",[k])}else g&&(this.publishChirpsInternal("publish","mentions",[a]),this.publishChirpsInternal("publish","interactions",[a]));_.each(this.streamingFeeds,function(c,d){var e=c.getMetadata();if(c.managed&&c.getType()=="search"){var f=e.term,g=b.cachedStreamingQueries[f];g||(g=b.cachedStreamingQueries[f]=new TD.services.TwitterSearchParser(f)),g.match(a.getFilterableText())&&b.publishChirpsInternal("publish","search",[a],g.query)}}),this.publishChirpsInternal("publish","usertweets",[a],String(a.user.id)),d&&this.publishChirpsInternal("publish","usertweets",[a],undefined)},TD.services.TwitterClient.prototype.processStreamEvent=function(a){var b,c;this.STREAM_LIST_EVENTS[a.event]&&(b=(new TD.services.TwitterList(this.oauth.account)).fromJSONObject(a.target_object));if(a.source.id==this.oauth.account.getUserID())switch(a.event){case"favorite":c=this.processTweet(a.target_object),this.updateFavoriteInternal(c,!0);break;case"unfavorite":c=this.processTweet(a.target_object),this.updateFavoriteInternal(c,!1);break;case"follow":this.friends[a.target.id]=!0;break;case"unfollow":delete this.friends[a.target.id];break;case"block":this.blocks[a.target.id]=!0,delete this.friends[a.target.id];break;case"unblock":delete this.blocks[a.target.id];break;case"list_created":case"list_updated":case"list_member_added":case"list_member_removed":case"list_user_subscribed":TD.cache.lists.add(b);break;case"list_destroyed":TD.cache.lists.purge(b.id);break;case"list_user_unsubscribed":TD.cache.lists.unsubscribe(b)}this.ACTIVITY_EVENT_TYPES[a.event]?this.publishAction(a):this.DELETE_ACTIVITY_EVENT_TYPES[a.event]&&this.removeAction(a)},TD.services.TwitterClient.prototype.cleanUp=function(){$.unsubscribe(this.subscription),this.streamEngine.disconnect()},TD.ui.main=function(){var a={},b=$("#infoWindow"),c=$(".infoContent",b),d;a.infoWindow=b,a.infoContent=c;var e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};return a.TRANSITION_END_EVENTS=e[Modernizr.prefixed("transition")],a.init=function(){var b=TD.ui.template.render("topbar/topbar"),c=$("body");c.prepend(b),c.on("click","a",function(a){var b=TD.util.maybeOpenClickExternally(a)}),TD.ui.columns.init(),TD.ui.columnNav.init(),TD.ui.updates.init(),TD.ui.compose.init(),TD.ui.openColumn.init(),$("#topbar").live("click",a.handleHeaderUI),$(".js-show-tip").tipsy({live:!0,gravity:"s"}),$(".js-show-tip-n").tipsy({live:!0,gravity:"n"});var d=$(".js-search-form"),e=$(".js-search-input");e.focus(function(a){d.addClass("s-searchmode")}).blur(function(a){e.val().length===0&&d.removeClass("s-searchmode")}).keydown(function(a){a.which===TD.constants.keyCodes.escape&&e.val("").blur()}).closest("form").submit(function(a){TD.ui.openColumn.showSearch(e.val()),e.val(""),e.blur(),a.preventDefault()});var f=$("#topbar").find(".js-clear-search");f.click(function(a){e.val(""),e.focus()}),c.on("click","a",function(a){var b=$(a.currentTarget),c=b.attr("rel"),d=!1;switch(c){case"user":TD.ui.openColumn.showTwitterProfile(_.last(b.attr("href").split("/"))),d=!0;break;case"hashtag":TD.ui.openColumn.showSearch(b.text()),d=!0}d&&a.preventDefault(),a.isDefaultPrevented()===!1&&(TD.util.openURL(b.attr("href")),a.preventDefault())}),$.subscribe("/storage/client/settings/use_narrow_columns",a.updateColumnSize),a.updateColumnSize()},a.updateColumnSize=function(){TD.settings.getUseNarrowColumns()?$("#container").addClass("s-narrow-columns"):$("#container").removeClass("s-narrow-columns")},a.handleHeaderUI=function(a){var b=$(a.target).closest("a");a.preventDefault();switch(b.data("action")){case"show-compose":TD.ui.compose.showComposeWindow();break;case"show-open":TD.ui.openColumn.showOpenColumn();break;case"settings-menu":var c=b.closest(".js-app-settings"),d=new TD.components.TopbarMenu(c);d.$node.bind(TD.components.DropDown.CLOSE,function(){d=null});break;case"show-lists":TD.ui.openColumn.showLists()}},a}(),TD.ui.popover=function(){var a={},b=$("#popOver"),c=$(".popHolder",b),d=$("#popContents",b),e=null,f=!1,g,h,i={width:"200px",height:"50px",timedelay:500,position:"top_right"},j;return a.show=function(h,j,k){h.addClass("active"),e=h,f&&a.hide(),j=$.extend(i,j);var l=500,m=null,n=function(){f=!0,m&&(clearTimeout(m),m=null)},o=function(){m=setTimeout(function(){a.hide(h)},l)};b.bind("mouseenter",n),b.bind("mouseleave",o),g!=0&&clearTimeout(g),k&&d.html(k),g=setTimeout(function(){g=0;var a=h.offset(),e=d.outerHeight(!0),i=d.outerWidth(!0);j.position=="bottom"?(b.css({left:a.left,right:"inherit",top:a.top-(e+28),minWidth:j.width,minHeight:j.height}),c.css({marginTop:0,marginBottom:38})):j.position=="top_right"?(b.css({right:"4px",left:"inherit",top:a.top+10,minWidth:j.width,minHeight:j.height}),c.css({marginTop:26,marginBottom:0})):j.position=="top_left"?(b.css({left:a.left,top:a.top+10,minWidth:j.width,minHeight:j.height}),c.css({marginTop:26,marginBottom:0})):(b.css({left:a.left-(i-h.outerWidth(!0)-5),right:"inherit",top:a.top+8,minWidth:j.width,minHeight:j.height}),c.css({marginTop:26,marginBottom:0})),b.css({visibility:"visible"}),f=!0},j.timedelay)},a.hide=function(a){b.unbind("mouseenter"),b.unbind("mouseleave"),h!=0&&clearTimeout(h),h=setTimeout(function(){h=0,b.css({visibility:"hidden"}),f=!1,e&&e.removeClass("active"),clearTimeout(g)},150)},a.content=function(a){f&&(clearTimeout(h),b.css({visibility:"hidden"})),d.html(a)},a.timerReset=function(){clearTimeout(g),clearTimeout(h)},a}(),TD.ui.compose=function(){function X(a){_.defer(bu)}function Y(a){var b=$(a.target);b.attr("rel")||(b=$(a.target).parent());var c=b.attr("rel");if(c)a.preventDefault();else return;if(q&&c!=="account"&&c!=="edit")return;switch(c){case"dismiss":bp();break;case"send":bl();break;case"message":J?bi():bg();break;case"clear":bo(),selectDefaultAccount();break;case"enterSchedule":bf();break;case"addLocation":bc();break;case"removeLocation":removeLocation();break;case"message":}}function Z(a){R=!1;var b=!1;Q==="down"&&bu(),Q="down";if((a.ctrlKey||a.metaKey)&&a.which===86||a.shiftKey&&a.which===45){X();return}b&&(a.preventDefault(),R=!0)}function ba(a){var b;a.originalEvent&&(b=a.originalEvent.keyIdentifier);if(R){a.preventDefault(),a.stopImmediatePropagation(),R=!1;return}switch(a.which){case 10:case 13:a.ctrlKey&&!V[b]&&(bl(),a.preventDefault(),a.stopImmediatePropagation())}}function bb(a){var b;Q="up",a.which===TD.constants.keyCodes.escape&&(C.isCompletionsOpen||(e.is(":focus")?e.blur():bp(),a.preventDefault())),b=e.val(),b.toLowerCase()==="d "&&!J&&(e.val(""),bg()),bu()}function bc(){var a=$("#compose-location"),b=$("button",a);z||(z=new TD.components.LocationPicker(a),z.$node.bind(TD.components.LocationPicker.SELECT,function(){e.focus(),b.toggleClass("s-active")})),b.toggleClass("s-active"),z.$node.toggle()}function bd(){d.show()}function bf(){var a=this,b=$("#compose-schedule"),c=function(a){var b,c;a===null?(y.$node.hide(),M.removeClass("set-content")):(b=TD.util.prettyTime(a),c=TD.ui.template.toHtml("{{hours12}}:{{minutes}} {{amPm}} {{date}} {{month}}",b),M.addClass("set-content"),$("b",M).text(c)),v=a},d=function(){M.removeClass("s-active")};y?(y.$node.toggle(),M.toggleClass("s-active"),v||y.setDate(new Date)):($.subscribe("/change/date",c),$.subscribe("/removed/date",d),y=new TD.components.ScheduledDatePicker(b),M.addClass("s-active"))}function bj(a){bk(a)}function bk(a){var b=e.val();b.length&&(a=b+" "+a),e.val(a),e.focus()}function bl(){bv(),bx();var a=bq(),b=[],c=0,d=function(){if(b.length+c>=a.length){var d=e.val();_.each(b,function(a){d=d.replace(a.long_url,a.url)}),bm(d)}},f=function(a){a.data?b.push(a.data):c++,d()},g=function(){c++,d()};TD.settings.getLinkShortener()==="bitly"&&a.length>0?_.each(a,function(a){TD.services.bitly.shorten(a,f,g)}):bm(e.val())}function bm(b){function i(a){var e=a.account,f=TD.controller.clients.getClient(a.account),g=f.create();J?g=g.DirectlyTo(L).WithMessage(b):(c!=""&&g.InReplyTo&&g.InReplyTo(c),g=g.WithMessage(b),H&&!_.isEmpty(H.getFilesToUpload())&&g.WithMedia(H.getFilesToUpload()[0]),g.WithLocation&&t&&g.WithLocation(t,u)),g.WithLocation&&z&&z.twitterPlaceID&&g.WithLocation(z.twitterPlaceID,z.twitterPlaceName),a.service=="facebook"&&a.type=="page"&&g.toPage(a.id);if(v){var j=TD.i("Scheduling update");if(!g.toSchedulableObject){TD.controller.progressIndicator.taskFailed(x,j);return}var k=g.toSchedulableObject();if(!k){TD.controller.progressIndicator.taskFailed(x,j);return}h.push(k);if(d.length>0)i(d.pop());else{TD.controller.progressIndicator.changeMessage(x,j);var l=w?w.token:null,m=TD.controller.clients.getTDClient().scheduleGroup(h,v,l);m.addCallback(function(){TD.controller.progressIndicator.taskComplete(x),w&&TD.controller.feedManager.deleteChirp(w.id),w=null,bp()}),m.addErrback(function(){TD.controller.progressIndicator.taskFailed(x,j),bu(),by()})}}else{var j=TD.i("Sending update to {{1}}",{1:_.capitalize(a.service)});TD.controller.progressIndicator.changeMessage(x,j),g.Post(function(){TD.controller.stats.post(e),H&&H.getFilesToUpload()&&H.clear(),d.length>0?i(d.pop()):(TD.controller.progressIndicator.taskComplete(x),bp())},function(a,b,c){c?j=c:a&&a.errorMessage&&(j+=" - "+a.errorMessage+""),TD.controller.progressIndicator.taskFailed(x,j),bu(),by()})}}var c=r,d=m.getSelectedAccounts(),e,f,g,h=[];if(J&&L==""){TD.controller.progressIndicator.addMessage(TD.i("Message has no recipient!")),by();return}if(a.getTextLength(b,H)===0){TD.controller.progressIndicator.addMessage(TD.i("Sorry, empty updates are not allowed")),by();return}if(o.is(":visible")&&parseInt(o.val())<0){by();return}s&&b.substr(0,s.length).toLowerCase()!=s&&(c=""),x&&(TD.controller.progressIndicator.deleteTask(x),x=null),bn(b),d.length>0?(x=TD.controller.progressIndicator.addTask("Sending update"),i(d.pop())):TD.controller.progressIndicator.addMessage(TD.i("Please select at least one account before sending"))}function bn(b){var c,d=twttr.txt.extractHashtags(b);for(i=0;i<d.length;i++)c="#"+d[i],a.hashtagSet[c.toLowerCase()]=c}function bo(){e.val(""),P={},bu(),r=undefined,s=undefined,f&&(f.empty(),f=null),B.removeClass("s-inreply"),m.updateSelectedAccounts(),by(),H&&H.clear(),y&&(y.setDate(null),M.removeClass("s-active")),J&&bi(),w=null}function bp(){var a=function(){bo(),b.hide(),$.unsubscribe(S)};if(w){var c={};c.title=TD.i("Stop editing?"),c.message=TD.i("If you close your edits now you will lose any changes made. Are you sure you want to stop editing?"),c.okLabel=TD.i("Yes"),c.cancelLabel=TD.i("No"),c.okCallback=a,(new TD.components.ConfirmationDialog(c)).show()}else a()}function bq(){return br(twttr.txt.extractUrls(e.val()))}function br(a){return _.filter(a,function(a){return!a.match(/^https?:\/\/t.co\/\w+$/)})}function bs(a){var b=TD.i("Links will appear shortened"),c=TD.i("Link will appear shortened");return a>1?b:c}function bt(){E=bq().length,E&&E!==F?(G.text(bs(E)).show(),B.addClass("s-link-added"),D=!0):D&&!E&&(G.hide(),B.removeClass("s-link-added"),D=!1),F=E}function bu(){var b=m.getSelectedAccounts(),c,d,f=Number.MAX_VALUE,g=e.val(),h=a.getTextLength(g,H),i="over-char-count";bt();for(d=0;d<b.length;d++){c=b[d];switch(c.service){case"twitter":f=Math.min(140,f);break;case"facebook":f=Math.min(420,f)}}if(f!=Number.MAX_VALUE){var j=Math.min(f-h,f);o.val(j),j<0?(o.addClass(i),bv()):j==f?(bv(),o.removeClass(i)):(o.removeClass(i),bw())}else o.val(""),bv()}function bv(){l.attr("disabled","disabled")}function bw(){l.removeAttr("disabled")}function bx(){B.addClass("s-sending"),e.attr("disabled","disabled"),bv()}function by(){B.removeClass("s-sending"),e.removeAttr("disabled"),bw()}function bz(){var c=function(){B.addClass("s-photo-added"),bu()},d=function(){B.removeClass("s-photo-added"),bu()};$.subscribe("/image/added",c),$.subscribe("/image/removed",d),H=new TD.components.PhotoUpload(a,$("#file-upload-input"),$('button[rel="addPhoto"]',b),$(".js-media-added",b))}function bA(){return B.css("position")==="absolute"&&(parseInt(B.css("left"),10)+B.outerWidth()/2>$("body").outerWidth()||parseInt(B.css("top"),10)+B.outerHeight()/3>$("body").outerHeight())}function bB(){B.attr("style","")}function bC(){B.css({position:"absolute",top:B.offset().top,left:B.offset().left})}var a={},b,c,d,e,f,g,h,j,k,l,m,n,o,p,q=!1,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J=!1,K,L,M,N,O,P={},Q="up",R=!1,S,T,U,V={"U+004A":!0,"U+004D":!0},W=20;a.hashtagSet={},a.init=function(){},a.setUp=function(){$(window).unbind("keyup",bb),$(window).bind("keyup",bb);if(b){bA()&&bB();return}b=$("#compose-modal"),b.html(TD.ui.template.render("compose/compose")),B=$(".js-compose",b),c=$("#composeBox"),d=$("#autocomplete-container"),g=$("h3",b),A=$(".js-accounts-toggle",b),T=$("span",A),e=$(".js-compose-input",b),h=$("#hiddenDiv"),j=$('button[rel="addLocation"]',b),k=$(".removeLocationButton",b),N=$('button[rel="message"]',b),M=$('button[rel="enterSchedule"]'),l=$('button[rel="send"]',b),n=$("#overlay"),o=$("#character-count"),G=$(".js-links-added"),p=$('button[rel="addPhoto"]',b),I=$(".js-inreply",b),K=$(".js-dm-recipient").bind("blur",function(a){_.defer(function(){bh(K.val())})}),U=$(".js-drag-handle",B),e.keypress(ba),e.keydown(Z),e.keyup(bb),e.bind("paste",X),B.draggable({boundary:b,handle:U}),B.on("start.draggable",bC),b.focus(),e.blur(function(){$(".cmp-input-container").removeClass("focus")}),e.focus(function(){$(".cmp-input-container").addClass("focus")}),b.live("click",Y),a.hashtagSet=TD.storage.store.get(":CACHED_HASHTAGS"),C=new TD.components.Autocomplete(e),C.$node.bind(TD.components.Autocomplete.SELECT,function(){bu()}),TD.components.PhotoUpload.canUpload?bz():p.remove(),TD.components.LocationPicker.canHazGeolocation()||j.hide();var f=new TD.components.ActionHeader;b.find(".mdl-header").prepend(f.$node),m=f.accountSelector,m.$node.bind(TD.components.AccountSelector.CHANGE,function(){bu(),e.focus()}),be(),m.selectDefaultAccount()},a.showComposeWindow=function(a,c,d,f){var g,h,i;this.setUp(),b.show(),a!=null&&(e.val(a),d=d===undefined?a.length:d,f=f===undefined?a.length:f,i=e[0],i.setSelectionRange?(i.focus(),i.selectionStart=d,i.selectionEnd=f):i.createTextRange&&(h=i.createTextRange(),h.collapse(!0),h.moveStart("character",d),h.moveEnd("character",f),h.select())),c?m.selectAccounts(c):m.selectDefaultAccount(),bu(),e.focus(),$.publish("modal/close"),S=$.subscribe("modal/close",bp)},a.referenceTo=function(a,b){this.setUp(),this.showComposeWindow("RE "+a+" ",[b])},a.mention=function(a,b){this.setUp(),this.showComposeWindow("@"+a+" ",[b])},a.replyToTweet=function(a,b,c,d,e){var g,h,i;this.setUp(),!b&&a&&(g=TD.util.getReplyUsers(a),g.length&&(b=g.join(" ")+" ",h=g[0].length+1,i=b.length)),this.showComposeWindow(b,[c],h,i),r=e||a.id,s="@"+(d||a.user.screenName.toLowerCase()),a&&(B.addClass("s-inreply"),I.html(TD.ui.template.render("status/status_twitter_inreplyto",a)).show(),f=$("#replyto"))},a.directMessage=function(a,b,c,d){this.setUp(),d=d||"",this.showComposeWindow("",[c]),bj(d),J&&bi(),bg(),bh(a,b),e.focus()},a.editScheduledUpdate=function(b){var c,d,e,f=[],g=0,h,i,j=function(){bo();if(b.twitterDMTargetScreenName)a.directMessage(b.twitterDMTargetScreenName,null,e,b.text);else if(b.twitterInReplyToStatusID){var c=twttr.txt.extractMentions(b.text)[0]||"";a.replyToTweet(null,b.text,null,c,b.twitterInReplyToStatusID)}else a.showComposeWindow(b.text);!b.twitterPlaceID,m.selectAccounts(f),bf(),y.setDate(b.created),w=b};a.setUp();for(c=0,d=b.updates.length;c<d;c++){h=!1,i=b.updates[c].service;if(i==="fbpage"){var k=TD.controller.clients.getClientsByService("facebook");for(var l=0;l<k.length&&!h;l++){var n=k[l];h=h||_.any(n.pages,function(a){return e=n.oauth.account.getKey()+"page"+a.id,a.id==b.updates[c].uid})}}else e=b.updates[c].service+":"+b.updates[c].uid,h=Boolean(TD.storage.accountController.get(e));h?f.push(e):g++}if(g>0){var o={};o.title=TD.i("Warning!"),o.message=TD.util.pluralise(TD.i("This scheduled update is associated with an account which has been removed from your TweetDeck. This account will therefore not be available during this edit unless you re-add it from the accounts panel."),TD.i("This scheduled update is associated with {{1}} accounts which have been removed from your TweetDeck. These account will therefore not be available during this edit unless you re-add them from the settings panel.",{1:g}),g),o.message+="\n\n",o.message+=TD.i("Are you sure you want to continue editing?"),o.okLabel=TD.i("Continue"),o.cancelLabel=TD.i("Cancel"),o.okCallback=j,(new TD.components.ConfirmationDialog(o)).show()}else j()},a.selectAccounts=function(a){m.selectAccounts(a)},a.displayLength=function(a){if(typeof a!="string")throw new Error("displayLength() requires a single input of type string");var b=0,c=0,d=function(a,b){var c=a.charCodeAt(b),d="",e="";if(55296<=c&&c<=56319){if(a.length<=b+1)throw"High surrogate without following low surrogate";d=a.charCodeAt(b+1);if(56320>d||d>57343)throw"High surrogate without following low surrogate";return a.charAt(b)+a.charAt(b+1)}if(56320<=c&&c<=57343){if(b===0)throw"Low surrogate without preceding high surrogate";e=a.charCodeAt(b-1);if(55296>e||e>56319)throw"Low surrogate without preceding high surrogate";return!1}return a.charAt(b)};for(b=0,c=0;b<a.length;b++){if(d(a,b)===!1)continue;c++}return c},a.getTextLength=function(b,c){var d=a.displayLength(b),e=twttr.txt.extractUrls(b);for(var f=0;f<e.length;f++)d+=W-e[f].length,_.startsWith(e[f],"https://")&&d++;if(c){var g=c.getFilesToUpload().length;d=d+g*(1+W)}return d};var be=function(){var a=!1;return function(){a?(T.text(TD.i("Change")),m.hide()):(T.text(TD.i("Hide")),m.show()),a=!a,e.focus()}}(),bg=function(){J=!0,B.addClass("s-message-to"),N.addClass("s-active"),l.text(TD.i("Send")),m.filterByServices(["twitter"]),p.hide(),j.hide(),H&&H.clear(),O=new TD.components.Autocomplete(K,{dmMode:!0}),O.$node.bind(TD.components.Autocomplete.SELECT,function(a,b,c){bh(b,c),e.focus()}),K.focus()},bh=function(a,b){a&&(a=_.trim(a));if(a===L)return;L=a,K.val(a||""),b?b=TD.util.transformTwitterAvatar(b,"mini"):b="http://a1.twimg.com/sticky/default_profile_images/default_profile_6_mini.png",$(".js-msg-to-avatar").attr("src",b)},bi=function(){J=!1,B.removeClass("s-message-to"),N.removeClass("s-active"),l.text(TD.i("Tweet")),O.destroy(),O=null,bh(null,null),m.reset(),H&&p.show(),e.focus()};return a}(),TD.ui.openColumn=function(){function c(a){var c=a.split("?"),d=c[0].split("/").slice(1),e=c[1]||"",f=TD.net.util.formDecode(e),g=d.shift();switch(g){case"add":case"profile":var h=TD.components.OpenColumn.instance;h&&!h.canGo(g,d)&&(h.destroy(),h=null),h||(h=new TD.components.OpenColumn),h.go(g,d,f),b.append(h.$node).show()}}var a={},b;return a.init=function(){b=$("#open-modal"),$.subscribe(TD.components.OpenColumn.GO_EVENT,function(a){c(a.data)})},a.showOpenColumn=function(){c("/add/home")},a.showTwitterProfile=function(a){c("/profile/twitter/"+a)},a.showSearch=function(a){c("/add/search?query="+encodeURIComponent(a))},a.showLists=function(){c("/add/lists")},a.showList=function(a,b){c("/add/lists?screenName="+a+"&slug="+b)},a}(),TD.ui.template=function(){function h(a){var b;try{b=$.ajax(a,{async:!1,isLocal:TD.util.getAppEnv()!=="web"})}catch(c){return null}return b.status!==200?"":b.responseText}function i(f){f=f.replace(b,"/");var g=c[f];return g===undefined&&(g=a.getHogan(f),g=e.compile(g,d),c[f]=g),g}function j(a,b){var c=this.partials[a];return b=b||{},b[c.name]||(b[c.name]=i(c.name)),Hogan.Template.prototype.ep.call(this,a,b)}function k(a,b,c){var d=Hogan.parse.call(this,a,b,c),e="";for(var f=0;f<d.length;f++)if(d[f].tag==="_v"&&d[f].n.indexOf("%TRANSLATION-HINT")===0){var g=d.splice(f,1)[0];f--,e=g.n.substring(g.n.indexOf("mode=")+"mode=".length)}return l(d,e,b,c)}function l(a,b,c,d){var e=[];for(var f=0;f<a.length;f++)if(a[f].tag==="#"&&a[f].n==="_i"){var g=n(c.substring(a[f].i,a[f].end),b);g.tag==="raw"?e.push(g):Array.prototype.push.apply(e,Hogan.parse(Hogan.scan(g,d.delimiters),c,d))}else a[f].tag==="#"||a[f].tag==="^"?(a[f].nodes=l(a[f].nodes,b,c,d),e.push(a[f])):e.push(a[f]);return m(e)}function m(a){if(a.length===0)return a;var b=[a[0]];for(var c=1;c<a.length;c++)b[b.length-1].tag!=="_t"||a[c].tag!=="\n"&&a[c].tag!=="_t"?b.push(a[c]):b[b.length-1].text+=a[c].text||"\n";return b}function n(a,b){var c;return b!==""?c={text:a,mode:b}:c=a,TD.i(c,null,!0)}var a={},b=/\\/g,c={},d={sectionTags:[{o:"_i",c:"i"}]},e,f,g;return g=function(a,b,c,d){this.ep=j,Hogan.Template.call(this,a,b,c,d)},g.prototype=Hogan.Template.prototype,f=function(){},f.prototype=Hogan,e=new f,e.template=g,e.parse=k,a.getHogan=function(a){var b=TD.mustaches[a+".mustache"];return b===undefined&&(b=h("../mustaches/"+a+".mustache"),b===""&&(b=a),TD.mustaches[a+".mustache"]=b),b},a.render=function(a,b,c){var d=i(a);return d.render(b,c)},a.toHtml=function(a,b,c){var f=e.compile(a,d);return f.render(b,c)},a}(),TD.ui.columns=function(){var a,b,c=6,d=46,e=350,f=500,g=200,h=20,i={},j={},k={},l={},m={},n=150,o=15,p=function(a){var b=$(a.currentTarget),c=b.data("action"),d=b.parents("section");switch(c){case"options":a.preventDefault();var e=$(d).data("column");d.hasClass("s-options")?t.exitEditMode(e):t.enterEditMode(e),a.stopPropagation();break;case"editList":a.preventDefault(),a.stopPropagation()}},q=function(a){var b=$(a.currentTarget),c=b.data("action"),d=b.parents("section"),e=d.data("column");TD.ui.columns.setColumnToTop(e)},r=function(a){var b,c,d=0;return function(e){var f=$(this),g=e.timeStamp||(new Date).getTime(),h,i=f.scrollTop();g-d>200&&(d=g,c=e.target.scrollHeight,b=f.height());var j=(b+i)/c;j>.9999?(d=0,h=TD.controller.columnManager.get(a),h.fetchOlderUpdates()):i===0&&t.setHeaderState(a,!1)}},s=function(b,c){var d,e=function(a){var b,c,d,e;b=a.model.getKey(),c=$(".column-updates","#"+b),d=r(b),e=c,c.scroll(d),j[b]=e},f=function(a){var c=a.model,e={columnkey:c.getKey(),columntitle:c.getTitle(),columnclass:b[d].getColumnClass()};return TD.ui.template.render("column",e)};c=Boolean(c);if(c)for(d=b.length-1;d>=0;d--)a.prepend(f(b[d])),e(b[d]);else for(d=0;d<b.length;d++)a.append(f(b[d])),e(b[d])},t={COLUMN_GLOW_DURATION:500,init:function(){a=$("#columns"),b=$("#container"),$(".js-action-header-button").live("click",p);var c=$(".js-action-header");c.live("click",q),$.browser.webkit&&TD.util.getOSName()==="windows"&&$("body").addClass("s-large-scrollbars")},setHeaderState:function(a,b){var c=$("[data-column='"+a+"'] header.column-header");b?c.addClass("new"):c.removeClass("new")},setTitleDisplay:function(a,b,c){var d=TD.controller.columnManager.get(a),e;c===undefined&&(c=d.detailViewComponent!=null),c?e=TD.ui.template.render("column/column_header_detail",{text:d.model.getTitle()}):e=TD.ui.template.render("column/column_header",{columntitle:b,isTemporary:d.temporary}),$("[data-column='"+a+"']").children("header").replaceWith(e)},setColumnToTop:function(a){var b=j[a],c=10,d=b.scrollTop(),f=250,g=function(){var e=Math.max(d-f,0);d-=f,b.scrollTop(e),e>0?setTimeout(g,c):t.setHeaderState(a,!1)};d*c/f>e&&(f=d*c/e),g()},enterEditMode:function(a){var b=TD.controller.columnManager.get(a),c=$("section[data-column='"+a+"']"),e=m[a],f;if(e)return;if(c.length){c.addClass("s-options"),e=new TD.components.ColumnOptions(b),m[a]=e,f=$(".column-options",c);var g=f.html(e.$node).height();g+=d,$(".holder",c).css("top",g)}},exitEditMode:function(a){var b=a?[a]:_.keys(m);_.each(b,function(a){var b=TD.controller.columnManager.get(a),c=$("section[data-column='"+a+"']"),e=m[a];c.removeClass("s-options"),e&&(e.destroy(),delete m[a]),$(".column-options",c).empty(),$(".holder",c).css("top",d)})},freezeScroll:function(a,b){var c=j[a];if(!c)return!1;var d=c.scrollTop();return b&&(i[a]=[c[0].scrollHeight-d,d],l[a]=!0),l[a]||(i[a]=[c[0].scrollHeight-d,d]),d!==0},unfreezeScroll:function(a,b,c){var d=j[a],e=i[a],f=k[a];c&&(l[a]=!1);if(l[a])return;if(!d)return;e&&e[1]>0&&(d.scrollTop(d[0].scrollHeight-e[0]),b&&b()),f&&f.resizeScroller()},addColumnsToView:function(a){s(a),$(".scroll-content").show()},removeColumn:function(b){var c=$('section[data-column="'+b+'"]',a);c.remove(),delete j[b],delete k[b]},_moveColumnInstantly:function(b,c,d,e,f,g){d.length>0&&d.attr("data-column")!==f[e+1]&&(g[d.attr("data-column")]=d.detach()),b?c.insertAfter(b):c.prependTo(a)},_animateInsertColumn:function(b,c){var d=this._getOriginalWidth(b),e,f=new TD.core.defer.Deferred;return b.index()===a.children(".column").length-1&&b.after(e=$("<div />",{"class":"column",css:{width:d}})),b.css({width:0,overflow:"hidden"}).find(".column-header, .holder").css({width:d}).end().animate({width:d},{duration:200,complete:function(){e&&e.remove(),$(this).attr("style","").find(".column-header, .holder").attr("style",""),f.callback()},step:function(a){e&&e.css({width:d-a})}}),f},_getOriginalWidth:function(a){return a.data("originalWidth")||parseInt(a.css("width"),10)},_storeOriginalWidth:function(a){var b=a.data("originalWidth");b===undefined&&(b=parseInt(a.css("width"),10)),a.data("originalWidth",b)},_isColumnOffScreen:function(a){return a.position().left+this._getOriginalWidth(a)<0||a.position().left+this._getOriginalWidth(a)>b.width()},_moveColumnToNewIndex:function(b,c,d,e,f){var g=c[b],h=d[g]||a.children('[data-column="'+g+'"]'),i=h.index(),j,k,l,m=function(){h.removeClass("s-moving"),e=h,delete d[g]};c.length>=b?(j=a.children(".column").filter('[data-column="'+c[b+1]+'"]'),k=j.index()):(j=!1,k=-1),b<c.length&&i!==k&&(h.hasClass("s-moving")?(this._storeOriginalWidth(h),this._moveColumnInstantly(e,h,j,b,c,d),this._isColumnOffScreen(h)?(l=this.scrollToColumn(h.attr("data-column"),h.outerWidth()),l.addCallback(function(){m(),t._moveColumnToNewIndex(b+1,c,d,e,f)})):(t.focusColumn(h.attr("data-column"),t.COLUMN_GLOW_DURATION),l=this._animateInsertColumn(h),l.addCallback(function(){m(),t._moveColumnToNewIndex(b+1,c,d,e,f)}))):(e=h,this._moveColumnToNewIndex(b+1,c,d,e,f)))},reorderColumns:function(b){var c={},d=null,e=a.children(".s-moving");e.length>0?this._moveColumnToNewIndex(0,b,c,d,e):_.each(b,function(e,f){var g=c[e]||a.children('[data-column="'+e+'"]'),h=a.children(".column").eq(f);h[0]!==g[0]&&(b.length>f+1&&h.length>0&&h.attr("data-column")!==b[f+1]&&(c[h.attr("data-column")]=h.detach()),f===0?g.prependTo(a):g.insertAfter(d),delete c[e]),d=g})},calculateScrollDuration:function(a,c,d){d=d||f,c=c||h;var e=Math.abs(a-b.scrollLeft()),i=g+e/100*c;return i=Math.min(i,d),i},scrollToColumn:function(d,e){e=e||0;var i=$('section[data-column="'+d+'"]',a),j,k,l=i.outerWidth(),m=b.get(0).scrollWidth-c,n=a.width(),o=b.scrollLeft(),p=i.offset().left,q=o+p-(n-l)/2+e,r;return q=Math.min(q,m-n),q=Math.max(q,0),q!==o?(j=Math.abs(q-o),k=g+j/100*h,k=Math.min(k,f),r=new TD.core.defer.Deferred,b.animate({scrollLeft:q},k,"easeInOutQuad",function(){TD.ui.columns.focusColumn(d,t.COLUMN_GLOW_DURATION),r.callback()})):(TD.ui.columns.focusColumn(d,t.COLUMN_GLOW_DURATION),r=TD.core.defer.succeed()),r},getLeftmostColumn:function(){var b=null;return a.children(".column").each(function(){b||($(this).position().left<10&&$(this).position().left>=0?b=this:$(this).position().left>10&&(b=$(this).prev()))}),$(b)},scrollColumn:function(d){$.fn.reverse=[].reverse;var e,f,g=b[0].scrollWidth-b.outerWidth(),h=!1,i=!1,j,k=0;d==="right"?e=this.getLeftmostColumn().next():e=this.getLeftmostColumn().prev(),e.length?(f=b.scrollLeft()+e.position().left,f>g?(h=!0,j=b[0].scrollWidth-(b.scrollLeft()+b.outerWidth()),j>0&&b.stop().animate({scrollLeft:g},350)):b.stop().animate({scrollLeft:f-c},350)):i=!0,h&&j===0&&a.find(".column").last().animate({marginRight:20},{duration:150,complete:function(){$(this).animate({marginRight:0},150),b.scrollLeft(b[0].scrollWidth)},step:function(a){b.not(":animated").scrollLeft(b.scrollLeft()+a-k),k=a}}),i&&this.bounceLeft()},bounceLeft:function(){a.animate({marginLeft:o},n,function(){a.animate({marginLeft:0},n,function(){b.attr("style","")})})},bounceRight:function(){a.find(".column").last().animate({marginRight:o},{duration:n,complete:function(){$(this).animate({marginRight:0},n)},step:function(a){b.scrollLeft(b[0].scrollWidth)}})},scrollPage:function(d){$.fn.reverse=[].reverse;var e=d==="left"?-1:1,f,g=b.innerWidth(),h=a.children(".column").outerWidth()+c,i=Math.floor(g/h),j=b.scrollLeft()+i*h*e,k,l,m;if(d==="left"&&j>0){l=i*h*e;for(var n=0;n<a.children(".column").length;n++){var o=a.children(".column").eq(n),p=o.position().left;p<l&&(k=o.next())}k&&(j=b.scrollLeft()-k.position().left*-1)}j<0?j=0:j+g>b[0].scrollWidth&&(j=b[0].scrollWidth-g),j===b.scrollLeft()&&d==="left"?this.bounceLeft():j===b.scrollLeft()&&d==="right"?this.bounceRight():(f=this.calculateScrollDuration(j,50,1e3),f<700?b.is(":animated")?m="easeOutQuad":m="easeInOutQuad":b.is(":animated")?m="easeOutQuart":m="easeInOutQuart",b.stop().animate({scrollLeft:j},{duration:f,easing:m}))},focusColumn:function(b,c){var d=$('section[data-column="'+b+'"]',a);d.addClass("s-focused"),_.isNumber(c)&&_.delay(function(){TD.ui.columns.unfocusColumn(b)},c)},unfocusColumn:function(b){var c=$('section[data-column="'+b+'"]',a);c.removeClass("s-focused")},setMovingColumn:function(b){a.children('[data-column="'+b+'"]').addClass("s-moving")}};return t}(),TD.ui.scrollType="page",TD.ui.columnNav=function(){var a={},b=null,c=null,d=function(a){var b=new TD.components.ColumnNavMenu(c);a.stopImmediatePropagation()},e=function(){var a=$(this).attr("data-action");TD.ui.scrollType==="page"?TD.ui.columns.scrollPage(a):TD.ui.scrollType==="col"&&TD.ui.columns.scrollColumn(a)};return a.init=function(){var a=TD.ui.template.render("topbar/column_navigator");b=$("#nav-column"),b.html(a),c=$(".js-column-toggle",b),c.click(d),$(".js-clm-scroll").click(e)},a}(),TD.ui.updates=function(){function e(b,c,d){var e=!1,h=$(b.target),i,j;if($("article",b.target).length>0)return;h.attr("rel")||(h=h.closest("a")),c||(i=a.findParentArticle(h),d||(d=TD.controller.columnManager.get(i.column)),d&&(c=d.findMostInterestingChirp(i.statusKey)));if(!c)return;j=h.attr("rel");switch(j){case"retweet":case"like":case"favorite":case"destroy":case"edit":c[j]();break;case"reply":TD.ui.compose.replyToTweet(c,"",c.account.getKey());break;case"viewDetails":g(d,c,!1);break;case"list":TD.ui.openColumn.showList(h.data("screen-name"),h.data("slug"));break;case"url":case"urlUsr":case"mediaPreview":e=f(c,h.attr("href"),d);break;case"spotify":e=!0;break;case"followStatus":var k=new TD.components.FollowDialog(c);break;case"actionsMenu":case"userActionsMenu":var l=h.data("user-id").toString(),m=TD.cache.twitterUsers.getById(l),n=j==="actionsMenu"?c:null;m.addCallback(function(a){var b=new TD.components.ProfileMenu(h,a,n,!0);return b.setPosition(TD.components.DropDown.POSITION_LEFT),b});break;default:e=!0}e||(b.preventDefault(),b.stopPropagation())}function f(a,b,c){var d=TD.services.media.supportedUrl(a,b);return d&&!c.temporary?(new TD.components.MediaGallery(a,d,c),!1):(TD.util.openURL(b),!0)}function g(a,b,c){var d=a.model.getKey(),e=$("#"+d);if(a.temporary)return;$.publish("modal/close"),TD.ui.columns.exitEditMode(d),a.detailViewComponent&&a.detailViewComponent.destroy(),b instanceof TD.services.TwitterStatus?(a.detailViewComponent=new TD.components.TweetDetailView(a,e),c?a.detailViewComponent.showId(b.inReplyToID,b.account.getKey()):a.detailViewComponent.showChirp(b)):b instanceof TD.services.TwitterMessageThread&&(a.detailViewComponent=new TD.components.MessageDetailView(a,e),a.detailViewComponent.showChirp(b))}function h(a,b){var c=a.closest("section"),d=a.closest("article"),e=c.data("column"),f=!1,g=!1;e&&(f=TD.ui.columns.freezeScroll(e),g=!f);if(g)var h=d.outerHeight();a.replaceWith(b);if(g){var i=d.outerHeight();d.addClass("s-expanding"),d.css({height:h}),d.animate({height:i},300,function(){d.removeClass("s-expanding"),d.removeAttr("style")})}TD.ui.columns.unfreezeScroll(e)}var a={currentlyDisplayedProfile:null},b=110,c="2s",d;return a.init=function(){$(".js-chirp:not(.chp-detail):not(.chp-thread-message)").live("click",function(b){var c=a.findParentArticle($(this)),d=TD.controller.columnManager.get(c.column),e;return d&&(e=d.findMostInterestingChirp(c.statusKey),g(d,e,!1)),!1}),$("body").delegate(".js-chirp a","click",function(a){return e(a),!1}),$(".form-comment").live("click",e),$.subscribe("chirp/action",function(a,b,c){e(a,b,c)})},a.statusAction=function(a,b){var c=TD.controller.columnManager.get(b.column),d;if(!c)return;d=c.findMostInterestingChirp(b.statusKey),d[a](b)},a.refreshTimestamps=function(){var a=TD.util.prettyDate;$("article:not(article.schedule) time").each(function(b,c){var d,e,f=$(this),g;d=f.attr("data-time"),g=new Date(Number(d)),e=a(g),$("a",f).text(e)})},a.findParentArticle=function(a){var b={},c=a.closest("article");return b.element=c,b.dataService=c.attr("data-service"),b.dataKey=c.attr("data-account-key"),b.statusKey=c.attr("data-key"),b.statusUser=c.attr("data-username"),b.column=c.closest("section").attr("data-column"),b},a.insertMediaEmbed=function(a,b){$('.js-media[data-key="'+a+'"]').each(function(){h($(this),b)})},a}(),TD.ui.startflow=function(a,b,c,d){function B(a){a.preventDefault();var b=$(a.currentTarget),c=b.data("action");switch(c){case"url":var d=window.open(b.attr("href"));d.focus();break;case"signin":D();break;case"showRegister":M(i);break;case"login":M(h);break;case"forgotPassword":C();break;case"resetReload":TD.sync.controller.debugFlushAndReload();break;case"spoofData":TD.sync.controller.debugInstallOldChromeData()}}function C(){if(w)return;var a=$("#tdRegEmail",m).val();if(!a||!a.match(f)){K([p],TD.i("Please enter a valid email address."));return}var b=new TD.services.TweetDeckClient;w=!0,K([p],TD.i("Sending password reset instructionsâ¦"));var c=b.forgotPassword(a);c.addCallback(function(){K([p],TD.i("We have sent an email to {{email}} with instructions to reset your password.",{email:a})),w=!1}),c.addErrback(function(){K([p],TD.i("Sorry, we could not send you reset instructions because something went wrong. Please try again later.")),w=!1})}function D(){var a=$("#tdRegEmail",m).val(),b=$("#tdRegPassword",m).val(),c=$("#tdRegRememberMe",m)[0].checked;E(a,b,c)}function E(a,b,d){if(a&&b!==""){M(j);var e=c.accountController.loginTweetdeck(a,b);e.addCallbacks(F,G,[d])}else M(h),K([q,p],TD.i("Please check your email & password."))}function F(a,b){a.stay_signed_in=b,z(),v.callback(a)}function G(a){M(h);var b,c=[];if(a.req.status===401)b=TD.i("Please check your password. Remember: TweetDeck accounts are different from Twitter accounts."),c=[q];else if(a.req.status===0)b=TD.i("Unable to connect. Please check your network.");else{var d;try{d=JSON.parse(a.req.responseText).error,b=TD.i("Unable to sign in: {{{1}}}",{1:d})}catch(e){b=TD.i("There was a problem signing in. Please try again in a moment."),console.log("An unknown error occurred at sign in"),console.log(a.req.responseText)}}A(a,c,b)}function H(){var a=$("#tdRegEmail",m).val(),b=$("#tdRegPassword",m).val(),c=$("#tdRegPasswordConfirm",m).val(),d=$("#tdRegRememberMe",m)[0].checked;if(!a||!a.match(f)){K([p],TD.i("Please use a valid email address."));return}if(b!==c){K([q],TD.i("Passwords must match!"));return}if(b.length<7){K([q],TD.i("Your password must be 7 characters or longer."));return}var e=I(a,b,d);e.addErrback(J),M(j)}function I(a,b,e){var f=c.accountController.loginTweetdeck(a,b);return f.addCallback(F,e),f.addErrback(function(){d.trace("register//login failed//going to try to create account");var f=c.accountController.createTweetdeckAccount(a,b);return f.addCallback(function(a){return a.created_account=!0,a}),f.addCallback(F,e),f}),f}function J(a){M(i),A(a,[q,p],TD.i("Registration unsuccessful. Please check your email & password"))}function K(a,b){b&&(n.text(b).show(),n.show()),a&&_.each(a,function(a){a.addClass("s-error")})}function L(){q.removeClass("s-error"),p.removeClass("s-error"),n.hide()}function M(a){k=a,L();switch(a){case h:t.fadeOut("fast"),$("#tdRegPasswordConfirm").attr("disabled",!0),r.attr("disabled",!1),l.addClass("s-login").removeClass("s-register s-loading");break;case i:t.fadeOut("fast"),$("#tdRegPasswordConfirm").attr("disabled",!1),s.attr("disabled",!1),l.addClass("s-register").removeClass("s-login s-loading");break;case j:t.fadeIn("fast"),r.attr("disabled",!0),s.attr("disabled",!0)}}var e={},f=/^[a-zA-Z0-9_\-\.+]+@[a-zA-Z0-9_\-\.]+\.[a-zA-Z]{2,4}$/,g=-1,h=0,i=1,j=2,k=g,l=$("#startflow-modal"),m=null,n,o,p,q,r,s,t,u="form-error",v=null,w;e.doLogin=function(b,c,d){v=new a.Deferred;try{x(b,c),y(),d&&K(null,d)}catch(e){var f="Unable to initialise login UI. Please contact your friendly dev team for assistance.";$("body").html(f),console.log("login UI init error:",[e]),TD.util.isChromeApp()&&console.log("stack trace:",[e.stack.split("\n")])}return v};var x=function(a,c){var d=localStorage.getItem("__debug_email__"),e={email:a||d||"",spoofData:Boolean(TD.debug.spoof_data),debugMenu:Boolean(TD.config.debug_menu),version:TD.version},f=b.render("startup/signin",e);$(".js-start-container",l).html(f),m=$("#startup-form"),n=$(".srt-error-msg",m),p=$(".js-email"),q=$(".js-password"),r=$(".js-signin"),s=$(".js-register"),t=$(".js-loader"),$("#tdRegRememberMe",m)[0].checked=Boolean(c),$("#tdAccountForm").submit(function(a){return k===h?D():H(),a.preventDefault(),!1}),$("a",m).live("click",B),m.live("keypress",function(a){a.keyCode==13&&$("tdAccountForm").submit()})},y=function(){$("#topbar").hide(),l.show(),$("#container").hide(),M(h)},z=function(){$("#topbar").show(),l.hide(),$("#container").show(),$(".js-start-container",l).empty()},A=function(a,b,c){a&&d.warn(a.message,a),K(b,c)};return e}(TD.core.defer,TD.ui.template,TD.storage,TD.sync.util);var TD,jQuery;TD.net.ajax=function(){var a={},b=function(a,b,c,d,e,f,g){var h,i=this,j;h={verb:a,url:b,global:!1,success:k,error:l,dataType:"text json"};var k=function(a,c){a||console.log('WARNING: call to "'+b+'" returned no data'),jsondata=JSON.parse(a),jsondata&&(a=jsondata),f&&f(a,c,i),j.deleteLater()},l=function(a,b){g&&g(i,a,b),j.deleteLater()};e?j=deck.signedRequestFactory(a,b,d,"","",e.getOAuthToken(),e.getTokenSecret()):j=deck.reqestFactory(a,b,d),j.onSuccess.connect(k),j.onFailure.connect(l),j.go()},c=function(a,b,c,d,e,f){var g,h=function(a){if(c)for(var b in c)c.hasOwnProperty(b)&&b.toLowerCase()!=="content-type"&&a.setRequestHeader(b,c[b])},i=function(a,c,d){a||console.log('WARNING: call to "'+b+'" returned no data'),e&&e(a,c,d)},j=function(a,b,c){f&&f(a,b,c)};g={url:b,global:!1,type:a,success:i,error:j,beforeSend:h,dataType:"text json"},d&&(g.data=d),c["Content-Type"]&&(g.contentType=c["Content-Type"]),jQuery.ajax(g)},d=function(a,b,d,e,f,g){var h=TD.config.api_root+"/";_.startsWith(b,h)?h=b:d&&d["x-td-oauth-key"]!==undefined?h+="oauth/sign/"+d["x-td-oauth-service"]+"/"+encodeURIComponent(b):h+="proxy/"+encodeURIComponent(b),c(a,h,d,e,f,g)};return a.bounce=function(a,b,e,f,g){var h=e&&e.method||"GET",i=e&&e.parameters||{},j=e&&e.body||null,k=e&&e.headers||{},l="",m="";if(i){var n=[];for(var o in i)n.push(o+"="+encodeURIComponent(i[o]));n.length&&(m=a.indexOf("?"),m==-1?l="?":m!=a.length-1&&(l="&"),a+=l+n.join("&"))}f&&(k["x-td-oauth-key"]=f.getOAuthToken(),k["x-td-oauth-secret"]=f.getTokenSecret(),k["x-td-oauth-service"]=f.getType());var p=function(a){var d=a.headers||{};k&&k["Content-Type"]&&(d["Content-Type"]=k["Content-Type"]),c(h,a.url,d,a.body,b,g)};h==="GET"?d(h,a,k,j,b,g):d(h,a,k,j,p,g)},a.proxy=function(a,d,e,f,g){var h=e&&e.method||"GET",i=e&&e.parameters||{},j=e&&e.body||null,k=e&&e.headers||{};if(h==="GET"||!TD.util.isWrapperApp())if(i){var l=[];for(var m in i)l.push(m+"="+encodeURIComponent(i[m]));l.length&&(a+=(a.indexOf("?")>=0?"":"?")+l.join("&"))}if(!TD.util.isWrapperApp()){f&&(k["x-td-oauth-key"]=f.getOAuthToken(),k["x-td-oauth-secret"]=f.getTokenSecret(),k["x-td-oauth-service"]=f.getType());var n=TD.config.api_root;_.startsWith(a,n)?n=a:(n+="/oauth/proxy/"+k["x-td-oauth-service"]+"/",n+=encodeURIComponent(a)),c(h,n,k,j,d,g)}else b(h,a,k,h==="POST"?i:null,f,d,g)},a.request=function(a,b,d){var e=a&&a.url,f=a&&a.method||"GET",g=a&&a.params||{},h=a&&a.body||null,i=a&&a.headers||{};if(!e)throw{name:"TypeError",message:'"url" argument not provided'};if(g){var j=[];for(var k in g)j.push(k+"="+encodeURIComponent(g[k]));j.length&&(e+="?"+j.join("&"))}c(f,e,i,h,b,d)},a.jsonp=function(a,b,c,d){$.ajax({url:a,data:b,dataType:"jsonp",success:c,error:d,timeout:1e4})},a.upload=function(a,b,c,d,e){var f={"x-td-oauth-key":c.getOAuthToken(),"x-td-oauth-secret":c.getTokenSecret(),"x-td-oauth-service":c.getType()};$.ajax({url:a,data:b,headers:f,cache:!1,contentType:!1,processData:!1,type:"POST",dataType:"json",success:function(a){d(a)},error:e,timeout:12e4})},a}(),function(a){function f(a,b){return 32-(new Date(a,b,32)).getDate()}function g(a,b){a=""+a,b=b||2;while(a.length<b)a="0"+a;return a}function j(a,b,c){var d=a.getDate(),f=a.getDay(),j=a.getMonth(),k=a.getFullYear(),l={d:d,dd:g(d),ddd:e[c].shortDays[f],dddd:e[c].days[f],m:j+1,mm:g(j+1),mmm:e[c].shortMonths[j],mmmm:e[c].months[j],yy:String(k).slice(2),yyyy:k},m=b.replace(h,function(a){return a in l?l[a]:a.slice(1,a.length-1)});return i.html(m).html()}function k(a){return parseInt(a,10)}function l(a,b){return a.getFullYear()===b.getFullYear()&&a.getMonth()==b.getMonth()&&a.getDate()==b.getDate()}function m(a){if(!a)return;if(a.constructor==Date)return a;if(typeof a=="string"){var b=a.split("-");if(b.length==3)return new Date(k(b[0]),k(b[1])-1,k(b[2]));if(!/^-?\d+$/.test(a))return;a=k(a)}var c=new Date;return c.setDate(c.getDate()+a),c}function n(c,g){function I(b,d,e){x=b,u=b.getFullYear(),v=b.getMonth(),w=b.getDate(),e=e||a.Event("api"),e.type="change",C.trigger(e,[b]);if(e.isDefaultPrevented())return;c.val(j(b,d.format,d.lang)),c.data("date",b),h.hide(e)}function J(a){a.type="onShow",C.trigger(a)}var h=this,i=new Date,n=g.css,o=e[g.lang],p=a("#"+n.root),q=p.find("#"+n.title),r,s,t,u,v,w,x=c.attr("data-value")||g.value||c.val(),y=c.attr("min")||g.min,z=c.attr("max")||g.max,A;y===0&&(y="0"),x=m(x)||i,y=m(y||g.yearRange[0]*365),z=m(z||g.yearRange[1]*365);if(!o)throw"Dateinput: invalid language: "+g.lang;if(c.attr("type")=="date"){var B=a("<input/>");a.each("class,disabled,id,maxlength,name,readonly,required,size,style,tabindex,title,value".split(","),function(a,b){B.attr(b,c.attr(b))}),c.replaceWith(B),c=B}c.addClass(n.input);var C=c.add(h);if(!p.length){p=a("<div><div><div/></div><div><div/><div/></div></div>").hide().css({position:"relative"}).attr("id",n.root),p.children().eq(0).attr("id",n.head).end().eq(1).attr("id",n.body).children().eq(0).attr("id",n.days).end().eq(1).attr("id",n.weeks).end().end().end(),q=p.find("#"+n.head).find("div").attr("id",n.title);if(g.selectors){var D=a("<select/>").attr("id",n.month),E=a("<select/>").attr("id",n.year);q.html(D.add(E))}var F=p.find("#"+n.days);for(var G=0;G<7;G++)F.append(a("<span/>").text(o.shortDays[(G+g.firstDay)%7]));a("#calendar").append(p)}var H=p.find("#"+n.weeks);E=p.find("#"+n.year),D=p.find("#"+n.month),a.extend(h,{show:function(d){if(c.attr("readonly")||c.attr("disabled")||A)return;d=d||a.Event(),d.type="onBeforeShow",C.trigger(d);if(d.isDefaultPrevented())return;a.each(b,function(){this.hide()}),A=!0,D.unbind("change").change(function(){h.setValue(E.val(),a(this).val())}),E.unbind("change").change(function(){h.setValue(a(this).val(),D.val())}),s=p.find("#"+n.prev).unbind("click").click(function(a){return s.hasClass(n.disabled)||h.addMonth(-1),!1}),t=p.find("#"+n.next).unbind("click").click(function(a){return t.hasClass(n.disabled)||h.addMonth(),!1}),h.setValue(x);var e=c.offset();return/iPad/i.test(navigator.userAgent)&&(e.top-=a(window).scrollTop()),g.speed?p.show(g.speed,function(){J(d)}):(p.show(),J(d)),h},setValue:function(b,c,d){var e=k(c)>=-1?new Date(k(b),k(c),k(d||1)):b||x;e<y?e=y:e>z&&(e=z),b=e.getFullYear(),c=e.getMonth(),d=e.getDate(),c==-1?(c=11,b--):c==12&&(c=0,b++);if(!A)return I(e,g),h;v=c,u=b,w=d;var j=new Date(b,c,1-g.firstDay),m=j.getDay(),p=f(b,c),r=f(b,c-1),B;if(g.selectors){D.empty(),a.each(o.months,function(c,d){y<new Date(b,c+1,-1)&&z>new Date(b,c,0)&&D.append(a("<option/>").html(d).attr("value",c))}),E.empty();var C=i.getFullYear();for(var F=C+g.yearRange[0];F<C+g.yearRange[1];F++)y<=new Date(F+1,-1,1)&&z>new Date(F,0,0)&&E.append(a("<option/>").text(F));D.val(c),E.val(b)}else q.html(o.months[c]+" "+b);H.empty(),s.add(t).removeClass(n.disabled);for(var G=m?0:-7,J,K;G<(m?42:35);G++)J=a("<a/>"),G%7===0&&(B=a("<div/>").addClass(n.week),H.append(B)),G<m?(J.addClass(n.off),K=r-m+G+1,e=new Date(b,c-1,K)):G>=m+p?(J.addClass(n.off),K=G-p-m+1,e=new Date(b,c+1,K)):(K=G-m+1,e=new Date(b,c,K),l(x,e)?J.attr("id",n.current).addClass(n.focus):l(i,e)&&J.attr("id",n.today)),y&&e<y&&J.add(s).addClass(n.disabled),z&&e>z&&J.add(t).addClass(n.disabled),J.attr("href","#"+K).text(K).data("date",e),B.append(J);return H.find("a").click(function(b){var c=a(this);return c.hasClass(n.disabled)||(a("#"+n.current).removeAttr("id"),c.attr("id",n.current),I(c.data("date"),g,b)),!1}),n.sunday&&H.find(n.week).each(function(){var b=g.firstDay?7-g.firstDay:0;a(this).children().slice(b,b+1).addClass(n.sunday)}),h},setMin:function(a,b){return y=m(a),b&&x<y&&h.setValue(y),h},setMax:function(a,b){return z=m(a),b&&x>z&&h.setValue(z),h},today:function(){return h.setValue(i)},addDay:function(a){return this.setValue(u,v,w+(a||1))},addMonth:function(a){return this.setValue(u,v+(a||1),w)},addYear:function(a){return this.setValue(u+(a||1),v,w)},hide:function(b){if(A){b=a.Event(),b.type="onHide",C.trigger(b),a(document).unbind("click.d").unbind("keydown.d");if(b.isDefaultPrevented())return;p.hide(),A=!1}return h},getConf:function(){return g},getInput:function(){return c},getCalendar:function(){return p},getValue:function(a){return a?j(x,a,g.lang):x},isOpen:function(){return A}}),a.each(["onBeforeShow","onShow","change","onHide"],function(b,c){a.isFunction(g[c])&&a(h).bind(c,g[c]),h[c]=function(b){return b&&a(h).bind(c,b),h}}),c.bind("focus click",h.show).keydown(function(b){var c=b.keyCode;return!A&&a(d).index(c)>=0?(h.show(b),b.preventDefault()):b.shiftKey||b.ctrlKey||b.altKey||c==9?!0:b.preventDefault()}),m(c.val())&&I(x,g)}a.tools=a.tools||{version:"1.2.5"};var b=[],c,d=[75,76,38,39,74,72,40,37],e={};c=a.tools.dateinput={conf:{format:"mm/dd/yy",selectors:!1,yearRange:[-5,5],lang:"en",offset:[0,0],speed:0,firstDay:0,min:undefined,max:undefined,trigger:!1,css:{prefix:"cal",input:"date",root:0,head:0,title:0,prev:0,next:0,month:0,year:0,days:0,body:0,weeks:0,today:0,current:0,week:0,off:0,sunday:0,focus:0,disabled:0,trigger:0}},localize:function(b,c){a.each(c,function(a,b){c[a]=b.split(",")}),e[b]=c}},c.localize("en",{months:"January,February,March,April,May,June,July,August,September,October,November,December",shortMonths:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",days:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday",shortDays:"S,M,T,W,T,F,S"});var h=/d{1,4}|m{1,4}|yy(?:yy)?|"[^"]*"|'[^']*'/g,i=a("<a/>");a.expr[":"].date=function(b){var c=b.getAttribute("type");return c&&c=="date"||!!a(b).data("dateinput")},a.fn.dateinput=function(d){if(this.data("dateinput"))return this;d=a.extend(!0,{},c.conf,d),a.each(d.css,function(a,b){!b&&a!="prefix"&&(d.css[a]=(d.css.prefix||"")+(b||a))});var e;return this.each(function(){var c=new n(a(this),d);b.push(c);var f=c.getInput().data("dateinput",c);e=e?e.add(f):f}),e?e:this}}(jQuery),function(a){a.fn.visibility=function(a){return this.css("visibility",a),this}}(jQuery),function(a){a.createElement=function(b){return a(document.createElement(b))}}(jQuery),function(a){function b(a,b){return typeof a=="function"?a.call(b):a}function c(b,c){this.$element=a(b),this.options=c,this.enabled=!0,this.fixTitle()}c.prototype={show:function(){var c=this.getTitle(),d=this,e;if(c&&this.enabled){var f=this.tip();f.find(".tipsy-inner")[this.options.html?"html":"text"](c),f[0].className="tipsy",f.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body);var g=a.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight}),h=f[0].offsetWidth,i=f[0].offsetHeight,j=b(this.options.gravity,this.$element[0]),k;switch(j.charAt(0)){case"n":k={top:g.top+g.height+this.options.offset,left:g.left+g.width/2-h/2};break;case"s":k={top:g.top-i-this.options.offset,left:g.left+g.width/2-h/2};break;case"e":k={top:g.top+g.height/2-i/2,left:g.left-h-this.options.offset};break;case"w":k={top:g.top+g.height/2-i/2,left:g.left+g.width+this.options.offset}}j.length==2&&(j.charAt(1)=="w"?k.left=g.left+g.width/2-15:k.left=g.left+g.width/2-h+15),f.css(k).addClass("tipsy-"+j),f.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+j.charAt(0),this.options.className&&f.addClass(b(this.options.className,this.$element[0])),this.options.fade?f.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):f.css({visibility:"visible",opacity:this.options.opacity}),e=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,typeof e=="function"?(this.elementMutationObserver=new e(function(b){b.forEach(function(b){a(b.removedNodes).find(d.$element[0])&&d.hide()})}),this.elementMutationObserver.observe(document,{childList:!0,subtree:!0})):this.elementRemovalInterval||(this.elementRemovalInterval=window.setInterval(function(){d.$element.closest("html").length===0&&(d.hide(),window.clearInterval(d.elementRemovalInterval))},500))}},hide:function(){this.elementMutationObserver?this.elementMutationObserver.disconnect():window.clearInterval(this.elementRemovalInterval),this.options.fade?this.tip().stop().fadeOut(function(){a(this).remove()}):this.tip().remove()},fixTitle:function(){var a=this.$element;(a.attr("title")||typeof a.attr("original-title")!="string")&&a.attr("original-title",a.attr("title")||"").removeAttr("title")},getTitle:function(){var a,b=this.$element,c=this.options;this.fixTitle();var a,c=this.options;return typeof c.title=="string"?a=b.attr(c.title=="title"?"original-title":c.title):typeof c.title=="function"&&(a=c.title.call(b[0])),a=(""+a).replace(/(^\s*|\s*$)/,""),a||c.fallback},tip:function(){return this.$tip||(this.$tip=a('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>')),this.$tip},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}},a.fn.tipsy=function(b){function e(d){var e=a.data(d,"tipsy");return e||(e=new c(d,a.fn.tipsy.elementOptions(d,b)),a.data(d,"tipsy",e)),e}function f(){var a=e(this);a.hoverState="in",b.delayIn==0?a.show():(a.fixTitle(),setTimeout(function(){a.hoverState=="in"&&a.show()},b.delayIn))}function g(){var a=e(this);a.hoverState="out",b.delayOut==0?a.hide():setTimeout(function(){a.hoverState=="out"&&a.hide()},b.delayOut)}if(b===!0)return this.data("tipsy");if(typeof b=="string"){var d=this.data("tipsy");return d&&d[b](),this}b=a.extend({},a.fn.tipsy.defaults,b),b.live||this.each(function(){e(this)});if(b.trigger!="manual"){var h=b.live?"live":"bind",i=b.trigger=="hover"?"mouseenter":"focus",j=b.trigger=="hover"?"mouseleave":"blur";this[h](i,f)[h](j,g)}return this},a.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:1,title:"title",trigger:"hover"},a.fn.tipsy.elementOptions=function(b,c){return a.metadata?a.extend({},c,a(b).metadata()):c},a.fn.tipsy.autoNS=function(){return a(this).offset().top>a(document).scrollTop()+a(window).height()/2?"s":"n"},a.fn.tipsy.autoWE=function(){return a(this).offset().left>a(document).scrollLeft()+a(window).width()/2?"e":"w"},a.fn.tipsy.autoBounds=function(b,c){return function(){var d={ns:c[0],ew:c.length>1?c[1]:!1},e=a(document).scrollTop()+b,f=a(document).scrollLeft()+b,g=a(this);return g.offset().top<e&&(d.ns="n"),g.offset().left<f&&(d.ew="w"),a(window).width()+a(document).scrollLeft()-g.offset().left<b&&(d.ew="e"),a(window).height()+a(document).scrollTop()-g.offset().top<b&&(d.ns="s"),d.ns+(d.ew?d.ew:"")}}}(jQuery),jQuery.easing.jswing=jQuery.easing.swing,jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(a,b,c,d,e){return jQuery.easing[jQuery.easing.def](a,b,c,d,e)},easeInQuad:function(a,b,c,d,e){return d*(b/=e)*b+c},easeOutQuad:function(a,b,c,d,e){return-d*(b/=e)*(b-2)+c},easeInOutQuad:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b+c:-d/2*(--b*(b-2)-1)+c},easeInCubic:function(a,b,c,d,e){return d*(b/=e)*b*b+c},easeOutCubic:function(a,b,c,d,e){return d*((b=b/e-1)*b*b+1)+c},easeInOutCubic:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b+c:d/2*((b-=2)*b*b+2)+c},easeInQuart:function(a,b,c,d,e){return d*(b/=e)*b*b*b+c},easeOutQuart:function(a,b,c,d,e){return-d*((b=b/e-1)*b*b*b-1)+c},easeInOutQuart:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b*b+c:-d/2*((b-=2)*b*b*b-2)+c},easeInQuint:function(a,b,c,d,e){return d*(b/=e)*b*b*b*b+c},easeOutQuint:function(a,b,c,d,e){return d*((b=b/e-1)*b*b*b*b+1)+c},easeInOutQuint:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b*b*b+c:d/2*((b-=2)*b*b*b*b+2)+c},easeInSine:function(a,b,c,d,e){return-d*Math.cos(b/e*(Math.PI/2))+d+c},easeOutSine:function(a,b,c,d,e){return d*Math.sin(b/e*(Math.PI/2))+c},easeInOutSine:function(a,b,c,d,e){return-d/2*(Math.cos(Math.PI*b/e)-1)+c},easeInExpo:function(a,b,c,d,e){return b==0?c:d*Math.pow(2,10*(b/e-1))+c},easeOutExpo:function(a,b,c,d,e){return b==e?c+d:d*(-Math.pow(2,-10*b/e)+1)+c},easeInOutExpo:function(a,b,c,d,e){return b==0?c:b==e?c+d:(b/=e/2)<1?d/2*Math.pow(2,10*(b-1))+c:d/2*(-Math.pow(2,-10*--b)+2)+c},easeInCirc:function(a,b,c,d,e){return-d*(Math.sqrt(1-(b/=e)*b)-1)+c},easeOutCirc:function(a,b,c,d,e){return d*Math.sqrt(1-(b=b/e-1)*b)+c},easeInOutCirc:function(a,b,c,d,e){return(b/=e/2)<1?-d/2*(Math.sqrt(1-b*b)-1)+c:d/2*(Math.sqrt(1-(b-=2)*b)+1)+c},easeInElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e)==1)return c+d;g||(g=e*.3);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return-(h*Math.pow(2,10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g))+c},easeOutElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e)==1)return c+d;g||(g=e*.3);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return h*Math.pow(2,-10*b)*Math.sin((b*e-f)*2*Math.PI/g)+d+c},easeInOutElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e/2)==2)return c+d;g||(g=e*.3*1.5);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return b<1?-0.5*h*Math.pow(2,10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g)+c:h*Math.pow(2,-10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g)*.5+d+c},easeInBack:function(a,b,c,d,e,f){return f==undefined&&(f=1.70158),d*(b/=e)*b*((f+1)*b-f)+c},easeOutBack:function(a,b,c,d,e,f){return f==undefined&&(f=1.70158),d*((b=b/e-1)*b*((f+1)*b+f)+1)+c},easeInOutBack:function(a,b,c,d,e,f){return f==undefined&&(f=1.70158),(b/=e/2)<1?d/2*b*b*(((f*=1.525)+1)*b-f)+c:d/2*((b-=2)*b*(((f*=1.525)+1)*b+f)+2)+c},easeInBounce:function(a,b,c,d,e){return d-jQuery.easing.easeOutBounce(a,e-b,0,d,e)+c},easeOutBounce:function(a,b,c,d,e){return(b/=e)<1/2.75?d*7.5625*b*b+c:b<2/2.75?d*(7.5625*(b-=1.5/2.75)*b+.75)+c:b<2.5/2.75?d*(7.5625*(b-=2.25/2.75)*b+.9375)+c:d*(7.5625*(b-=2.625/2.75)*b+.984375)+c},easeInOutBounce:function(a,b,c,d,e){return b<e/2?jQuery.easing.easeInBounce(a,b*2,0,d,e)*.5+c:jQuery.easing.easeOutBounce(a,b*2-e,0,d,e)*.5+d*.5+c}}),function(a){a.fn.draggable=function(b){var c={translateY:!0,translateX:!0,boundary:"body"};a(this).each(function(){function l(){if(!f||f.length===0)typeof d.boundary=="function"?f=d.boundary():f=a(d.boundary)}function m(){return f[0].scrollHeight}function n(){return f[0].scrollWidth}function o(a,b,c){var d,g,h,i,j,k,l,o,p,q,r,s,t,u,v;c==="x"?(b=b.x,i=e.outerWidth(),d=e.offset().left,j=f.offset().left,k=f.outerWidth(),o=a.pageX<d,p=a.pageX>d+i,u="left",v=n()):(b=b.y,i=e.outerHeight(),d=e.offset().top,j=f.offset().top,k=f.outerHeight(),o=a.pageY<d,p=a.pageY>d+i,u="top",v=m()),s=b>0,t=b<0,g=parseInt(e.css(u),10),q=d<j,h=g+i,r=d+i>j+k,o&&s||p&&t||q&&t||r&&s||(t?g+b<0?l=0:l=g+b:h+b>v?l=v-i-1:l=g+b,e.css(u,l))}function p(a){var b={y:a.pageY-i,x:a.pageX-j},c=!1;i=a.pageY,j=a.pageX,a.preventDefault(),d.translateY&&(o(a,b,"y"),c=!0),d.translateX&&(o(a,b,"x"),c=!0),c&&e.trigger("drag.draggable",[b,{y:a.pageY,x:a.pageX}])}function q(){a(document).unbind("mousemove",r).unbind("mousemove",p).unbind("mouseup",q),k&&e.trigger("drop.draggable").removeClass("draggable-dragging"),k=!1}function r(b){k=!0,a(document).unbind("mousemove",r).bind("mousemove",p),i=b.pageY,j=b.pageX,l(),g=m(),h=n(),e.trigger("start.draggable",[b.offsetY,b.offsetX]).addClass("draggable-dragging")}function s(b){b.preventDefault(),a(document).bind("mousemove",r).bind("mouseup",q)}var d,e=a(this),f,g,h,i,j,k=!1;e.data("draggable")?d=a.extend({},e.data("draggable").settings,b):d=a.extend({},c,b),d.$handle=d.handle?a(d.handle,this):e,e.data("draggable",{settings:d}),d.$handle.unbind("mousedown",s).bind("mousedown",s)})}}(jQuery),function(a){var b=function(b){function l(){var b=a(this).position().top+f.scrollTop(),c=a(this).innerWidth();d.unshift(b),a(this).css({position:"absolute",top:b,width:c})}function m(e){d=[],a.fn.reverse=[].reverse,g=function(){var b=0;return f.children().each(function(){b+=a(this).outerHeight()}),b}(),f.append(a("<"+b.tagName+"/>",{"class":"placeholder",height:g})),f.css("z-index",2).find(".draggable").each(function(b){a(this).data("draggable-index",b)}).reverse().each(l),c=a(e.target),c.css({"z-index":10})}function n(a,b){var e=c.data("draggable-index"),f=a.data("draggable-index"),g,h=a.outerHeight()-c.outerHeight();b==="up"?g=d[e]-h:(g=d[e],d[f]=g+a.outerHeight()),a.stop().animate({top:g},"fast"),c.data("draggable-index",f),a.data("draggable-index",e)}function o(a){var b,d=c.position().top,e=c.outerHeight(),f,g;a===h?b=c.prev(".draggable"):b=c.next(".draggable"),b.length&&(f=b.position().top,g=b.outerHeight(),a===h?d<f+g/2&&(c.insertBefore(b),n(b,a)):d+e>f+g/2&&(c.insertAfter(b),n(b,a)))}function p(a){var b=a===i?j:-j,d=f.scrollTop(),e=parseInt(c.css("top"),10),h=e+c.outerHeight();d+b<0?r():d+b>g-f.innerHeight()?r():(f.scrollTop(f.scrollTop()+b),e+b>0&&h+b<g&&c.css({top:e+b}),o(a))}function q(a){r(),e=setInterval(_.bind(p,this,a),k)}function r(){clearInterval(e),e=null}function s(a,b,d){if(c){var g,j=parseInt(c.css("top"),10),k=j+c.outerHeight(),l=f.scrollTop()+f.innerHeight(),m;if(b){g=b.y<0?h:i,m=b.y;while(m<0)o(g),m+=c.outerHeight();m=b.y;while(m>0)o(g),m-=c.outerHeight()}d?(d.y>f.offset().top||d.y<f.offset().top+f.outerHeight())&&r():r(),e||(k>l?q(i):j<f.scrollTop()?q(h):r())}}function t(){f.css("height","auto").find(".placeholder").remove().end().find(".draggable").attr("style","")}function u(){r(),c.animate({top:d[c.data("draggable-index")]},"fast",t),c.trigger("drop.dragdroplist")}var c,d,e,f=b.$boundary,g,h="up",i="down",j=8,k=30;return{handleDragStart:m,handleDrop:u,handleDrag:s}};a.fn.dragdroplist=function(c){var d={orientation:"vertical",tagName:"li"};return a(this).each(function(){var e,f;a(this).data("dragdroplist")||(e=a.extend({},d,c),e.$boundary=a(this),a(this).data("dragdroplist",{settings:e}),f=new b(e),a(this).find(e.tagName).draggable({translateX:e.orientation==="horizontal",translateY:e.orientation==="vertical",handle:e.handle?e.handle:e.tagName,boundary:e.$boundary}),a(this).bind("start.draggable",f.handleDragStart).bind("drop.draggable",f.handleDrop).bind("drag.draggable",f.handleDrag))}),a(this)}}(jQuery),function(a){a.embedly=a.embedly||{};if(a.embedly.version)return;a.embedly.version="2.0.0",a.extend({embedly:function(b,c,d){var e=[],f={maxWidth:null,maxHeight:null,wmode:"opaque",method:"replace",addImageStyles:!0,wrapElement:"div",className:"embed",urlRe:null,key:null,elems:[],success:null},g;typeof c!="undefined"?g=a.extend(f,c):g=f,typeof b=="string"&&(b=new Array(b)),typeof d!="undefined"&&(g.success=d),g.success==null&&(g.success=function(b,c){var d,e=a(c.node);if(!b)return null;if((d=g.method)==="replace")return e.replaceWith(b.code);if(d==="after")return e.after(b.code);if(d==="afterParent")return e.parent().after(b.code)});var h=function(a){return a.match(g.urlRe)!==null},j=function(a){var b="urls="+a;return g.maxWidth!=null?b+="&maxwidth="+g.maxWidth:typeof dimensions!="undefined"&&(b+="&maxwidth="+dimensions.width),g.maxHeight!=null&&(b+="&maxheight="+g.maxHeight),b+="&wmode="+g.wmode,typeof g.key=="string"&&(b+="&key="+g.key),b},k=function(){return typeof g.key=="string"?"http://pro.embedly.com/1/oembed":"http://api.embed.ly/1/oembed"},l=function(b,c){var d,e,f,h,i;return(d=b.type)==="photo"?(h=b.title||"",f=[],g.addImageStyles&&(g.maxWidth&&(units=typeof g.maxWidth=="number"?"px":"",f.push("max-width: "+g.maxWidth+units)),g.maxHeight&&(units=typeof g.maxHeight=="number"?"px":"",f.push("max-height: "+g.maxHeight+units))),f=f.join(";"),i={textUrl:c.url,url:b.url},e=TD.ui.template.render("status/tweet_detail_mediaembed",i)):d==="video"?e=b.html:d==="rich"?e=b.html:(h=b.title||c.url,thumb=b.thumbnail_url?'<img src="'+b.thumbnail_url+'" class="thumb" />':"",description=b.description,provider=b.provider_name?'<a href="'+b.provider_url+'" class="provider">'+b.provider_name+"</a> - ":"",e=thumb+"<a href='"+c.url+"'>"+h+"</a>",e+=provider,e+=description),g.wrapElement&&(e="<"+g.wrapElement+' class="'+g.className+'">'+e+"</"+g.wrapElement+">"),b.code=e,typeof c.node!="undefined"&&a(c.node).data("oembed",b).trigger("embedly-oembed",[b]),g.success(b,c)},m=function(b){var c,d,e,f;e=a.map(b,function(b,c){return c==0&&b.node!==null&&(node=a(b.node),f={width:node.parent().width(),height:node.parent().height()}),encodeURIComponent(b.url)}).join(","),a.ajax({url:k(),dataType:"jsonp",data:j(e),success:function(c){return a.each(c,function(a,c){return c.type!="error"?l(c,b[a]):null})}})};a.each(b,function(b,c){return node=typeof g.elems!="undefined"?g.elems[b]:null,typeof node!="undefined"&&!h(c)&&!g.key&&a(node).data("oembed",!1),c&&(h(c)||g.key)?e.push({url:c,node:node}):null});var n=[],o=e.length;for(i=0;0<=o?i<o:i>o;i+=20)n=n.concat(m(e.slice(i,i+20)));return g.elems?g.elems:this}})}($),this.JSON||(this.JSON={}),function(){function f(a){return a<10?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i=="object"&&typeof i.toJSON=="function"&&(i=i.toJSON(a)),typeof rep=="function"&&(i=rep.call(b,a,i));switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";gap+=indent,h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1)h[c]=str(c,i)||"null";return e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g,e}if(rep&&typeof rep=="object"){f=rep.length;for(c=0;c<f;c+=1)d=rep[c],typeof d=="string"&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e))}else for(d in i)Object.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));return e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g,e}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(a,b,c){var d;gap="",indent="";if(typeof c=="number")for(d=0;d<c;d+=1)indent+=" ";else typeof c=="string"&&(indent=c);rep=b;if(!b||typeof b=="function"||typeof b=="object"&&typeof b.length=="number")return str("",{"":a});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e=="object")for(c in e)Object.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),window.FB||(FB={_apiKey:null,_session:null,_userStatus:"unknown",_logging:!0,_inCanvas:window.location.search.indexOf("fb_sig_in_iframe=1")>-1||window.location.search.indexOf("session=")>-1,_domain:{api:"https://api.facebook.com/",api_read:"https://api-read.facebook.com/",cdn:window.location.protocol=="https:"?"https://s-static.ak.fbcdn.net/":"http://static.ak.fbcdn.net/",graph:"https://graph.facebook.com/",staticfb:"http://static.ak.facebook.com/",www:window.location.protocol+"//www.facebook.com/"},_locale:null,_localeIsRtl:!1,copy:function(a,b,c,d){for(var e in b)if(c||typeof a[e]=="undefined")a[e]=d?d(b[e]):b[e];return a},create:function(a,b){var c=window.FB,d=a?a.split("."):[],e=d.length;for(var f=0;f<e;f++){var g=d[f],h=c[g];h||(h=b&&f+1==e?b:{},c[g]=h),c=h}return c},provide:function(a,b,c){return FB.copy(typeof a=="string"?FB.create(a):a,b,c)},guid:function(){return"f"+(Math.random()*(1<<30)).toString(16).replace(".","")},log:function(a){FB._logging&&(window.Debug&&window.Debug.writeln?window.Debug.writeln(a):window.console&&window.console.log(a)),FB.Event&&FB.Event.fire("fb.log",a)},$:function(a){return document.getElementById(a)}}),FB.provide("",{api:function(){typeof arguments[0]=="string"?FB.ApiServer.graph.apply(FB.ApiServer,arguments):FB.ApiServer.rest.apply(FB.ApiServer,arguments)}}),FB.provide("ApiServer",{METHODS:["get","post","delete","put"],_callbacks:{},_readOnlyCalls:{fql_query:!0,fql_multiquery:!0,friends_get:!0,notifications_get:!0,stream_get:!0,users_getinfo:!0},graph:function(){var a=Array.prototype.slice.call(arguments),b=a.shift(),c=a.shift(),d,e,f;while(c){var g=typeof c;if(g==="string"&&!d)d=c.toLowerCase();else if(g==="function"&&!f)f=c;else if(g==="object"&&!e)e=c;else{FB.log("Invalid argument passed to FB.api(): "+c);return}c=a.shift()}d=d||"get",e=e||{},b[0]==="/"&&(b=b.substr(1));if(FB.Array.indexOf(FB.ApiServer.METHODS,d)<0){FB.log("Invalid method passed to FB.api(): "+d);return}FB.ApiServer.oauthRequest("graph",b,d,e,f)},rest:function(a,b){var c=a.method.toLowerCase().replace(".","_");if(FB.Auth&&c==="auth_revokeauthorization"){var d=b;b=function(a){a===!0&&FB.Auth.setSession(null,"notConnected"),d&&d(a)}}a.format="json-strings",a.api_key=FB._apiKey;var e=FB.ApiServer._readOnlyCalls[c]?"api_read":"api";FB.ApiServer.oauthRequest(e,"restserver.php","get",a,b)},oauthRequest:function(a,b,c,d,e){FB._session&&FB._session.access_token&&!d.access_token&&(d.access_token=FB._session.access_token),d.sdk="joey";try{FB.ApiServer.jsonp(a,b,c,FB.JSON.flatten(d),e)}catch(f){if(FB.Flash.hasMinVersion())FB.ApiServer.flash(a,b,c,FB.JSON.flatten(d),e);else throw new Error("Flash is required for this API call.")}},jsonp:function(a,b,c,d,e){var f=FB.guid(),g=document.createElement("script");a==="graph"&&c!=="get"&&(d.method=c),d.callback="FB.ApiServer._callbacks."+f;var h=FB._domain[a]+b+(b.indexOf("?")>-1?"&":"?")+FB.QS.encode(d);if(h.length>2e3)throw new Error("JSONP only support a maximum of 2000 bytes of input.");FB.ApiServer._callbacks[f]=function(a){e&&e(a),delete FB.ApiServer._callbacks[f],g.parentNode.removeChild(g)},g.src=h,document.getElementsByTagName("head")[0].appendChild(g)},flash:function(a,b,c,d,e){window.FB_OnXdHttpResult||(window.FB_OnXdHttpResult=function(a,b){FB.ApiServer._callbacks[a](decodeURIComponent(b))}),FB.Flash.onReady(function(){var f=FB._domain[a]+b,g=FB.QS.encode(d);c==="get"?f.length+g.length>2e3?(a==="graph"&&(d.method="get"),c="post",g=FB.QS.encode(d)):(f+=(f.indexOf("?")>-1?"&":"?")+g,g=""):c!=="post"&&(a==="graph"&&(d.method=c),c="post",g=FB.QS.encode(d));var h=document.XdComm.sendXdHttpRequest(c.toUpperCase(),f,g,null);FB.ApiServer._callbacks[h]=function(a){e&&e(FB.JSON.parse(a)),delete FB.ApiServer._callbacks[h]}})}}),FB.provide("Content",{_root:null,_hiddenRoot:null,_callbacks:{},append:function(a,b){if(!b)if(!FB.Content._root){FB.Content._root=b=FB.$("fb-root");if(!b){FB.log('The "fb-root" div has not been created.');return}b.className+=" fb_reset"}else b=FB.Content._root;if(typeof a=="string"){var c=document.createElement("div");return b.appendChild(c).innerHTML=a,c}return b.appendChild(a)},appendHidden:function(a){if(!FB.Content._hiddenRoot){var b=document.createElement("div"),c=b.style;c.position="absolute",c.top="-10000px",c.width=c.height=0,FB.Content._hiddenRoot=FB.Content.append(b)}return FB.Content.append(a,FB.Content._hiddenRoot)},insertIframe:function(a){a.id=a.id||FB.guid(),a.name=a.name||FB.guid();var b=FB.guid(),c=!1,d=!1;FB.Content._callbacks[b]=function(){c&&!d&&(d=!0,a.onload&&a.onload(a.root.firstChild))};if(document.attachEvent){var e='<iframe id="'+a.id+'"'+' name="'+a.name+'"'+(a.className?' class="'+a.className+'"':"")+' style="border:none;'+(a.width?"width:"+a.width+"px;":"")+(a.height?"height:"+a.height+"px;":"")+'"'+' src="'+a.url+'"'+' frameborder="0"'+' scrolling="no"'+' allowtransparency="true"'+' onload="FB.Content._callbacks.'+b+'()"'+"></iframe>";a.root.innerHTML='<iframe src="javascript:false" frameborder="0" scrolling="no" style="height:1px"></iframe>',c=!0,window.setTimeout(function(){a.root.innerHTML=e},0)}else{var f=document.createElement("iframe");f.id=a.id,f.name=a.name,f.onload=FB.Content._callbacks[b],f.style.border="none",f.style.overflow="hidden",a.className&&(f.className=a.className),a.height&&(f.style.height=a.height+"px"),a.width&&(f.style.width=a.width+"px"),a.root.appendChild(f),c=!0,f.src=a.url}},postTarget:function(a){var b=document.createElement("form");b.action=a.url,b.target=a.target,b.method="POST",FB.Content.appendHidden(b),FB.Array.forEach(a.params,function(a,c){if(a!==null&&a!==undefined){var d=document.createElement("input");d.name=c,d.value=a,b.appendChild(d)}}),b.submit(),b.parentNode.removeChild(b)}}),FB.provide("Flash",{_minVersions:[[9,0,159,0],[10,0,22,87]],_swfPath:"swf/XdComm.swf",_callbacks:[],init:function(){if(FB.Flash._init)return;FB.Flash._init=!0,window.FB_OnFlashXdCommReady=function(){FB.Flash._ready=!0;for(var a=0,b=FB.Flash._callbacks.length;a<b;a++)FB.Flash._callbacks[a]();FB.Flash._callbacks=[]};var a=!!document.attachEvent,b=FB._domain.cdn+FB.Flash._swfPath,c='<object type="application/x-shockwave-flash" id="XdComm" '+(a?'name="XdComm" ':"")+(a?"":'data="'+b+'" ')+(a?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ':"")+'allowscriptaccess="always">'+'<param name="movie" value="'+b+'"></param>'+'<param name="allowscriptaccess" value="always"></param>'+"</object>";FB.Content.appendHidden(c)},hasMinVersion:function(){if(typeof FB.Flash._hasMinVersion=="undefined"){var a,b,c,d=[];try{a=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(e){if(navigator.mimeTypes.length>0){var f="application/x-shockwave-flash";if(navigator.mimeTypes[f].enabledPlugin){var g="Shockwave Flash";a=(navigator.plugins[g+" 2.0"]||navigator.plugins[g]).description}}}if(a){var h=a.replace(/\D+/g,",").match(/^,?(.+),?$/)[1].split(",");for(b=0,c=h.length;b<c;b++)d.push(parseInt(h[b],10))}FB.Flash._hasMinVersion=!1;i:for(b=0,c=FB.Flash._minVersions.length;b<c;b++){var j=FB.Flash._minVersions[b];if(j[0]!=d[0])continue;for(var k=1,l=j.length,m=d.length;k<l&&k<m;k++){if(d[k]<j[k]){FB.Flash._hasMinVersion=!1;continue i}FB.Flash._hasMinVersion=!0;if(d[k]>j[k])break i}}}return FB.Flash._hasMinVersion},onReady:function(a){FB.Flash.init(),FB.Flash._ready?window.setTimeout(a,0):FB.Flash._callbacks.push(a)}}),FB.provide("JSON",{stringify:function(a){return window.Prototype&&Object.toJSON?Object.toJSON(a):JSON.stringify(a)},parse:function(a){return JSON.parse(a)},flatten:function(a){var b={};for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];if(null===d||undefined===d)continue;typeof d=="string"?b[c]=d:b[c]=FB.JSON.stringify(d)}return b}}),FB.provide("QS",{encode:function(a,b,c){b=b===undefined?"&":b,c=c===!1?function(a){return a}:encodeURIComponent;var d=[];return FB.Array.forEach(a,function(a,b){a!==null&&typeof a!="undefined"&&d.push(c(b)+"="+c(a))}),d.sort(),d.join(b)},decode:function(a){var b=decodeURIComponent,c={},d=a.split("&"),e,f;for(e=0;e<d.length;e++)f=d[e].split("=",2),f&&f[0]&&(c[b(f[0])]=b(f[1]));return c}}),FB.provide("Array",{indexOf:function(a,b){if(a.indexOf)return a.indexOf(b);var c=a.length;if(c)for(var d=0;d<c;d++)if(a[d]===b)return d;return-1},merge:function(a,b){for(var c=0;c<b.length;c++)FB.Array.indexOf(a,b[c])<0&&a.push(b[c]);return a},filter:function(a,b){var c=[];for(var d=0;d<a.length;d++)b(a[d])&&c.push(a[d]);return c},keys:function(a,b){var c=[];for(var d in a)(b||a.hasOwnProperty(d))&&c.push(d);return c},map:function(a,b){var c=[];for(var d=0;d<a.length;d++)c.push(b(a[d]));return c},forEach:function(a,b,c){if(!a)return;if(Object.prototype.toString.apply(a)!=="[object Array]"&&(a instanceof Function||typeof a.length!="number"))for(var f in a)(c||a.hasOwnProperty(f))&&b(a[f],f,a);else if(a.forEach)a.forEach(b);else for(var d=0,e=a.length;d<e;d++)b(a[d],d,a)}}),TD.debug=function(){var a={};return a.spoof_data=null,a}();